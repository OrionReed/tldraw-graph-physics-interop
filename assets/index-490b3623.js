var Vpe=Object.defineProperty;var Hpe=(Rs,Ce,Jn)=>Ce in Rs?Vpe(Rs,Ce,{enumerable:!0,configurable:!0,writable:!0,value:Jn}):Rs[Ce]=Jn;var w=(Rs,Ce,Jn)=>(Hpe(Rs,typeof Ce!="symbol"?Ce+"":Ce,Jn),Jn);(async()=>{var Sx,xx,_x,kx,Cx,Px,Ex,Ix,Mx,Tx,Ax,jx,Rx,Ox,Dx,Lx,zx,Nx,Fx,$x;function Rs(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();var Ce=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Jn(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zx={exports:{}},ch={},Jx={exports:{}},Ee={},bc=Symbol.for("react.element"),V4=Symbol.for("react.portal"),H4=Symbol.for("react.fragment"),W4=Symbol.for("react.strict_mode"),K4=Symbol.for("react.profiler"),G4=Symbol.for("react.provider"),Y4=Symbol.for("react.context"),X4=Symbol.for("react.forward_ref"),q4=Symbol.for("react.suspense"),Z4=Symbol.for("react.memo"),J4=Symbol.for("react.lazy"),Qx=Symbol.iterator;function Q4(n){return n===null||typeof n!="object"?null:(n=Qx&&n[Qx]||n["@@iterator"],typeof n=="function"?n:null)}var e_={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t_=Object.assign,n_={};function Ma(n,e,t){this.props=n,this.context=e,this.refs=n_,this.updater=t||e_}Ma.prototype.isReactComponent={},Ma.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},Ma.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function r_(){}r_.prototype=Ma.prototype;function oy(n,e,t){this.props=n,this.context=e,this.refs=n_,this.updater=t||e_}var sy=oy.prototype=new r_;sy.constructor=oy,t_(sy,Ma.prototype),sy.isPureReactComponent=!0;var i_=Array.isArray,o_=Object.prototype.hasOwnProperty,ay={current:null},s_={key:!0,ref:!0,__self:!0,__source:!0};function a_(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)o_.call(e,r)&&!s_.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:bc,type:n,key:o,ref:s,props:i,_owner:ay.current}}function e5(n,e){return{$$typeof:bc,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ly(n){return typeof n=="object"&&n!==null&&n.$$typeof===bc}function t5(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var l_=/\/+/g;function cy(n,e){return typeof n=="object"&&n!==null&&n.key!=null?t5(""+n.key):e.toString(36)}function uh(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case bc:case V4:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+cy(s,0):r,i_(i)?(t="",n!=null&&(t=n.replace(l_,"$&/")+"/"),uh(i,e,t,"",function(c){return c})):i!=null&&(ly(i)&&(i=e5(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(l_,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",i_(n))for(var a=0;a<n.length;a++){o=n[a];var l=r+cy(o,a);s+=uh(o,e,t,l,i)}else if(l=Q4(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=r+cy(o,a++),s+=uh(o,e,t,l,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function dh(n,e,t){if(n==null)return n;var r=[],i=0;return uh(n,r,"","",function(o){return e.call(t,o,i++)}),r}function n5(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var _n={current:null},hh={transition:null},r5={ReactCurrentDispatcher:_n,ReactCurrentBatchConfig:hh,ReactCurrentOwner:ay};Ee.Children={map:dh,forEach:function(n,e,t){dh(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return dh(n,function(){e++}),e},toArray:function(n){return dh(n,function(e){return e})||[]},only:function(n){if(!ly(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},Ee.Component=Ma,Ee.Fragment=H4,Ee.Profiler=K4,Ee.PureComponent=oy,Ee.StrictMode=W4,Ee.Suspense=q4,Ee.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=r5,Ee.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=t_({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=ay.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)o_.call(e,l)&&!s_.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:bc,type:n.type,key:i,ref:o,props:r,_owner:s}},Ee.createContext=function(n){return n={$$typeof:Y4,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:G4,_context:n},n.Consumer=n},Ee.createElement=a_,Ee.createFactory=function(n){var e=a_.bind(null,n);return e.type=n,e},Ee.createRef=function(){return{current:null}},Ee.forwardRef=function(n){return{$$typeof:X4,render:n}},Ee.isValidElement=ly,Ee.lazy=function(n){return{$$typeof:J4,_payload:{_status:-1,_result:n},_init:n5}},Ee.memo=function(n,e){return{$$typeof:Z4,type:n,compare:e===void 0?null:e}},Ee.startTransition=function(n){var e=hh.transition;hh.transition={};try{n()}finally{hh.transition=e}},Ee.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},Ee.useCallback=function(n,e){return _n.current.useCallback(n,e)},Ee.useContext=function(n){return _n.current.useContext(n)},Ee.useDebugValue=function(){},Ee.useDeferredValue=function(n){return _n.current.useDeferredValue(n)},Ee.useEffect=function(n,e){return _n.current.useEffect(n,e)},Ee.useId=function(){return _n.current.useId()},Ee.useImperativeHandle=function(n,e,t){return _n.current.useImperativeHandle(n,e,t)},Ee.useInsertionEffect=function(n,e){return _n.current.useInsertionEffect(n,e)},Ee.useLayoutEffect=function(n,e){return _n.current.useLayoutEffect(n,e)},Ee.useMemo=function(n,e){return _n.current.useMemo(n,e)},Ee.useReducer=function(n,e,t){return _n.current.useReducer(n,e,t)},Ee.useRef=function(n){return _n.current.useRef(n)},Ee.useState=function(n){return _n.current.useState(n)},Ee.useSyncExternalStore=function(n,e,t){return _n.current.useSyncExternalStore(n,e,t)},Ee.useTransition=function(){return _n.current.useTransition()},Ee.version="18.2.0",Jx.exports=Ee;var S=Jx.exports;const oe=Jn(S),i5=Rs({__proto__:null,default:oe},[S]);var o5=S,s5=Symbol.for("react.element"),a5=Symbol.for("react.fragment"),l5=Object.prototype.hasOwnProperty,c5=o5.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u5={key:!0,ref:!0,__self:!0,__source:!0};function c_(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)l5.call(e,r)&&!u5.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:s5,type:n,key:o,ref:s,props:i,_owner:c5.current}}ch.Fragment=a5,ch.jsx=c_,ch.jsxs=c_,Zx.exports=ch;var y=Zx.exports,uy={},u_={exports:{}},Qn={},d_={exports:{}},h_={};(function(n){function e(G,L){var V=G.length;G.push(L);e:for(;0<V;){var J=V-1>>>1,le=G[J];if(0<i(le,L))G[J]=L,G[V]=le,V=J;else break e}}function t(G){return G.length===0?null:G[0]}function r(G){if(G.length===0)return null;var L=G[0],V=G.pop();if(V!==L){G[0]=V;e:for(var J=0,le=G.length,me=le>>>1;J<me;){var ve=2*(J+1)-1,fe=G[ve],Pe=ve+1,Rt=G[Pe];if(0>i(fe,V))Pe<le&&0>i(Rt,fe)?(G[J]=Rt,G[Pe]=V,J=Pe):(G[J]=fe,G[ve]=V,J=ve);else if(Pe<le&&0>i(Rt,V))G[J]=Rt,G[Pe]=V,J=Pe;else break e}}return L}function i(G,L){var V=G.sortIndex-L.sortIndex;return V!==0?V:G.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,d=null,h=3,p=!1,g=!1,f=!1,m=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(G){for(var L=t(c);L!==null;){if(L.callback===null)r(c);else if(L.startTime<=G)r(c),L.sortIndex=L.expirationTime,e(l,L);else break;L=t(c)}}function x(G){if(f=!1,_(G),!g)if(t(l)!==null)g=!0,$(C);else{var L=t(c);L!==null&&q(x,L.startTime-G)}}function C(G,L){g=!1,f&&(f=!1,v(I),I=-1),p=!0;var V=h;try{for(_(L),d=t(l);d!==null&&(!(d.expirationTime>L)||G&&!D());){var J=d.callback;if(typeof J=="function"){d.callback=null,h=d.priorityLevel;var le=J(d.expirationTime<=L);L=n.unstable_now(),typeof le=="function"?d.callback=le:d===t(l)&&r(l),_(L)}else r(l);d=t(l)}if(d!==null)var me=!0;else{var ve=t(c);ve!==null&&q(x,ve.startTime-L),me=!1}return me}finally{d=null,h=V,p=!1}}var k=!1,E=null,I=-1,T=5,A=-1;function D(){return!(n.unstable_now()-A<T)}function N(){if(E!==null){var G=n.unstable_now();A=G;var L=!0;try{L=E(!0,G)}finally{L?U():(k=!1,E=null)}}else k=!1}var U;if(typeof b=="function")U=function(){b(N)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,B=R.port2;R.port1.onmessage=N,U=function(){B.postMessage(null)}}else U=function(){m(N,0)};function $(G){E=G,k||(k=!0,U())}function q(G,L){I=m(function(){G(n.unstable_now())},L)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){g||p||(g=!0,$(C))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return h},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(h){case 1:case 2:case 3:var L=3;break;default:L=h}var V=h;h=L;try{return G()}finally{h=V}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,L){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var V=h;h=G;try{return L()}finally{h=V}},n.unstable_scheduleCallback=function(G,L,V){var J=n.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?J+V:J):V=J,G){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=V+le,G={id:u++,callback:L,priorityLevel:G,startTime:V,expirationTime:le,sortIndex:-1},V>J?(G.sortIndex=V,e(c,G),t(l)===null&&G===t(c)&&(f?(v(I),I=-1):f=!0,q(x,V-J))):(G.sortIndex=le,e(l,G),g||p||(g=!0,$(C))),G},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(G){var L=h;return function(){var V=h;h=L;try{return G.apply(this,arguments)}finally{h=V}}}})(h_),d_.exports=h_;var d5=d_.exports,p_=S,er=d5;function Q(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var f_=new Set,vc={};function Os(n,e){Ta(n,e),Ta(n+"Capture",e)}function Ta(n,e){for(vc[n]=e,n=0;n<e.length;n++)f_.add(e[n])}var Ki=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dy=Object.prototype.hasOwnProperty,h5=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g_={},m_={};function p5(n){return dy.call(m_,n)?!0:dy.call(g_,n)?!1:h5.test(n)?m_[n]=!0:(g_[n]=!0,!1)}function f5(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function g5(n,e,t,r){if(e===null||typeof e>"u"||f5(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function kn(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Wt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Wt[n]=new kn(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Wt[e]=new kn(e,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){Wt[n]=new kn(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Wt[n]=new kn(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Wt[n]=new kn(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){Wt[n]=new kn(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){Wt[n]=new kn(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){Wt[n]=new kn(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){Wt[n]=new kn(n,5,!1,n.toLowerCase(),null,!1,!1)});var hy=/[\-:]([a-z])/g;function py(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(hy,py);Wt[e]=new kn(e,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(hy,py);Wt[e]=new kn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(hy,py);Wt[e]=new kn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){Wt[n]=new kn(n,1,!1,n.toLowerCase(),null,!1,!1)}),Wt.xlinkHref=new kn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){Wt[n]=new kn(n,1,!1,n.toLowerCase(),null,!0,!0)});function fy(n,e,t,r){var i=Wt.hasOwnProperty(e)?Wt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(g5(e,t,i,r)&&(t=null),r||i===null?p5(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Gi=p_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ph=Symbol.for("react.element"),Aa=Symbol.for("react.portal"),ja=Symbol.for("react.fragment"),gy=Symbol.for("react.strict_mode"),my=Symbol.for("react.profiler"),y_=Symbol.for("react.provider"),w_=Symbol.for("react.context"),yy=Symbol.for("react.forward_ref"),wy=Symbol.for("react.suspense"),by=Symbol.for("react.suspense_list"),vy=Symbol.for("react.memo"),Do=Symbol.for("react.lazy"),b_=Symbol.for("react.offscreen"),v_=Symbol.iterator;function Sc(n){return n===null||typeof n!="object"?null:(n=v_&&n[v_]||n["@@iterator"],typeof n=="function"?n:null)}var ft=Object.assign,Sy;function xc(n){if(Sy===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Sy=e&&e[1]||""}return`
`+Sy+n}var xy=!1;function _y(n,e){if(!n||xy)return"";xy=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=a);break}}}finally{xy=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?xc(n):""}function m5(n){switch(n.tag){case 5:return xc(n.type);case 16:return xc("Lazy");case 13:return xc("Suspense");case 19:return xc("SuspenseList");case 0:case 2:case 15:return n=_y(n.type,!1),n;case 11:return n=_y(n.type.render,!1),n;case 1:return n=_y(n.type,!0),n;default:return""}}function ky(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case ja:return"Fragment";case Aa:return"Portal";case my:return"Profiler";case gy:return"StrictMode";case wy:return"Suspense";case by:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case w_:return(n.displayName||"Context")+".Consumer";case y_:return(n._context.displayName||"Context")+".Provider";case yy:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case vy:return e=n.displayName||null,e!==null?e:ky(n.type)||"Memo";case Do:e=n._payload,n=n._init;try{return ky(n(e))}catch{}}return null}function y5(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ky(e);case 8:return e===gy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Lo(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function S_(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function w5(n){var e=S_(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function fh(n){n._valueTracker||(n._valueTracker=w5(n))}function x_(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=S_(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function gh(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Cy(n,e){var t=e.checked;return ft({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function __(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Lo(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function k_(n,e){e=e.checked,e!=null&&fy(n,"checked",e,!1)}function Py(n,e){k_(n,e);var t=Lo(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Ey(n,e.type,t):e.hasOwnProperty("defaultValue")&&Ey(n,e.type,Lo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function C_(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Ey(n,e,t){(e!=="number"||gh(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var _c=Array.isArray;function Ra(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Lo(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Iy(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Q(91));return ft({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function P_(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Q(92));if(_c(t)){if(1<t.length)throw Error(Q(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Lo(t)}}function E_(n,e){var t=Lo(e.value),r=Lo(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function I_(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function M_(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function My(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?M_(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var mh,T_=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(mh=mh||document.createElement("div"),mh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function kc(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var Cc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},b5=["Webkit","ms","Moz","O"];Object.keys(Cc).forEach(function(n){b5.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),Cc[e]=Cc[n]})});function A_(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Cc.hasOwnProperty(n)&&Cc[n]?(""+e).trim():e+"px"}function j_(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=A_(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var v5=ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ty(n,e){if(e){if(v5[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Q(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Q(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Q(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Q(62))}}function Ay(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jy=null;function Ry(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Oy=null,Oa=null,Da=null;function R_(n){if(n=Gc(n)){if(typeof Oy!="function")throw Error(Q(280));var e=n.stateNode;e&&(e=Fh(e),Oy(n.stateNode,n.type,e))}}function O_(n){Oa?Da?Da.push(n):Da=[n]:Oa=n}function D_(){if(Oa){var n=Oa,e=Da;if(Da=Oa=null,R_(n),e)for(n=0;n<e.length;n++)R_(e[n])}}function L_(n,e){return n(e)}function z_(){}var Dy=!1;function N_(n,e,t){if(Dy)return n(e,t);Dy=!0;try{return L_(n,e,t)}finally{Dy=!1,(Oa!==null||Da!==null)&&(z_(),D_())}}function Pc(n,e){var t=n.stateNode;if(t===null)return null;var r=Fh(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Q(231,e,typeof t));return t}var Ly=!1;if(Ki)try{var Ec={};Object.defineProperty(Ec,"passive",{get:function(){Ly=!0}}),window.addEventListener("test",Ec,Ec),window.removeEventListener("test",Ec,Ec)}catch{Ly=!1}function S5(n,e,t,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var Ic=!1,yh=null,wh=!1,zy=null,x5={onError:function(n){Ic=!0,yh=n}};function _5(n,e,t,r,i,o,s,a,l){Ic=!1,yh=null,S5.apply(x5,arguments)}function k5(n,e,t,r,i,o,s,a,l){if(_5.apply(this,arguments),Ic){if(Ic){var c=yh;Ic=!1,yh=null}else throw Error(Q(198));wh||(wh=!0,zy=c)}}function Ds(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function F_(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function $_(n){if(Ds(n)!==n)throw Error(Q(188))}function C5(n){var e=n.alternate;if(!e){if(e=Ds(n),e===null)throw Error(Q(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return $_(i),n;if(o===r)return $_(i),e;o=o.sibling}throw Error(Q(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Q(189))}}if(t.alternate!==r)throw Error(Q(190))}if(t.tag!==3)throw Error(Q(188));return t.stateNode.current===t?n:e}function B_(n){return n=C5(n),n!==null?U_(n):null}function U_(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=U_(n);if(e!==null)return e;n=n.sibling}return null}var V_=er.unstable_scheduleCallback,H_=er.unstable_cancelCallback,P5=er.unstable_shouldYield,E5=er.unstable_requestPaint,Mt=er.unstable_now,I5=er.unstable_getCurrentPriorityLevel,Ny=er.unstable_ImmediatePriority,W_=er.unstable_UserBlockingPriority,bh=er.unstable_NormalPriority,M5=er.unstable_LowPriority,K_=er.unstable_IdlePriority,vh=null,yi=null;function T5(n){if(yi&&typeof yi.onCommitFiberRoot=="function")try{yi.onCommitFiberRoot(vh,n,void 0,(n.current.flags&128)===128)}catch{}}var Ur=Math.clz32?Math.clz32:R5,A5=Math.log,j5=Math.LN2;function R5(n){return n>>>=0,n===0?32:31-(A5(n)/j5|0)|0}var Sh=64,xh=4194304;function Mc(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function _h(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=Mc(a):(o&=s,o!==0&&(r=Mc(o)))}else s=t&~i,s!==0?r=Mc(s):o!==0&&(r=Mc(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Ur(e),i=1<<t,r|=n[t],e&=~i;return r}function O5(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function D5(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-Ur(o),a=1<<s,l=i[s];l===-1?(!(a&t)||a&r)&&(i[s]=O5(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function Fy(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function G_(){var n=Sh;return Sh<<=1,!(Sh&4194240)&&(Sh=64),n}function $y(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Tc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Ur(e),n[e]=t}function L5(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Ur(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function By(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Ur(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var He=0;function Y_(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var X_,Uy,q_,Z_,J_,Vy=!1,kh=[],zo=null,No=null,Fo=null,Ac=new Map,jc=new Map,$o=[],z5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Q_(n,e){switch(n){case"focusin":case"focusout":zo=null;break;case"dragenter":case"dragleave":No=null;break;case"mouseover":case"mouseout":Fo=null;break;case"pointerover":case"pointerout":Ac.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":jc.delete(e.pointerId)}}function Rc(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=Gc(e),e!==null&&Uy(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function N5(n,e,t,r,i){switch(e){case"focusin":return zo=Rc(zo,n,e,t,r,i),!0;case"dragenter":return No=Rc(No,n,e,t,r,i),!0;case"mouseover":return Fo=Rc(Fo,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return Ac.set(o,Rc(Ac.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,jc.set(o,Rc(jc.get(o)||null,n,e,t,r,i)),!0}return!1}function ek(n){var e=Ls(n.target);if(e!==null){var t=Ds(e);if(t!==null){if(e=t.tag,e===13){if(e=F_(t),e!==null){n.blockedOn=e,J_(n.priority,function(){q_(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ch(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Wy(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);jy=r,t.target.dispatchEvent(r),jy=null}else return e=Gc(t),e!==null&&Uy(e),n.blockedOn=t,!1;e.shift()}return!0}function tk(n,e,t){Ch(n)&&t.delete(e)}function F5(){Vy=!1,zo!==null&&Ch(zo)&&(zo=null),No!==null&&Ch(No)&&(No=null),Fo!==null&&Ch(Fo)&&(Fo=null),Ac.forEach(tk),jc.forEach(tk)}function Oc(n,e){n.blockedOn===e&&(n.blockedOn=null,Vy||(Vy=!0,er.unstable_scheduleCallback(er.unstable_NormalPriority,F5)))}function Dc(n){function e(i){return Oc(i,n)}if(0<kh.length){Oc(kh[0],n);for(var t=1;t<kh.length;t++){var r=kh[t];r.blockedOn===n&&(r.blockedOn=null)}}for(zo!==null&&Oc(zo,n),No!==null&&Oc(No,n),Fo!==null&&Oc(Fo,n),Ac.forEach(e),jc.forEach(e),t=0;t<$o.length;t++)r=$o[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<$o.length&&(t=$o[0],t.blockedOn===null);)ek(t),t.blockedOn===null&&$o.shift()}var La=Gi.ReactCurrentBatchConfig,Ph=!0;function $5(n,e,t,r){var i=He,o=La.transition;La.transition=null;try{He=1,Hy(n,e,t,r)}finally{He=i,La.transition=o}}function B5(n,e,t,r){var i=He,o=La.transition;La.transition=null;try{He=4,Hy(n,e,t,r)}finally{He=i,La.transition=o}}function Hy(n,e,t,r){if(Ph){var i=Wy(n,e,t,r);if(i===null)l0(n,e,r,Eh,t),Q_(n,r);else if(N5(i,n,e,t,r))r.stopPropagation();else if(Q_(n,r),e&4&&-1<z5.indexOf(n)){for(;i!==null;){var o=Gc(i);if(o!==null&&X_(o),o=Wy(n,e,t,r),o===null&&l0(n,e,r,Eh,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else l0(n,e,r,null,t)}}var Eh=null;function Wy(n,e,t,r){if(Eh=null,n=Ry(r),n=Ls(n),n!==null)if(e=Ds(n),e===null)n=null;else if(t=e.tag,t===13){if(n=F_(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Eh=n,null}function nk(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(I5()){case Ny:return 1;case W_:return 4;case bh:case M5:return 16;case K_:return 536870912;default:return 16}default:return 16}}var Bo=null,Ky=null,Ih=null;function rk(){if(Ih)return Ih;var n,e=Ky,t=e.length,r,i="value"in Bo?Bo.value:Bo.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return Ih=i.slice(n,1<r?1-r:void 0)}function Mh(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Th(){return!0}function ik(){return!1}function tr(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Th:ik,this.isPropagationStopped=ik,this}return ft(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Th)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Th)},persist:function(){},isPersistent:Th}),e}var za={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Gy=tr(za),Lc=ft({},za,{view:0,detail:0}),U5=tr(Lc),Yy,Xy,zc,Ah=ft({},Lc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zy,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==zc&&(zc&&n.type==="mousemove"?(Yy=n.screenX-zc.screenX,Xy=n.screenY-zc.screenY):Xy=Yy=0,zc=n),Yy)},movementY:function(n){return"movementY"in n?n.movementY:Xy}}),ok=tr(Ah),V5=ft({},Ah,{dataTransfer:0}),H5=tr(V5),W5=ft({},Lc,{relatedTarget:0}),qy=tr(W5),K5=ft({},za,{animationName:0,elapsedTime:0,pseudoElement:0}),G5=tr(K5),Y5=ft({},za,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),X5=tr(Y5),q5=ft({},za,{data:0}),sk=tr(q5),Z5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},J5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Q5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function eD(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=Q5[n])?!!e[n]:!1}function Zy(){return eD}var tD=ft({},Lc,{key:function(n){if(n.key){var e=Z5[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Mh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?J5[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zy,charCode:function(n){return n.type==="keypress"?Mh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Mh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),nD=tr(tD),rD=ft({},Ah,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ak=tr(rD),iD=ft({},Lc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zy}),oD=tr(iD),sD=ft({},za,{propertyName:0,elapsedTime:0,pseudoElement:0}),aD=tr(sD),lD=ft({},Ah,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),cD=tr(lD),uD=[9,13,27,32],Jy=Ki&&"CompositionEvent"in window,Nc=null;Ki&&"documentMode"in document&&(Nc=document.documentMode);var dD=Ki&&"TextEvent"in window&&!Nc,lk=Ki&&(!Jy||Nc&&8<Nc&&11>=Nc),ck=String.fromCharCode(32),uk=!1;function dk(n,e){switch(n){case"keyup":return uD.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hk(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Na=!1;function hD(n,e){switch(n){case"compositionend":return hk(e);case"keypress":return e.which!==32?null:(uk=!0,ck);case"textInput":return n=e.data,n===ck&&uk?null:n;default:return null}}function pD(n,e){if(Na)return n==="compositionend"||!Jy&&dk(n,e)?(n=rk(),Ih=Ky=Bo=null,Na=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lk&&e.locale!=="ko"?null:e.data;default:return null}}var fD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function pk(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!fD[n.type]:e==="textarea"}function fk(n,e,t,r){O_(r),e=Lh(e,"onChange"),0<e.length&&(t=new Gy("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var Fc=null,$c=null;function gD(n){jk(n,0)}function jh(n){var e=Va(n);if(x_(e))return n}function mD(n,e){if(n==="change")return e}var gk=!1;if(Ki){var Qy;if(Ki){var e0="oninput"in document;if(!e0){var mk=document.createElement("div");mk.setAttribute("oninput","return;"),e0=typeof mk.oninput=="function"}Qy=e0}else Qy=!1;gk=Qy&&(!document.documentMode||9<document.documentMode)}function yk(){Fc&&(Fc.detachEvent("onpropertychange",wk),$c=Fc=null)}function wk(n){if(n.propertyName==="value"&&jh($c)){var e=[];fk(e,$c,n,Ry(n)),N_(gD,e)}}function yD(n,e,t){n==="focusin"?(yk(),Fc=e,$c=t,Fc.attachEvent("onpropertychange",wk)):n==="focusout"&&yk()}function wD(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return jh($c)}function bD(n,e){if(n==="click")return jh(e)}function vD(n,e){if(n==="input"||n==="change")return jh(e)}function SD(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Vr=typeof Object.is=="function"?Object.is:SD;function Bc(n,e){if(Vr(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!dy.call(e,i)||!Vr(n[i],e[i]))return!1}return!0}function bk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function vk(n,e){var t=bk(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=bk(t)}}function Sk(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Sk(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function xk(){for(var n=window,e=gh();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=gh(n.document)}return e}function t0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function xD(n){var e=xk(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Sk(t.ownerDocument.documentElement,t)){if(r!==null&&t0(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=vk(t,o);var s=vk(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var _D=Ki&&"documentMode"in document&&11>=document.documentMode,Fa=null,n0=null,Uc=null,r0=!1;function _k(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;r0||Fa==null||Fa!==gh(r)||(r=Fa,"selectionStart"in r&&t0(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Uc&&Bc(Uc,r)||(Uc=r,r=Lh(n0,"onSelect"),0<r.length&&(e=new Gy("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Fa)))}function Rh(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var $a={animationend:Rh("Animation","AnimationEnd"),animationiteration:Rh("Animation","AnimationIteration"),animationstart:Rh("Animation","AnimationStart"),transitionend:Rh("Transition","TransitionEnd")},i0={},kk={};Ki&&(kk=document.createElement("div").style,"AnimationEvent"in window||(delete $a.animationend.animation,delete $a.animationiteration.animation,delete $a.animationstart.animation),"TransitionEvent"in window||delete $a.transitionend.transition);function Oh(n){if(i0[n])return i0[n];if(!$a[n])return n;var e=$a[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in kk)return i0[n]=e[t];return n}var Ck=Oh("animationend"),Pk=Oh("animationiteration"),Ek=Oh("animationstart"),Ik=Oh("transitionend"),Mk=new Map,Tk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Uo(n,e){Mk.set(n,e),Os(e,[n])}for(var o0=0;o0<Tk.length;o0++){var s0=Tk[o0],kD=s0.toLowerCase(),CD=s0[0].toUpperCase()+s0.slice(1);Uo(kD,"on"+CD)}Uo(Ck,"onAnimationEnd"),Uo(Pk,"onAnimationIteration"),Uo(Ek,"onAnimationStart"),Uo("dblclick","onDoubleClick"),Uo("focusin","onFocus"),Uo("focusout","onBlur"),Uo(Ik,"onTransitionEnd"),Ta("onMouseEnter",["mouseout","mouseover"]),Ta("onMouseLeave",["mouseout","mouseover"]),Ta("onPointerEnter",["pointerout","pointerover"]),Ta("onPointerLeave",["pointerout","pointerover"]),Os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Os("onBeforeInput",["compositionend","keypress","textInput","paste"]),Os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Vc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PD=new Set("cancel close invalid load scroll toggle".split(" ").concat(Vc));function Ak(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,k5(r,e,void 0,n),n.currentTarget=null}function jk(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Ak(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Ak(i,a,c),o=l}}}if(wh)throw n=zy,wh=!1,zy=null,n}function at(n,e){var t=e[f0];t===void 0&&(t=e[f0]=new Set);var r=n+"__bubble";t.has(r)||(Rk(e,n,2,!1),t.add(r))}function a0(n,e,t){var r=0;e&&(r|=4),Rk(t,n,r,e)}var Dh="_reactListening"+Math.random().toString(36).slice(2);function Hc(n){if(!n[Dh]){n[Dh]=!0,f_.forEach(function(t){t!=="selectionchange"&&(PD.has(t)||a0(t,!1,n),a0(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Dh]||(e[Dh]=!0,a0("selectionchange",!1,e))}}function Rk(n,e,t,r){switch(nk(e)){case 1:var i=$5;break;case 4:i=B5;break;default:i=Hy}t=i.bind(null,e,t,n),i=void 0,!Ly||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function l0(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=Ls(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}N_(function(){var c=o,u=Ry(t),d=[];e:{var h=Mk.get(n);if(h!==void 0){var p=Gy,g=n;switch(n){case"keypress":if(Mh(t)===0)break e;case"keydown":case"keyup":p=nD;break;case"focusin":g="focus",p=qy;break;case"focusout":g="blur",p=qy;break;case"beforeblur":case"afterblur":p=qy;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=ok;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=H5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=oD;break;case Ck:case Pk:case Ek:p=G5;break;case Ik:p=aD;break;case"scroll":p=U5;break;case"wheel":p=cD;break;case"copy":case"cut":case"paste":p=X5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=ak}var f=(e&4)!==0,m=!f&&n==="scroll",v=f?h!==null?h+"Capture":null:h;f=[];for(var b=c,_;b!==null;){_=b;var x=_.stateNode;if(_.tag===5&&x!==null&&(_=x,v!==null&&(x=Pc(b,v),x!=null&&f.push(Wc(b,x,_)))),m)break;b=b.return}0<f.length&&(h=new p(h,g,null,t,u),d.push({event:h,listeners:f}))}}if(!(e&7)){e:{if(h=n==="mouseover"||n==="pointerover",p=n==="mouseout"||n==="pointerout",h&&t!==jy&&(g=t.relatedTarget||t.fromElement)&&(Ls(g)||g[Yi]))break e;if((p||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=c,g=g?Ls(g):null,g!==null&&(m=Ds(g),g!==m||g.tag!==5&&g.tag!==6)&&(g=null)):(p=null,g=c),p!==g)){if(f=ok,x="onMouseLeave",v="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(f=ak,x="onPointerLeave",v="onPointerEnter",b="pointer"),m=p==null?h:Va(p),_=g==null?h:Va(g),h=new f(x,b+"leave",p,t,u),h.target=m,h.relatedTarget=_,x=null,Ls(u)===c&&(f=new f(v,b+"enter",g,t,u),f.target=_,f.relatedTarget=m,x=f),m=x,p&&g)t:{for(f=p,v=g,b=0,_=f;_;_=Ba(_))b++;for(_=0,x=v;x;x=Ba(x))_++;for(;0<b-_;)f=Ba(f),b--;for(;0<_-b;)v=Ba(v),_--;for(;b--;){if(f===v||v!==null&&f===v.alternate)break t;f=Ba(f),v=Ba(v)}f=null}else f=null;p!==null&&Ok(d,h,p,f,!1),g!==null&&m!==null&&Ok(d,m,g,f,!0)}}e:{if(h=c?Va(c):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var C=mD;else if(pk(h))if(gk)C=vD;else{C=wD;var k=yD}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(C=bD);if(C&&(C=C(n,c))){fk(d,C,t,u);break e}k&&k(n,h,c),n==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&Ey(h,"number",h.value)}switch(k=c?Va(c):window,n){case"focusin":(pk(k)||k.contentEditable==="true")&&(Fa=k,n0=c,Uc=null);break;case"focusout":Uc=n0=Fa=null;break;case"mousedown":r0=!0;break;case"contextmenu":case"mouseup":case"dragend":r0=!1,_k(d,t,u);break;case"selectionchange":if(_D)break;case"keydown":case"keyup":_k(d,t,u)}var E;if(Jy)e:{switch(n){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Na?dk(n,t)&&(I="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(lk&&t.locale!=="ko"&&(Na||I!=="onCompositionStart"?I==="onCompositionEnd"&&Na&&(E=rk()):(Bo=u,Ky="value"in Bo?Bo.value:Bo.textContent,Na=!0)),k=Lh(c,I),0<k.length&&(I=new sk(I,n,null,t,u),d.push({event:I,listeners:k}),E?I.data=E:(E=hk(t),E!==null&&(I.data=E)))),(E=dD?hD(n,t):pD(n,t))&&(c=Lh(c,"onBeforeInput"),0<c.length&&(u=new sk("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=E))}jk(d,e)})}function Wc(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Lh(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Pc(n,t),o!=null&&r.unshift(Wc(n,o,i)),o=Pc(n,e),o!=null&&r.push(Wc(n,o,i))),n=n.return}return r}function Ba(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Ok(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Pc(t,o),l!=null&&s.unshift(Wc(t,l,a))):i||(l=Pc(t,o),l!=null&&s.push(Wc(t,l,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var ED=/\r\n?/g,ID=/\u0000|\uFFFD/g;function Dk(n){return(typeof n=="string"?n:""+n).replace(ED,`
`).replace(ID,"")}function zh(n,e,t){if(e=Dk(e),Dk(n)!==e&&t)throw Error(Q(425))}function Nh(){}var c0=null,u0=null;function d0(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var h0=typeof setTimeout=="function"?setTimeout:void 0,MD=typeof clearTimeout=="function"?clearTimeout:void 0,Lk=typeof Promise=="function"?Promise:void 0,TD=typeof queueMicrotask=="function"?queueMicrotask:typeof Lk<"u"?function(n){return Lk.resolve(null).then(n).catch(AD)}:h0;function AD(n){setTimeout(function(){throw n})}function p0(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Dc(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Dc(e)}function Vo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function zk(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ua=Math.random().toString(36).slice(2),wi="__reactFiber$"+Ua,Kc="__reactProps$"+Ua,Yi="__reactContainer$"+Ua,f0="__reactEvents$"+Ua,jD="__reactListeners$"+Ua,RD="__reactHandles$"+Ua;function Ls(n){var e=n[wi];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Yi]||t[wi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=zk(n);n!==null;){if(t=n[wi])return t;n=zk(n)}return e}n=t,t=n.parentNode}return null}function Gc(n){return n=n[wi]||n[Yi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Va(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Q(33))}function Fh(n){return n[Kc]||null}var g0=[],Ha=-1;function Ho(n){return{current:n}}function lt(n){0>Ha||(n.current=g0[Ha],g0[Ha]=null,Ha--)}function et(n,e){Ha++,g0[Ha]=n.current,n.current=e}var Wo={},rn=Ho(Wo),Ln=Ho(!1),zs=Wo;function Wa(n,e){var t=n.type.contextTypes;if(!t)return Wo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function zn(n){return n=n.childContextTypes,n!=null}function $h(){lt(Ln),lt(rn)}function Nk(n,e,t){if(rn.current!==Wo)throw Error(Q(168));et(rn,e),et(Ln,t)}function Fk(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Q(108,y5(n)||"Unknown",i));return ft({},t,r)}function Bh(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Wo,zs=rn.current,et(rn,n),et(Ln,Ln.current),!0}function $k(n,e,t){var r=n.stateNode;if(!r)throw Error(Q(169));t?(n=Fk(n,e,zs),r.__reactInternalMemoizedMergedChildContext=n,lt(Ln),lt(rn),et(rn,n)):lt(Ln),et(Ln,t)}var Xi=null,Uh=!1,m0=!1;function Bk(n){Xi===null?Xi=[n]:Xi.push(n)}function OD(n){Uh=!0,Bk(n)}function Ko(){if(!m0&&Xi!==null){m0=!0;var n=0,e=He;try{var t=Xi;for(He=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}Xi=null,Uh=!1}catch(i){throw Xi!==null&&(Xi=Xi.slice(n+1)),V_(Ny,Ko),i}finally{He=e,m0=!1}}return null}var Ka=[],Ga=0,Vh=null,Hh=0,_r=[],kr=0,Ns=null,qi=1,Zi="";function Fs(n,e){Ka[Ga++]=Hh,Ka[Ga++]=Vh,Vh=n,Hh=e}function Uk(n,e,t){_r[kr++]=qi,_r[kr++]=Zi,_r[kr++]=Ns,Ns=n;var r=qi;n=Zi;var i=32-Ur(r)-1;r&=~(1<<i),t+=1;var o=32-Ur(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,qi=1<<32-Ur(e)+i|t<<i|r,Zi=o+n}else qi=1<<o|t<<i|r,Zi=n}function y0(n){n.return!==null&&(Fs(n,1),Uk(n,1,0))}function w0(n){for(;n===Vh;)Vh=Ka[--Ga],Ka[Ga]=null,Hh=Ka[--Ga],Ka[Ga]=null;for(;n===Ns;)Ns=_r[--kr],_r[kr]=null,Zi=_r[--kr],_r[kr]=null,qi=_r[--kr],_r[kr]=null}var nr=null,rr=null,dt=!1,Hr=null;function Vk(n,e){var t=Ir(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function Hk(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,nr=n,rr=Vo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,nr=n,rr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ns!==null?{id:qi,overflow:Zi}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ir(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,nr=n,rr=null,!0):!1;default:return!1}}function b0(n){return(n.mode&1)!==0&&(n.flags&128)===0}function v0(n){if(dt){var e=rr;if(e){var t=e;if(!Hk(n,e)){if(b0(n))throw Error(Q(418));e=Vo(t.nextSibling);var r=nr;e&&Hk(n,e)?Vk(r,t):(n.flags=n.flags&-4097|2,dt=!1,nr=n)}}else{if(b0(n))throw Error(Q(418));n.flags=n.flags&-4097|2,dt=!1,nr=n}}}function Wk(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;nr=n}function Wh(n){if(n!==nr)return!1;if(!dt)return Wk(n),dt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!d0(n.type,n.memoizedProps)),e&&(e=rr)){if(b0(n))throw Kk(),Error(Q(418));for(;e;)Vk(n,e),e=Vo(e.nextSibling)}if(Wk(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Q(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){rr=Vo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}rr=null}}else rr=nr?Vo(n.stateNode.nextSibling):null;return!0}function Kk(){for(var n=rr;n;)n=Vo(n.nextSibling)}function Ya(){rr=nr=null,dt=!1}function S0(n){Hr===null?Hr=[n]:Hr.push(n)}var DD=Gi.ReactCurrentBatchConfig;function Wr(n,e){if(n&&n.defaultProps){e=ft({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Kh=Ho(null),Gh=null,Xa=null,x0=null;function _0(){x0=Xa=Gh=null}function k0(n){var e=Kh.current;lt(Kh),n._currentValue=e}function C0(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function qa(n,e){Gh=n,x0=Xa=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Nn=!0),n.firstContext=null)}function Cr(n){var e=n._currentValue;if(x0!==n)if(n={context:n,memoizedValue:e,next:null},Xa===null){if(Gh===null)throw Error(Q(308));Xa=n,Gh.dependencies={lanes:0,firstContext:n}}else Xa=Xa.next=n;return e}var $s=null;function P0(n){$s===null?$s=[n]:$s.push(n)}function Gk(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,P0(e)):(t.next=i.next,i.next=t),e.interleaved=t,Ji(n,r)}function Ji(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Go=!1;function E0(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yk(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Qi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Yo(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,Ae&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Ji(n,t)}return i=r.interleaved,i===null?(e.next=e,P0(r)):(e.next=i.next,i.next=e),r.interleaved=e,Ji(n,t)}function Yh(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,By(n,t)}}function Xk(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Xh(n,e,t,r){var i=n.updateQueue;Go=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(o!==null){var d=i.baseState;s=0,u=c=l=null,a=o;do{var h=a.lane,p=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=n,f=a;switch(h=e,p=t,f.tag){case 1:if(g=f.payload,typeof g=="function"){d=g.call(p,d,h);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=f.payload,h=typeof g=="function"?g.call(p,d,h):g,h==null)break e;d=ft({},d,h);break e;case 2:Go=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=p,l=d):u=u.next=p,s|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Vs|=s,n.lanes=s,n.memoizedState=d}}function qk(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Q(191,i));i.call(r)}}}var Zk=new p_.Component().refs;function I0(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:ft({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var qh={isMounted:function(n){return(n=n._reactInternals)?Ds(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Pn(),i=Jo(n),o=Qi(r,i);o.payload=e,t!=null&&(o.callback=t),e=Yo(n,o,i),e!==null&&(Yr(e,n,i,r),Yh(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Pn(),i=Jo(n),o=Qi(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Yo(n,o,i),e!==null&&(Yr(e,n,i,r),Yh(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Pn(),r=Jo(n),i=Qi(t,r);i.tag=2,e!=null&&(i.callback=e),e=Yo(n,i,r),e!==null&&(Yr(e,n,r,t),Yh(e,n,r))}};function Jk(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Bc(t,r)||!Bc(i,o):!0}function Qk(n,e,t){var r=!1,i=Wo,o=e.contextType;return typeof o=="object"&&o!==null?o=Cr(o):(i=zn(e)?zs:rn.current,r=e.contextTypes,o=(r=r!=null)?Wa(n,i):Wo),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=qh,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function eC(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&qh.enqueueReplaceState(e,e.state,null)}function M0(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=Zk,E0(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Cr(o):(o=zn(e)?zs:rn.current,i.context=Wa(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(I0(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&qh.enqueueReplaceState(i,i.state,null),Xh(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Yc(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Q(309));var r=t.stateNode}if(!r)throw Error(Q(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;a===Zk&&(a=i.refs={}),s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Q(284));if(!t._owner)throw Error(Q(290,n))}return n}function Zh(n,e){throw n=Object.prototype.toString.call(e),Error(Q(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function tC(n){var e=n._init;return e(n._payload)}function nC(n){function e(v,b){if(n){var _=v.deletions;_===null?(v.deletions=[b],v.flags|=16):_.push(b)}}function t(v,b){if(!n)return null;for(;b!==null;)e(v,b),b=b.sibling;return null}function r(v,b){for(v=new Map;b!==null;)b.key!==null?v.set(b.key,b):v.set(b.index,b),b=b.sibling;return v}function i(v,b){return v=es(v,b),v.index=0,v.sibling=null,v}function o(v,b,_){return v.index=_,n?(_=v.alternate,_!==null?(_=_.index,_<b?(v.flags|=2,b):_):(v.flags|=2,b)):(v.flags|=1048576,b)}function s(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,b,_,x){return b===null||b.tag!==6?(b=dw(_,v.mode,x),b.return=v,b):(b=i(b,_),b.return=v,b)}function l(v,b,_,x){var C=_.type;return C===ja?u(v,b,_.props.children,x,_.key):b!==null&&(b.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Do&&tC(C)===b.type)?(x=i(b,_.props),x.ref=Yc(v,b,_),x.return=v,x):(x=mp(_.type,_.key,_.props,null,v.mode,x),x.ref=Yc(v,b,_),x.return=v,x)}function c(v,b,_,x){return b===null||b.tag!==4||b.stateNode.containerInfo!==_.containerInfo||b.stateNode.implementation!==_.implementation?(b=hw(_,v.mode,x),b.return=v,b):(b=i(b,_.children||[]),b.return=v,b)}function u(v,b,_,x,C){return b===null||b.tag!==7?(b=Gs(_,v.mode,x,C),b.return=v,b):(b=i(b,_),b.return=v,b)}function d(v,b,_){if(typeof b=="string"&&b!==""||typeof b=="number")return b=dw(""+b,v.mode,_),b.return=v,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case ph:return _=mp(b.type,b.key,b.props,null,v.mode,_),_.ref=Yc(v,null,b),_.return=v,_;case Aa:return b=hw(b,v.mode,_),b.return=v,b;case Do:var x=b._init;return d(v,x(b._payload),_)}if(_c(b)||Sc(b))return b=Gs(b,v.mode,_,null),b.return=v,b;Zh(v,b)}return null}function h(v,b,_,x){var C=b!==null?b.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return C!==null?null:a(v,b,""+_,x);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case ph:return _.key===C?l(v,b,_,x):null;case Aa:return _.key===C?c(v,b,_,x):null;case Do:return C=_._init,h(v,b,C(_._payload),x)}if(_c(_)||Sc(_))return C!==null?null:u(v,b,_,x,null);Zh(v,_)}return null}function p(v,b,_,x,C){if(typeof x=="string"&&x!==""||typeof x=="number")return v=v.get(_)||null,a(b,v,""+x,C);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ph:return v=v.get(x.key===null?_:x.key)||null,l(b,v,x,C);case Aa:return v=v.get(x.key===null?_:x.key)||null,c(b,v,x,C);case Do:var k=x._init;return p(v,b,_,k(x._payload),C)}if(_c(x)||Sc(x))return v=v.get(_)||null,u(b,v,x,C,null);Zh(b,x)}return null}function g(v,b,_,x){for(var C=null,k=null,E=b,I=b=0,T=null;E!==null&&I<_.length;I++){E.index>I?(T=E,E=null):T=E.sibling;var A=h(v,E,_[I],x);if(A===null){E===null&&(E=T);break}n&&E&&A.alternate===null&&e(v,E),b=o(A,b,I),k===null?C=A:k.sibling=A,k=A,E=T}if(I===_.length)return t(v,E),dt&&Fs(v,I),C;if(E===null){for(;I<_.length;I++)E=d(v,_[I],x),E!==null&&(b=o(E,b,I),k===null?C=E:k.sibling=E,k=E);return dt&&Fs(v,I),C}for(E=r(v,E);I<_.length;I++)T=p(E,v,I,_[I],x),T!==null&&(n&&T.alternate!==null&&E.delete(T.key===null?I:T.key),b=o(T,b,I),k===null?C=T:k.sibling=T,k=T);return n&&E.forEach(function(D){return e(v,D)}),dt&&Fs(v,I),C}function f(v,b,_,x){var C=Sc(_);if(typeof C!="function")throw Error(Q(150));if(_=C.call(_),_==null)throw Error(Q(151));for(var k=C=null,E=b,I=b=0,T=null,A=_.next();E!==null&&!A.done;I++,A=_.next()){E.index>I?(T=E,E=null):T=E.sibling;var D=h(v,E,A.value,x);if(D===null){E===null&&(E=T);break}n&&E&&D.alternate===null&&e(v,E),b=o(D,b,I),k===null?C=D:k.sibling=D,k=D,E=T}if(A.done)return t(v,E),dt&&Fs(v,I),C;if(E===null){for(;!A.done;I++,A=_.next())A=d(v,A.value,x),A!==null&&(b=o(A,b,I),k===null?C=A:k.sibling=A,k=A);return dt&&Fs(v,I),C}for(E=r(v,E);!A.done;I++,A=_.next())A=p(E,v,I,A.value,x),A!==null&&(n&&A.alternate!==null&&E.delete(A.key===null?I:A.key),b=o(A,b,I),k===null?C=A:k.sibling=A,k=A);return n&&E.forEach(function(N){return e(v,N)}),dt&&Fs(v,I),C}function m(v,b,_,x){if(typeof _=="object"&&_!==null&&_.type===ja&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case ph:e:{for(var C=_.key,k=b;k!==null;){if(k.key===C){if(C=_.type,C===ja){if(k.tag===7){t(v,k.sibling),b=i(k,_.props.children),b.return=v,v=b;break e}}else if(k.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Do&&tC(C)===k.type){t(v,k.sibling),b=i(k,_.props),b.ref=Yc(v,k,_),b.return=v,v=b;break e}t(v,k);break}else e(v,k);k=k.sibling}_.type===ja?(b=Gs(_.props.children,v.mode,x,_.key),b.return=v,v=b):(x=mp(_.type,_.key,_.props,null,v.mode,x),x.ref=Yc(v,b,_),x.return=v,v=x)}return s(v);case Aa:e:{for(k=_.key;b!==null;){if(b.key===k)if(b.tag===4&&b.stateNode.containerInfo===_.containerInfo&&b.stateNode.implementation===_.implementation){t(v,b.sibling),b=i(b,_.children||[]),b.return=v,v=b;break e}else{t(v,b);break}else e(v,b);b=b.sibling}b=hw(_,v.mode,x),b.return=v,v=b}return s(v);case Do:return k=_._init,m(v,b,k(_._payload),x)}if(_c(_))return g(v,b,_,x);if(Sc(_))return f(v,b,_,x);Zh(v,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,b!==null&&b.tag===6?(t(v,b.sibling),b=i(b,_),b.return=v,v=b):(t(v,b),b=dw(_,v.mode,x),b.return=v,v=b),s(v)):t(v,b)}return m}var Za=nC(!0),rC=nC(!1),Xc={},bi=Ho(Xc),qc=Ho(Xc),Zc=Ho(Xc);function Bs(n){if(n===Xc)throw Error(Q(174));return n}function T0(n,e){switch(et(Zc,e),et(qc,n),et(bi,Xc),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:My(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=My(e,n)}lt(bi),et(bi,e)}function Ja(){lt(bi),lt(qc),lt(Zc)}function iC(n){Bs(Zc.current);var e=Bs(bi.current),t=My(e,n.type);e!==t&&(et(qc,n),et(bi,t))}function A0(n){qc.current===n&&(lt(bi),lt(qc))}var gt=Ho(0);function Jh(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var j0=[];function R0(){for(var n=0;n<j0.length;n++)j0[n]._workInProgressVersionPrimary=null;j0.length=0}var Qh=Gi.ReactCurrentDispatcher,O0=Gi.ReactCurrentBatchConfig,Us=0,mt=null,Dt=null,zt=null,ep=!1,Jc=!1,Qc=0,LD=0;function on(){throw Error(Q(321))}function D0(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Vr(n[t],e[t]))return!1;return!0}function L0(n,e,t,r,i,o){if(Us=o,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Qh.current=n===null||n.memoizedState===null?$D:BD,n=t(r,i),Jc){o=0;do{if(Jc=!1,Qc=0,25<=o)throw Error(Q(301));o+=1,zt=Dt=null,e.updateQueue=null,Qh.current=UD,n=t(r,i)}while(Jc)}if(Qh.current=rp,e=Dt!==null&&Dt.next!==null,Us=0,zt=Dt=mt=null,ep=!1,e)throw Error(Q(300));return n}function z0(){var n=Qc!==0;return Qc=0,n}function vi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zt===null?mt.memoizedState=zt=n:zt=zt.next=n,zt}function Pr(){if(Dt===null){var n=mt.alternate;n=n!==null?n.memoizedState:null}else n=Dt.next;var e=zt===null?mt.memoizedState:zt.next;if(e!==null)zt=e,Dt=n;else{if(n===null)throw Error(Q(310));Dt=n,n={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},zt===null?mt.memoizedState=zt=n:zt=zt.next=n}return zt}function eu(n,e){return typeof e=="function"?e(n):e}function N0(n){var e=Pr(),t=e.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=n;var r=Dt,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var u=c.lane;if((Us&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,s=r):l=l.next=d,mt.lanes|=u,Vs|=u}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,Vr(r,e.memoizedState)||(Nn=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,mt.lanes|=o,Vs|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function F0(n){var e=Pr(),t=e.queue;if(t===null)throw Error(Q(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);Vr(o,e.memoizedState)||(Nn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function oC(){}function sC(n,e){var t=mt,r=Pr(),i=e(),o=!Vr(r.memoizedState,i);if(o&&(r.memoizedState=i,Nn=!0),r=r.queue,$0(cC.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||zt!==null&&zt.memoizedState.tag&1){if(t.flags|=2048,tu(9,lC.bind(null,t,r,i,e),void 0,null),Nt===null)throw Error(Q(349));Us&30||aC(t,e,i)}return i}function aC(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function lC(n,e,t,r){e.value=t,e.getSnapshot=r,uC(e)&&dC(n)}function cC(n,e,t){return t(function(){uC(e)&&dC(n)})}function uC(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Vr(n,t)}catch{return!0}}function dC(n){var e=Ji(n,1);e!==null&&Yr(e,n,1,-1)}function hC(n){var e=vi();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:eu,lastRenderedState:n},e.queue=n,n=n.dispatch=FD.bind(null,mt,n),[e.memoizedState,n]}function tu(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function pC(){return Pr().memoizedState}function tp(n,e,t,r){var i=vi();mt.flags|=n,i.memoizedState=tu(1|e,t,void 0,r===void 0?null:r)}function np(n,e,t,r){var i=Pr();r=r===void 0?null:r;var o=void 0;if(Dt!==null){var s=Dt.memoizedState;if(o=s.destroy,r!==null&&D0(r,s.deps)){i.memoizedState=tu(e,t,o,r);return}}mt.flags|=n,i.memoizedState=tu(1|e,t,o,r)}function fC(n,e){return tp(8390656,8,n,e)}function $0(n,e){return np(2048,8,n,e)}function gC(n,e){return np(4,2,n,e)}function mC(n,e){return np(4,4,n,e)}function yC(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function wC(n,e,t){return t=t!=null?t.concat([n]):null,np(4,4,yC.bind(null,e,n),t)}function B0(){}function bC(n,e){var t=Pr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&D0(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function vC(n,e){var t=Pr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&D0(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function SC(n,e,t){return Us&21?(Vr(t,e)||(t=G_(),mt.lanes|=t,Vs|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Nn=!0),n.memoizedState=t)}function zD(n,e){var t=He;He=t!==0&&4>t?t:4,n(!0);var r=O0.transition;O0.transition={};try{n(!1),e()}finally{He=t,O0.transition=r}}function xC(){return Pr().memoizedState}function ND(n,e,t){var r=Jo(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},_C(n))kC(e,t);else if(t=Gk(n,e,t,r),t!==null){var i=Pn();Yr(t,n,r,i),CC(t,e,r)}}function FD(n,e,t){var r=Jo(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(_C(n))kC(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,Vr(a,s)){var l=e.interleaved;l===null?(i.next=i,P0(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=Gk(n,e,i,r),t!==null&&(i=Pn(),Yr(t,n,r,i),CC(t,e,r))}}function _C(n){var e=n.alternate;return n===mt||e!==null&&e===mt}function kC(n,e){Jc=ep=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function CC(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,By(n,t)}}var rp={readContext:Cr,useCallback:on,useContext:on,useEffect:on,useImperativeHandle:on,useInsertionEffect:on,useLayoutEffect:on,useMemo:on,useReducer:on,useRef:on,useState:on,useDebugValue:on,useDeferredValue:on,useTransition:on,useMutableSource:on,useSyncExternalStore:on,useId:on,unstable_isNewReconciler:!1},$D={readContext:Cr,useCallback:function(n,e){return vi().memoizedState=[n,e===void 0?null:e],n},useContext:Cr,useEffect:fC,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,tp(4194308,4,yC.bind(null,e,n),t)},useLayoutEffect:function(n,e){return tp(4194308,4,n,e)},useInsertionEffect:function(n,e){return tp(4,2,n,e)},useMemo:function(n,e){var t=vi();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=vi();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=ND.bind(null,mt,n),[r.memoizedState,n]},useRef:function(n){var e=vi();return n={current:n},e.memoizedState=n},useState:hC,useDebugValue:B0,useDeferredValue:function(n){return vi().memoizedState=n},useTransition:function(){var n=hC(!1),e=n[0];return n=zD.bind(null,n[1]),vi().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=mt,i=vi();if(dt){if(t===void 0)throw Error(Q(407));t=t()}else{if(t=e(),Nt===null)throw Error(Q(349));Us&30||aC(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,fC(cC.bind(null,r,o,n),[n]),r.flags|=2048,tu(9,lC.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=vi(),e=Nt.identifierPrefix;if(dt){var t=Zi,r=qi;t=(r&~(1<<32-Ur(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Qc++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=LD++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},BD={readContext:Cr,useCallback:bC,useContext:Cr,useEffect:$0,useImperativeHandle:wC,useInsertionEffect:gC,useLayoutEffect:mC,useMemo:vC,useReducer:N0,useRef:pC,useState:function(){return N0(eu)},useDebugValue:B0,useDeferredValue:function(n){var e=Pr();return SC(e,Dt.memoizedState,n)},useTransition:function(){var n=N0(eu)[0],e=Pr().memoizedState;return[n,e]},useMutableSource:oC,useSyncExternalStore:sC,useId:xC,unstable_isNewReconciler:!1},UD={readContext:Cr,useCallback:bC,useContext:Cr,useEffect:$0,useImperativeHandle:wC,useInsertionEffect:gC,useLayoutEffect:mC,useMemo:vC,useReducer:F0,useRef:pC,useState:function(){return F0(eu)},useDebugValue:B0,useDeferredValue:function(n){var e=Pr();return Dt===null?e.memoizedState=n:SC(e,Dt.memoizedState,n)},useTransition:function(){var n=F0(eu)[0],e=Pr().memoizedState;return[n,e]},useMutableSource:oC,useSyncExternalStore:sC,useId:xC,unstable_isNewReconciler:!1};function Qa(n,e){try{var t="",r=e;do t+=m5(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function U0(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function V0(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var VD=typeof WeakMap=="function"?WeakMap:Map;function PC(n,e,t){t=Qi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){up||(up=!0,rw=r),V0(n,e)},t}function EC(n,e,t){t=Qi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){V0(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){V0(n,e),typeof r!="function"&&(qo===null?qo=new Set([this]):qo.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function IC(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new VD;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=rL.bind(null,n,e,t),e.then(n,n))}function MC(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function TC(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Qi(-1,1),e.tag=2,Yo(t,e,1))),t.lanes|=1),n)}var HD=Gi.ReactCurrentOwner,Nn=!1;function Cn(n,e,t,r){e.child=n===null?rC(e,null,t,r):Za(e,n.child,t,r)}function AC(n,e,t,r,i){t=t.render;var o=e.ref;return qa(e,i),r=L0(n,e,t,r,o,i),t=z0(),n!==null&&!Nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,eo(n,e,i)):(dt&&t&&y0(e),e.flags|=1,Cn(n,e,r,i),e.child)}function jC(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!uw(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,RC(n,e,o,r,i)):(n=mp(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:Bc,t(s,r)&&n.ref===e.ref)return eo(n,e,i)}return e.flags|=1,n=es(o,r),n.ref=e.ref,n.return=e,e.child=n}function RC(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Bc(o,r)&&n.ref===e.ref)if(Nn=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Nn=!0);else return e.lanes=n.lanes,eo(n,e,i)}return H0(n,e,t,r,i)}function OC(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(tl,ir),ir|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,et(tl,ir),ir|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,et(tl,ir),ir|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,et(tl,ir),ir|=r;return Cn(n,e,i,t),e.child}function DC(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function H0(n,e,t,r,i){var o=zn(t)?zs:rn.current;return o=Wa(e,o),qa(e,i),t=L0(n,e,t,r,o,i),r=z0(),n!==null&&!Nn?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,eo(n,e,i)):(dt&&r&&y0(e),e.flags|=1,Cn(n,e,t,i),e.child)}function LC(n,e,t,r,i){if(zn(t)){var o=!0;Bh(e)}else o=!1;if(qa(e,i),e.stateNode===null)op(n,e),Qk(e,t,r),M0(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,c=t.contextType;typeof c=="object"&&c!==null?c=Cr(c):(c=zn(t)?zs:rn.current,c=Wa(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&eC(e,s,r,c),Go=!1;var h=e.memoizedState;s.state=h,Xh(e,r,s,i),l=e.memoizedState,a!==r||h!==l||Ln.current||Go?(typeof u=="function"&&(I0(e,t,u,r),l=e.memoizedState),(a=Go||Jk(e,t,a,r,h,l,c))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,Yk(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Wr(e.type,a),s.props=c,d=e.pendingProps,h=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=Cr(l):(l=zn(t)?zs:rn.current,l=Wa(e,l));var p=t.getDerivedStateFromProps;(u=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||h!==l)&&eC(e,s,r,l),Go=!1,h=e.memoizedState,s.state=h,Xh(e,r,s,i);var g=e.memoizedState;a!==d||h!==g||Ln.current||Go?(typeof p=="function"&&(I0(e,t,p,r),g=e.memoizedState),(c=Go||Jk(e,t,c,r,h,g,l)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,g,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,g,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),s.props=r,s.state=g,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&h===n.memoizedState||(e.flags|=1024),r=!1)}return W0(n,e,t,r,o,i)}function W0(n,e,t,r,i,o){DC(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&$k(e,t,!1),eo(n,e,o);r=e.stateNode,HD.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Za(e,n.child,null,o),e.child=Za(e,null,a,o)):Cn(n,e,a,o),e.memoizedState=r.state,i&&$k(e,t,!0),e.child}function zC(n){var e=n.stateNode;e.pendingContext?Nk(n,e.pendingContext,e.pendingContext!==e.context):e.context&&Nk(n,e.context,!1),T0(n,e.containerInfo)}function NC(n,e,t,r,i){return Ya(),S0(i),e.flags|=256,Cn(n,e,t,r),e.child}var K0={dehydrated:null,treeContext:null,retryLane:0};function G0(n){return{baseLanes:n,cachePool:null,transitions:null}}function FC(n,e,t){var r=e.pendingProps,i=gt.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),et(gt,i&1),n===null)return v0(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=yp(s,r,0,null),n=Gs(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=G0(t),e.memoizedState=K0,n):Y0(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return WD(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=es(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=es(a,o):(o=Gs(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?G0(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=K0,r}return o=n.child,n=o.sibling,r=es(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function Y0(n,e){return e=yp({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function ip(n,e,t,r){return r!==null&&S0(r),Za(e,n.child,null,t),n=Y0(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function WD(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=U0(Error(Q(422))),ip(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=yp({mode:"visible",children:r.children},i,0,null),o=Gs(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Za(e,n.child,null,s),e.child.memoizedState=G0(s),e.memoizedState=K0,o);if(!(e.mode&1))return ip(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Q(419)),r=U0(o,r,void 0),ip(n,e,s,r)}if(a=(s&n.childLanes)!==0,Nn||a){if(r=Nt,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Ji(n,i),Yr(r,n,i,-1))}return cw(),r=U0(Error(Q(421))),ip(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=iL.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,rr=Vo(i.nextSibling),nr=e,dt=!0,Hr=null,n!==null&&(_r[kr++]=qi,_r[kr++]=Zi,_r[kr++]=Ns,qi=n.id,Zi=n.overflow,Ns=e),e=Y0(e,r.children),e.flags|=4096,e)}function $C(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),C0(n.return,e,t)}function X0(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function BC(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Cn(n,e,r.children,t),r=gt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&$C(n,t,e);else if(n.tag===19)$C(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(et(gt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&Jh(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),X0(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&Jh(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}X0(e,!0,t,null,o);break;case"together":X0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function op(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function eo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Vs|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Q(153));if(e.child!==null){for(n=e.child,t=es(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=es(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function KD(n,e,t){switch(e.tag){case 3:zC(e),Ya();break;case 5:iC(e);break;case 1:zn(e.type)&&Bh(e);break;case 4:T0(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;et(Kh,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(et(gt,gt.current&1),e.flags|=128,null):t&e.child.childLanes?FC(n,e,t):(et(gt,gt.current&1),n=eo(n,e,t),n!==null?n.sibling:null);et(gt,gt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return BC(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),et(gt,gt.current),r)break;return null;case 22:case 23:return e.lanes=0,OC(n,e,t)}return eo(n,e,t)}var UC,q0,VC,HC;UC=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}},q0=function(){},VC=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Bs(bi.current);var o=null;switch(t){case"input":i=Cy(n,i),r=Cy(n,r),o=[];break;case"select":i=ft({},i,{value:void 0}),r=ft({},r,{value:void 0}),o=[];break;case"textarea":i=Iy(n,i),r=Iy(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Nh)}Ty(t,r);var s;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(vc.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i==null?void 0:i[c],r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(o||(o=[]),o.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(vc.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&at("scroll",n),o||a===l||(o=[])):(o=o||[]).push(c,l))}t&&(o=o||[]).push("style",t);var c=o;(e.updateQueue=c)&&(e.flags|=4)}},HC=function(n,e,t,r){t!==r&&(e.flags|=4)};function nu(n,e){if(!dt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function sn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function GD(n,e,t){var r=e.pendingProps;switch(w0(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sn(e),null;case 1:return zn(e.type)&&$h(),sn(e),null;case 3:return r=e.stateNode,Ja(),lt(Ln),lt(rn),R0(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Wh(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Hr!==null&&(sw(Hr),Hr=null))),q0(n,e),sn(e),null;case 5:A0(e);var i=Bs(Zc.current);if(t=e.type,n!==null&&e.stateNode!=null)VC(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Q(166));return sn(e),null}if(n=Bs(bi.current),Wh(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[wi]=e,r[Kc]=o,n=(e.mode&1)!==0,t){case"dialog":at("cancel",r),at("close",r);break;case"iframe":case"object":case"embed":at("load",r);break;case"video":case"audio":for(i=0;i<Vc.length;i++)at(Vc[i],r);break;case"source":at("error",r);break;case"img":case"image":case"link":at("error",r),at("load",r);break;case"details":at("toggle",r);break;case"input":__(r,o),at("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},at("invalid",r);break;case"textarea":P_(r,o),at("invalid",r)}Ty(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&zh(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&zh(r.textContent,a,n),i=["children",""+a]):vc.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&at("scroll",r)}switch(t){case"input":fh(r),C_(r,o,!0);break;case"textarea":fh(r),I_(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Nh)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=M_(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[wi]=e,n[Kc]=r,UC(n,e,!1,!1),e.stateNode=n;e:{switch(s=Ay(t,r),t){case"dialog":at("cancel",n),at("close",n),i=r;break;case"iframe":case"object":case"embed":at("load",n),i=r;break;case"video":case"audio":for(i=0;i<Vc.length;i++)at(Vc[i],n);i=r;break;case"source":at("error",n),i=r;break;case"img":case"image":case"link":at("error",n),at("load",n),i=r;break;case"details":at("toggle",n),i=r;break;case"input":__(n,r),i=Cy(n,r),at("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=ft({},r,{value:void 0}),at("invalid",n);break;case"textarea":P_(n,r),i=Iy(n,r),at("invalid",n);break;default:i=r}Ty(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?j_(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&T_(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&kc(n,l):typeof l=="number"&&kc(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(vc.hasOwnProperty(o)?l!=null&&o==="onScroll"&&at("scroll",n):l!=null&&fy(n,o,l,s))}switch(t){case"input":fh(n),C_(n,r,!1);break;case"textarea":fh(n),I_(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Lo(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?Ra(n,!!r.multiple,o,!1):r.defaultValue!=null&&Ra(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Nh)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return sn(e),null;case 6:if(n&&e.stateNode!=null)HC(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Q(166));if(t=Bs(Zc.current),Bs(bi.current),Wh(e)){if(r=e.stateNode,t=e.memoizedProps,r[wi]=e,(o=r.nodeValue!==t)&&(n=nr,n!==null))switch(n.tag){case 3:zh(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&zh(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[wi]=e,e.stateNode=r}return sn(e),null;case 13:if(lt(gt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(dt&&rr!==null&&e.mode&1&&!(e.flags&128))Kk(),Ya(),e.flags|=98560,o=!1;else if(o=Wh(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Q(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Q(317));o[wi]=e}else Ya(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;sn(e),o=!1}else Hr!==null&&(sw(Hr),Hr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||gt.current&1?Lt===0&&(Lt=3):cw())),e.updateQueue!==null&&(e.flags|=4),sn(e),null);case 4:return Ja(),q0(n,e),n===null&&Hc(e.stateNode.containerInfo),sn(e),null;case 10:return k0(e.type._context),sn(e),null;case 17:return zn(e.type)&&$h(),sn(e),null;case 19:if(lt(gt),o=e.memoizedState,o===null)return sn(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)nu(o,!1);else{if(Lt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=Jh(n),s!==null){for(e.flags|=128,nu(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return et(gt,gt.current&1|2),e.child}n=n.sibling}o.tail!==null&&Mt()>nl&&(e.flags|=128,r=!0,nu(o,!1),e.lanes=4194304)}else{if(!r)if(n=Jh(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nu(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!dt)return sn(e),null}else 2*Mt()-o.renderingStartTime>nl&&t!==1073741824&&(e.flags|=128,r=!0,nu(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Mt(),e.sibling=null,t=gt.current,et(gt,r?t&1|2:t&1),e):(sn(e),null);case 22:case 23:return lw(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ir&1073741824&&(sn(e),e.subtreeFlags&6&&(e.flags|=8192)):sn(e),null;case 24:return null;case 25:return null}throw Error(Q(156,e.tag))}function YD(n,e){switch(w0(e),e.tag){case 1:return zn(e.type)&&$h(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Ja(),lt(Ln),lt(rn),R0(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return A0(e),null;case 13:if(lt(gt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Q(340));Ya()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return lt(gt),null;case 4:return Ja(),null;case 10:return k0(e.type._context),null;case 22:case 23:return lw(),null;case 24:return null;default:return null}}var sp=!1,an=!1,XD=typeof WeakSet=="function"?WeakSet:Set,ne=null;function el(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){_t(n,e,r)}else t.current=null}function WC(n,e,t){try{t()}catch(r){_t(n,e,r)}}var KC=!1;function qD(n,e){if(c0=Ph,n=xk(),t0(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,l=-1,c=0,u=0,d=n,h=null;t:for(;;){for(var p;d!==t||i!==0&&d.nodeType!==3||(a=s+i),d!==o||r!==0&&d.nodeType!==3||(l=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(p=d.firstChild)!==null;)h=d,d=p;for(;;){if(d===n)break t;if(h===t&&++c===i&&(a=s),h===o&&++u===r&&(l=s),(p=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=p}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(u0={focusedElem:n,selectionRange:t},Ph=!1,ne=e;ne!==null;)if(e=ne,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,ne=n;else for(;ne!==null;){e=ne;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var f=g.memoizedProps,m=g.memoizedState,v=e.stateNode,b=v.getSnapshotBeforeUpdate(e.elementType===e.type?f:Wr(e.type,f),m);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Q(163))}}catch(x){_t(e,e.return,x)}if(n=e.sibling,n!==null){n.return=e.return,ne=n;break}ne=e.return}return g=KC,KC=!1,g}function ru(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&WC(e,t,o)}i=i.next}while(i!==r)}}function ap(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function Z0(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function GC(n){var e=n.alternate;e!==null&&(n.alternate=null,GC(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[wi],delete e[Kc],delete e[f0],delete e[jD],delete e[RD])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function YC(n){return n.tag===5||n.tag===3||n.tag===4}function XC(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||YC(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function J0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Nh));else if(r!==4&&(n=n.child,n!==null))for(J0(n,e,t),n=n.sibling;n!==null;)J0(n,e,t),n=n.sibling}function Q0(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(Q0(n,e,t),n=n.sibling;n!==null;)Q0(n,e,t),n=n.sibling}var Kt=null,Kr=!1;function Xo(n,e,t){for(t=t.child;t!==null;)qC(n,e,t),t=t.sibling}function qC(n,e,t){if(yi&&typeof yi.onCommitFiberUnmount=="function")try{yi.onCommitFiberUnmount(vh,t)}catch{}switch(t.tag){case 5:an||el(t,e);case 6:var r=Kt,i=Kr;Kt=null,Xo(n,e,t),Kt=r,Kr=i,Kt!==null&&(Kr?(n=Kt,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Kt.removeChild(t.stateNode));break;case 18:Kt!==null&&(Kr?(n=Kt,t=t.stateNode,n.nodeType===8?p0(n.parentNode,t):n.nodeType===1&&p0(n,t),Dc(n)):p0(Kt,t.stateNode));break;case 4:r=Kt,i=Kr,Kt=t.stateNode.containerInfo,Kr=!0,Xo(n,e,t),Kt=r,Kr=i;break;case 0:case 11:case 14:case 15:if(!an&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&WC(t,e,s),i=i.next}while(i!==r)}Xo(n,e,t);break;case 1:if(!an&&(el(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){_t(t,e,a)}Xo(n,e,t);break;case 21:Xo(n,e,t);break;case 22:t.mode&1?(an=(r=an)||t.memoizedState!==null,Xo(n,e,t),an=r):Xo(n,e,t);break;default:Xo(n,e,t)}}function ZC(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new XD),e.forEach(function(r){var i=oL.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function Gr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:Kt=a.stateNode,Kr=!1;break e;case 3:Kt=a.stateNode.containerInfo,Kr=!0;break e;case 4:Kt=a.stateNode.containerInfo,Kr=!0;break e}a=a.return}if(Kt===null)throw Error(Q(160));qC(o,s,i),Kt=null,Kr=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){_t(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JC(e,n),e=e.sibling}function JC(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Gr(e,n),Si(n),r&4){try{ru(3,n,n.return),ap(3,n)}catch(f){_t(n,n.return,f)}try{ru(5,n,n.return)}catch(f){_t(n,n.return,f)}}break;case 1:Gr(e,n),Si(n),r&512&&t!==null&&el(t,t.return);break;case 5:if(Gr(e,n),Si(n),r&512&&t!==null&&el(t,t.return),n.flags&32){var i=n.stateNode;try{kc(i,"")}catch(f){_t(n,n.return,f)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&k_(i,o),Ay(a,s);var c=Ay(a,o);for(s=0;s<l.length;s+=2){var u=l[s],d=l[s+1];u==="style"?j_(i,d):u==="dangerouslySetInnerHTML"?T_(i,d):u==="children"?kc(i,d):fy(i,u,d,c)}switch(a){case"input":Py(i,o);break;case"textarea":E_(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?Ra(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?Ra(i,!!o.multiple,o.defaultValue,!0):Ra(i,!!o.multiple,o.multiple?[]:"",!1))}i[Kc]=o}catch(f){_t(n,n.return,f)}}break;case 6:if(Gr(e,n),Si(n),r&4){if(n.stateNode===null)throw Error(Q(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(f){_t(n,n.return,f)}}break;case 3:if(Gr(e,n),Si(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Dc(e.containerInfo)}catch(f){_t(n,n.return,f)}break;case 4:Gr(e,n),Si(n);break;case 13:Gr(e,n),Si(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(nw=Mt())),r&4&&ZC(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(an=(c=an)||u,Gr(e,n),an=c):Gr(e,n),Si(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(ne=n,u=n.child;u!==null;){for(d=ne=u;ne!==null;){switch(h=ne,p=h.child,h.tag){case 0:case 11:case 14:case 15:ru(4,h,h.return);break;case 1:el(h,h.return);var g=h.stateNode;if(typeof g.componentWillUnmount=="function"){r=h,t=h.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(f){_t(r,t,f)}}break;case 5:el(h,h.return);break;case 22:if(h.memoizedState!==null){t2(d);continue}}p!==null?(p.return=h,ne=p):t2(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=A_("display",s))}catch(f){_t(n,n.return,f)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(f){_t(n,n.return,f)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Gr(e,n),Si(n),r&4&&ZC(n);break;case 21:break;default:Gr(e,n),Si(n)}}function Si(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(YC(t)){var r=t;break e}t=t.return}throw Error(Q(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(kc(i,""),r.flags&=-33);var o=XC(n);Q0(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=XC(n);J0(n,a,s);break;default:throw Error(Q(161))}}catch(l){_t(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function ZD(n,e,t){ne=n,QC(n)}function QC(n,e,t){for(var r=(n.mode&1)!==0;ne!==null;){var i=ne,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||sp;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||an;a=sp;var c=an;if(sp=s,(an=l)&&!c)for(ne=i;ne!==null;)s=ne,l=s.child,s.tag===22&&s.memoizedState!==null?n2(i):l!==null?(l.return=s,ne=l):n2(i);for(;o!==null;)ne=o,QC(o),o=o.sibling;ne=i,sp=a,an=c}e2(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ne=o):e2(n)}}function e2(n){for(;ne!==null;){var e=ne;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:an||ap(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!an)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Wr(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&qk(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}qk(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Dc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Q(163))}an||e.flags&512&&Z0(e)}catch(h){_t(e,e.return,h)}}if(e===n){ne=null;break}if(t=e.sibling,t!==null){t.return=e.return,ne=t;break}ne=e.return}}function t2(n){for(;ne!==null;){var e=ne;if(e===n){ne=null;break}var t=e.sibling;if(t!==null){t.return=e.return,ne=t;break}ne=e.return}}function n2(n){for(;ne!==null;){var e=ne;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{ap(4,e)}catch(l){_t(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){_t(e,i,l)}}var o=e.return;try{Z0(e)}catch(l){_t(e,o,l)}break;case 5:var s=e.return;try{Z0(e)}catch(l){_t(e,s,l)}}}catch(l){_t(e,e.return,l)}if(e===n){ne=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ne=a;break}ne=e.return}}var JD=Math.ceil,lp=Gi.ReactCurrentDispatcher,ew=Gi.ReactCurrentOwner,Er=Gi.ReactCurrentBatchConfig,Ae=0,Nt=null,At=null,Gt=0,ir=0,tl=Ho(0),Lt=0,iu=null,Vs=0,cp=0,tw=0,ou=null,Fn=null,nw=0,nl=1/0,to=null,up=!1,rw=null,qo=null,dp=!1,Zo=null,hp=0,su=0,iw=null,pp=-1,fp=0;function Pn(){return Ae&6?Mt():pp!==-1?pp:pp=Mt()}function Jo(n){return n.mode&1?Ae&2&&Gt!==0?Gt&-Gt:DD.transition!==null?(fp===0&&(fp=G_()),fp):(n=He,n!==0||(n=window.event,n=n===void 0?16:nk(n.type)),n):1}function Yr(n,e,t,r){if(50<su)throw su=0,iw=null,Error(Q(185));Tc(n,t,r),(!(Ae&2)||n!==Nt)&&(n===Nt&&(!(Ae&2)&&(cp|=t),Lt===4&&Qo(n,Gt)),$n(n,r),t===1&&Ae===0&&!(e.mode&1)&&(nl=Mt()+500,Uh&&Ko()))}function $n(n,e){var t=n.callbackNode;D5(n,e);var r=_h(n,n===Nt?Gt:0);if(r===0)t!==null&&H_(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&H_(t),e===1)n.tag===0?OD(i2.bind(null,n)):Bk(i2.bind(null,n)),TD(function(){!(Ae&6)&&Ko()}),t=null;else{switch(Y_(r)){case 1:t=Ny;break;case 4:t=W_;break;case 16:t=bh;break;case 536870912:t=K_;break;default:t=bh}t=h2(t,r2.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function r2(n,e){if(pp=-1,fp=0,Ae&6)throw Error(Q(327));var t=n.callbackNode;if(rl()&&n.callbackNode!==t)return null;var r=_h(n,n===Nt?Gt:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=gp(n,r);else{e=r;var i=Ae;Ae|=2;var o=s2();(Nt!==n||Gt!==e)&&(to=null,nl=Mt()+500,Ws(n,e));do try{tL();break}catch(a){o2(n,a)}while(1);_0(),lp.current=o,Ae=i,At!==null?e=0:(Nt=null,Gt=0,e=Lt)}if(e!==0){if(e===2&&(i=Fy(n),i!==0&&(r=i,e=ow(n,i))),e===1)throw t=iu,Ws(n,0),Qo(n,r),$n(n,Mt()),t;if(e===6)Qo(n,r);else{if(i=n.current.alternate,!(r&30)&&!QD(i)&&(e=gp(n,r),e===2&&(o=Fy(n),o!==0&&(r=o,e=ow(n,o))),e===1))throw t=iu,Ws(n,0),Qo(n,r),$n(n,Mt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Q(345));case 2:Ks(n,Fn,to);break;case 3:if(Qo(n,r),(r&130023424)===r&&(e=nw+500-Mt(),10<e)){if(_h(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Pn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=h0(Ks.bind(null,n,Fn,to),e);break}Ks(n,Fn,to);break;case 4:if(Qo(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-Ur(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Mt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*JD(r/1960))-r,10<r){n.timeoutHandle=h0(Ks.bind(null,n,Fn,to),r);break}Ks(n,Fn,to);break;case 5:Ks(n,Fn,to);break;default:throw Error(Q(329))}}}return $n(n,Mt()),n.callbackNode===t?r2.bind(null,n):null}function ow(n,e){var t=ou;return n.current.memoizedState.isDehydrated&&(Ws(n,e).flags|=256),n=gp(n,e),n!==2&&(e=Fn,Fn=t,e!==null&&sw(e)),n}function sw(n){Fn===null?Fn=n:Fn.push.apply(Fn,n)}function QD(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Vr(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Qo(n,e){for(e&=~tw,e&=~cp,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Ur(e),r=1<<t;n[t]=-1,e&=~r}}function i2(n){if(Ae&6)throw Error(Q(327));rl();var e=_h(n,0);if(!(e&1))return $n(n,Mt()),null;var t=gp(n,e);if(n.tag!==0&&t===2){var r=Fy(n);r!==0&&(e=r,t=ow(n,r))}if(t===1)throw t=iu,Ws(n,0),Qo(n,e),$n(n,Mt()),t;if(t===6)throw Error(Q(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ks(n,Fn,to),$n(n,Mt()),null}function aw(n,e){var t=Ae;Ae|=1;try{return n(e)}finally{Ae=t,Ae===0&&(nl=Mt()+500,Uh&&Ko())}}function Hs(n){Zo!==null&&Zo.tag===0&&!(Ae&6)&&rl();var e=Ae;Ae|=1;var t=Er.transition,r=He;try{if(Er.transition=null,He=1,n)return n()}finally{He=r,Er.transition=t,Ae=e,!(Ae&6)&&Ko()}}function lw(){ir=tl.current,lt(tl)}function Ws(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,MD(t)),At!==null)for(t=At.return;t!==null;){var r=t;switch(w0(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$h();break;case 3:Ja(),lt(Ln),lt(rn),R0();break;case 5:A0(r);break;case 4:Ja();break;case 13:lt(gt);break;case 19:lt(gt);break;case 10:k0(r.type._context);break;case 22:case 23:lw()}t=t.return}if(Nt=n,At=n=es(n.current,null),Gt=ir=e,Lt=0,iu=null,tw=cp=Vs=0,Fn=ou=null,$s!==null){for(e=0;e<$s.length;e++)if(t=$s[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}$s=null}return n}function o2(n,e){do{var t=At;try{if(_0(),Qh.current=rp,ep){for(var r=mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}ep=!1}if(Us=0,zt=Dt=mt=null,Jc=!1,Qc=0,ew.current=null,t===null||t.return===null){Lt=1,iu=e,At=null;break}e:{var o=n,s=t.return,a=t,l=e;if(e=Gt,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var p=MC(s);if(p!==null){p.flags&=-257,TC(p,s,a,o,e),p.mode&1&&IC(o,c,e),e=p,l=c;var g=e.updateQueue;if(g===null){var f=new Set;f.add(l),e.updateQueue=f}else g.add(l);break e}else{if(!(e&1)){IC(o,c,e),cw();break e}l=Error(Q(426))}}else if(dt&&a.mode&1){var m=MC(s);if(m!==null){!(m.flags&65536)&&(m.flags|=256),TC(m,s,a,o,e),S0(Qa(l,a));break e}}o=l=Qa(l,a),Lt!==4&&(Lt=2),ou===null?ou=[o]:ou.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var v=PC(o,l,e);Xk(o,v);break e;case 1:a=l;var b=o.type,_=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(qo===null||!qo.has(_)))){o.flags|=65536,e&=-e,o.lanes|=e;var x=EC(o,a,e);Xk(o,x);break e}}o=o.return}while(o!==null)}l2(t)}catch(C){e=C,At===t&&t!==null&&(At=t=t.return);continue}break}while(1)}function s2(){var n=lp.current;return lp.current=rp,n===null?rp:n}function cw(){(Lt===0||Lt===3||Lt===2)&&(Lt=4),Nt===null||!(Vs&268435455)&&!(cp&268435455)||Qo(Nt,Gt)}function gp(n,e){var t=Ae;Ae|=2;var r=s2();(Nt!==n||Gt!==e)&&(to=null,Ws(n,e));do try{eL();break}catch(i){o2(n,i)}while(1);if(_0(),Ae=t,lp.current=r,At!==null)throw Error(Q(261));return Nt=null,Gt=0,Lt}function eL(){for(;At!==null;)a2(At)}function tL(){for(;At!==null&&!P5();)a2(At)}function a2(n){var e=d2(n.alternate,n,ir);n.memoizedProps=n.pendingProps,e===null?l2(n):At=e,ew.current=null}function l2(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=YD(t,e),t!==null){t.flags&=32767,At=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Lt=6,At=null;return}}else if(t=GD(t,e,ir),t!==null){At=t;return}if(e=e.sibling,e!==null){At=e;return}At=e=n}while(e!==null);Lt===0&&(Lt=5)}function Ks(n,e,t){var r=He,i=Er.transition;try{Er.transition=null,He=1,nL(n,e,t,r)}finally{Er.transition=i,He=r}return null}function nL(n,e,t,r){do rl();while(Zo!==null);if(Ae&6)throw Error(Q(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Q(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(L5(n,o),n===Nt&&(At=Nt=null,Gt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||dp||(dp=!0,h2(bh,function(){return rl(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=Er.transition,Er.transition=null;var s=He;He=1;var a=Ae;Ae|=4,ew.current=null,qD(n,t),JC(t,n),xD(u0),Ph=!!c0,u0=c0=null,n.current=t,ZD(t),E5(),Ae=a,He=s,Er.transition=o}else n.current=t;if(dp&&(dp=!1,Zo=n,hp=i),o=n.pendingLanes,o===0&&(qo=null),T5(t.stateNode),$n(n,Mt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(up)throw up=!1,n=rw,rw=null,n;return hp&1&&n.tag!==0&&rl(),o=n.pendingLanes,o&1?n===iw?su++:(su=0,iw=n):su=0,Ko(),null}function rl(){if(Zo!==null){var n=Y_(hp),e=Er.transition,t=He;try{if(Er.transition=null,He=16>n?16:n,Zo===null)var r=!1;else{if(n=Zo,Zo=null,hp=0,Ae&6)throw Error(Q(331));var i=Ae;for(Ae|=4,ne=n.current;ne!==null;){var o=ne,s=o.child;if(ne.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ne=c;ne!==null;){var u=ne;switch(u.tag){case 0:case 11:case 15:ru(8,u,o)}var d=u.child;if(d!==null)d.return=u,ne=d;else for(;ne!==null;){u=ne;var h=u.sibling,p=u.return;if(GC(u),u===c){ne=null;break}if(h!==null){h.return=p,ne=h;break}ne=p}}}var g=o.alternate;if(g!==null){var f=g.child;if(f!==null){g.child=null;do{var m=f.sibling;f.sibling=null,f=m}while(f!==null)}}ne=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,ne=s;else e:for(;ne!==null;){if(o=ne,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var v=o.sibling;if(v!==null){v.return=o.return,ne=v;break e}ne=o.return}}var b=n.current;for(ne=b;ne!==null;){s=ne;var _=s.child;if(s.subtreeFlags&2064&&_!==null)_.return=s,ne=_;else e:for(s=b;ne!==null;){if(a=ne,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ap(9,a)}}catch(C){_t(a,a.return,C)}if(a===s){ne=null;break e}var x=a.sibling;if(x!==null){x.return=a.return,ne=x;break e}ne=a.return}}if(Ae=i,Ko(),yi&&typeof yi.onPostCommitFiberRoot=="function")try{yi.onPostCommitFiberRoot(vh,n)}catch{}r=!0}return r}finally{He=t,Er.transition=e}}return!1}function c2(n,e,t){e=Qa(t,e),e=PC(n,e,1),n=Yo(n,e,1),e=Pn(),n!==null&&(Tc(n,1,e),$n(n,e))}function _t(n,e,t){if(n.tag===3)c2(n,n,t);else for(;e!==null;){if(e.tag===3){c2(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(qo===null||!qo.has(r))){n=Qa(t,n),n=EC(e,n,1),e=Yo(e,n,1),n=Pn(),e!==null&&(Tc(e,1,n),$n(e,n));break}}e=e.return}}function rL(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Pn(),n.pingedLanes|=n.suspendedLanes&t,Nt===n&&(Gt&t)===t&&(Lt===4||Lt===3&&(Gt&130023424)===Gt&&500>Mt()-nw?Ws(n,0):tw|=t),$n(n,e)}function u2(n,e){e===0&&(n.mode&1?(e=xh,xh<<=1,!(xh&130023424)&&(xh=4194304)):e=1);var t=Pn();n=Ji(n,e),n!==null&&(Tc(n,e,t),$n(n,t))}function iL(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),u2(n,t)}function oL(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Q(314))}r!==null&&r.delete(e),u2(n,t)}var d2;d2=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ln.current)Nn=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Nn=!1,KD(n,e,t);Nn=!!(n.flags&131072)}else Nn=!1,dt&&e.flags&1048576&&Uk(e,Hh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;op(n,e),n=e.pendingProps;var i=Wa(e,rn.current);qa(e,t),i=L0(null,e,r,n,i,t);var o=z0();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,zn(r)?(o=!0,Bh(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,E0(e),i.updater=qh,e.stateNode=i,i._reactInternals=e,M0(e,r,n,t),e=W0(null,e,r,!0,o,t)):(e.tag=0,dt&&o&&y0(e),Cn(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(op(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=aL(r),n=Wr(r,n),i){case 0:e=H0(null,e,r,n,t);break e;case 1:e=LC(null,e,r,n,t);break e;case 11:e=AC(null,e,r,n,t);break e;case 14:e=jC(null,e,r,Wr(r.type,n),t);break e}throw Error(Q(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wr(r,i),H0(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wr(r,i),LC(n,e,r,i,t);case 3:e:{if(zC(e),n===null)throw Error(Q(387));r=e.pendingProps,o=e.memoizedState,i=o.element,Yk(n,e),Xh(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Qa(Error(Q(423)),e),e=NC(n,e,r,t,i);break e}else if(r!==i){i=Qa(Error(Q(424)),e),e=NC(n,e,r,t,i);break e}else for(rr=Vo(e.stateNode.containerInfo.firstChild),nr=e,dt=!0,Hr=null,t=rC(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ya(),r===i){e=eo(n,e,t);break e}Cn(n,e,r,t)}e=e.child}return e;case 5:return iC(e),n===null&&v0(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,d0(r,i)?s=null:o!==null&&d0(r,o)&&(e.flags|=32),DC(n,e),Cn(n,e,s,t),e.child;case 6:return n===null&&v0(e),null;case 13:return FC(n,e,t);case 4:return T0(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Za(e,null,r,t):Cn(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wr(r,i),AC(n,e,r,i,t);case 7:return Cn(n,e,e.pendingProps,t),e.child;case 8:return Cn(n,e,e.pendingProps.children,t),e.child;case 12:return Cn(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,et(Kh,r._currentValue),r._currentValue=s,o!==null)if(Vr(o.value,s)){if(o.children===i.children&&!Ln.current){e=eo(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=Qi(-1,t&-t),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),C0(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Q(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),C0(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Cn(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,qa(e,t),i=Cr(i),r=r(i),e.flags|=1,Cn(n,e,r,t),e.child;case 14:return r=e.type,i=Wr(r,e.pendingProps),i=Wr(r.type,i),jC(n,e,r,i,t);case 15:return RC(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Wr(r,i),op(n,e),e.tag=1,zn(r)?(n=!0,Bh(e)):n=!1,qa(e,t),Qk(e,r,i),M0(e,r,i,t),W0(null,e,r,!0,n,t);case 19:return BC(n,e,t);case 22:return OC(n,e,t)}throw Error(Q(156,e.tag))};function h2(n,e){return V_(n,e)}function sL(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ir(n,e,t,r){return new sL(n,e,t,r)}function uw(n){return n=n.prototype,!(!n||!n.isReactComponent)}function aL(n){if(typeof n=="function")return uw(n)?1:0;if(n!=null){if(n=n.$$typeof,n===yy)return 11;if(n===vy)return 14}return 2}function es(n,e){var t=n.alternate;return t===null?(t=Ir(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function mp(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")uw(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case ja:return Gs(t.children,i,o,e);case gy:s=8,i|=8;break;case my:return n=Ir(12,t,e,i|2),n.elementType=my,n.lanes=o,n;case wy:return n=Ir(13,t,e,i),n.elementType=wy,n.lanes=o,n;case by:return n=Ir(19,t,e,i),n.elementType=by,n.lanes=o,n;case b_:return yp(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case y_:s=10;break e;case w_:s=9;break e;case yy:s=11;break e;case vy:s=14;break e;case Do:s=16,r=null;break e}throw Error(Q(130,n==null?n:typeof n,""))}return e=Ir(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Gs(n,e,t,r){return n=Ir(7,n,r,e),n.lanes=t,n}function yp(n,e,t,r){return n=Ir(22,n,r,e),n.elementType=b_,n.lanes=t,n.stateNode={isHidden:!1},n}function dw(n,e,t){return n=Ir(6,n,null,e),n.lanes=t,n}function hw(n,e,t){return e=Ir(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function lL(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$y(0),this.expirationTimes=$y(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$y(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function pw(n,e,t,r,i,o,s,a,l){return n=new lL(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Ir(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},E0(o),n}function cL(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Aa,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function p2(n){if(!n)return Wo;n=n._reactInternals;e:{if(Ds(n)!==n||n.tag!==1)throw Error(Q(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(zn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Q(171))}if(n.tag===1){var t=n.type;if(zn(t))return Fk(n,t,e)}return e}function f2(n,e,t,r,i,o,s,a,l){return n=pw(t,r,!0,n,i,o,s,a,l),n.context=p2(null),t=n.current,r=Pn(),i=Jo(t),o=Qi(r,i),o.callback=e??null,Yo(t,o,i),n.current.lanes=i,Tc(n,i,r),$n(n,r),n}function wp(n,e,t,r){var i=e.current,o=Pn(),s=Jo(i);return t=p2(t),e.context===null?e.context=t:e.pendingContext=t,e=Qi(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Yo(i,e,s),n!==null&&(Yr(n,i,s,o),Yh(n,i,s)),s}function bp(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function g2(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function fw(n,e){g2(n,e),(n=n.alternate)&&g2(n,e)}function uL(){return null}var m2=typeof reportError=="function"?reportError:function(n){console.error(n)};function gw(n){this._internalRoot=n}vp.prototype.render=gw.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Q(409));wp(n,e,null,null)},vp.prototype.unmount=gw.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Hs(function(){wp(null,n,null,null)}),e[Yi]=null}};function vp(n){this._internalRoot=n}vp.prototype.unstable_scheduleHydration=function(n){if(n){var e=Z_();n={blockedOn:null,target:n,priority:e};for(var t=0;t<$o.length&&e!==0&&e<$o[t].priority;t++);$o.splice(t,0,n),t===0&&ek(n)}};function mw(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Sp(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function y2(){}function dL(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=bp(s);o.call(c)}}var s=f2(e,r,n,0,null,!1,!1,"",y2);return n._reactRootContainer=s,n[Yi]=s.current,Hc(n.nodeType===8?n.parentNode:n),Hs(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=bp(l);a.call(c)}}var l=pw(n,0,!1,null,null,!1,!1,"",y2);return n._reactRootContainer=l,n[Yi]=l.current,Hc(n.nodeType===8?n.parentNode:n),Hs(function(){wp(e,l,t,r)}),l}function xp(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=bp(s);a.call(l)}}wp(e,s,n,i)}else s=dL(t,e,n,i,r);return bp(s)}X_=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Mc(e.pendingLanes);t!==0&&(By(e,t|1),$n(e,Mt()),!(Ae&6)&&(nl=Mt()+500,Ko()))}break;case 13:Hs(function(){var r=Ji(n,1);if(r!==null){var i=Pn();Yr(r,n,1,i)}}),fw(n,1)}},Uy=function(n){if(n.tag===13){var e=Ji(n,134217728);if(e!==null){var t=Pn();Yr(e,n,134217728,t)}fw(n,134217728)}},q_=function(n){if(n.tag===13){var e=Jo(n),t=Ji(n,e);if(t!==null){var r=Pn();Yr(t,n,e,r)}fw(n,e)}},Z_=function(){return He},J_=function(n,e){var t=He;try{return He=n,e()}finally{He=t}},Oy=function(n,e,t){switch(e){case"input":if(Py(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=Fh(r);if(!i)throw Error(Q(90));x_(r),Py(r,i)}}}break;case"textarea":E_(n,t);break;case"select":e=t.value,e!=null&&Ra(n,!!t.multiple,e,!1)}},L_=aw,z_=Hs;var hL={usingClientEntryPoint:!1,Events:[Gc,Va,Fh,O_,D_,aw]},au={findFiberByHostInstance:Ls,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pL={bundleType:au.bundleType,version:au.version,rendererPackageName:au.rendererPackageName,rendererConfig:au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gi.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=B_(n),n===null?null:n.stateNode},findFiberByHostInstance:au.findFiberByHostInstance||uL,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _p=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_p.isDisabled&&_p.supportsFiber)try{vh=_p.inject(pL),yi=_p}catch{}}Qn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hL,Qn.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!mw(e))throw Error(Q(200));return cL(n,e,null,t)},Qn.createRoot=function(n,e){if(!mw(n))throw Error(Q(299));var t=!1,r="",i=m2;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=pw(n,1,!1,null,null,t,!1,r,i),n[Yi]=e.current,Hc(n.nodeType===8?n.parentNode:n),new gw(e)},Qn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Q(188)):(n=Object.keys(n).join(","),Error(Q(268,n)));return n=B_(e),n=n===null?null:n.stateNode,n},Qn.flushSync=function(n){return Hs(n)},Qn.hydrate=function(n,e,t){if(!Sp(e))throw Error(Q(200));return xp(null,n,e,!0,t)},Qn.hydrateRoot=function(n,e,t){if(!mw(n))throw Error(Q(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=m2;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=f2(e,null,n,1,t??null,i,!1,o,s),n[Yi]=e.current,Hc(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new vp(e)},Qn.render=function(n,e,t){if(!Sp(e))throw Error(Q(200));return xp(null,n,e,!1,t)},Qn.unmountComponentAtNode=function(n){if(!Sp(n))throw Error(Q(40));return n._reactRootContainer?(Hs(function(){xp(null,null,n,!1,function(){n._reactRootContainer=null,n[Yi]=null})}),!0):!1},Qn.unstable_batchedUpdates=aw,Qn.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Sp(t))throw Error(Q(200));if(n==null||n._reactInternals===void 0)throw Error(Q(38));return xp(n,e,t,!1,r)},Qn.version="18.2.0-next-9e3b772b8-20220608";function w2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(w2)}catch(n){console.error(n)}}w2(),u_.exports=Qn;var il=u_.exports;const fL=Jn(il);var b2=il;uy.createRoot=b2.createRoot,uy.hydrateRoot=b2.hydrateRoot;function v2(n){return n&&typeof n=="object"&&"parents"in n}function S2(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const kp=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&v2(n))for(let t=0,r=n.parents.length;t<r;t++)kp(n.parents[t],n)},yw=(n,e)=>{if(n.children.add(e)&&v2(n))for(let t=0,r=n.parents.length;t<r;t++)yw(n.parents[t],n)};function x2(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function ts(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const no=ts("empty_array",()=>Object.freeze([])),_2=8;class k2{constructor(){w(this,"arraySize",0);w(this,"array",Array(_2));w(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<_2?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}}const or=Symbol.for("com.tldraw.state/RESET_VALUE");class C2{constructor(e){w(this,"index",0);w(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===or){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let o=0;o<r;o++){const s=(t-1+r-o)%r,a=i[s];if(!a)return or;const[l,c]=a;if(o===0&&e>=c)return[];if(l<=e&&e<c){const u=o+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=i[(s+h)%r][2];return d}}return or}}class gL{constructor(e,t){w(this,"offset",0);w(this,"numNewParents",0);w(this,"maybeRemoved");this.below=e,this.child=t}}const ct=ts("capture",()=>({stack:null}));function P2(n){ct.stack=new gL(ct.stack,n)}function E2(){var e;const n=ct.stack;if(ct.stack=n.below,n.numNewParents>0||n.offset!==n.child.parents.length){for(let t=n.offset;t<n.child.parents.length;t++){const r=n.child.parents[t];n.child.parents.indexOf(r)>=n.offset&&kp(r,n.child)}if(n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset,(e=ct.stack)==null?void 0:e.maybeRemoved)for(let t=0;t<ct.stack.maybeRemoved.length;t++){const r=ct.stack.maybeRemoved[t];n.child.parents.indexOf(r)===-1&&kp(r,n.child)}}}function ww(n){if(ct.stack){const e=ct.stack.child.parents.indexOf(n);if(e<0&&(ct.stack.numNewParents++,ct.stack.child.isActivelyListening&&yw(n,ct.stack.child)),e<0||e>=ct.stack.offset){if(e!==ct.stack.offset&&e>0){const t=ct.stack.child.parents[ct.stack.offset];ct.stack.maybeRemoved?ct.stack.maybeRemoved.indexOf(t)===-1&&ct.stack.maybeRemoved.push(t):ct.stack.maybeRemoved=[t]}ct.stack.child.parents[ct.stack.offset]=n,ct.stack.child.parentEpochs[ct.stack.offset]=n.lastChangedEpoch,ct.stack.offset++}}}const Ys=-1;class mL{constructor(e,t,r){w(this,"_isActivelyListening",!1);w(this,"lastTraversedEpoch",Ys);w(this,"lastReactedEpoch",Ys);w(this,"_scheduleCount",0);w(this,"parentEpochs",[]);w(this,"parents",[]);w(this,"_scheduleEffect");w(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==sr()){if(this.parents.length&&!S2(this)){this.lastReactedEpoch=sr();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)yw(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)kp(this.parents[e],this)}execute(){try{P2(this);const e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=sr(),e}finally{E2()}}}const ol=ts("EffectScheduler",()=>mL);function lu(n,e,t){const r=new ol(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function yL(n,e,t){const r=new ol(n,e,t);return{scheduler:r,start:i=>{const o=(i==null?void 0:i.force)??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class wL{constructor(e){w(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const e=this.initialAtomValues;this.initialAtomValues=new Map,I2(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){ln.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}}const ln=ts("transactions",()=>({globalEpoch:Ys+1,globalIsReacting:!1,currentTransaction:null}));function sr(){return ln.globalEpoch}function I2(n){if(ln.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{ln.globalIsReacting=!0;const e=new Set,t=r=>{r.lastTraversedEpoch!==ln.globalEpoch&&(r.lastTraversedEpoch=ln.globalEpoch,r instanceof ol?e.add(r):r.children.visit(t))};for(const r of n)r.children.visit(t);for(const r of e)r.maybeScheduleEffect()}finally{ln.globalIsReacting=!1}}function bL(n,e){ln.currentTransaction?ln.currentTransaction.initialAtomValues.has(n)||ln.currentTransaction.initialAtomValues.set(n,e):I2([n])}function vL(){ln.globalEpoch++}function SL(n){const e=new wL(ln.currentTransaction);ln.currentTransaction=e;try{let t=!1;const r=n(()=>t=!0);return t?e.abort():e.commit(),r}catch(t){throw e.abort(),t}finally{ln.currentTransaction=ln.currentTransaction.parent}}function Xr(n){return ln.currentTransaction?n():SL(n)}class xL{constructor(e,t,r){w(this,"isEqual");w(this,"computeDiff");w(this,"lastChangedEpoch",sr());w(this,"children",new k2);w(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new C2(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get(){return ww(this),this.current}set(e,t){var i,o;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??x2(this.current,e))return this.current;vL(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,sr(),t??((o=this.computeDiff)==null?void 0:o.call(this,this.current,e,this.lastChangedEpoch,sr()))??or),this.lastChangedEpoch=sr();const r=this.current;return this.current=e,bL(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return ww(this),e>=this.lastChangedEpoch?no:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??or}}const _L=ts("Atom",()=>xL);function En(n,e,t){return new _L(n,e,t)}let M2=!1;function kL(){M2||(M2=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const bw=Symbol.for("com.tldraw.state/UNINITIALIZED"),sl=n=>n===bw,vw=ts("WithDiff",()=>class{constructor(n,e){this.value=n,this.diff=e}});function cu(n,e){return new vw(n,e)}class CL{constructor(e,t,r){w(this,"lastChangedEpoch",Ys);w(this,"lastTraversedEpoch",Ys);w(this,"lastCheckedEpoch",Ys);w(this,"parents",[]);w(this,"parentEpochs",[]);w(this,"children",new k2);w(this,"historyBuffer");w(this,"state",bw);w(this,"computeDiff");w(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new C2(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??x2}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var t;const e=this.lastChangedEpoch===Ys;if(!e&&(this.lastCheckedEpoch===sr()||!S2(this)))return this.lastCheckedEpoch=sr(),this.state;try{P2(this);const r=this.derive(this.state,this.lastCheckedEpoch),i=r instanceof vw?r.value:r;if(this.state===bw||!this.isEqual(i,this.state)){if(this.historyBuffer&&!e){const o=r instanceof vw?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,sr(),o??((t=this.computeDiff)==null?void 0:t.call(this,this.state,i,this.lastCheckedEpoch,sr()))??or)}this.lastChangedEpoch=sr(),this.state=i}return this.lastCheckedEpoch=sr(),this.state}finally{E2()}}get(){const e=this.__unsafe__getWithoutCapture();return ww(this),e}getDiffSince(e){var t;return this.get(),e>=this.lastChangedEpoch?no:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??or}}const Sw=ts("Computed",()=>CL);function PL(n={},e,t,r){const i=r.value,o=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let s=this[o];return s||(s=new Sw(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[IL]=!0,r}function T2(n={},e,t,r){return r.get?(kL(),EL(n,e,t,r)):PL(n,e,t,r)}function EL(n={},e,t,r){const i=r.get,o=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let s=this[o];return s||(s=new Sw(t,i.bind(this),n),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}const IL="@@__isComputedMethod__@@";function ee(){if(arguments.length===1){const n=arguments[0];return(e,t,r)=>T2(n,e,t,r)}else return typeof arguments[0]=="string"?new Sw(arguments[0],arguments[1],arguments[2]):T2(void 0,arguments[0],arguments[1],arguments[2])}const A2=1;if(ts("apiVersion",()=>A2)!==A2)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");function Cp(n,e){const t=oe.useRef(e);t.current=e;const[r,i,o]=oe.useMemo(()=>{let s=null;const a=c=>(s=c,()=>{s=null}),l=new ol(`useStateTracking(${n})`,()=>{var c;return(c=t.current)==null?void 0:c.call(t)},{scheduleEffect(){s==null||s()}});return[l,a,()=>l.scheduleCount]},[n]);return oe.useSyncExternalStore(i,o,o),oe.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const j2={apply(n,e,t){return Cp(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},ML=Symbol.for("react.memo"),TL=Symbol.for("react.forward_ref");function ze(n){let e=null;const t=n.$$typeof;return t===ML&&(n=n.type,e=n.compare),t===TL?S.memo(S.forwardRef(new Proxy(n.render,j2))):S.memo(new Proxy(n,j2),e)}function R2(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return S.useMemo(()=>ee(`useComputed(${n})`,e,t),r)}function Xs(n,e,t=no){S.useEffect(()=>{const r=new ol(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function Z(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=S.useRef(!0);r.current=!0;const i=S.useMemo(()=>n.length===1?n[0]:ee(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:s}=S.useMemo(()=>({subscribe:a=>lu(`useValue(${t})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return S.useSyncExternalStore(o,s,s)}finally{r.current=!1}}class Pp{constructor(e){w(this,"nextValue");w(this,"diff");this.previousValue=e}get(){var r,i,o,s;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var r,i,o;const t=this.previousValue.has(e);if(t)return(i=(r=this.diff)==null?void 0:r.removed)!=null&&i.has(e)?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var r,i,o,s;const t=this.previousValue.has(e);if(!t)return(i=(r=this.diff)==null?void 0:r.added)!=null&&i.has(e)?this._remove(e,t):void 0;(s=(o=this.diff)==null?void 0:o.removed)!=null&&s.has(e)||this._remove(e,t)}}function Ep(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function ye(n){return n.filter(e=>e!=null)}function Bn(n){return n[n.length-1]}function AL(n,e){let t,r=1/0;for(const i of n){const o=e(i);o<r&&(t=i,r=o)}return t}function jL(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function O2(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}function al(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const qs=O2((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),RL=O2((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function D2(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((o,s)=>{t.resolve=o,t.reject=s})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const o=t;t=void 0;try{o.resolve(n(...o.latestArgs))}catch(s){o.reject(s)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const L2=new WeakMap;function xw(n,e){if(typeof n!="object"||n===null)return;let t=L2.get(n);t||(t={tags:{},extras:{}},L2.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}class OL{static async base64ToFile(e){return fetch(e).then(function(t){return t.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o)}})}}function Ip(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}let _w=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(_w=new Int32Array(_w));const DL=(n,e)=>{let t=e===0?0:~~e^-1;for(let r=0;r<n.length;r++)t=_w[(t^n[r])&255]^t>>>8;return t^-1},z2=4,N2=4;class xi{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!xi.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,o=e.getInt32(t);t+=4;const s=xi.getChunkType(e,t);if(s==="IDAT"&&r[s]){t+=o+z2+N2;continue}if(s==="IEND")break;r[s]={start:i,dataOffset:t+4,size:o},t+=o+z2+N2}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return xi.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,o=0;const s=xi.findChunk(e,"pHYs");s&&(i=s.start,o=s.size);const a=xi.findChunk(e,"IDAT");a&&(i=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,"p".charCodeAt(0)),c.setUint8(5,"H".charCodeAt(0)),c.setUint8(6,"Y".charCodeAt(0)),c.setUint8(7,"s".charCodeAt(0));const u=2835.5;c.setInt32(8,u*t),c.setInt32(12,u*t),c.setInt8(16,1);const d=new Uint8Array(l.slice(4,17));c.setInt32(17,DL(d));const h=e.buffer.slice(0,i),p=e.buffer.slice(i+o);return new Blob([h,l,p],r)}}class F2{static async getVideoSizeFromSrc(e){return await new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t({w:i.videoWidth,h:i.videoHeight}),i.onerror=o=>{console.error(o),r(new Error("Could not get video size"))},i.crossOrigin="anonymous",i.src=e})}static async getImageSizeFromSrc(e){return await new Promise((t,r)=>{const i=new Image;i.onload=async()=>{try{const o=await OL.base64ToFile(e),s=new DataView(o);if(xi.isPng(s,0)){const a=xi.findChunk(s,"pHYs");if(a){const l=xi.parsePhys(s,a.dataOffset);if(l.unit===0&&l.ppux===l.ppuy){const c=Math.max(l.ppux/2834.5,1);t({w:Math.round(i.width/c),h:Math.round(i.height/c)});return}}}t({w:i.width,h:i.height})}catch(o){console.error(o),t({w:i.width,h:i.height})}},i.onerror=o=>{console.error(o),r(new Error("Could not get image size"))},i.crossOrigin="anonymous",i.src=e})}}function ns(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function Mp(n,e,t,r=!1){const[i,o]=e,[s,a]=t,l=s+(n-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function Tp(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Zs(n,e){if(Tp(n,e))return n[e]}function cn(n){if(!n)return n;if(Array.isArray(n)){const e=[],t=n.length;for(let r=0;r<t;r++)e.push(cn(n[r]));return e}else if(typeof n=="object"){const e=Object.keys(n),t=e.length,r={};for(let i=0;i<t;i++){const o=e[i];r[o]=cn(n[o])}return r}return n}function $2(n){return Object.keys(n)}function kt(n){return Object.values(n)}function ro(n){return Object.entries(n)}function B2(n){return Object.fromEntries(n)}function kw(n,e){const t={};let r=!1;for(const[i,o]of ro(n))e(i,o)?t[i]=o:r=!0;return r?t:n}function U2(n,e){const t={};for(const[r,i]of ro(n)){const o=e(r,i);t[r]=o}return t}function V2(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}const LL=()=>typeof process<"u"&&!1,Ap=[],zL=()=>{const n=Ap.splice(0,Ap.length);for(const e of n)e()};let Cw;function NL(){Cw||(Cw=requestAnimationFrame(()=>{Cw=void 0,zL()}))}function FL(n){if(LL())return n();Ap.includes(n)||(Ap.push(n),NL())}function $L(n,e){return n.id>e.id?1:-1}function BL(n){return n!==null}const rs=typeof window<"u"&&window.structuredClone?window.structuredClone:n=>n&&JSON.parse(JSON.stringify(n));let jp=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class Pw{constructor(e,t){w(this,"createDefaultProperties");w(this,"migrations");w(this,"validator");w(this,"scope");w(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:r=>r},this.scope=t.scope??"document"}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...rs(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??jp())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Pw(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function io(n,e){return new Pw(n,{createDefaultProperties:()=>({}),migrations:e.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:e.validator,scope:e.scope})}class H2{constructor(){w(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}var Rp={exports:{}};Rp.exports,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Function]",g="[object GeneratorFunction]",f="[object Map]",m="[object Number]",v="[object Null]",b="[object Object]",_="[object Promise]",x="[object Proxy]",C="[object RegExp]",k="[object Set]",E="[object String]",I="[object Symbol]",T="[object Undefined]",A="[object WeakMap]",D="[object ArrayBuffer]",N="[object DataView]",U="[object Float32Array]",R="[object Float64Array]",B="[object Int8Array]",$="[object Int16Array]",q="[object Int32Array]",G="[object Uint8Array]",L="[object Uint8ClampedArray]",V="[object Uint16Array]",J="[object Uint32Array]",le=/[\\^$.*+?()[\]{}|]/g,me=/^\[object .+?Constructor\]$/,ve=/^(?:0|[1-9]\d*)$/,fe={};fe[U]=fe[R]=fe[B]=fe[$]=fe[q]=fe[G]=fe[L]=fe[V]=fe[J]=!0,fe[a]=fe[l]=fe[D]=fe[u]=fe[N]=fe[d]=fe[h]=fe[p]=fe[f]=fe[m]=fe[b]=fe[C]=fe[k]=fe[E]=fe[A]=!1;var Pe=typeof Ce=="object"&&Ce&&Ce.Object===Object&&Ce,Rt=typeof self=="object"&&self&&self.Object===Object&&self,Ue=Pe||Rt||Function("return this")(),Le=e&&!e.nodeType&&e,Ve=Le&&!0&&n&&!n.nodeType&&n,gi=Ve&&Ve.exports===Le,Zn=gi&&Pe.process,Sr=function(){try{return Zn&&Zn.binding&&Zn.binding("util")}catch{}}(),Ot=Sr&&Sr.isTypedArray;function Et(j,F){for(var X=-1,ie=j==null?0:j.length,ut=0,ke=[];++X<ie;){var It=j[X];F(It,X,j)&&(ke[ut++]=It)}return ke}function jo(j,F){for(var X=-1,ie=F.length,ut=j.length;++X<ie;)j[ut+X]=F[X];return j}function ih(j,F){for(var X=-1,ie=j==null?0:j.length;++X<ie;)if(F(j[X],X,j))return!0;return!1}function Bx(j,F){for(var X=-1,ie=Array(j);++X<j;)ie[X]=F(X);return ie}function Ux(j){return function(F){return j(F)}}function Vx(j,F){return j.has(F)}function yc(j,F){return j==null?void 0:j[F]}function $he(j){var F=-1,X=Array(j.size);return j.forEach(function(ie,ut){X[++F]=[ut,ie]}),X}function Bhe(j,F){return function(X){return j(F(X))}}function Uhe(j){var F=-1,X=Array(j.size);return j.forEach(function(ie){X[++F]=ie}),X}var Vhe=Array.prototype,Hhe=Function.prototype,Zm=Object.prototype,Hx=Ue["__core-js_shared__"],C4=Hhe.toString,Wi=Zm.hasOwnProperty,P4=function(){var j=/[^.]+$/.exec(Hx&&Hx.keys&&Hx.keys.IE_PROTO||"");return j?"Symbol(src)_1."+j:""}(),E4=Zm.toString,Whe=RegExp("^"+C4.call(Wi).replace(le,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),I4=gi?Ue.Buffer:void 0,Jm=Ue.Symbol,M4=Ue.Uint8Array,T4=Zm.propertyIsEnumerable,Khe=Vhe.splice,ka=Jm?Jm.toStringTag:void 0,A4=Object.getOwnPropertySymbols,Ghe=I4?I4.isBuffer:void 0,Yhe=Bhe(Object.keys,Object),Wx=wc(Ue,"DataView"),oh=wc(Ue,"Map"),Kx=wc(Ue,"Promise"),Gx=wc(Ue,"Set"),Yx=wc(Ue,"WeakMap"),sh=wc(Object,"create"),Xhe=Ea(Wx),qhe=Ea(oh),Zhe=Ea(Kx),Jhe=Ea(Gx),Qhe=Ea(Yx),j4=Jm?Jm.prototype:void 0,Xx=j4?j4.valueOf:void 0;function Ca(j){var F=-1,X=j==null?0:j.length;for(this.clear();++F<X;){var ie=j[F];this.set(ie[0],ie[1])}}function epe(){this.__data__=sh?sh(null):{},this.size=0}function tpe(j){var F=this.has(j)&&delete this.__data__[j];return this.size-=F?1:0,F}function npe(j){var F=this.__data__;if(sh){var X=F[j];return X===r?void 0:X}return Wi.call(F,j)?F[j]:void 0}function rpe(j){var F=this.__data__;return sh?F[j]!==void 0:Wi.call(F,j)}function ipe(j,F){var X=this.__data__;return this.size+=this.has(j)?0:1,X[j]=sh&&F===void 0?r:F,this}Ca.prototype.clear=epe,Ca.prototype.delete=tpe,Ca.prototype.get=npe,Ca.prototype.has=rpe,Ca.prototype.set=ipe;function Ro(j){var F=-1,X=j==null?0:j.length;for(this.clear();++F<X;){var ie=j[F];this.set(ie[0],ie[1])}}function ope(){this.__data__=[],this.size=0}function spe(j){var F=this.__data__,X=ey(F,j);if(X<0)return!1;var ie=F.length-1;return X==ie?F.pop():Khe.call(F,X,1),--this.size,!0}function ape(j){var F=this.__data__,X=ey(F,j);return X<0?void 0:F[X][1]}function lpe(j){return ey(this.__data__,j)>-1}function cpe(j,F){var X=this.__data__,ie=ey(X,j);return ie<0?(++this.size,X.push([j,F])):X[ie][1]=F,this}Ro.prototype.clear=ope,Ro.prototype.delete=spe,Ro.prototype.get=ape,Ro.prototype.has=lpe,Ro.prototype.set=cpe;function Pa(j){var F=-1,X=j==null?0:j.length;for(this.clear();++F<X;){var ie=j[F];this.set(ie[0],ie[1])}}function upe(){this.size=0,this.__data__={hash:new Ca,map:new(oh||Ro),string:new Ca}}function dpe(j){var F=ty(this,j).delete(j);return this.size-=F?1:0,F}function hpe(j){return ty(this,j).get(j)}function ppe(j){return ty(this,j).has(j)}function fpe(j,F){var X=ty(this,j),ie=X.size;return X.set(j,F),this.size+=X.size==ie?0:1,this}Pa.prototype.clear=upe,Pa.prototype.delete=dpe,Pa.prototype.get=hpe,Pa.prototype.has=ppe,Pa.prototype.set=fpe;function Qm(j){var F=-1,X=j==null?0:j.length;for(this.__data__=new Pa;++F<X;)this.add(j[F])}function gpe(j){return this.__data__.set(j,r),this}function mpe(j){return this.__data__.has(j)}Qm.prototype.add=Qm.prototype.push=gpe,Qm.prototype.has=mpe;function Ts(j){var F=this.__data__=new Ro(j);this.size=F.size}function ype(){this.__data__=new Ro,this.size=0}function wpe(j){var F=this.__data__,X=F.delete(j);return this.size=F.size,X}function bpe(j){return this.__data__.get(j)}function vpe(j){return this.__data__.has(j)}function Spe(j,F){var X=this.__data__;if(X instanceof Ro){var ie=X.__data__;if(!oh||ie.length<t-1)return ie.push([j,F]),this.size=++X.size,this;X=this.__data__=new Pa(ie)}return X.set(j,F),this.size=X.size,this}Ts.prototype.clear=ype,Ts.prototype.delete=wpe,Ts.prototype.get=bpe,Ts.prototype.has=vpe,Ts.prototype.set=Spe;function xpe(j,F){var X=ny(j),ie=!X&&zpe(j),ut=!X&&!ie&&qx(j),ke=!X&&!ie&&!ut&&B4(j),It=X||ie||ut||ke,Ht=It?Bx(j.length,String):[],nn=Ht.length;for(var xt in j)(F||Wi.call(j,xt))&&!(It&&(xt=="length"||ut&&(xt=="offset"||xt=="parent")||ke&&(xt=="buffer"||xt=="byteLength"||xt=="byteOffset")||jpe(xt,nn)))&&Ht.push(xt);return Ht}function ey(j,F){for(var X=j.length;X--;)if(z4(j[X][0],F))return X;return-1}function _pe(j,F,X){var ie=F(j);return ny(j)?ie:jo(ie,X(j))}function ah(j){return j==null?j===void 0?T:v:ka&&ka in Object(j)?Tpe(j):Lpe(j)}function R4(j){return lh(j)&&ah(j)==a}function O4(j,F,X,ie,ut){return j===F?!0:j==null||F==null||!lh(j)&&!lh(F)?j!==j&&F!==F:kpe(j,F,X,ie,O4,ut)}function kpe(j,F,X,ie,ut,ke){var It=ny(j),Ht=ny(F),nn=It?l:As(j),xt=Ht?l:As(F);nn=nn==a?b:nn,xt=xt==a?b:xt;var xr=nn==b,mi=xt==b,xn=nn==xt;if(xn&&qx(j)){if(!qx(F))return!1;It=!0,xr=!1}if(xn&&!xr)return ke||(ke=new Ts),It||B4(j)?D4(j,F,X,ie,ut,ke):Ipe(j,F,nn,X,ie,ut,ke);if(!(X&i)){var $r=xr&&Wi.call(j,"__wrapped__"),Br=mi&&Wi.call(F,"__wrapped__");if($r||Br){var js=$r?j.value():j,Oo=Br?F.value():F;return ke||(ke=new Ts),ut(js,Oo,X,ie,ke)}}return xn?(ke||(ke=new Ts),Mpe(j,F,X,ie,ut,ke)):!1}function Cpe(j){if(!$4(j)||Ope(j))return!1;var F=N4(j)?Whe:me;return F.test(Ea(j))}function Ppe(j){return lh(j)&&F4(j.length)&&!!fe[ah(j)]}function Epe(j){if(!Dpe(j))return Yhe(j);var F=[];for(var X in Object(j))Wi.call(j,X)&&X!="constructor"&&F.push(X);return F}function D4(j,F,X,ie,ut,ke){var It=X&i,Ht=j.length,nn=F.length;if(Ht!=nn&&!(It&&nn>Ht))return!1;var xt=ke.get(j);if(xt&&ke.get(F))return xt==F;var xr=-1,mi=!0,xn=X&o?new Qm:void 0;for(ke.set(j,F),ke.set(F,j);++xr<Ht;){var $r=j[xr],Br=F[xr];if(ie)var js=It?ie(Br,$r,xr,F,j,ke):ie($r,Br,xr,j,F,ke);if(js!==void 0){if(js)continue;mi=!1;break}if(xn){if(!ih(F,function(Oo,Ia){if(!Vx(xn,Ia)&&($r===Oo||ut($r,Oo,X,ie,ke)))return xn.push(Ia)})){mi=!1;break}}else if(!($r===Br||ut($r,Br,X,ie,ke))){mi=!1;break}}return ke.delete(j),ke.delete(F),mi}function Ipe(j,F,X,ie,ut,ke,It){switch(X){case N:if(j.byteLength!=F.byteLength||j.byteOffset!=F.byteOffset)return!1;j=j.buffer,F=F.buffer;case D:return!(j.byteLength!=F.byteLength||!ke(new M4(j),new M4(F)));case u:case d:case m:return z4(+j,+F);case h:return j.name==F.name&&j.message==F.message;case C:case E:return j==F+"";case f:var Ht=$he;case k:var nn=ie&i;if(Ht||(Ht=Uhe),j.size!=F.size&&!nn)return!1;var xt=It.get(j);if(xt)return xt==F;ie|=o,It.set(j,F);var xr=D4(Ht(j),Ht(F),ie,ut,ke,It);return It.delete(j),xr;case I:if(Xx)return Xx.call(j)==Xx.call(F)}return!1}function Mpe(j,F,X,ie,ut,ke){var It=X&i,Ht=L4(j),nn=Ht.length,xt=L4(F),xr=xt.length;if(nn!=xr&&!It)return!1;for(var mi=nn;mi--;){var xn=Ht[mi];if(!(It?xn in F:Wi.call(F,xn)))return!1}var $r=ke.get(j);if($r&&ke.get(F))return $r==F;var Br=!0;ke.set(j,F),ke.set(F,j);for(var js=It;++mi<nn;){xn=Ht[mi];var Oo=j[xn],Ia=F[xn];if(ie)var U4=It?ie(Ia,Oo,xn,F,j,ke):ie(Oo,Ia,xn,j,F,ke);if(!(U4===void 0?Oo===Ia||ut(Oo,Ia,X,ie,ke):U4)){Br=!1;break}js||(js=xn=="constructor")}if(Br&&!js){var ry=j.constructor,iy=F.constructor;ry!=iy&&"constructor"in j&&"constructor"in F&&!(typeof ry=="function"&&ry instanceof ry&&typeof iy=="function"&&iy instanceof iy)&&(Br=!1)}return ke.delete(j),ke.delete(F),Br}function L4(j){return _pe(j,$pe,Ape)}function ty(j,F){var X=j.__data__;return Rpe(F)?X[typeof F=="string"?"string":"hash"]:X.map}function wc(j,F){var X=yc(j,F);return Cpe(X)?X:void 0}function Tpe(j){var F=Wi.call(j,ka),X=j[ka];try{j[ka]=void 0;var ie=!0}catch{}var ut=E4.call(j);return ie&&(F?j[ka]=X:delete j[ka]),ut}var Ape=A4?function(j){return j==null?[]:(j=Object(j),Et(A4(j),function(F){return T4.call(j,F)}))}:Bpe,As=ah;(Wx&&As(new Wx(new ArrayBuffer(1)))!=N||oh&&As(new oh)!=f||Kx&&As(Kx.resolve())!=_||Gx&&As(new Gx)!=k||Yx&&As(new Yx)!=A)&&(As=function(j){var F=ah(j),X=F==b?j.constructor:void 0,ie=X?Ea(X):"";if(ie)switch(ie){case Xhe:return N;case qhe:return f;case Zhe:return _;case Jhe:return k;case Qhe:return A}return F});function jpe(j,F){return F=F??s,!!F&&(typeof j=="number"||ve.test(j))&&j>-1&&j%1==0&&j<F}function Rpe(j){var F=typeof j;return F=="string"||F=="number"||F=="symbol"||F=="boolean"?j!=="__proto__":j===null}function Ope(j){return!!P4&&P4 in j}function Dpe(j){var F=j&&j.constructor,X=typeof F=="function"&&F.prototype||Zm;return j===X}function Lpe(j){return E4.call(j)}function Ea(j){if(j!=null){try{return C4.call(j)}catch{}try{return j+""}catch{}}return""}function z4(j,F){return j===F||j!==j&&F!==F}var zpe=R4(function(){return arguments}())?R4:function(j){return lh(j)&&Wi.call(j,"callee")&&!T4.call(j,"callee")},ny=Array.isArray;function Npe(j){return j!=null&&F4(j.length)&&!N4(j)}var qx=Ghe||Upe;function Fpe(j,F){return O4(j,F)}function N4(j){if(!$4(j))return!1;var F=ah(j);return F==p||F==g||F==c||F==x}function F4(j){return typeof j=="number"&&j>-1&&j%1==0&&j<=s}function $4(j){var F=typeof j;return j!=null&&(F=="object"||F=="function")}function lh(j){return j!=null&&typeof j=="object"}var B4=Ot?Ux(Ot):Ppe;function $pe(j){return Npe(j)?xpe(j):Epe(j)}function Bpe(){return[]}function Upe(){return!1}n.exports=Fpe}(Rp,Rp.exports);var UL=Rp.exports;const VL=Jn(UL);function HL(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(o=>o.has(i))&&r.add(i);return r}function WL(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function W2(n,e){for(const[t,r]of Object.entries(n)){const i=r,o=e[t];if("eq"in i&&o!==i.eq||"neq"in i&&o===i.neq||"gt"in i&&(typeof o!="number"||o<=i.gt))return!1}return!0}function K2(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,o]of Object.entries(t))if("eq"in o){const s=n.index(e,i).get().get(o.eq);if(s)for(const a of s)r[i].add(a)}else if("neq"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a!==o.neq)for(const c of l)r[i].add(c)}else if("gt"in o){const s=n.index(e,i);for(const[a,l]of s.get())if(a>o.gt)for(const c of l)r[i].add(c)}return HL(Object.values(r))}class KL{constructor(e,t){w(this,"indexCache",new Map);w(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=ee("filterHistory:"+e,(r,i)=>{if(sl(r))return this.history.get();const o=this.history.getDiffSince(i);if(o===or)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const u of o){for(const d of kt(u.added))if(d.typeName===e)if(s.removed[d.id]){const h=s.removed[d.id];delete s.removed[d.id],l--,h!==d&&(s.updated[d.id]=[h,d],c++)}else s.added[d.id]=d,a++;for(const[d,h]of kt(u.updated))h.typeName===e&&(s.added[h.id]?s.added[h.id]=h:s.updated[h.id]?s.updated[h.id]=[s.updated[h.id][0],h]:(s.updated[h.id]=[d,h],c++));for(const d of kt(u.removed))d.typeName===e&&(s.added[d.id]?(delete s.added[d.id],a--):s.updated[d.id]?(s.removed[d.id]=s.updated[d.id][0],delete s.updated[d.id],c--,l++):(s.removed[d.id]=d,l++))}return a||l||c?cu(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const o=new Map;for(const s of kt(this.atoms.get())){const a=s.get();if(a.typeName===e){const l=a[t];o.has(l)||o.set(l,new Set),o.get(l).add(a.id)}}return o};return ee("index:"+e+":"+t,(o,s)=>{if(sl(o))return i();const a=r.getDiffSince(s);if(a===or)return i();const l=new Map,c=(p,g)=>{let f=l.get(p);f||(f=new Pp(o.get(p)??new Set)),f.add(g),l.set(p,f)},u=(p,g)=>{let f=l.get(p);f||(f=new Pp(o.get(p)??new Set)),f.remove(g),l.set(p,f)};for(const p of a){for(const g of kt(p.added))if(g.typeName===e){const f=g[t];c(f,g.id)}for(const[g,f]of kt(p.updated))if(f.typeName===e){const m=g[t],v=f[t];m!==v&&(u(m,f.id),c(v,f.id))}for(const g of kt(p.removed))if(g.typeName===e){const f=g[t];u(f,g.id)}}let d,h;for(const[p,g]of l){const f=g.get();f&&(d||(d=new Map(o)),h||(h=new Map),f.value.size===0?d.delete(p):d.set(p,f.value),h.set(p,f.diff))}return d&&h?cu(d,h):o},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return ee(r,()=>{var o;for(const s of i.get())return(o=this.atoms.get()[s])==null?void 0:o.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return ee(r,()=>[...i.get()].map(o=>{const s=this.atoms.get()[o];if(!s)throw new Error("no atom found for record id: "+o);return s.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),o=()=>{i.get();const l=t();return Object.keys(l).length===0?new Set(kt(this.atoms.get()).flatMap(c=>{const u=c.get();return u.typeName===e?u.id:[]})):K2(this,e,l)},s=l=>{const c=o(),u=WL(l,c);return u?cu(c,u):l},a=ee("ids_query:"+r,t,{isEqual:VL});return ee("query:"+r,(l,c)=>{const u=a.get();if(sl(l))return o();if(c<a.lastChangedEpoch)return s(l);const d=i.getDiffSince(c);if(d===or)return s(l);const h=new Pp(l);for(const g of d){for(const f of kt(g.added))f.typeName===e&&W2(u,f)&&h.add(f.id);for(const[f,m]of kt(g.updated))m.typeName===e&&(W2(u,m)?h.add(m.id):h.remove(m.id));for(const f of kt(g.removed))f.typeName===e&&h.remove(f.id)}const p=h.get();return p?cu(p.value,p.diff):l},{historyLength:50})}exec(e,t){const r=K2(this,e,t);if(r.size===0)return no;const i=this.atoms.get();return[...r].map(o=>i[o].get())}}class G2{constructor(e){w(this,"id",jp());w(this,"atoms",En("store_atoms",{}));w(this,"history",En("history",0,{historyLength:1e3}));w(this,"query",new KL(this.atoms,this.history));w(this,"listeners",new Set);w(this,"historyAccumulator",new YL);w(this,"historyReactor");w(this,"schema");w(this,"props");w(this,"scopedTypes");w(this,"onBeforeCreate");w(this,"onAfterCreate");w(this,"onBeforeChange");w(this,"onAfterChange");w(this,"onBeforeDelete");w(this,"onAfterDelete");w(this,"_runCallbacks",!0);w(this,"put",(e,t)=>{Xr(()=>{const r={},i={},o=this.atoms.__unsafe__getWithoutCapture();let s=null,a,l=!1;const c=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,u=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,d=this.isMergingRemoteChanges?"remote":"user";for(let h=0,p=e.length;h<p;h++){a=e[h];const g=(s??o)[a.id];if(g){const f=g.__unsafe__getWithoutCapture();u&&(a=u(f,a,d)),a=this.schema.validateRecord(this,a,t??"updateRecord",f),g.set(a);const m=g.__unsafe__getWithoutCapture();f!==m&&(l=!0,r[a.id]=[f,m])}else c&&(a=c(a,d)),l=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),i[a.id]=a,s||(s={...o}),s[a.id]=En("atom:"+a.id,a)}if(s&&this.atoms.set(s),!!l&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:h,onAfterChange:p}=this;h&&Object.values(i).forEach(g=>{h(g,d)}),p&&Object.values(r).forEach(([g,f])=>{p(g,f,d)})}})});w(this,"remove",e=>{Xr(()=>{const t=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const o of e){const s=this.atoms.__unsafe__getWithoutCapture()[o];s&&this.onBeforeDelete(s.get(),r)===!1&&t.push(o)}let i;if(this.atoms.update(o=>{let s;for(const a of e)t.includes(a)||a in o&&(s||(s={...o}),i||(i={}),delete s[a],i[a]=o[a].get());return s??o}),!!i&&(this.updateHistory({added:{},updated:{},removed:i}),this.onAfterDelete&&this._runCallbacks)){let o;for(let s=0,a=e.length;s<a;s++)o=i[e[s]],o&&this.onAfterDelete(o,r)}})});w(this,"get",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.get()});w(this,"unsafeGetWithoutCapture",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.__unsafe__getWithoutCapture()});w(this,"serialize",(e="document")=>{const t={};for(const[r,i]of ro(this.atoms.get())){const o=i.get();(e==="all"||this.scopedTypes[e].has(o.typeName))&&(t[r]=o)}return t});w(this,"allRecords",()=>kt(this.atoms.get()).map(e=>e.get()));w(this,"clear",()=>{this.remove($2(this.atoms.get()))});w(this,"update",(e,t)=>{const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])});w(this,"has",e=>!!this.atoms.get()[e]);w(this,"listen",(e,t)=>{this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});w(this,"isMergingRemoteChanges",!1);w(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,Xr(e)}finally{this.isMergingRemoteChanges=!1}});w(this,"createComputedCache",(e,t,r)=>{const i=new H2;return{get:o=>{const s=this.atoms.get()[o];if(s)return i.get(s,()=>{const a=r?ee(s.name+":equals",()=>s.get(),{isEqual:r}):s;return ee(e+":"+o,()=>t(a.get()))}).get()}}});w(this,"createSelectedComputedCache",(e,t,r)=>{const i=new H2;return{get:o=>{const s=this.atoms.get()[o];if(!s)return;const a=ee(e+":"+o+":selector",()=>t(s.get()));return i.get(s,()=>ee(e+":"+o,()=>r(a.get()))).get()}}});w(this,"getRecordType",e=>{const t=this.schema.types[e.typeName];if(!t)throw new Error(`Record type ${e.typeName} not found`);return t});w(this,"_integrityChecker");w(this,"_isPossiblyCorrupted",!1);const{initialData:t,schema:r}=e;this.schema=r,this.props=e.props,t&&this.atoms.set(B2(ro(t).map(([i,o])=>[i,En("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=yL("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>FL(i)}),this.scopedTypes={document:new Set(kt(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(kt(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(kt(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,o=null,s=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(o??(o=this.filterChangesByScope(t,"document")),!o)continue;a({changes:o,source:r})}else if(l.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;a({changes:i,source:r})}else{if(s??(s=this.filterChangesByScope(t,"presence")),!s)continue;a({changes:s,source:r})}else a({changes:t,source:r})}}}filterChangesByScope(e,t){const r={added:kw(e.added,(i,o)=>this.scopedTypes[t].has(o.typeName)),updated:kw(e.updated,(i,o)=>this.scopedTypes[t].has(o[1].typeName)),removed:kw(e.removed,(i,o)=>this.scopedTypes[t].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);Xr(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}extractingChanges(e){const t=[],r=this.historyAccumulator.intercepting(i=>t.push(i.changes));try{return Xr(e),Op(t)}finally{r()}}applyDiff(e,t=!0){const r=this._runCallbacks;try{this._runCallbacks=t,Xr(()=>{const i=kt(e.added).concat(kt(e.updated).map(([s,a])=>a)),o=$2(e.removed);i.length&&this.put(i),o.length&&this.remove(o)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function Op(n){const e={added:{},removed:{},updated:{}};for(const t of n){for(const[r,i]of ro(t.added))if(e.removed[r]){const o=e.removed[r];delete e.removed[r],o!==i&&(e.updated[r]=[o,i])}else e.added[r]=i;for(const[r,[i,o]]of ro(t.updated)){if(e.added[r]){e.added[r]=o,delete e.updated[r],delete e.removed[r];continue}if(e.updated[r]){e.updated[r]=[e.updated[r][0],o],delete e.removed[r];continue}e.updated[r]=t.updated[r],delete e.removed[r]}for(const[r,i]of ro(t.removed))e.added[r]?delete e.added[r]:e.updated[r]?(e.removed[r]=e.updated[r][0],delete e.updated[r]):e.removed[r]=i}return e}function GL(n){const e=[];let t=n[0],r;for(let i=1,o=n.length;i<o;i++)r=n[i],t.source!==r.source?(e.push(t),t=r):t={source:t.source,changes:Op([t.changes,r.changes])};return e.push(t),e}class YL{constructor(){w(this,"_history",[]);w(this,"_interceptors",new Set)}intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=GL(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function XL(n){return typeof n=="object"&&n!==null&&"id"in n&&"typeName"in n}function Ne(n){const{currentVersion:e,firstVersion:t,migrators:r={},subTypeKey:i,subTypeMigrations:o}=n;if(typeof e=="number"&&typeof t=="number"){if(e===t)throw Error("Current version is equal to initial version.");if(e<t)throw Error("Current version is lower than initial version.")}return{firstVersion:t??0,currentVersion:e??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var uu=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(uu||{});function Y2({record:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;if(!XL(n))throw new Error("[migrateRecord] object is not a record");const{typeName:o,id:s,...a}=n;let l=a;for(;i<r;){const c=i+1,u=e.migrators[c];if(!u)return{type:"error",reason:"target-version-too-new"};l=u.up(l),i=c}for(;i>r;){const c=i-1,u=e.migrators[i];if(!u)return{type:"error",reason:"target-version-too-old"};l=u.down(l),i=c}return{type:"success",value:{...l,id:s,typeName:o}}}function Ew({value:n,migrations:e,fromVersion:t,toVersion:r}){let i=t;for(;i<r;){const o=i+1,s=e.migrators[o];if(!s)return{type:"error",reason:"target-version-too-new"};n=s.up(n),i=o}for(;i>r;){const o=i-1,s=e.migrators[i];if(!s)return{type:"error",reason:"target-version-too-old"};n=s.down(n),i=o}return{type:"success",value:n}}class Iw{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new Iw(e,t??{})}get currentStoreVersion(){var e;return((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0}validateRecord(e,t,r,i){try{const o=Zs(this.types,t.typeName);if(!o)throw new Error(`Missing definition for record type ${t.typeName}`);return o.validate(t)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:o});throw o}}migratePersistedRecord(e,t,r="up"){var d;const i=Zs(this.types,e.typeName),o=t.recordVersions[e.typeName];if(!o||!i)return{type:"error",reason:uu.UnknownType};const s=i.migrations.currentVersion,a=o.version;if(s!==a){const h=Y2(r==="up"?{record:e,migrations:i.migrations,fromVersion:a,toVersion:s}:{record:e,migrations:i.migrations,fromVersion:s,toVersion:a});if(h.type==="error")return h;e=h.value}if(!i.migrations.subTypeKey)return{type:"success",value:e};const l=(d=i.migrations.subTypeMigrations)==null?void 0:d[e[i.migrations.subTypeKey]],c="subTypeVersions"in o?o.subTypeVersions[e[i.migrations.subTypeKey]]:void 0;if(l===void 0)return{type:"error",reason:uu.UnrecognizedSubtype};if(c===void 0)return{type:"error",reason:uu.IncompatibleSubtype};const u=Y2(r==="up"?{record:e,migrations:l,fromVersion:c,toVersion:l.currentVersion}:{record:e,migrations:l,fromVersion:l.currentVersion,toVersion:c});return u.type==="error"?u:{type:"success",value:u.value}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:t};const i=r.currentVersion,o=e.schema.storeVersion??0;if(i<o)return{type:"error",reason:uu.TargetVersionTooOld};if(i>o){const a=Ew({value:t,migrations:r,fromVersion:o,toVersion:i});if(a.type==="error")return a;t=a.value}const s=[];for(const a of kt(t)){const l=this.migratePersistedRecord(a,e.schema);if(l.type==="error")return l;l.value&&l.value!==a&&s.push(l.value)}if(s.length){t={...t};for(const a of s)t[a.id]=a}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0,recordVersions:Object.fromEntries(kt(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.currentVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.currentVersion])):void 0}:{version:t.migrations.currentVersion}]))}}serializeEarliestVersion(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.firstVersion)??0,recordVersions:Object.fromEntries(kt(this.types).map(t=>[t.typeName,t.migrations.subTypeKey&&t.migrations.subTypeMigrations?{version:t.migrations.firstVersion,subTypeKey:t.migrations.subTypeKey,subTypeVersions:t.migrations.subTypeMigrations?Object.fromEntries(Object.entries(t.migrations.subTypeMigrations).map(([r,i])=>[r,i.firstVersion])):void 0}:{version:t.migrations.firstVersion}]))}}}const qL=(n,e)=>{if(n.schemaVersion>e.schemaVersion)return 1;if(n.schemaVersion<e.schemaVersion)return-1;if(n.storeVersion>e.storeVersion)return 1;if(n.storeVersion<e.storeVersion)return-1;for(const t of Object.keys(n.recordVersions)){const r=n.recordVersions[t],i=e.recordVersions[t];if(r.version>i.version)return 1;if(r.version<i.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in i)))for(const o of Object.keys(r.subTypeVersions)){const s=r.subTypeVersions[o],a=i.subTypeVersions[o];if(s>a)return 1;if(s<a)return-1}}return 0};function ZL(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e.startsWith(".")?e.slice(1):e}class Je extends Error{constructor(t,r=[]){const i=ZL(r),o=t.split(`
`).map((s,a)=>a===0?s:`  ${s}`).join(`
`);super(r?`At ${i}: ${o}`:o);w(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function ll(n,e){try{return e()}catch(t){throw t instanceof Je?new Je(t.rawMessage,[n,...t.path]):new Je(t.toString(),[n])}}function cl(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:al(e)}}class In{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return rz(this)}optional(){return q2(this)}refine(e){return new In(t=>e(this.validate(t)))}check(e,t){return typeof e=="string"?this.refine(r=>(ll(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class JL extends In{constructor(e){super(t=>{const r=nz.validate(t);for(let i=0;i<r.length;i++)ll(i,()=>e.validate(r[i]));return r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Je("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Je("Expected an array with length greater than 1")})}}class Dp extends In{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new Je(`Expected object, got ${cl(r)}`);for(const[i,o]of Object.entries(e))ll(i,()=>{o.validate(Zs(r,i))});if(!t){for(const i of Object.keys(r))if(!Tp(e,i))throw new Je("Unexpected property",[i])}return r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Dp(this.config,!0)}extend(e){return new Dp({...this.config,...e})}}class Mw extends In{constructor(e,t,r){super(i=>{if(typeof i!="object"||i===null)throw new Je(`Expected an object, got ${cl(i)}`,[]);const o=Zs(i,e);if(typeof o!="string")throw new Je(`Expected a string for key "${e}", got ${cl(o)}`);const s=Tp(t,o)?t[o]:void 0;return s===void 0?this.unknownValueValidation(i,o):ll(`(${e} = ${o})`,()=>s.validate(i))}),this.key=e,this.config=t,this.unknownValueValidation=r}validateUnknownVariants(e){return new Mw(this.key,this.config,e)}}class QL extends In{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new Je(`Expected object, got ${cl(r)}`);for(const[i,o]of Object.entries(r))ll(i,()=>{e.validate(i),t.validate(o)});return r}),this.keyValidator=e,this.valueValidator=t}}function Tw(n){return new In(e=>{if(typeof e!==n)throw new Je(`Expected ${n}, got ${cl(e)}`);return e})}const ez=new In(n=>n),Se=Tw("string"),be=Tw("number").check(n=>{if(Number.isNaN(n))throw new Je("Expected a number, got NaN");if(!Number.isFinite(n))throw new Je(`Expected a finite number, got ${n}`)}),Aw=be.check(n=>{if(n<0)throw new Je(`Expected a positive number, got ${n}`)}),Un=be.check(n=>{if(n<=0)throw new Je(`Expected a non-zero positive number, got ${n}`)}),X2=be.check(n=>{if(!Number.isInteger(n))throw new Je(`Expected an integer, got ${n}`)}),Lp=X2.check(n=>{if(n<0)throw new Je(`Expected a positive integer, got ${n}`)}),tz=X2.check(n=>{if(n<=0)throw new Je(`Expected a non-zero positive integer, got ${n}`)}),Ie=Tw("boolean");function Vn(n){return new In(e=>{if(e!==n)throw new Je(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const nz=new In(n=>{if(!Array.isArray(n))throw new Je(`Expected an array, got ${cl(n)}`);return n});function Mn(n){return new JL(n)}function Te(n){return new Dp(n)}function jw(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(jw):typeof n=="object"?Object.values(n).every(jw):!1}const _i=new In(n=>{if(jw(n))return n;throw new Je(`Expected json serializable value, got ${typeof n}`)});function Rw(n,e){return new QL(n,e)}function Ow(n,e){return new Mw(n,e,(t,r)=>{throw new Je(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])})}function oo(n,e){return new In(t=>{const r=t&&typeof t=="object"&&"id"in t&&typeof t.id=="string"?`${n}(id = ${t.id})`:n;return ll(r,()=>e.validate(t))})}function du(n){return new In(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new Je(`Expected ${t}, got ${e}`)}return e})}function q2(n){return new In(e=>{if(e!==void 0)return n.validate(e)})}function rz(n){return new In(e=>e===null?null:n.validate(e))}function Z2(...n){return du(new Set(n))}function J2(n){try{return new URL(n)}catch{throw new Je(`Expected a valid url, got ${JSON.stringify(n)}`)}}const iz=new Set(["http:","https:","mailto:"]),ar=Se.check(n=>{if(n==="")return;const e=J2(n);if(!iz.has(e.protocol.toLowerCase()))throw new Je(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),oz=new Set(["http:","https:","data:"]),ul=Se.check(n=>{if(n==="")return;const e=J2(n);if(!oz.has(e.protocol.toLowerCase()))throw new Je(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});function qr(n){return Se.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const zp=qr("asset");function Dw(n,e){return Te({id:zp,typeName:Vn("asset"),type:Vn(n),props:e,meta:_i})}const sz=oo("camera",Te({typeName:Vn("camera"),id:qr("camera"),x:be,y:be,z:be,meta:_i})),Q2={AddMeta:1},az=Ne({currentVersion:Q2.AddMeta,migrators:{[Q2.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),un=io("camera",{validator:sz,migrations:az,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),hu=Te({x:be,y:be,z:be.optional()}),pu=Te({x:be,y:be,w:be,h:be}),lz=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),eP=du(lz),cz=Te({type:eP,rotation:be}),tP=be.check(n=>{if(n<0||n>1)throw new Je("Opacity must be between 0 and 1")}),uz=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),dz=du(uz),hz=new Set(["starting","paused","active","stopping"]),nP=Te({id:Se,points:Mn(hu),size:Aw,color:dz,opacity:be,state:du(hz),delay:be,shrink:be,taper:Ie}),fu=qr("page"),pz=oo("page",Te({typeName:Vn("page"),id:fu,name:Se,index:Se,meta:_i})),rP={AddMeta:1},fz=Ne({currentVersion:rP.AddMeta,migrators:{[rP.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),so=io("page",{validator:pz,migrations:fz,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Hn(n){return so.isId(n)}qr("instance");function gz(n){const e={};for(const[r,i]of n)e[r]=q2(i);const t=oo("instance",Te({typeName:Vn("instance"),id:qr("instance"),currentPageId:fu,followingUserId:Se.nullable(),brush:pu.nullable(),opacityForNextShape:tP,stylesForNextShape:Te(e),cursor:cz,scribbles:Mn(nP),isFocusMode:Ie,isDebugMode:Ie,isToolLocked:Ie,exportBackground:Ie,screenBounds:pu,zoomBrush:pu.nullable(),isPenMode:Ie,isGridMode:Ie,chatMessage:Se,isChatting:Ie,highlightedUserIds:Mn(Se),canMoveCamera:Ie,isFocused:Ie,devicePixelRatio:be,isCoarsePointer:Ie,isHoveringCanvas:Ie.nullable(),openMenus:Mn(Se),isChangingStyle:Ie,isReadonly:Ie,meta:_i}));return io("instance",{migrations:mz,validator:t,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const yt={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22},mz=Ne({currentVersion:yt.AddScribbles,migrators:{[yt.AddTransparentExportBgs]:{up:n=>({...n,exportBackground:!0}),down:({exportBackground:n,...e})=>e},[yt.RemoveDialog]:{up:({dialog:n,...e})=>e,down:n=>({...n,dialog:null})},[yt.AddToolLockMode]:{up:n=>({...n,isToolLocked:!1}),down:({isToolLocked:n,...e})=>e},[yt.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))}),down:n=>n},[yt.AddLabelColor]:{up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:{...t}}}},[yt.AddFollowingUserId]:{up:n=>({...n,followingUserId:null}),down:({followingUserId:n,...e})=>e},[yt.RemoveAlignJustify]:{up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}},down:n=>({...n})},[yt.AddZoom]:{up:n=>({...n,zoomBrush:null}),down:({zoomBrush:n,...e})=>e},[yt.AddVerticalAlign]:{up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.propsForNextShape;return{...n,propsForNextShape:t}}},[yt.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[yt.RemoveUserId]:{up:({userId:n,...e})=>e,down:n=>({...n,userId:"user:none"})},[yt.AddIsPenModeAndIsGridMode]:{up:n=>({...n,isPenMode:!1,isGridMode:!1}),down:({isPenMode:n,isGridMode:e,...t})=>t},[yt.HoistOpacity]:{up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e}),down:({opacityForNextShape:n,...e})=>({...e,propsForNextShape:{...e.propsForNextShape,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[yt.AddChat]:{up:n=>({...n,chatMessage:"",isChatting:!1}),down:({chatMessage:n,isChatting:e,...t})=>t},[yt.AddHighlightedUserIds]:{up:n=>({...n,highlightedUserIds:[]}),down:({highlightedUserIds:n,...e})=>e},[yt.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}}),down:({stylesForNextShape:n,...e})=>({...e,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[yt.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[yt.RemoveCursorColor]:{up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}},down:n=>({...n,cursor:{...n.cursor,color:"black"}})},[yt.AddLonelyProperties]:{up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:n,isFocused:e,devicePixelRatio:t,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:s,...a})=>({...a})},[yt.ReadOnlyReadonly]:{up:({isReadOnly:n,...e})=>({...e,isReadonly:n}),down:({isReadonly:n,...e})=>({...e,isReadOnly:n})},[yt.AddHoveringCanvas]:{up:n=>({...n,isHoveringCanvas:null}),down:({isHoveringCanvas:n,...e})=>({...e})},[yt.AddScribbles]:{up:({scribble:n,...e})=>({...e,scribbles:[]}),down:({scribbles:n,...e})=>({...e,scribble:null})}}}),Tn="instance:instance",yz=Se.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),Zr=qr("shape");function wz(n,e,t){return Te({id:Zr,typeName:Vn("shape"),x:be,y:be,rotation:be,index:Se,parentId:yz,type:Vn(n),isLocked:Ie,opacity:tP,props:e?Te(e):_i,meta:t?Te(t):_i})}const bz=oo("instance_page_state",Te({typeName:Vn("instance_page_state"),id:qr("instance_page_state"),pageId:fu,selectedShapeIds:Mn(Zr),hintingShapeIds:Mn(Zr),erasingShapeIds:Mn(Zr),hoveredShapeId:Zr.nullable(),editingShapeId:Zr.nullable(),croppingShapeId:Zr.nullable(),focusedGroupId:Zr.nullable(),meta:_i})),dl={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},vz=Ne({currentVersion:dl.RenamePropertiesAgain,migrators:{[dl.AddCroppingId]:{up(n){return{...n,croppingShapeId:null}},down({croppingShapeId:n,...e}){return e}},[dl.RemoveInstanceIdAndCameraId]:{up({instanceId:n,cameraId:e,...t}){return t},down(n){return{...n,instanceId:Tn,cameraId:un.createId("void")}}},[dl.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[dl.RenameProperties]:{up:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}}},[dl.RenamePropertiesAgain]:{up:n=>{const{selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:s,croppingId:a,focusLayerId:l,...c}=n;return{...c,selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s??a??null,focusedGroupId:l}},down:n=>{const{selectedShapeIds:e,hintingShapeIds:t,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:s,focusedGroupId:a,...l}=n;return{...l,selectedIds:e,hintingIds:t,erasingIds:r,hoveredId:i,editingId:o,croppingId:s,focusLayerId:a}}}}}),dn=io("instance_page_state",{migrations:vz,validator:bz,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),Sz=oo("pointer",Te({typeName:Vn("pointer"),id:qr("pointer"),x:be,y:be,lastActivityTimestamp:be,meta:_i})),iP={AddMeta:1},xz=Ne({currentVersion:iP.AddMeta,migrators:{[iP.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Lw=io("pointer",{validator:Sz,migrations:xz,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Np=Lw.createId("pointer"),_z=oo("instance_presence",Te({typeName:Vn("instance_presence"),id:qr("instance_presence"),userId:Se,userName:Se,lastActivityTimestamp:be,followingUserId:Se.nullable(),cursor:Te({x:be,y:be,type:eP,rotation:be}),color:Se,camera:Te({x:be,y:be,z:be}),screenBounds:pu,selectedShapeIds:Mn(qr("shape")),currentPageId:qr("page"),brush:pu.nullable(),scribbles:Mn(nP),chatMessage:Se,meta:_i})),hl={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},kz=Ne({currentVersion:hl.RenameSelectedShapeIds,migrators:{[hl.AddScribbleDelay]:{up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n},down:n=>{if(n.scribble!==null){const{delay:e,...t}=n.scribble;return{...n,scribble:t}}return{...n}}},[hl.RemoveInstanceId]:{up:({instanceId:n,...e})=>e,down:n=>({...n,instanceId:Tn})},[hl.AddChatMessage]:{up:n=>({...n,chatMessage:""}),down:({chatMessage:n,...e})=>e},[hl.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})},[hl.RenameSelectedShapeIds]:{up:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}},down:n=>{const{selectedShapeIds:e,...t}=n;return{selectedShapeIds:e,...t}}}}}),Cz=io("instance_presence",{migrations:kz,validator:_z,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),Pz=oo("document",Te({typeName:Vn("document"),id:Vn("document:document"),gridSize:be,name:Se,meta:_i})),zw={AddName:1,AddMeta:2},Ez=Ne({currentVersion:zw.AddMeta,migrators:{[zw.AddName]:{up:n=>({...n,name:""}),down:({name:n,...e})=>e},[zw.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Nw=io("document",{migrations:Ez,validator:Pz,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),Fw=Nw.createId("document");function Iz(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function oP(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const Mz=({error:n,phase:e,record:t,recordBefore:r})=>{throw xw(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?oP(rs(r)):void 0,recordAfter:oP(rs(t))}}),n};function Tz(){return[so.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function Az(n){const e=n.query.ids("page"),t=()=>{if(!n.has(Fw))return n.put([Nw.create({id:Fw,name:n.props.defaultName})]),t();if(!n.has(Np))return n.put([Lw.create({id:Np})]),t();const r=e.get();if(r.size===0)return n.put(Tz()),t();const i=()=>[...r].map(l=>n.get(l)).sort(Iz)[0].id,o=n.get(Tn);if(o){if(!r.has(o.currentPageId))return n.put([{...o,currentPageId:i()}]),t()}else return n.put([n.schema.types.instance.create({id:Tn,currentPageId:i(),exportBackground:!0})]),t();const s=new Set,a=new Set;for(const l of r){const c=dn.createId(l);n.has(c)||s.add(c);const u=un.createId(l);n.has(u)||a.add(u)}s.size>0&&n.put([...s].map(l=>dn.create({id:l,pageId:dn.parseId(l)}))),a.size>0&&n.put([...a].map(l=>un.create({id:l})))};return t}const jz=Dw("bookmark",Te({title:Se,description:Se,image:Se,src:ul.nullable()})),sP={MakeUrlsValid:1},Rz=Ne({currentVersion:sP.MakeUrlsValid,migrators:{[sP.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!ul.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),Oz=Dw("image",Te({w:be,h:be,name:Se,isAnimated:Ie,mimeType:Se.nullable(),src:ul.nullable()})),Fp={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},Dz=Ne({currentVersion:Fp.MakeUrlsValid,migrators:{[Fp.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[Fp.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[Fp.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!ul.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),Lz=Dw("video",Te({w:be,h:be,name:Se,isAnimated:Ie,mimeType:Se.nullable(),src:ul.nullable()})),$p={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},zz=Ne({currentVersion:$p.MakeUrlsValid,migrators:{[$p.AddIsAnimated]:{up:n=>({...n,props:{...n.props,isAnimated:!1}}),down:n=>{const{isAnimated:e,...t}=n.props;return{...n,props:t}}},[$p.RenameWidthHeight]:{up:n=>{const{width:e,height:t,...r}=n.props;return{...n,props:{w:e,h:t,...r}}},down:n=>{const{w:e,h:t,...r}=n.props;return{...n,props:{width:e,height:t,...r}}}},[$p.MakeUrlsValid]:{up:n=>{const e=n.props.src;return e&&!ul.isValid(e)?{...n,props:{...n.props,src:""}}:n},down:n=>n}}}),Nz=oo("asset",Ow("type",{image:Oz,video:Lz,bookmark:jz})),aP={AddMeta:1},Fz=Ne({subTypeKey:"type",subTypeMigrations:{image:Dz,video:zz,bookmark:Rz},currentVersion:aP.AddMeta,migrators:{[aP.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}}),Js=io("asset",{migrations:Fz,validator:Nz,scope:"document"}).withDefaultProperties(()=>({meta:{}}));class hn{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=ez}=t;return new hn(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new $z(e,r,i)}validate(e){return this.type.validate(e)}}class $z extends hn{constructor(e,t,r){super(e,t,Z2(...r)),this.values=r}}const Bp={AddIsLocked:1,HoistOpacity:2,AddMeta:3},$w=Ne({currentVersion:Bp.AddMeta,migrators:{[Bp.AddIsLocked]:{up:n=>({...n,isLocked:!1}),down:n=>{const{isLocked:e,...t}=n;return{...t}}},[Bp.HoistOpacity]:{up:({props:{opacity:n,...e},...t})=>({...t,opacity:Number(n??"1"),props:e}),down:({opacity:n,...e})=>({...e,props:{...e.props,opacity:n<.175?"0.1":n<.375?"0.25":n<.625?"0.5":n<.875?"0.75":"1"}})},[Bp.AddMeta]:{up:n=>({...n,meta:{}}),down:({meta:n,...e})=>({...e})}}});function Qs(n){return n?n.typeName==="shape":!1}function Mr(n){return n?n.startsWith("shape:"):!1}function tt(n){return`shape:${n??jp()}`}function lP(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof hn){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function Bz(n){return io("shape",{migrations:Ne({currentVersion:$w.currentVersion,firstVersion:$w.firstVersion,migrators:$w.migrators,subTypeKey:"type",subTypeMigrations:U2(n,(e,t)=>t.migrations??Ne({}))}),scope:"document",validator:oo("shape",Ow("type",U2(n,(e,{props:t,meta:r})=>wz(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const gu={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},Uz=Ne({currentVersion:gu.RemoveUserDocument,migrators:{[gu.RemoveCodeAndIconShapeTypes]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="shape"||t.type!=="icon"&&t.type!=="code")),down:n=>n},[gu.AddInstancePresenceType]:{up:n=>n,down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="instance_presence"))},[gu.RemoveTLUserAndPresenceAndAddPointer]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>t.typeName!=="pointer"))},[gu.RemoveUserDocument]:{up:n=>Object.fromEntries(Object.entries(n).filter(([e,t])=>!t.typeName.match("user_document"))),down:n=>n}}});function Vz({shapes:n}){const e=new Map;for(const i of kt(n))for(const o of lP(i.props??{}).keys()){if(e.has(o.id)&&e.get(o.id)!==o)throw new Error(`Multiple StyleProp instances with the same id: ${o.id}`);e.set(o.id,o)}const t=Bz(n),r=gz(e);return Iw.create({asset:Js,camera:un,document:Nw,instance:r,instance_page_state:dn,page:so,shape:t,instance_presence:Cz,pointer:Lw},{snapshotMigrations:Uz,onValidationFailure:Mz,createIntegrityChecker:Az})}const cP=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],Up={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Wn(n){return n.isDarkMode?Up.darkMode:Up.lightMode}const Tr=hn.defineEnum("tldraw:color",{defaultValue:"black",values:cP}),uP=hn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:cP}),ea=hn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),pl=hn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),ki=hn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),mu={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Ci=hn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),dP=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Vp=hn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:dP}),Hp=hn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:dP}),hP=Ow("type",{binding:Te({type:Vn("binding"),boundShapeId:Zr,normalizedAnchor:hu,isExact:Ie,isPrecise:Ie}),point:Te({type:Vn("point"),x:be,y:be})}),Hz={labelColor:uP,color:Tr,fill:pl,dash:ea,size:Ci,arrowheadStart:Vp,arrowheadEnd:Hp,font:ki,start:hP,end:hP,bend:be,text:Se},Bw={AddLabelColor:1,AddIsPrecise:2},Wz=Ne({currentVersion:Bw.AddIsPrecise,migrators:{[Bw.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[Bw.AddIsPrecise]:{up:n=>{const{start:e,end:t}=n.props;return{...n,props:{...n.props,start:e.type==="binding"?{...e,isPrecise:!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5)}:e,end:t.type==="binding"?{...t,isPrecise:!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)}:t}}},down:n=>{const{start:e,end:t}=n.props,r={...e},i={...t};return r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),i.type==="binding"&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...n,props:{...n.props,start:r,end:i}}}}}}),Kz={w:Un,h:Un,assetId:zp.nullable(),url:ar},Uw={NullAssetId:1,MakeUrlsValid:2},Gz=Ne({currentVersion:Uw.MakeUrlsValid,migrators:{[Uw.NullAssetId]:{up:n=>n.props.assetId===void 0?{...n,props:{...n.props,assetId:null}}:n,down:n=>{if(n.props.assetId===null){const{assetId:e,...t}=n.props;return{...n,props:t}}return n}},[Uw.MakeUrlsValid]:{up:n=>n.props.url!==""&&!ar.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),pP=Te({type:Z2("free","straight"),points:Mn(hu)}),Yz={color:Tr,fill:pl,dash:ea,size:Ci,segments:Mn(pP),isComplete:Ie,isClosed:Ie,isPen:Ie},fP={AddInPen:1},Xz=Ne({currentVersion:fP.AddInPen,migrators:{[fP.AddInPen]:{up:n=>{const{points:e}=n.props.segments[0];if(e.length===0)return{...n,props:{...n.props,isPen:!1}};let t=!(e[0].z===0||e[0].z===.5);return e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),{...n,props:{...n.props,isPen:t}}},down:n=>{const{isPen:e,...t}=n.props;return{...n,props:{...t}}}}}}),gP=/(^\/r\/[^/]+\/?$)/,Ye=n=>{try{return new URL(n)}catch{return}},fl=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(gP))return n},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(gP))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,i,o]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${{}.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const t=e.searchParams.get("zoom"),[r,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${r},${i},${t}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n),t=e&&e.pathname.match(/\/v\/([^/]+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ye(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ye(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/embed/${o}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,o]=t;return`https://codepen.io/${i}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ye(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.hostname.replace(/^www./,"")==="youtube.com"){const t=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(t)return`https://www.youtube.com/watch?v=${t[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:n=>{const e=Ye(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Ye(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=Ye(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ye(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Ye(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}}],qz={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},Zz={w:Un,h:Un,url:Se},yu={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},Jz=Ne({currentVersion:yu.RemovePermissionOverrides,migrators:{[yu.GenOriginalUrlInEmbed]:{up:n=>{const e=n.props.url,t=new URL(e).host.replace("www.","");let r;for(const i of fl)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(o){console.warn(o)}return{...n,props:{...n.props,tmpOldUrl:n.props.url,url:r??""}}},down:n=>{let e=n.props.tmpOldUrl;if(!e||e===""){const i=n.props.url,o=new URL(i).host.replace("www.","");for(const s of fl)if(s.hostnames.includes(o))try{e=s.toEmbedUrl(i)}catch(a){console.warn(a)}}const{tmpOldUrl:t,...r}=n.props;return{...n,props:{...r,url:e??""}}}},[yu.RemoveDoesResize]:{up:n=>{const{doesResize:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props,doesResize:!0}})},[yu.RemoveTmpOldUrl]:{up:n=>{const{tmpOldUrl:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})},[yu.RemovePermissionOverrides]:{up:n=>{const{overridePermissions:e,...t}=n.props;return{...n,props:{...t}}},down:n=>({...n,props:{...n.props}})}}}),Qz={w:Un,h:Un,name:Se},eN=Ne({}),wu=hn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Wp=hn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Pi=hn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),tN={geo:Pi,labelColor:uP,color:Tr,fill:pl,dash:ea,size:Ci,font:ki,align:wu,verticalAlign:Wp,url:ar,w:Un,h:Un,growY:Aw,text:Se},ao={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8},nN=Ne({currentVersion:ao.MakeUrlsValid,migrators:{[ao.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[ao.AddLabelColor]:{up:n=>({...n,props:{...n.props,labelColor:"black"}}),down:n=>{const{labelColor:e,...t}=n.props;return{...n,props:t}}},[ao.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[ao.AddCheckBox]:{up:n=>({...n}),down:n=>({...n,props:{...n.props,geo:n.props.geo==="check-box"?"rectangle":n.props.geo}})},[ao.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[ao.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[ao.AddCloud]:{up:n=>n,down:n=>{if(n.props.geo==="cloud")return{...n,props:{...n.props,geo:"rectangle"}}}},[ao.MakeUrlsValid]:{up:n=>n.props.url!==""&&!ar.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),rN={},iN=Ne({}),oN={color:Tr,size:Ci,segments:Mn(pP),isComplete:Ie,isPen:Ie},sN=Ne({}),aN=Te({topLeft:hu,bottomRight:hu}),lN={w:Un,h:Un,playing:Ie,url:ar,assetId:zp.nullable(),crop:aN.nullable()},Kp={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3},cN=Ne({currentVersion:Kp.MakeUrlsValid,migrators:{[Kp.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Kp.AddCropProp]:{up:n=>({...n,props:{...n.props,crop:null}}),down:n=>{const{crop:e,...t}=n.props;return{...n,props:t}}},[Kp.MakeUrlsValid]:{up:n=>n.props.url!==""&&!ar.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),uN=new Set(["vertex","virtual","create"]),dN=Te({id:Se,type:du(uN),canBind:Ie.optional(),canSnap:Ie.optional(),index:Se,x:be,y:be}),Gp=hn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),hN={color:Tr,dash:ea,size:Ci,spline:Gp,handles:Rw(Se,dN)},mP={AddSnapHandles:1},pN=Ne({currentVersion:mP.AddSnapHandles,migrators:{[mP.AddSnapHandles]:{up:n=>{const e=cn(n.props.handles);for(const t in e)e[t].canSnap=!0;return{...n,props:{...n.props,handles:e}}},down:n=>{const e=cn(n.props.handles);for(const t in e)delete e[t].canSnap;return{...n,props:{...n.props,handles:e}}}}}}),fN={color:Tr,size:Ci,font:ki,align:wu,verticalAlign:Wp,growY:Aw,url:ar,text:Se},gl={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5},gN=Ne({currentVersion:gl.MakeUrlsValid,migrators:{[gl.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[gl.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})},[gl.MigrateLegacyAlign]:{up:n=>{let e;switch(n.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...n,props:{...n.props,align:e}}},down:n=>{let e;switch(n.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=n.props.align}return{...n,props:{...n.props,align:e}}}},[gl.AddVerticalAlign]:{up:n=>({...n,props:{...n.props,verticalAlign:"middle"}}),down:n=>{const{verticalAlign:e,...t}=n.props;return{...n,props:t}}},[gl.MakeUrlsValid]:{up:n=>n.props.url!==""&&!ar.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),mN={color:Tr,size:Ci,font:ki,align:wu,w:Un,text:Se,scale:Un,autoSize:Ie},yP={RemoveJustify:1},yN=Ne({currentVersion:yP.RemoveJustify,migrators:{[yP.RemoveJustify]:{up:n=>{let e=n.props.align;return e==="justify"&&(e="start"),{...n,props:{...n.props,align:e}}},down:n=>({...n})}}}),wN={w:Un,h:Un,time:be,playing:Ie,url:ar,assetId:zp.nullable()},Vw={AddUrlProp:1,MakeUrlsValid:2},bN=Ne({currentVersion:Vw.MakeUrlsValid,migrators:{[Vw.AddUrlProp]:{up:n=>({...n,props:{...n.props,url:""}}),down:n=>{const{url:e,...t}=n.props;return{...n,props:t}}},[Vw.MakeUrlsValid]:{up:n=>n.props.url!==""&&!ar.isValid(n.props.url)?{...n,props:{...n.props,url:""}}:n,down:n=>n}}}),bu=[{locale:"ar",label:"\u0639\u0631\u0628\u064A"},{locale:"ca",label:"Catal\xE0"},{locale:"cs",label:"\u010Ce\u0161tina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xF1ol"},{locale:"fa",label:"\u0641\u0627\u0631\u0633\u06CC"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Fran\xE7ais"},{locale:"gl",label:"Galego"},{locale:"he",label:"\u05E2\u05D1\u05E8\u05D9\u05EA"},{locale:"it",label:"Italiano"},{locale:"ja",label:"\u65E5\u672C\u8A9E"},{locale:"ko-kr",label:"\uD55C\uAD6D\uC5B4"},{locale:"ku",label:"\u06A9\u0648\u0631\u062F\u06CC"},{locale:"hi-in",label:"\u0939\u093F\u0928\u094D\u0926\u0940"},{locale:"hu",label:"Magyar"},{locale:"my",label:"\u1019\u103C\u1014\u103A\u1019\u102C\u1005\u102C"},{locale:"ne",label:"\u0928\u0947\u092A\u093E\u0932\u0940"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xEAs - Brasil"},{locale:"pt-pt",label:"Portugu\xEAs - Europeu"},{locale:"ro",label:"Rom\xE2n\u0103"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41"},{locale:"th",label:"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22"},{locale:"tr",label:"T\xFCrk\xE7e"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ti\u1EBFng Vi\u1EC7t"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"\u7E41\u9AD4\u4E2D\u6587 (\u53F0\u7063)"}];function vN(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return SN(n)}function SN(n){for(const e of n){const t=xN(e);if(t)return t}return"en"}const wP={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function xN(n){const e=bu.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=bu.find(o=>o.locale===t);if(i)return i.locale}return t in wP?wP[t]:null}var bP={exports:{}};(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var o="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(o=i(o,r(a)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var s="";for(var a in o)e.call(o,a)&&o[a]&&(s=i(s,a));return s}function i(o,s){return s?o?o+" "+s:o+s:o}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(bP);var _N=bP.exports;const we=Jn(_N),kN={},nt={preventDefaultLogging:lr("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:lr("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:lr("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:lr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:lr("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:lr("debugSvg",{defaults:{all:!1}}),throwToBlob:lr("throwToBlob",{defaults:{all:!1}}),logMessages:lr("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:lr("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:lr("debugCursors",{defaults:{all:!1}}),forceSrgb:lr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:lr("debugGeometry",{defaults:{all:!1}}),hideShapes:lr("hideShapes",{defaults:{all:!1}})};if(typeof window<"u"&&(window.tldrawLog=n=>{nt.logMessages.set(nt.logMessages.get().concat(n))}),typeof Element<"u"){const n=Element.prototype.removeChild;lu("element removal logging",()=>{nt.elementRemovalLogging.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function lr(n,{defaults:e,shouldStoreForSession:t=!0}){return CN({name:n,defaults:e,shouldStoreForSession:t})}function CN(n){const e=EN(n),t=n.shouldStoreForSession?PN(n.name):null,r=En(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&lu(`debug:${n.name}`,()=>{const i=r.get();try{i===e?window.sessionStorage.removeItem(`tldraw_debug:${n.name}`):window.sessionStorage.setItem(`tldraw_debug:${n.name}`,JSON.stringify(i))}catch{}}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function PN(n){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${n}`))??"null")}catch{return null}}function Hw(n){try{return n()}catch{return null}}function EN(n){switch(Hw(()=>({}).TLDRAW_ENV)??Hw(()=>({}).VERCEL_PUBLIC_TLDRAW_ENV)??Hw(()=>({}).NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function Yp(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return Yp(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Oe(n){n.preventDefault(),nt.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",n)}function vu(n,e){if(n.setPointerCapture(e.pointerId),nt.pointerCaptureTracking.get()){const t=nt.pointerCaptureTrackingObject.get();t.set(n,(t.get(n)??0)+1)}nt.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",n,e)}function Su(n,e){if(n.hasPointerCapture(e.pointerId)){if(n.releasePointerCapture(e.pointerId),nt.pointerCaptureTracking.get()){const t=nt.pointerCaptureTrackingObject.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture")}nt.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",n,e)}}const Ft=n=>n.stopPropagation();function Kn(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}const Ww=oe.createContext({});function Y(){return oe.useContext(Ww)}function IN(){const n=Y();return S.useMemo(function(){let e,t;function r(p){if(!p.isKilled){if(p.button===2){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Kn(p)});return}p.button!==0&&p.button!==1&&p.button!==5||(vu(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Kn(p)}),n.getOpenMenus().length>0&&(n.updateInstanceState({openMenus:[]}),document.body.click(),n.getContainer().focus()))}}function i(p){p.isKilled||p.clientX===e&&p.clientY===t||(e=p.clientX,t=p.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Kn(p)}))}function o(p){p.isKilled||p.button!==0&&p.button!==1&&p.button!==2&&p.button!==5||(e=p.clientX,t=p.clientY,Su(p.currentTarget,p),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Kn(p)}))}function s(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:g?!0:null})}function a(p){if(p.isKilled||n.getInstanceState().isPenMode&&p.pointerType!=="pen")return;const g=p.pointerType==="mouse"||p.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:g?!1:null})}function l(p){p.isKilled=!0,document.body.click(),Oe(p)}function c(p){p.isKilled=!0,p.target.tagName!=="A"&&p.target.tagName!=="TEXTAREA"&&Oe(p)}function u(p){Oe(p)}async function d(p){var f,m;if(Oe(p),!((m=(f=p.dataTransfer)==null?void 0:f.files)!=null&&m.length))return;const g=Array.from(p.dataTransfer.files);await n.putExternalContent({type:"files",files:g,point:n.screenToPage({x:p.clientX,y:p.clientY}),ignoreParent:!1})}function h(p){Ft(p)}return{onPointerDown:r,onPointerMove:i,onPointerUp:o,onPointerEnter:s,onPointerLeave:a,onDragOver:u,onDrop:d,onTouchStart:l,onTouchEnd:c,onClick:h}},[n])}function MN(){const n=Y();S.useEffect(()=>{if(n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos){n.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const e=window.matchMedia("(pointer: coarse)"),t=()=>{n.updateInstanceState({isCoarsePointer:!!e.matches})};if(t(),e)return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}},[n])}const vP=S.createContext(null);function TN({container:n,children:e}){return y.jsx(vP.Provider,{value:n,children:e})}function pn(){return RL(S.useContext(vP),"useContainer used outside of <Tldraw />")}function AN(){const n=Y(),e=pn(),t=Z("isFocused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(typeof matchMedia===void 0)return;let r=null;const i=()=>{r==null||r();const o=`(resolution: ${window.devicePixelRatio}dppx)`,s=matchMedia(o),a=l=>{l.type==="change"&&i()};s.addEventListener?s.addEventListener("change",i):s.addListener&&s.addListener(a),r=()=>{s.removeEventListener?s.removeEventListener("change",i):s.removeListener&&s.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),S.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!xu()&&Oe(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){Oe(a);return}break}case"Tab":{if(xu()||n.getIsMenuOpen())return;break}case",":{if(!xu()&&(Oe(a),!n.inputs.keys.has("Comma"))){const{x:c,y:u,z:d}=n.inputs.currentScreenPoint;n.inputs.keys.add("Comma");const h={type:"pointer",name:"pointer_down",point:{x:c,y:u,z:d},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(h);return}break}case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&a.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(xu()||n.getIsMenuOpen())return}const l={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)},i=a=>{var c;if(a.isKilled||(a.isKilled=!0,xu()||n.getIsMenuOpen()))return;if(a.key===","&&((c=document.activeElement)!=null&&c.ELEMENT_NODE&&Oe(a),n.inputs.keys.has(a.code))){const{x:u,y:d,z:h}=n.inputs.currentScreenPoint;n.inputs.keys.delete(a.code);const p={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:h},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p);return}const l={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};n.dispatch(l)};function o(a){var l,c;if(e.contains(a.target)){const u=a.touches[0].pageX,d=a.touches[0].radiusX||0;(u-d<10||u+d>n.getViewportScreenBounds().width-10)&&(((l=a.target)==null?void 0:l.tagName)==="BUTTON"&&((c=a.target)==null||c.click()),Oe(a))}}const s=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&Oe(a)};return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",Oe),document.addEventListener("gesturechange",Oe),document.addEventListener("gestureend",Oe),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",s),document.removeEventListener("gesturestart",Oe),document.removeEventListener("gesturechange",Oe),document.removeEventListener("gestureend",Oe),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}const jN=["input","select","button","textarea"];function xu(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||jN.indexOf(n.tagName.toLowerCase())>-1))}const RN={error:null};class SP extends S.Component{constructor(){super(...arguments);w(this,"state",RN)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return y.jsx(r,{error:t})}return this.props.children}}function _u({children:n,fallback:e,...t}){return e===null?y.jsx(y.Fragment,{children:n}):y.jsx(SP,{fallback:e,...t,children:n})}class ON{constructor(e){this.shape=e}equals(e){var t,r,i,o,s,a;return((t=this.shape)==null?void 0:t.isLocked)===((r=e==null?void 0:e.shape)==null?void 0:r.isLocked)&&((i=this.shape)==null?void 0:i.props)===((o=e==null?void 0:e.shape)==null?void 0:o.props)&&((s=this.shape)==null?void 0:s.meta)===((a=e==null?void 0:e.shape)==null?void 0:a.meta)}}const DN=({shape:n,util:e})=>Cp("Indicator:"+n.type,()=>e.indicator(n)),LN=({editor:n,id:e})=>{const t=Z("shape",()=>new ON(n.store.get(e)),[n,e]),{ShapeIndicatorErrorFallback:r}=$t();return!t.shape||t.shape.isLocked?null:y.jsx(_u,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:y.jsx(DN,{shape:t.shape,util:n.getShapeUtil(t.shape)},t.shape.id)})},zN=({id:n,className:e,color:t,opacity:r})=>{const i=Y(),o=Z("transform",()=>{const s=i.getShapePageTransform(n);return s?s.toCssString():""},[i,n]);return y.jsx("svg",{className:we("tl-overlays__item",e),children:y.jsx("g",{className:"tl-shape-indicator",transform:o,stroke:t??"var(--color-selected)",opacity:r,children:y.jsx(LN,{editor:i,id:n})})})},ku=S.memo(zN);function NN(){return y.jsx("div",{className:"tl-background"})}function ml(n,e,t,r,i,o){S.useLayoutEffect(()=>{const s=n.current;if(!s||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}const fn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class P{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),o=Math.cos(e);return this.x=t*o-r*i,this.y=t*i+r*o,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,o=Math.sin(t),s=Math.cos(t);return this.x=e.x+(r*s-i*o),this.y=e.y+(r*o+i*s),this}clone(){const{x:e,y:t,z:r}=this;return new P(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=P.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return P.Dpr(this,e)}cpr(e){return P.Cpr(this,e)}len2(){return P.Len2(this)}len(){return P.Len(this)}pry(e){return P.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return P.Uni(this)}tan(e){return P.Tan(this,e)}dist(e){return P.Dist(this,e)}distanceToLineSegment(e,t){return P.DistanceToLineSegment(e,t,this)}slope(e){return P.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return P.Angle(this,e)}toAngle(){return P.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return P.Equals(this,e)}equalsXY(e,t){return P.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return P.ToFixed(this)}toString(){return P.ToString(P.ToFixed(this))}toJson(){return P.ToJson(this)}toArray(){return P.ToArray(this)}static Add(e,t){return new P(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new P(e.x+t,e.y+r)}static Sub(e,t){return new P(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new P(e.x-t,e.y-r)}static AddScalar(e,t){return new P(e.x+t,e.y+t)}static SubScalar(e,t){return new P(e.x-t,e.y-t)}static Div(e,t){return new P(e.x/t,e.y/t)}static Mul(e,t){return new P(e.x*t,e.y*t)}static DivV(e,t){return new P(e.x/t.x,e.y/t.y)}static MulV(e,t){return new P(e.x*t.x,e.y*t.y)}static Neg(e){return new P(-e.x,-e.y)}static Per(e){return new P(e.y,-e.x)}static Dist2(e,t){return P.Sub(e,t).len2()}static Abs(e){return new P(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new P(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return P.Dpr(e,t)/P.Len(t)}static Uni(e){return P.Div(e,P.Len(e))}static Tan(e,t){return P.Uni(P.Sub(e,t))}static Min(e,t){return new P(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new P(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new P(e,t,r)}static FromArray(e){return new P(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new P(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,o=e.y-t.y,s=Math.sin(r),a=Math.cos(r);return new P(t.x+(i*a-o*s),t.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(e,t,r){return P.Mul(t,P.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){const o=P.Tan(t,e),s=P.Add(e,P.Mul(o,P.Sub(r,e).pry(o)));if(i){if(s.x<Math.min(e.x,t.x))return P.Cast(e.x<t.x?e:t);if(s.x>Math.max(e.x,t.x))return P.Cast(e.x>t.x?e:t);if(s.y<Math.min(e.y,t.y))return P.Cast(e.y<t.y?e:t);if(s.y>Math.max(e.y,t.y))return P.Cast(e.y>t.y?e:t)}return s}static DistanceToLineThroughPoint(e,t,r){return P.Dist(r,P.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return P.Dist(r,P.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof P?e:P.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return P.Sub(t,e).mul(r).add(e)}static Med(e,t){return new P((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=P.Len(e);return new P(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return P.Sub(e,r).mul(t).add(r)}static ToFixed(e,t=2){return new P(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,r){return P.Add(e,P.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new P(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new P(0,0);for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new P(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new P(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let o=0;o<r;o++){const s=fn.easeInQuad(o/(r-1)),a=P.Lrp(e,t,s);a.z=Math.min(1,.5+Math.abs(.5-FN(s))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const FN=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Yt(n){return`${O(n.x)},${O(n.y)} `}function Gn(n,e){return`${O((n.x+e.x)/2)},${O((n.y+e.y)/2)} `}const Fe=Math.PI,rt=Fe/2,We=Fe*2,$N=Math.sin;function Ei(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function Xp(n,e=1e10){return n?Math.round(n*e)/e:0}function Cu(n,e,t=1e-6){return Math.abs(n-e)<=t}function Pu(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return Fe*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function Jr(n){return n=n%We,n<0?n=n+We:n===0&&(n=0),n}function qp(n,e){return n=Jr(n),e=Jr(e),n>e&&(e+=We),e-n}function BN(n,e){return We-qp(n,e)}function Eu(n,e){const t=(e-n)%We;return 2*t%We-t}function Kw(n){return(We+n)%We}function Zp(n,e){const t=We/e;let r=Math.floor((Kw(n)+t/2)/t)*t%We;return r<Fe&&(r+=We),r>Fe&&(r-=We),r}function xP(n,e){return n===e||Cu(n%(Math.PI/2)-e%(Math.PI/2),0)}function UN(n){return n*Fe/180}function VN(n){return n*180/Fe}function _P(n,e,t,r){return new P(n+t*Math.cos(r),e+t*Math.sin(r))}function Gw(n,e,t){const r=n/2,i=e/2,o=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let g=0;g<t;g++){const f=We/t,m=-rt+g*f,v=r+r*Math.cos(m),b=i+i*Math.sin(m);v<s&&(s=v),b<l&&(l=b),v>a&&(a=v),b>c&&(c=b),o.push(new P(v,b))}const u=a-s,d=c-l,h=n-u,p=e-d;if(h!==0||p!==0)for(let g=0;g<o.length;g++){const f=o[g];f.x=(f.x-s)/u*n,f.y=(f.y-l)/d*e}return o}function Iu(n,e,t,r){return n<r&&t<e}function Qr(n,e,t,r){const i=Math.max(n,t),o=Math.min(e,r);return i<=o?[i,o]:null}function kP(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function Ii(n,e){let t=0,r,i;for(let o=0;o<e.length;o++){if(r=e[o],r.x===n.x&&r.y===n.y||(i=e[(o+1)%e.length],P.Dist(n,r)+P.Dist(n,i)===P.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&kP(r,i,n)>0&&(t+=1):i.y<=n.y&&kP(r,i,n)<0&&(t-=1)}return t!==0}function O(n){return+n.toFixed(4)}function Jp(n){return+n.toFixed(2)}const CP=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER,Qp=({brush:n,color:e,opacity:t,className:r})=>{const i=S.useRef(null);ml(i,n.x,n.y);const o=O(Math.max(1,n.w)),s=O(Math.max(1,n.h));return y.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?y.jsxs("g",{className:"tl-brush",opacity:t,children:[y.jsx("rect",{width:o,height:s,fill:e,opacity:.75}),y.jsx("rect",{width:o,height:s,fill:"none",stroke:e,opacity:.1})]}):y.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},HN=({className:n,zoom:e,point:t,color:r,viewport:i,opacity:o=1})=>{const s=S.useRef(null);return ml(s,Ei(t.x,i.minX+5/e,i.maxX-5/e),Ei(t.y,i.minY+5/e,i.maxY-5/e),1/e,P.Angle(i.center,t)),y.jsxs("svg",{ref:s,className:we("tl-overlays__item",n),children:[y.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),y.jsx("use",{href:"#cursor_hint",color:r,opacity:o})]})},WN=({className:n,zoom:e,point:t,color:r,name:i,chatMessage:o})=>{const s=S.useRef(null);return ml(s,t==null?void 0:t.x,t==null?void 0:t.y,1/e),t?y.jsxs("div",{ref:s,className:we("tl-overlays__item",n),children:[y.jsx("svg",{className:"tl-cursor",children:y.jsx("use",{href:"#cursor",color:r})}),o?y.jsxs(y.Fragment,{children:[i&&y.jsx("div",{className:"tl-nametag-title",style:{color:r},children:i}),y.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&y.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null},PP=S.memo(WN),Yw={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function EP(){Yw.hardReset()}function KN(){Yw.refreshPage()}const GN="https://github.com/tldraw/tldraw/issues/new";function YN(){}const IP=({error:n,editor:e})=>{const t=S.useRef(null),[r,i]=S.useState(!1),[o,s]=S.useState(!1),[a,l]=S.useState(!1),c=n instanceof Error?n.message:String(n),u=n instanceof Error?n.stack:null,d=Z("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[h,p]=S.useState(null);S.useLayoutEffect(()=>{var x;d!==null&&p(d);let b=(x=t.current)==null?void 0:x.parentElement,_=!1;for(;b;){if(b.classList.contains("tl-theme__dark")||b.classList.contains("tl-theme__light")){_=!0;break}b=b.parentElement}if(_){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[d]),S.useEffect(()=>{if(o){const b=setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(b)}},[o]);const g=()=>{const b=document.createElement("textarea");b.value=u??c,document.body.appendChild(b),b.select(),document.execCommand("copy"),b.remove(),s(!0)},f=()=>{KN()},m=async()=>{EP()},v=new URL(GN);return v.searchParams.set("title",c),v.searchParams.set("labels","bug"),v.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??c}
\`\`\`

My browser: ${navigator.userAgent}`),y.jsxs("div",{ref:t,className:we("tl-container tl-error-boundary",h===null?"":h?"tl-theme__dark":"tl-theme__light"),children:[y.jsx("div",{className:"tl-error-boundary__overlay"}),e&&y.jsx(SP,{onError:YN,fallback:()=>null,children:y.jsx(Ww.Provider,{value:e,children:y.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:y.jsx(ab,{})})})}),y.jsx("div",{className:we("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?y.jsxs(y.Fragment,{children:[y.jsx("h2",{children:"Are you sure?"}),y.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),y.jsxs("div",{className:"tl-error-boundary__content__actions",children:[y.jsx("button",{onClick:()=>l(!1),children:"Cancel"}),y.jsx("button",{className:"tl-error-boundary__reset",onClick:m,children:"Reset data"})]})]}):y.jsxs(y.Fragment,{children:[y.jsx("h2",{children:"Something's gone wrong."}),y.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",y.jsx("a",{href:v.toString(),children:"create a GitHub issue"})," or"," ",y.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&y.jsxs("div",{className:"tl-error-boundary__content__error",children:[y.jsx("pre",{children:y.jsx("code",{children:u??c})}),y.jsx("button",{onClick:g,children:o?"Copied!":"Copy"})]}),y.jsxs("div",{className:"tl-error-boundary__content__actions",children:[y.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),y.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[y.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),y.jsx("button",{className:"tl-error-boundary__refresh",onClick:f,children:"Refresh Page"})]})]})]})})]})},lo=2e3,ef=40,co=320,yl=[.1,.25,.5,1,2,4,8],Mu=.1,is=8,XN=.5,qN=.1,ZN=.2,JN=.005,QN=.05,e6=450,t6=200,Xw=6,Tu=4,n6=32,tf={};for(let n=1;n<=Math.ceil(is);n++)tf[n+"_dark"]=`hash_pattern_zoom_${n}_dark`,tf[n+"_light"]=`hash_pattern_zoom_${n}_light`;const r6={duration:0,easing:fn.easeInOutCubic},nf=.09,MP=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],i6=6e4,TP=3e3,o6=1200,AP={CAMERA_MOVE:-10},s6=64,a6=620,ei=8,l6=20,wl=32,c6=({x:n,y:e,z:t,size:r})=>y.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[y.jsx("defs",{children:MP.map(({min:i,mid:o,step:s},a)=>{const l=s*r*t,c=.5+n*t,u=.5+e*t,d=c>0?c%l:l+c%l,h=u>0?u%l:l+u%l,p=t<o?Mp(t,[i,o],[0,1]):1;return y.jsx("pattern",{id:`grid-${s}`,width:l,height:l,patternUnits:"userSpaceOnUse",children:y.jsx("circle",{className:"tl-grid-dot",cx:d,cy:h,r:1,opacity:p})},`grid-pattern-${a}`)})}),MP.map(({step:i},o)=>y.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${i})`},`grid-rect-${o}`))]}),u6=({handle:n,isCoarse:e,className:t,zoom:r})=>{const i=(e?20:12)/r,o=(n.type==="create"&&e?3:4)/r;return y.jsxs("g",{className:we("tl-handle",{"tl-handle__virtual":n.type==="virtual","tl-handle__create":n.type==="create"},t),children:[y.jsx("circle",{className:"tl-handle__bg",r:i}),y.jsx("circle",{className:"tl-handle__fg",r:o})]})},d6=({children:n})=>y.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),h6=({shapeId:n})=>y.jsx(ku,{className:"tl-user-indicator__hovered",id:n});function Au(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${Yt(r)}L${Yt(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s],i=n[s+1],o+=Gn(r,i);return e?`M${Gn(n[0],n[1])}Q${Yt(n[1])}${Gn(n[1],n[2])}T${o}${Gn(n[t-1],n[0])}${Gn(n[0],n[1])}Z`:`M${Yt(n[0])}Q${Yt(n[1])}${Gn(n[1],n[2])}${n.length>3?"T":""}${o}L${Yt(n[t-1])}`}const jP=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>n.points.length?y.jsx("svg",{className:i&&we("tl-overlays__item",i),children:y.jsx("path",{className:"tl-scribble",d:Au(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null,RP=({bounds:n,rotation:e})=>{const t=S.useRef(null);return ml(t,n.x,n.y,1,e),S.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=O(Math.max(1,n.width))+"px",r.style.height=O(Math.max(1,n.height))+"px")},[n.width,n.height]),y.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})},p6=({bounds:n,rotation:e})=>{const t=Y(),r=S.useRef(null),i=Z("only selected shape",()=>t.getOnlySelectedShape(),[t]),o=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return ml(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-o,y:-o}),n=n.clone().expandBy(o).zeroFix(),y.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:y.jsx("rect",{className:we("tl-selection__fg__outline"),width:O(n.width),height:O(n.height)})})},f6=()=>y.jsx("div",{className:"tl-shape-error-boundary"}),g6=()=>y.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function m6({points:n,zoom:e}){const t=2.5/e,r=n.reduce((h,p)=>Math.min(h,p.x),1/0),i=n.reduce((h,p)=>Math.max(h,p.x),-1/0),o=n.reduce((h,p)=>Math.min(h,p.y),1/0),s=n.reduce((h,p)=>Math.max(h,p.y),-1/0),a=n.some(h=>h.x===r&&h.y===o);let l,c,u,d;return a?(l=r,c=o,u=i,d=s):(l=r,c=s,u=i,d=o),y.jsxs("g",{className:"tl-snap-line",children:[y.jsx("line",{x1:l,y1:c,x2:u,y2:d}),n.map((h,p)=>y.jsx("g",{transform:`translate(${h.x},${h.y})`,children:y.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},p))]})}function y6({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],o=null;const s=e==="horizontal";for(const l of n){if(o=Qr(i[0],i[1],s?l.startEdge[0].y:l.startEdge[0].x,s?l.startEdge[1].y:l.startEdge[1].x),o)i=o;else continue;if(o=Qr(i[0],i[1],s?l.endEdge[0].y:l.endEdge[0].x,s?l.endEdge[1].y:l.endEdge[1].x),o)i=o;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return y.jsx("g",{className:"tl-snap-line",children:n.map(({startEdge:l,endEdge:c},u)=>y.jsx(S.Fragment,{children:s?y.jsxs(y.Fragment,{children:[y.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),y.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),y.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),y.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):y.jsxs(y.Fragment,{children:[y.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),y.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),y.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),y.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},u))})}const w6=({className:n,line:e,zoom:t})=>y.jsx("svg",{className:we("tl-overlays__item",n),children:e.type==="points"?y.jsx(m6,{...e,zoom:t}):e.type==="gaps"?y.jsx(y6,{...e,zoom:t}):null}),b6=()=>y.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:y.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[y.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),y.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:y.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),v6=()=>null,OP=S.createContext({});function S6({overrides:n,children:e}){return y.jsx(OP.Provider,{value:S.useMemo(()=>({Background:NN,SvgDefs:v6,Brush:Qp,ZoomBrush:Qp,ScreenshotBrush:Qp,CollaboratorBrush:Qp,Cursor:PP,CollaboratorCursor:PP,CollaboratorHint:HN,CollaboratorShapeIndicator:ku,Grid:c6,Scribble:jP,SnapLine:w6,Handles:d6,Handle:u6,CollaboratorScribble:jP,ErrorFallback:IP,ShapeErrorFallback:f6,ShapeIndicatorErrorFallback:g6,Spinner:b6,SelectionBackground:RP,SelectionForeground:p6,HoveredShapeIndicator:h6,OnTheCanvas:null,InFrontOfTheCanvas:null,...n}),[n]),children:e})}function $t(){return S.useContext(OP)}const x6=["textarea","input"];function _6(n){const e=Y();S.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var o;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:s}=i;if(x6.includes((o=s.tagName)==null?void 0:o.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Oe(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function k6(n,e,t){return Math.max(e,Math.min(n,t))}const Xt={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function DP(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function LP(n,e,t,r=.15){return r===0?k6(n,e,t):n<e?-DP(e-n,t-e,r)+e:n>t?+DP(n-t,t-e,r)+t:n}function C6(n,[e,t],[r,i]){const[[o,s],[a,l]]=n;return[LP(e,o,s,r),LP(t,a,l,i)]}function P6(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function E6(n){var e=P6(n,"string");return typeof e=="symbol"?e:String(e)}function gn(n,e,t){return e=E6(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function zP(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function wt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?zP(Object(t),!0).forEach(function(r){gn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):zP(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const NP={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function FP(n){return n?n[0].toUpperCase()+n.slice(1):""}const I6=["enter","leave"];function M6(n=!1,e){return n&&!I6.includes(e)}function T6(n,e="",t=!1){const r=NP[n],i=r&&r[e]||e;return"on"+FP(n)+FP(i)+(M6(t,i)?"Capture":"")}const A6=["gotpointercapture","lostpointercapture"];function j6(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=A6.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function R6(n,e=""){const t=NP[n],r=t&&t[e]||e;return n+r}function $P(n){return"touches"in n}function O6(n){return $P(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function D6(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function qw(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,o=(e.clientY+n.clientY)/2,s=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:s,origin:[i,o]}}catch{}return null}function L6(n){return D6(n).map(e=>e.identifier)}function BP(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return qw(t,r)}const UP=40,VP=800;function HP(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=UP,t*=UP):r===2&&(e*=VP,t*=VP),[e,t]}function z6(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:o})}return e}function rf(n,...e){return typeof n=="function"?n(...e):n}function N6(){}function F6(...n){return n.length===0?N6:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function WP(n,e){return Object.assign({},e,n||{})}const $6=32;class KP{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?rf(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let o=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,z6(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const k=t._delta.map(Math.abs);Xt.addTo(t._distance,k)}this.axisIntent&&this.axisIntent(e);const[s,a]=t._movement,[l,c]=r.threshold,{_step:u,values:d}=t;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(s)>=l&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=c&&d[1])):(u[0]===!1&&(u[0]=Math.abs(s)>=l&&Math.sign(s)*l),u[1]===!1&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[k,E]=d;h[0]=u[0]!==!1?k-u[0]:0,h[1]=u[1]!==!1?E-u[1]:0}else h[0]=u[0]!==!1?s-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(h);const p=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=rf(r.bounds,t)),this.setup&&this.setup()),t.movement=h,this.computeOffset()));const[f,m]=t.offset,[[v,b],[_,x]]=t._bounds;t.overflow=[f<v?-1:f>b?1:0,m<_?-1:m>x?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const C=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=C6(t._bounds,t.offset,C),t.delta=Xt.sub(t.offset,p),this.computeMovement(),g&&(!t.last||o>$6)){t.delta=Xt.sub(t.offset,p);const k=t.delta.map(Math.abs);Xt.addTo(t.distance,k),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&o>0&&(t.velocity=[k[0]/o,k[1]/o],t.timeDelta=o)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(wt(wt(wt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function B6([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class U6 extends KP{constructor(...e){super(...e),gn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Xt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Xt.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[O6(e)]:r.axisThreshold;t.axis=B6(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const V6=n=>n,GP=.15,YP={enabled(n=!0){return n},eventOptions(n,e,t){return wt(wt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[GP,GP];case!1:return[0,0];default:return Xt.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Xt.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||V6},threshold(n){return Xt.toVector(n,0)}},H6=0,ju=wt(wt({},YP),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=H6){return n},bounds(n={}){if(typeof n=="function")return o=>ju.bounds(n(o));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),Ru=typeof window<"u"&&window.document&&window.document.createElement;function XP(){return Ru&&"ontouchstart"in window}function W6(){return XP()||Ru&&window.navigator.maxTouchPoints>1}function K6(){return Ru&&"onpointerdown"in window}function G6(){return Ru&&"exitPointerLock"in window.document}function Y6(){try{return"constructor"in GestureEvent}catch{return!1}}const Ar={isBrowser:Ru,gesture:Y6(),touch:XP(),touchscreen:W6(),pointer:K6(),pointerLock:G6()},X6=250,q6=180,Z6=.5,J6=50,Q6=250,e8=10,qP={mouse:0,touch:0,pen:8};wt(wt({},ju),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Ar.pointerLock,Ar.touch&&t?"touch":this.pointerLock?"mouse":Ar.pointer&&!i?"pointer":Ar.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?X6:void 0,!(!Ar.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const o=Xt.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,o},swipe({velocity:n=Z6,distance:e=J6,duration:t=Q6}={}){return{velocity:this.transform(Xt.toVector(n)),distance:this.transform(Xt.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return q6;case!1:return 0;default:return n}},axisThreshold(n){return n?wt(wt({},qP),n):qP},keyboardDisplacement(n=e8){return n}});function ZP(n){const[e,t]=n.overflow,[r,i]=n._delta,[o,s]=n._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&s<0||t>0&&i<0&&s>0)&&(n._movement[1]=n._movementBound[1])}const t8=30,n8=100;class r8 extends KP{constructor(...e){super(...e),gn(this,"ingKey","pinching"),gn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Xt.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*t8-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=BP(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(s=>i.has(s))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const o=qw(...Array.from(r.values()));o&&this.pinchStart(e,o)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=BP(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=qw(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],o=t.angle-i;let s=0;Math.abs(o)>270&&(s+=Math.sign(o)),this.computeValues([t.distance,t.angle-360*s]),r.origin=t.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Xt.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(r=>e[r]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const t=this.state;t._delta=[-HP(e)[1]/n8*t.offset[0],0],Xt.addTo(t._movement,t._delta),ZP(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const i8=wt(wt({},YP),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Ar.touch&&Ar.gesture)return"gesture";if(Ar.touch&&r)return"touch";if(Ar.touchscreen){if(Ar.pointer)return"pointer";if(Ar.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=s=>{const a=WP(rf(t,s),{min:-1/0,max:1/0});return[a.min,a.max]},o=s=>{const a=WP(rf(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),o()]:s=>[i(s),o(s)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",Xt.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});wt(wt({},ju),{},{mouseOnly:(n=!0)=>n});class o8 extends U6{constructor(...e){super(...e),gn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=HP(e),Xt.addTo(t._movement,t._delta),ZP(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const s8=ju;wt(wt({},ju),{},{mouseOnly:(n=!0)=>n});const Zw=new Map,Jw=new Map;function a8(n){Zw.set(n.key,n.engine),Jw.set(n.key,n.resolver)}const l8={key:"pinch",engine:r8,resolver:i8},c8={key:"wheel",engine:o8,resolver:s8};function u8(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function d8(n,e){if(n==null)return{};var t=u8(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const h8={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Ar.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},p8=["target","eventOptions","window","enabled","transform"];function of(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=of(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function f8(n,e,t={}){const r=n,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=d8(r,p8);if(t.shared=of({target:i,eventOptions:o,window:s,enabled:a,transform:l},h8),e){const u=Jw.get(e);t[e]=of(wt({shared:t.shared},c),u)}else for(const u in c){const d=Jw.get(u);d&&(t[u]=of(wt({shared:t.shared},c[u]),d))}return t}class JP{constructor(e,t){gn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,o){const s=this._listeners,a=R6(t,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=wt(wt({},l),o);e.addEventListener(a,i,c);const u=()=>{e.removeEventListener(a,i,c),s.delete(u)};return s.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class g8{constructor(){gn(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class m8{constructor(e){gn(this,"gestures",new Set),gn(this,"_targetEventStore",new JP(this)),gn(this,"gestureEventStores",{}),gn(this,"gestureTimeoutStores",{}),gn(this,"handlers",{}),gn(this,"config",{}),gn(this,"pointerIds",new Set),gn(this,"touchIds",new Set),gn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),y8(this,e)}setEventIds(e){if($P(e))return this.touchIds=new Set(L6(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=f8(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const s of this.gestures){const a=this.config[s],l=QP(r,a.eventOptions,!!i);if(a.enabled){const c=Zw.get(s);new c(this,e,s).bind(l)}}const o=QP(r,t.eventOptions,!!i);for(const s in this.nativeHandlers)o(s,"",a=>this.nativeHandlers[s](wt(wt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in r)r[o]=F6(...r[o]);if(!i)return r;for(const o in r){const{device:s,capture:a,passive:l}=j6(o);this._targetEventStore.add(i,s,"",r[o],{capture:a,passive:l})}}}}function bl(n,e){n.gestures.add(e),n.gestureEventStores[e]=new JP(n,e),n.gestureTimeoutStores[e]=new g8}function y8(n,e){e.drag&&bl(n,"drag"),e.wheel&&bl(n,"wheel"),e.scroll&&bl(n,"scroll"),e.move&&bl(n,"move"),e.pinch&&bl(n,"pinch"),e.hover&&bl(n,"hover")}const QP=(n,e,t)=>(r,i,o,s={},a=!1)=>{var l,c;const u=(l=s.capture)!==null&&l!==void 0?l:e.capture,d=(c=s.passive)!==null&&c!==void 0?c:e.passive;let h=a?r:T6(r,i,u);t&&d&&(h+="Passive"),n[h]=n[h]||[],n[h].push(o)},w8=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function b8(n){const e={},t={},r=new Set;for(let i in n)w8.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function vl(n,e,t,r,i,o){if(!n.has(t)||!Zw.has(r))return;const s=t+"Start",a=t+"End",l=c=>{let u;return c.first&&s in e&&e[s](c),t in e&&(u=e[t](c)),c.last&&a in e&&e[a](c),u};i[r]=l,o[r]=o[r]||{}}function v8(n,e){const[t,r,i]=b8(n),o={};return vl(i,t,"onDrag","drag",o,e),vl(i,t,"onWheel","wheel",o,e),vl(i,t,"onScroll","scroll",o,e),vl(i,t,"onPinch","pinch",o,e),vl(i,t,"onMove","move",o,e),vl(i,t,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function S8(n,e={},t,r){const i=oe.useMemo(()=>new m8(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),oe.useEffect(i.effect.bind(i)),oe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function x8(n){return n.forEach(a8),function(e,t){const{handlers:r,nativeHandlers:i,config:o}=v8(e,t||{});return S8(r,o,void 0,i)}}const eE=10,_8=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function tE(n){let{deltaY:e,deltaX:t}=n,r=0;if(n.ctrlKey||n.altKey||n.metaKey){const i=Math.sign(n.deltaY),o=Math.abs(n.deltaY);let s=e;o>eE&&(s=eE*i),r=s/100}else n.shiftKey&&!_8&&(t=e,e=0);return{x:-t,y:-e,z:-r}}const k8=x8([c8,l8]);let Sl;const C8=n=>Sl===void 0?(Sl=n,!1):n-Sl>120&&n-Sl<160?(Sl=n,!0):(Sl=n,!1);function P8(n){const e=Y(),t=S.useMemo(()=>{let r="not sure";const i=({event:p})=>{var b;if(!e.getInstanceState().isFocused||(r="not sure",C8(Date.now())))return;const g=e.getEditingShapeId();if(g){const _=e.getShape(g);if(_&&e.getShapeUtil(_).canScroll(_)&&((b=e.getShapePageBounds(g))!=null&&b.containsPoint(e.inputs.currentPagePoint)))return}Oe(p);const f=tE(p);if(f.x===0&&f.y===0)return;const m=e.getContainer().getBoundingClientRect(),v={type:"wheel",name:"wheel",delta:f,point:new P(p.clientX,p.clientY).sub({x:m.left,y:m.top}),shiftKey:p.shiftKey,altKey:p.altKey,ctrlKey:p.metaKey||p.ctrlKey};e.dispatch(v)};let o=1,s=1,a=1,l=0;const c=new P,u=new P,d=p=>{const g=n.current;r="not sure";const{event:f,origin:m,da:v}=p;f instanceof WheelEvent||(f.target===g||g!=null&&g.contains(f.target))&&(u.x=m[0],u.y=m[1],c.x=m[0],c.y=m[1],o=v[0],s=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:m[0],y:m[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey}))},h=p=>{if(p&&(r="zooming"),r==="zooming")return;const g=Math.abs(l-o),f=P.Dist(c,u);switch(r){case"not sure":{g>24?r="zooming":f>16&&(r="panning");break}case"panning":{g>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:d,onPinchEnd:p=>{const g=n.current,{event:f,origin:m,offset:v}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const b=v[0];r="not sure",requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:m[0],y:m[1],z:b},delta:{x:m[0],y:m[1]},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey})})},onPinch:p=>{const g=n.current,{event:f,origin:m,offset:v,da:b}=p;if(f instanceof WheelEvent||!(f.target===g||g!=null&&g.contains(f.target)))return;const _=p.type==="gesturechange"||p.type==="gestureend";l=b[0];const x=m[0]-u.x,C=m[1]-u.y;switch(u.x=m[0],u.y=m[1],h(_),r){case"zooming":{a=v[0],e.dispatch({type:"pinch",name:"pinch",point:{x:m[0],y:m[1],z:a},delta:{x,y:C},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:m[0],y:m[1],z:s},delta:{x,y:C},shiftKey:f.shiftKey,altKey:f.altKey,ctrlKey:f.metaKey||f.ctrlKey});break}}}}},[e,n]);k8(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function Qw(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(o=>o.id===t)}}function E8(n,e){const t=Y();return S.useMemo(()=>{const r=s=>{if(s.isKilled)return;const a=Yp(s.currentTarget);vu(a,s);const{shape:l,handle:c}=Qw(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_down",...Kn(s)})};let i,o;return{onPointerDown:r,onPointerMove:s=>{if(s.isKilled||s.clientX===i&&s.clientY===o)return;i=s.clientX,o=s.clientY;const{shape:a,handle:l}=Qw(t,n,e);l&&t.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...Kn(s)})},onPointerUp:s=>{if(s.isKilled)return;const a=Yp(s.currentTarget);Su(a,s);const{shape:l,handle:c}=Qw(t,n,e);c&&t.dispatch({type:"pointer",target:"handle",handle:c,shape:l,name:"pointer_up",...Kn(s)})}}},[t,n,e])}var nE="Expected a function",rE=0/0,I8="[object Symbol]",M8=/^\s+|\s+$/g,T8=/^[-+]0x[0-9a-f]+$/i,A8=/^0b[01]+$/i,j8=/^0o[0-7]+$/i,R8=parseInt,O8=typeof Ce=="object"&&Ce&&Ce.Object===Object&&Ce,D8=typeof self=="object"&&self&&self.Object===Object&&self,L8=O8||D8||Function("return this")(),z8=Object.prototype,N8=z8.toString,F8=Math.max,$8=Math.min,eb=function(){return L8.Date.now()};function B8(n,e,t){var r,i,o,s,a,l,c=0,u=!1,d=!1,h=!0;if(typeof n!="function")throw new TypeError(nE);e=iE(e)||0,sf(t)&&(u=!!t.leading,d="maxWait"in t,o=d?F8(iE(t.maxWait)||0,e):o,h="trailing"in t?!!t.trailing:h);function p(k){var E=r,I=i;return r=i=void 0,c=k,s=n.apply(I,E),s}function g(k){return c=k,a=setTimeout(v,e),u?p(k):s}function f(k){var E=k-l,I=k-c,T=e-E;return d?$8(T,o-I):T}function m(k){var E=k-l,I=k-c;return l===void 0||E>=e||E<0||d&&I>=o}function v(){var k=eb();if(m(k))return b(k);a=setTimeout(v,f(k))}function b(k){return a=void 0,h&&r?p(k):(r=i=void 0,s)}function _(){a!==void 0&&clearTimeout(a),c=0,r=l=i=a=void 0}function x(){return a===void 0?s:b(eb())}function C(){var k=eb(),E=m(k);if(r=arguments,i=this,l=k,E){if(a===void 0)return g(l);if(d)return a=setTimeout(v,e),p(l)}return a===void 0&&(a=setTimeout(v,e)),s}return C.cancel=_,C.flush=x,C}function U8(n,e,t){var r=!0,i=!0;if(typeof n!="function")throw new TypeError(nE);return sf(t)&&(r="leading"in t?!!t.leading:r,i="trailing"in t?!!t.trailing:i),B8(n,e,{leading:r,maxWait:e,trailing:i})}function sf(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function V8(n){return!!n&&typeof n=="object"}function H8(n){return typeof n=="symbol"||V8(n)&&N8.call(n)==I8}function iE(n){if(typeof n=="number")return n;if(H8(n))return rE;if(sf(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=sf(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(M8,"");var t=A8.test(n);return t||j8.test(n)?R8(n.slice(2),t?2:8):T8.test(n)?rE:+n}var W8=U8;const K8=Jn(W8);function G8(){const n=Y();S.useLayoutEffect(()=>{const e=K8(()=>{n.updateViewportScreenBounds()},200,{trailing:!0});n.updateViewportScreenBounds();const t=setInterval(e,1e3);return window.addEventListener("resize",e),window.addEventListener("scroll",e),()=>{clearInterval(t),window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}},[n])}const pt=class pt{constructor(e=0,t=0,r=0,i=0){w(this,"x",0);w(this,"y",0);w(this,"w",0);w(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new P(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new P(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY)]}get snapPoints(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new P(this.w,this.h)}toFixed(){return this.x=Xp(this.x),this.y=Xp(this.y),this.w=Xp(this.w),this.h=Xp(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=o-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new pt(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,o-r)}collides(e){return pt.Collides(this,e)}contains(e){return pt.Contains(this,e)}includes(e){return pt.Includes(this,e)}containsPoint(e,t=0){return pt.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new P(this.minX,this.minY);case"top_right":return new P(this.maxX,this.minY);case"bottom_left":return new P(this.minX,this.maxY);case"bottom_right":return new P(this.maxX,this.maxY);case"top":return new P(this.midX,this.minY);case"right":return new P(this.maxX,this.midY);case"bottom":return new P(this.midX,this.maxY);case"left":return new P(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:o,maxX:s,maxY:a}=this;let{minX:l,minY:c,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const h=(u-l)/(s-i),p=(d-c)/(a-o),g=h<0,f=p<0;if(g){const m=u;u=l,l=m}if(f){const m=d;d=c,c=m}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=o-r,this}static From(e){return new pt(e.x,e.y,e.w,e.h)}static FromPoints(e){if(e.length===0)return new pt;let t=1/0,r=1/0,i=-1/0,o=-1/0,s;for(let a=0,l=e.length;a<l;a++)s=e[a],t=Math.min(s.x,t),r=Math.min(s.y,r),i=Math.max(s.x,i),o=Math.max(s.y,o);return new pt(t,r,i-t,o-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),o=Math.max(t.maxX,e.maxX),s=Math.max(t.maxY,e.maxY);return new pt(r,i,o-r,s-i)}static ExpandBy(e,t){return new pt(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Resize(e,t,r,i,o=!1){const{minX:s,minY:a,maxX:l,maxY:c}=e;let{minX:u,minY:d,maxX:h,maxY:p}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(t){case"top":case"top_left":case"top_right":{d+=i;break}case"bottom":case"bottom_left":case"bottom_right":{p+=i;break}}const g=(h-u)/(l-s),f=(p-d)/(c-a),m=g<0,v=f<0;if(o){const _=(l-s)/(c-a),x=Math.abs(h-u),C=Math.abs(p-d),k=x*(f<0?1:-1)*(1/_),E=C*(g<0?1:-1)*_,I=_<x/C;switch(t){case"top_left":{I?d=p+k:u=h+E;break}case"top_right":{I?d=p+k:h=u-E;break}case"bottom_right":{I?p=d-k:h=u-E;break}case"bottom_left":{I?p=d-k:u=h+E;break}case"bottom":case"top":{const T=(u+h)/2,A=C*_;u=T-A/2,h=T+A/2;break}case"left":case"right":{const T=(d+p)/2,A=x/_;d=T-A/2,p=T+A/2;break}}}if(m){const _=h;h=u,u=_}if(v){const _=p;p=d,d=_}const b=new pt(u,d,Math.abs(h-u),Math.abs(p-d));return{box:b,scaleX:+(b.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(b.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return pt.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new pt(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};w(pt,"Collides",(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)),w(pt,"Contains",(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX),w(pt,"Includes",(e,t)=>pt.Collides(e,t)||pt.Contains(e,t)),w(pt,"ContainsPoint",(e,t,r=0)=>!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)),w(pt,"Common",e=>{let t=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0;s<e.length;s++){const a=e[s];t=Math.min(t,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),o=Math.max(o,a.maxY)}return new pt(t,r,i-t,o-r)}),w(pt,"Sides",(e,t=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let de=pt;function Y8(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function X8(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function q8(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}const Be=class Be{constructor(e,t,r,i,o,s){w(this,"a",1);w(this,"b",0);w(this,"c",0);w(this,"d",1);w(this,"e",0);w(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=o,this.f=s}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:o,d:s,e:a,f:l}=this;return this.a=r*t.a+o*t.b,this.c=r*t.c+o*t.d,this.e=r*t.e+o*t.f+a,this.b=i*t.a+s*t.b,this.d=i*t.c+s*t.d,this.f=i*t.e+s*t.f+l,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(Be.Rotate(e)):this.translate(t,r).multiply(Be.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(Be.Translate(e,t))}scale(e,t){return this.multiply(Be.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:o,f:s}=this,a=e*i-t*r;return this.a=i/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(i*o-r*s)/-a,this.f=(t*o-e*s)/a,this}applyToPoint(e){return Be.applyToPoint(this,e)}applyToPoints(e){return Be.applyToPoints(this,e)}rotation(){return Be.Rotation(this)}point(){return Be.Point(this)}decomposed(){return Be.Decompose(this)}toCssString(){return Be.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Be.Decompose(this)}clone(){return new Be(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Be(1,0,0,1,0,0)}static Translate(e,t){return new Be(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return Be.Identity();const i=Math.cos(e),o=Math.sin(e),s=new Be(i,o,-o,i,0,0);return t===void 0?s:Be.Compose(Be.Translate(t,r),s,Be.Translate(-t,-r))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=Be.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new P(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=Math.hypot(e.a,e.c);t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=Math.hypot(e.b,e.d);t=rt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return Kw(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const o=Math.hypot(e.a,e.c);t=o,r=(e.a*e.d-e.b*e.c)/o,i=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/o,r=o,i=rt+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:Kw(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${O(e.a)}, ${O(e.b)}, ${O(e.c)}, ${O(e.d)}, ${O(e.e)}, ${O(e.f)})`}static applyToPoint(e,t){return new P(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new P(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new de(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Be(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Be?e:Be.From(e)}};w(Be,"Scale",(e,t,r,i)=>{const o=new Be(e,0,0,t,0,0);return r===void 0?o:Be.Compose(Be.Translate(r,i),o,Be.Translate(-r,-i))});let re=Be;function Z8(n=!0){const[e,t]=S.useState(0),r=Y();S.useEffect(()=>{if(!n)return;const i=()=>t(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const J8=ze(function({showStroke:n=!0,showVertices:e=!0,showClosestPointOnOutline:t=!0}){const r=Y();Z8(t);const i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return y.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(a=>{const l=r.getShape(a.id);if(l.type==="group")return null;const c=r.getShapeGeometry(l),u=r.getShapePageTransform(l),d=r.getPointInShapeSpace(l,s),h=c.nearestPoint(d),p=c.distanceToPoint(d,!0),g=Math.abs(p)*i,f=p<0,{vertices:m}=c;return y.jsxs("g",{transform:u.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[n&&y.jsx("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:c.toSimpleSvgPath()}),e&&m.map((v,b)=>y.jsx("circle",{cx:v.x,cy:v.y,r:"2",fill:`hsl(${Mp(b,[0,m.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${b}`)),t&&g<150&&y.jsx("line",{x1:h.x,y1:h.y,x2:d.x,y2:d.y,opacity:1-g/150,stroke:f?"goldenrod":"dodgerblue",strokeWidth:"2"})]},a.id+"_outline")})})});var Q8=200,tb="__lodash_hash_undefined__",eF=1/0,tF="[object Function]",nF="[object GeneratorFunction]",rF=/[\\^$.*+?()[\]{}|]/g,iF=/^\[object .+?Constructor\]$/,oF=typeof Ce=="object"&&Ce&&Ce.Object===Object&&Ce,sF=typeof self=="object"&&self&&self.Object===Object&&self,nb=oF||sF||Function("return this")();function aF(n,e){var t=n?n.length:0;return!!t&&uF(n,e,0)>-1}function lF(n,e,t){for(var r=-1,i=n?n.length:0;++r<i;)if(t(e,n[r]))return!0;return!1}function cF(n,e,t,r){for(var i=n.length,o=t+(r?1:-1);r?o--:++o<i;)if(e(n[o],o,n))return o;return-1}function uF(n,e,t){if(e!==e)return cF(n,dF,t);for(var r=t-1,i=n.length;++r<i;)if(n[r]===e)return r;return-1}function dF(n){return n!==n}function hF(n,e){return n.has(e)}function pF(n,e){return n==null?void 0:n[e]}function fF(n){var e=!1;if(n!=null&&typeof n.toString!="function")try{e=!!(n+"")}catch{}return e}function oE(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var gF=Array.prototype,mF=Function.prototype,sE=Object.prototype,rb=nb["__core-js_shared__"],aE=function(){var n=/[^.]+$/.exec(rb&&rb.keys&&rb.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),lE=mF.toString,ib=sE.hasOwnProperty,yF=sE.toString,wF=RegExp("^"+lE.call(ib).replace(rF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),bF=gF.splice,vF=sb(nb,"Map"),ob=sb(nb,"Set"),Ou=sb(Object,"create");function ta(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function SF(){this.__data__=Ou?Ou(null):{}}function xF(n){return this.has(n)&&delete this.__data__[n]}function _F(n){var e=this.__data__;if(Ou){var t=e[n];return t===tb?void 0:t}return ib.call(e,n)?e[n]:void 0}function kF(n){var e=this.__data__;return Ou?e[n]!==void 0:ib.call(e,n)}function CF(n,e){var t=this.__data__;return t[n]=Ou&&e===void 0?tb:e,this}ta.prototype.clear=SF,ta.prototype.delete=xF,ta.prototype.get=_F,ta.prototype.has=kF,ta.prototype.set=CF;function xl(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function PF(){this.__data__=[]}function EF(n){var e=this.__data__,t=lf(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():bF.call(e,t,1),!0}function IF(n){var e=this.__data__,t=lf(e,n);return t<0?void 0:e[t][1]}function MF(n){return lf(this.__data__,n)>-1}function TF(n,e){var t=this.__data__,r=lf(t,n);return r<0?t.push([n,e]):t[r][1]=e,this}xl.prototype.clear=PF,xl.prototype.delete=EF,xl.prototype.get=IF,xl.prototype.has=MF,xl.prototype.set=TF;function _l(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}function AF(){this.__data__={hash:new ta,map:new(vF||xl),string:new ta}}function jF(n){return cf(this,n).delete(n)}function RF(n){return cf(this,n).get(n)}function OF(n){return cf(this,n).has(n)}function DF(n,e){return cf(this,n).set(n,e),this}_l.prototype.clear=AF,_l.prototype.delete=jF,_l.prototype.get=RF,_l.prototype.has=OF,_l.prototype.set=DF;function af(n){var e=-1,t=n?n.length:0;for(this.__data__=new _l;++e<t;)this.add(n[e])}function LF(n){return this.__data__.set(n,tb),this}function zF(n){return this.__data__.has(n)}af.prototype.add=af.prototype.push=LF,af.prototype.has=zF;function lf(n,e){for(var t=n.length;t--;)if(WF(n[t][0],e))return t;return-1}function NF(n){if(!cE(n)||UF(n))return!1;var e=KF(n)||fF(n)?wF:iF;return e.test(VF(n))}function FF(n,e,t){var r=-1,i=aF,o=n.length,s=!0,a=[],l=a;if(t)s=!1,i=lF;else if(o>=Q8){var c=e?null:$F(n);if(c)return oE(c);s=!1,i=hF,l=new af}else l=e?[]:a;e:for(;++r<o;){var u=n[r],d=e?e(u):u;if(u=t||u!==0?u:0,s&&d===d){for(var h=l.length;h--;)if(l[h]===d)continue e;e&&l.push(d),a.push(u)}else i(l,d,t)||(l!==a&&l.push(d),a.push(u))}return a}var $F=ob&&1/oE(new ob([,-0]))[1]==eF?function(n){return new ob(n)}:GF;function cf(n,e){var t=n.__data__;return BF(e)?t[typeof e=="string"?"string":"hash"]:t.map}function sb(n,e){var t=pF(n,e);return NF(t)?t:void 0}function BF(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function UF(n){return!!aE&&aE in n}function VF(n){if(n!=null){try{return lE.call(n)}catch{}try{return n+""}catch{}}return""}function HF(n){return n&&n.length?FF(n):[]}function WF(n,e){return n===e||n!==n&&e!==e}function KF(n){var e=cE(n)?yF.call(n):"";return e==tF||e==nF}function cE(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function GF(){}var YF=HF;const XF=Jn(YF);function uE(n){return XF(n)}function qF(){const n=Y(),e=S.useMemo(()=>n.store.query.records("instance_presence",()=>({userId:{neq:n.user.getId()}})),[n]),t=R2("userIds",()=>uE(e.get().map(r=>r.userId)).sort(),{isEqual:(r,i)=>{var o;return r.join(",")===((o=i.join)==null?void 0:o.call(i,","))}},[e]);return Z(t)}function dE(n){const e=Y(),t=S.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{eq:n}})),[e,n]);return Z(`latestPresence:${n}`,()=>t.get().slice().sort((r,i)=>i.lastActivityTimestamp-r.lastActivityTimestamp)[0],[])??null}const ZF=ze(function(){const n=qF();return y.jsx(y.Fragment,{children:n.map(e=>y.jsx(JF,{collaboratorId:e},e))})}),JF=ze(function({collaboratorId:n}){const e=Y(),t=dE(n),r=e9(t);if(!(t&&t.currentPageId===e.getCurrentPageId()))return null;switch(r){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=e.getInstanceState();if(!(i===t.userId||o.includes(t.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=e.getInstanceState();if(t.followingUserId===e.user.getId()&&!(t.chatMessage||i.includes(t.userId)))return null;break}}return y.jsx(QF,{latestPresence:t})}),QF=ze(function({latestPresence:n}){const e=Y(),{CollaboratorBrush:t,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=$t(),a=e.getZoomLevel(),l=e.getViewportPageBounds(),{userId:c,chatMessage:u,brush:d,scribbles:h,selectedShapeIds:p,userName:g,cursor:f,color:m}=n,v=!(f.x<l.minX-12/a||f.y<l.minY-16/a||f.x>l.maxX-12/a||f.y>l.maxY-16/a);return y.jsxs(y.Fragment,{children:[d&&t?y.jsx(t,{className:"tl-collaborator__brush",brush:d,color:m,opacity:.1},c+"_brush"):null,v&&i?y.jsx(i,{className:"tl-collaborator__cursor",point:f,color:m,zoom:a,name:g!=="New User"?g:null,chatMessage:u},c+"_cursor"):o?y.jsx(o,{className:"tl-collaborator__cursor-hint",point:f,color:m,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?y.jsx(y.Fragment,{children:h.map(b=>y.jsx(r,{className:"tl-collaborator__scribble",scribble:b,color:m,zoom:a,opacity:b.color==="laser"?.5:.1},c+"_scribble_"+b.id))}):null,s&&p.map(b=>y.jsx(s,{className:"tl-collaborator__shape-indicator",id:b,color:m,opacity:.5},c+"_"+b))]})});function hE(n){return n>i6?"inactive":n>TP?"idle":"active"}function e9(n){const e=S.useRef((n==null?void 0:n.lastActivityTimestamp)??-1),[t,r]=S.useState(()=>hE(Date.now()-e.current));return S.useEffect(()=>{const i=setInterval(()=>{r(hE(Date.now()-e.current))},o6);return()=>clearInterval(i)},[]),n&&(e.current=n.lastActivityTimestamp),t}function pE(n,e){return e===0?n:pE(e,n%e)}function fE(n){const e=n.toString().split(".")[1];if(!e)return 1;const t=Math.pow(10,e.length),r=parseInt(e,10);return t/pE(r,t)}function t9(){const n=Y(),e=pn();S.useEffect(()=>lu("useDPRMultiple",()=>{const t=n.getInstanceState().devicePixelRatio;e.style.setProperty("--tl-dpr-multiple",fE(t).toString())}),[n,e])}const gE=ze(function({id:n,shape:e,util:t,index:r,backgroundIndex:i,opacity:o,isCulled:s}){const a=Y(),{ShapeErrorFallback:l}=$t(),c=S.useRef(null),u=S.useRef(null),d=S.useCallback((p,g)=>{var f,m;(f=c.current)==null||f.style.setProperty(p,g),(m=u.current)==null||m.style.setProperty(p,g)},[]);Xs("set shape container transform position",()=>{if(!a.getShape(n))return;const p=a.getShapePageTransform(n),g=re.toCssString(p);d("transform",g)},[a,d]),Xs("set shape container clip path",()=>{if(!a.getShape(n))return null;const p=a.getShapeClipPath(n);d("clip-path",p??"none")},[a,d]),Xs("set shape height and width",()=>{const p=a.getShape(n);if(!p)return null;const g=a.getShapeGeometry(p).bounds,f=Math.floor(a.getInstanceState().devicePixelRatio*100)/100,m=fE(f),v=g.w%m,b=v===0?g.w:g.w+(m-v),_=g.h%m,x=_===0?g.h:g.h+(m-_);d("width",Math.max(b,m)+"px"),d("height",Math.max(x,m)+"px")},[a]),S.useLayoutEffect(()=>{var p,g;d("opacity",o+""),(p=c.current)==null||p.style.setProperty("z-index",r+""),(g=u.current)==null||g.style.setProperty("z-index",i+"")},[o,r,i,d]);const h=S.useCallback(p=>{a.annotateError(p,{origin:"react.shape",willCrashApp:!1})},[a]);return e?y.jsxs(y.Fragment,{children:[t.backgroundComponent&&y.jsx("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":e.type,draggable:!1,children:!s&&y.jsx(_u,{fallback:l,onError:h,children:y.jsx(r9,{shape:e,util:t})})}),y.jsx("div",{ref:c,className:"tl-shape","data-shape-type":e.type,draggable:!1,children:s?y.jsx(i9,{shape:e}):y.jsx(_u,{fallback:l,onError:h,children:y.jsx(n9,{shape:e,util:t})})})]}):null}),n9=S.memo(function({shape:n,util:e}){return Cp("InnerShape:"+n.type,()=>e.component(n))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta&&n.util===e.util),r9=S.memo(function({shape:n,util:e}){return Cp("InnerShape:"+n.type,()=>{var t;return(t=e.backgroundComponent)==null?void 0:t.call(e,n)})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),i9=S.memo(function({shape:n}){const e=Y().getShapeGeometry(n).bounds;return y.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${O(e.minX)}px, ${O(e.minY)}px)`,width:Math.max(1,O(e.width)),height:Math.max(1,O(e.height))}})},()=>!0);function ab({className:n}){const e=Y(),{Background:t,SvgDefs:r}=$t(),i=oe.useRef(null),o=oe.useRef(null),s=oe.useRef(null);G8(),AN(),MN(),P8(i),_6(i),Xs("position layers",()=>{const h=o.current;if(!h)return;const p=s.current;if(!p)return;const{x:g,y:f,z:m}=e.getCamera(),v=m>=1?Mp(m,[1,8],[.125,.5],!0):Mp(m,[.1,1],[-2,.125],!0),b=`scale(${O(m)}) translate(${O(g+v)}px,${O(f+v)}px)`;h.style.setProperty("transform",b),p.style.setProperty("transform",b)},[e]);const a=IN(),l=Z("shapeSvgDefs",()=>{const h=new Map;for(const p of kt(e.shapeUtils)){if(!p)return;const g=p.getCanvasSvgDefs();for(const{key:f,component:m}of g)h.has(f)||h.set(f,y.jsx(m,{},f))}return[...h.values()]},[e]),c=Z("debug_shapes",()=>nt.hideShapes.get(),[nt]),u=Z("debug_svg",()=>nt.debugSvg.get(),[nt]),d=Z("debug_geometry",()=>nt.debugGeometry.get(),[nt]);return y.jsxs("div",{ref:i,draggable:!1,className:we("tl-canvas",n),"data-testid":"canvas",...a,children:[t&&y.jsx(t,{}),y.jsx(o9,{}),y.jsx(x9,{}),y.jsx("svg",{className:"tl-svg-context",children:y.jsxs("defs",{children:[l,mE&&y.jsx(mE,{}),y.jsx(w9,{}),y.jsx(b9,{}),y.jsx(v9,{}),r&&y.jsx(r,{})]})}),y.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[y.jsx(C9,{}),y.jsx(k9,{}),c?null:u?y.jsx(p9,{}):y.jsx(f9,{})]}),y.jsxs("div",{className:"tl-fixed-layer tl-overlays",children:[y.jsxs("div",{ref:s,className:"tl-html-layer",children:[d?y.jsx(J8,{}):null,y.jsx(d9,{}),y.jsx(a9,{}),y.jsx(s9,{}),y.jsx(l9,{}),y.jsx(g9,{}),y.jsx(m9,{}),y.jsx(y9,{}),y.jsx(c9,{}),y.jsx(_9,{}),y.jsx(ZF,{})]}),y.jsx(P9,{})]})]})}function o9(){const n=Y(),e=Z("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=Z("camera",()=>n.getCamera(),[n]),o=Z("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:s}=$t();return s&&o?y.jsx(s,{x:t,y:r,z:i,size:e}):null}function s9(){const n=Y(),e=Z("scribbles",()=>n.getInstanceState().scribbles,[n]),t=Z("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=$t();return r&&e.length?y.jsx(y.Fragment,{children:e.map(i=>y.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id))}):null}function a9(){const n=Y(),e=Z("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=$t();return t&&e?y.jsx(t,{className:"tl-user-brush",brush:e}):null}function l9(){const n=Y(),e=Z("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=$t();return t&&e?y.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function c9(){const n=Y(),e=Z("snapLines",()=>n.snaps.getLines(),[n]),t=Z("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapLine:r}=$t();return r&&e.length>0?y.jsx(y.Fragment,{children:e.map(i=>y.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id))}):null}const u9=48;function d9(){const n=Y(),{Handles:e}=$t(),t=Z("zoomLevel",()=>n.getZoomLevel(),[n]),r=Z("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),i=Z("onlySelectedShape",()=>n.getOnlySelectedShape(),[n]),o=Z("isChangingStyle",()=>n.getInstanceState().isChangingStyle,[n]),s=Z("isChangingStyle",()=>n.getInstanceState().isReadonly,[n]),a=Z("handles",()=>{const u=n.getOnlySelectedShape();if(u)return n.getShapeHandles(u)},[n]),l=Z("transform",()=>{const u=n.getOnlySelectedShape();if(u)return n.getShapePageTransform(u)},[n]);if(!e||!i||o||s||!a||!l)return null;const c=[];for(let u=0,d=a[u];u<a.length;u++,d=a[u]){if(d.type!=="vertex"){const h=a[u-1],p=a[u+1];if(h&&p&&Math.hypot(h.y-p.y,h.x-p.x)<u9/t)continue}c.push(d)}return c.sort(u=>u.type==="vertex"?1:-1),y.jsx(e,{children:y.jsx("g",{transform:re.toCssString(l),children:c.map(u=>y.jsx(h9,{shapeId:i.id,handle:u,zoom:t,isCoarse:r},u.id))})})}function h9({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=E8(n,e.id),{Handle:o}=$t();return o?y.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:y.jsx(o,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function p9(){const n=Y(),e=Z("rendering shapes",()=>n.getRenderingShapes(),[n]);return y.jsx(y.Fragment,{children:e.map(t=>y.jsxs(oe.Fragment,{children:[y.jsx(gE,{...t}),y.jsx(S9,{id:t.id})]},t.id+"_fragment"))})}function f9(){const n=Y(),e=Z("rendering shapes",()=>n.getRenderingShapes(),[n]);return y.jsx(y.Fragment,{children:e.map(t=>y.jsx(gE,{...t},t.id+"_shape"))})}function g9(){const n=Y(),e=Z("selectedShapeIds",()=>n.getCurrentPageState().selectedShapeIds,[n]);return Z("should display selected ids",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!n.getInstanceState().isChangingStyle,[n])?y.jsx(y.Fragment,{children:e.map(t=>y.jsx(ku,{className:"tl-user-indicator__selected",id:t},t+"_indicator"))}):null}const m9=function(){const n=Y(),{HoveredShapeIndicator:e}=$t(),t=Z("coarse pointer",()=>n.getInstanceState().isCoarsePointer,[n]),r=Z("hovering canvas",()=>n.getInstanceState().isHoveringCanvas,[n]),i=Z("hovered id",()=>n.getCurrentPageState().hoveredShapeId,[n]);return t||!r||!i||!e?null:y.jsx(e,{shapeId:i})},y9=ze(function(){const n=Y(),e=Ep(n.getHintingShapeIds());return e.length?y.jsx(y.Fragment,{children:e.map(t=>y.jsx(ku,{className:"tl-user-indicator__hint",id:t},t+"_hinting"))}):null});function mE(){return y.jsxs("g",{id:"cursor",children:[y.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[y.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),y.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),y.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[y.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),y.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),y.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[y.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),y.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function w9(){return y.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function b9(){return y.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:y.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function v9(){return y.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[y.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),y.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const S9=ze(function({id:n}){const e=Y(),t=e.getShape(n),[r,i]=oe.useState(""),o=(t==null?void 0:t.parentId)===e.getCurrentPageId();return oe.useEffect(()=>{if(!o)return;let s=null;const a=lu("shape to svg",async()=>{const l=Math.random();s=l;const c=e.getShapePageBounds(n),u=await e.getSvg([n],{padding:0});u&&c&&s===l&&(u.style.setProperty("overflow","visible"),u.setAttribute("preserveAspectRatio","xMidYMin slice"),u.style.setProperty("transform",`translate(${c.x}px, ${c.y+c.h+12}px)`),u.style.setProperty("border","1px solid black"),i(u==null?void 0:u.outerHTML))});return()=>{s=null,a()}},[e,n,o]),o?y.jsx("div",{style:{paddingTop:12,position:"absolute"},children:y.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function x9(){const n=Z("debugging ui log",()=>nt.logMessages.get(),[nt]);return n.length?y.jsx("div",{className:"debug__ui-logger",children:n.map((e,t)=>{const r=typeof e=="string"?e:JSON.stringify(e);return y.jsx("div",{className:"debug__ui-logger__line",children:r},t)})}):null}function _9(){const n=Y(),e=Z("selection rotation",()=>n.getSelectionRotation(),[n]),t=Z("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=$t();return!t||!r?null:y.jsx(r,{bounds:t,rotation:e})}function k9(){const n=Y(),e=Z("selection rotation",()=>n.getSelectionRotation(),[n]),t=Z("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=$t();return!t||!r?null:y.jsx(r,{bounds:t,rotation:e})}function C9(){const{OnTheCanvas:n}=$t();return n?y.jsx(n,{}):null}function P9(){const{InFrontOfTheCanvas:n}=$t();return n?y.jsx(n,{}):null}const E9=()=>y.jsx(aI,{children:"Connecting..."});function Xe(){return jp()}const yE="TLDRAW_USER_DATA_v3",wE=Te({id:Se,name:Se.nullable().optional(),locale:Se.nullable().optional(),color:Se.nullable().optional(),isDarkMode:Ie.nullable().optional(),animationSpeed:be.nullable().optional(),edgeScrollSpeed:be.nullable().optional(),isSnapMode:Ie.nullable().optional()}),Du={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},uf=Ne({currentVersion:Du.AddEdgeScrollSpeed,migrators:{[Du.AddAnimationSpeed]:{up:n=>({...n,animationSpeed:1}),down:({animationSpeed:n,...e})=>e},[Du.AddIsSnapMode]:{up:n=>({...n,isSnapMode:!1}),down:({isSnapMode:n,...e})=>e},[Du.MakeFieldsNullable]:{up:n=>n,down:n=>({id:n.id,name:n.name??jr.name,locale:n.locale??jr.locale,color:n.color??jr.color,isDarkMode:n.isDarkMode??jr.isDarkMode,animationSpeed:n.animationSpeed??jr.animationSpeed,isSnapMode:n.isSnapMode??jr.isSnapMode})},[Du.AddEdgeScrollSpeed]:{up:n=>({...n,edgeScrollSpeed:1}),down:({edgeScrollSpeed:n,...e})=>e}}}),bE=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function I9(){return bE[Math.floor(Math.random()*bE.length)]}function M9(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-color-scheme: dark)"))==null?void 0:e.matches)??!1}function T9(){var n,e;return typeof window>"u"?!1:((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1}const jr=Object.freeze({name:"New User",locale:vN(),color:I9(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:T9()?0:1,isSnapMode:!1});function lb(){return{id:Xe()}}function vE(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return lb();const e=Ew({value:n.user,fromVersion:n.version,toVersion:uf.currentVersion??0,migrations:uf});if(e.type==="error")return lb();try{wE.validate(e.value)}catch{return lb()}return e.value}function A9(){var e;const n=typeof window>"u"?null:JSON.parse(((e=window==null?void 0:window.localStorage)==null?void 0:e.getItem(yE))||"null")??null;return vE(n)}const Lu=En("globalUserData",A9());function j9(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(yE,JSON.stringify({version:uf.currentVersion,user:Lu.get()}))}function R9(n){wE.validate(n),Lu.set(n),j9(),D9()}const O9=typeof process<"u"&&!1,kl=typeof BroadcastChannel<"u"&&!O9?new BroadcastChannel("tldraw-user-sync"):null;kl==null||kl.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===xE&&(e==null?void 0:e.origin)!==SE&&Lu.set(vE(e.data))});const SE=Xe(),xE="tldraw-user-preferences-change";function D9(){kl==null||kl.postMessage({type:xE,origin:SE,data:{user:Lu.get(),version:uf.currentVersion}})}function L9(){return Lu.get()}function _E(n={}){return{derivePresenceState:n.derivePresenceState??(()=>ee("presence",()=>null)),userPreferences:n.userPreferences??ee("userPreferences",()=>L9()),setUserPreferences:n.setUserPreferences??R9}}var kE={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function o(l,c,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new i(u,d||l,h),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],p]:l._events[g].push(p):(l._events[g]=p,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],c,u;if(this._eventsCount===0)return l;for(u in c=this._events)e.call(c,u)&&l.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},a.prototype.listeners=function(l){var c=t?t+l:l,u=this._events[c];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,h=u.length,p=new Array(h);d<h;d++)p[d]=u[d].fn;return p},a.prototype.listenerCount=function(l){var c=t?t+l:l,u=this._events[c];return u?u.fn?1:u.length:0},a.prototype.emit=function(l,c,u,d,h,p){var g=t?t+l:l;if(!this._events[g])return!1;var f=this._events[g],m=arguments.length,v,b;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),m){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,c),!0;case 3:return f.fn.call(f.context,c,u),!0;case 4:return f.fn.call(f.context,c,u,d),!0;case 5:return f.fn.call(f.context,c,u,d,h),!0;case 6:return f.fn.call(f.context,c,u,d,h,p),!0}for(b=1,v=new Array(m-1);b<m;b++)v[b-1]=arguments[b];f.fn.apply(f.context,v)}else{var _=f.length,x;for(b=0;b<_;b++)switch(f[b].once&&this.removeListener(l,f[b].fn,void 0,!0),m){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,c);break;case 3:f[b].fn.call(f[b].context,c,u);break;case 4:f[b].fn.call(f[b].context,c,u,d);break;default:if(!v)for(x=1,v=new Array(m-1);x<m;x++)v[x-1]=arguments[x];f[b].fn.apply(f[b].context,v)}}return!0},a.prototype.on=function(l,c,u){return o(this,l,c,u,!1)},a.prototype.once=function(l,c,u){return o(this,l,c,u,!0)},a.prototype.removeListener=function(l,c,u,d){var h=t?t+l:l;if(!this._events[h])return this;if(!c)return s(this,h),this;var p=this._events[h];if(p.fn)p.fn===c&&(!d||p.once)&&(!u||p.context===u)&&s(this,h);else{for(var g=0,f=[],m=p.length;g<m;g++)(p[g].fn!==c||d&&!p[g].once||u&&p[g].context!==u)&&f.push(p[g]);f.length?this._events[h]=f.length===1?f[0]:f:s(this,h)}return this},a.prototype.removeAllListeners=function(l){var c;return l?(c=t?t+l:l,this._events[c]&&s(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(kE);var z9=kE.exports;function cr({children:n,className:e="",...t}){return y.jsx("svg",{...t,className:`tl-svg-container ${e}`,children:n})}class na{constructor(e){w(this,"isFilled",!1);w(this,"isClosed",!0);w(this,"isLabel",!1);w(this,"isSnappable",!0);w(this,"_vertices");w(this,"_bounds");w(this,"_snapPoints");w(this,"_area");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1,this.isLabel=e.isLabel??!1}hitTestPoint(e,t=0,r=!1){return this.distanceToPoint(e,r)<=t}distanceToPoint(e,t=!1){const r=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&Ii(e,this.vertices)?-r:r}distanceToLineSegment(e,t){const r=this.nearestPointOnLineSegment(e,t),i=P.DistanceToLineSegment(e,t,r);return this.isClosed&&this.isFilled&&Ii(r,this.vertices)?-i:i}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){let r=1/0,i;for(let o=0;o<this.vertices.length;o++){const s=this.vertices[o],a=P.DistanceToLineSegment(e,t,s);a<r&&(r=a,i=s)}if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return de.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const o=e[r],s=e[(r+1)%i];t+=o.x*s.y-s.x*o.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}}class os extends na{constructor(t){super({...t,isClosed:!0,isFilled:!1});w(this,"children");const{children:r}=t;if(r.length===0)throw Error("Group2d must have at least one child");this.children=r}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:o}=this;if(o.length===0)throw Error("no children");for(const s of o){const a=s.nearestPoint(t),l=a.dist(t);l<r&&(r=l,i=a)}if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,o)=>i.distanceToPoint(t,r||o>0)))}hitTestPoint(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(o=>!o.isLabel).find(o=>o.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=de.FromPoints(this.vertices).corners;for(let i=0,o=r.length;i<o;i++){const s=r[i],a=r[(i-1+o)%o],l=s.dist(a),c=r[(i+1)%o],u=s.dist(c),d=s.clone().lrp(a,4/l),h=s,p=s.clone().lrp(c,4/u);t+=`M${d.x},${d.y} L${h.x},${h.y} L${p.x},${p.y} `}return t}}function cb(n,e,t,r){const i=n.x-t.x,o=n.y-t.y,s=r.x-t.x,a=r.y-t.y,l=e.x-n.x,c=e.y-n.y,u=s*o-a*i,d=l*o-c*i,h=a*l-s*c;if(u===0||d===0||h===0)return null;if(h!==0){const p=u/h,g=d/h;if(0<=p&&p<=1&&0<=g&&g<=1)return P.AddXY(n,p*l,p*c)}return null}function df(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),o=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),s=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=o*o-4*i*s;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*i),u=(-o-l)/(2*i);if((c<0||c>1)&&(u<0||u>1))return null;const d=[];return 0<=c&&c<=1&&d.push(P.Lrp(n,e,c)),0<=u&&u<=1&&d.push(P.Lrp(n,e,u)),d.length===0?null:d}function CE(n,e,t){const r=[];let i;for(let o=0,s=t.length-1;o<s;o++)i=cb(n,e,t[o],t[o+1]),i&&r.push(i);return r.length===0?null:r}function N9(n,e,t){const r=[];let i;for(let o=1,s=t.length;o<s+1;o++)i=cb(n,e,t[o-1],t[o%t.length]),i&&r.push(i);return r.length===0?null:r}function F9(n,e,t,r){let i=t.x-n.x,o=t.y-n.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+e*e)/(2*s),l=Math.sqrt(e*e-a*a);return i/=s,o/=s,[new P(n.x+i*a-o*l,n.y+o*a+i*l),new P(n.x+i*a+o*l,n.y+o*a-i*l)]}function PE(n,e,t){const r=[];let i,o,s;for(let a=0,l=t.length;a<l;a++)i=t[a],o=t[(a+1)%t.length],s=df(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function EE(n,e,t){const r=[];let i,o,s;for(let a=1,l=t.length;a<l;a++)i=t[a-1],o=t[a],s=df(i,o,n,e),s&&r.push(...s);return r.length===0?null:r}function hf(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function IE(n,e,t,r){return hf(n,t,r)!==hf(e,t,r)&&hf(n,e,t)!==hf(n,e,r)}function ub(n,e){const t=new Map;let r,i,o,s;for(let a=0,l=n.length;a<l;a++)if(r=n[a],Ii(r,e)){const c=db(r);t.has(c)||t.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],Ii(r,n)){const c=db(r);t.has(c)||t.set(c,r)}for(let a=0,l=n.length;a<l;a++){r=n[a],i=n[(a+1)%n.length];for(let c=0,u=e.length;c<u;c++){o=e[c],s=e[(c+1)%e.length];const d=cb(r,i,o,s);if(d!==null){const h=db(d);t.has(h)||t.set(h,d)}}}return t.size===0?null:$9([...t.values()])}function db(n){return`${n.x},${n.y}`}function $9(n){const e=P.Average(n);return n.sort((t,r)=>P.Angle(e,t)-P.Angle(e,r))}function B9(n,e){let t,r,i,o;for(let s=0,a=n.length;s<a;s++){t=n[s],r=n[(s+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],o=e[(l+1)%c],IE(t,r,i,o))return!0}return!1}class pf extends na{constructor(t){super({...t,isClosed:!1,isFilled:!1});w(this,"start");w(this,"end");w(this,"d");w(this,"u");w(this,"ul");w(this,"_length");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,u:o,ul:s}=this;if(s===0)return r;const a=P.Sub(t,r).dpr(o)/s,l=r.x+o.x*a;if(l<Math.min(r.x,i.x))return r.x<i.x?r:i;if(l>Math.max(r.x,i.x))return r.x>i.x?r:i;const c=r.y+o.y*a;return c<Math.min(r.y,i.y)?r.y<i.y?r:i:c>Math.max(r.y,i.y)?r.y>i.y?r:i:new P(l,c)}hitTestLineSegment(t,r,i){return IE(t,r,this.start,this.end)}}class ra extends na{constructor(t){super({isClosed:!1,isFilled:!1,...t});w(this,"points");w(this,"_segments");w(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const o=t[r],s=t[r+1];this._segments.push(new pf({start:o,end:s}))}this.isClosed&&this._segments.push(new pf({start:t[t.length-1],end:t[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],o=1/0,s,a;for(let l=0;l<r.length;l++)s=r[l].nearestPoint(t),a=s.dist(t),a<o&&(i=s,o=a);return i}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class Bt extends ra{constructor(e){super({...e}),this.isClosed=!0}}class ss extends Bt{constructor(t){const{x:r=0,y:i=0,width:o,height:s}=t;super({...t,points:[new P(r,i),new P(r+o,i),new P(r+o,i+s),new P(r,i+s)]});w(this,"x");w(this,"y");w(this,"w");w(this,"h");this.x=r,this.y=i,this.w=o,this.h=s}getBounds(){return new de(this.x,this.y,this.w,this.h)}}class ti{constructor(e){w(this,"canSnap",()=>!0);w(this,"canScroll",()=>!1);w(this,"canUnmount",()=>!0);w(this,"canBind",(e,t)=>!0);w(this,"canEdit",()=>!1);w(this,"canResize",()=>!0);w(this,"canEditInReadOnly",()=>!1);w(this,"canCrop",()=>!1);w(this,"hideResizeHandles",()=>!1);w(this,"hideRotateHandle",()=>!1);w(this,"hideSelectionBoundsBg",()=>!1);w(this,"hideSelectionBoundsFg",()=>!1);w(this,"isAspectRatioLocked",()=>!1);w(this,"onBeforeCreate");w(this,"onBeforeUpdate");w(this,"onDragShapesOver");w(this,"onDragShapesOut");w(this,"onDropShapesOver");w(this,"onResizeStart");w(this,"onResize");w(this,"onResizeEnd");w(this,"onTranslateStart");w(this,"onTranslate");w(this,"onTranslateEnd");w(this,"onRotateStart");w(this,"onRotate");w(this,"onRotateEnd");w(this,"onHandleChange");w(this,"onBindingChange");w(this,"onChildrenChange");w(this,"onDoubleClickHandle");w(this,"onDoubleClickEdge");w(this,"onDoubleClick");w(this,"onClick");w(this,"onEditEnd");this.editor=e}providesBackgroundForChildren(e){return!1}getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}}w(ti,"props"),w(ti,"migrations"),w(ti,"type");function U9(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(e*a,n/4);break}case"dotted":{d=100,c=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),u=Math.floor(n/c/(2*d)),u-=u%i,u<3&&l==="dashed"?n/e<5?(c=n,u=1,h=0):(c=n*.333,h=n*.333):(u=Math.max(u,3),c=n/u/(2*d),r?(p=c/2,h=(n-u*c)/u):h=(n-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function ME({bounds:n,className:e}){const t=Y(),r=Z("zoom level",()=>t.getZoomLevel(),[t]);return y.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,o)=>{const{strokeDasharray:s,strokeDashoffset:a}=U9(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return y.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:s,strokeDashoffset:a},o)})})}class ff extends ti{constructor(){super(...arguments);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"canBind",()=>!1);w(this,"onChildrenChange",t=>{const r=this.editor.getSortedChildIdsForParent(t.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([t.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,t.parentId),this.editor.deleteShapes([t.id]);return}})}getDefaultProps(){return{}}getGeometry(t){const r=this.editor.getSortedChildIdsForParent(t.id);return r.length===0?new ss({width:1,height:1,isFilled:!1}):new os({children:r.map(i=>{const o=this.editor.getShape(i),s=this.editor.getShapeGeometry(i),a=this.editor.getShapeLocalTransform(o).applyToPoints(s.vertices);return s.isClosed?new Bt({points:a,isFilled:!0}):new ra({points:a})})})}component(t){const r=this.editor.getErasingShapeIds().includes(t.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),o=i.length>0&&i.some(l=>l!==t.id&&this.editor.isShapeOfType(this.editor.getShape(l),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==t.id;if(!r&&(s||o))return null;const a=this.editor.getShapeGeometry(t).bounds;return y.jsx(cr,{id:t.id,children:y.jsx(ME,{className:"tl-group",bounds:a})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return y.jsx(ME,{className:"",bounds:r})}}w(ff,"type","group"),w(ff,"props",rN),w(ff,"migrations",iN);const TE=[ff],V9=new Set(TE.map(n=>n.type));function AE(n){const e=[...TE],t=new Set;for(const r of n){if(V9.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function jE(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw al(n)}}class H9{constructor(e){w(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!jE(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!jE(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class hb extends H9{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:al(r,"type")}}}class pb{constructor(){w(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}function W9(n,e,t){return fetch(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}function K9(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${t} 1`;return t}const ur="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",G9="a0",RE="A00000000000000000000000000";function OE(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-"a".charCodeAt(0)+2;if(n>="A"&&n<="Z")return"Z".charCodeAt(0)-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function DE(n){if(n.length!==OE(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function LE(n){if(n===void 0)throw Error("n is undefined")}function zE(n){DE(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=ur.indexOf(t[i])+1;o===ur.length?t[i]="0":(t[i]=ur.charAt(o),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?t.push("0"):t.pop(),i+t.join("")}else return e+t.join("")}function Y9(n){DE(n);const[e,...t]=n.split("");let r=!0;for(let i=t.length-1;r&&i>=0;i--){const o=ur.indexOf(t[i])-1;o===-1?t[i]=ur.slice(-1):(t[i]=ur.charAt(o),r=!1)}if(r){if(e==="a")return"Z"+ur.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?t.push(ur.slice(-1)):t.pop(),i+t.join("")}else return e+t.join("")}function Cl(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(n.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+Cl(n.slice(i),e.slice(i))}const t=n?ur.indexOf(n.charAt(0)):0,r=e!==void 0?ur.indexOf(e.charAt(0)):ur.length;if(r-t>1){const i=Math.round(.5*(t+r));return ur.charAt(i)}else return e&&e.length>1?e.slice(0,1):ur.charAt(t)+Cl(n.slice(1),void 0)}function zu(n){const e=OE(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function NE(n){if(n===RE)throw new Error("invalid index: "+n);const e=zu(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function Pl(n,e){if(n!==void 0&&NE(n),e!==void 0&&NE(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return G9;if(n===void 0){if(e===void 0)throw Error("b is undefined");const a=zu(e),l=e.slice(a.length);if(a===RE)return a+Cl("",l);if(a<e)return a;const c=Y9(a);return LE(c),c}if(e===void 0){const a=zu(n),l=n.slice(a.length),c=zE(a);return c===void 0?a+Cl(l,void 0):c}const t=zu(n),r=n.slice(t.length),i=zu(e),o=e.slice(i.length);if(t===i)return t+Cl(r,o);const s=zE(t);return LE(s),s<e?s:t+Cl(r,void 0)}function as(n,e,t){if(t===0)return[];if(t===1)return[Pl(n,e)];if(e===void 0){let o=Pl(n,e);const s=[o];for(let a=0;a<t-1;a++)o=Pl(o,e),s.push(o);return s}if(n===void 0){let o=Pl(n,e);const s=[o];for(let a=0;a<t-1;a++)o=Pl(n,o),s.push(o);return s.reverse(),s}const r=Math.floor(t/2),i=Pl(n,e);return[...as(n,i,r),i,...as(i,e,t-r-1)]}function El(n,e,t){return as(n,e,t)}function fb(n,e){return as(n,void 0,e)}function Nu(n,e){return as(n,e,1)[0]}function uo(n){return as(n,void 0,1)[0]}function X9(n){return as(void 0,n,1)[0]}function FE(n,e="a1"){return[e,...as(e,void 0,n)]}function mn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function gf(n,e,t){if(t.length===0)return[];const r=new Map;for(const o of ye(t.map(s=>n.getShape(s)))){const{parentId:s}=o;r.has(s)||r.set(s,{children:ye(n.getSortedChildIdsForParent(s).map(a=>n.getShape(a))),moving:new Set}),r.get(s).moving.add(o)}const i=[];switch(e){case"toBack":{r.forEach(({moving:o,children:s})=>q9(o,s,i));break}case"toFront":{r.forEach(({moving:o,children:s})=>Z9(o,s,i));break}case"forward":{r.forEach(({moving:o,children:s})=>J9(o,s,i));break}case"backward":{r.forEach(({moving:o,children:s})=>Q9(o,s,i));break}}return i}function q9(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=0;s<r;s++){const a=e[s];if(n.has(a))i=a.index,n.delete(a);else{o=a.index;break}}if(n.size!==0){const s=El(i,o,n.size);t.push(...Array.from(n.values()).sort(mn).map((a,l)=>({...a,index:s[l]})))}}function Z9(n,e,t){const r=e.length;if(n.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const a=e[s];if(n.has(a))o=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const s=El(i,o,n.size);t.push(...Array.from(n.values()).sort(mn).map((a,l)=>({...a,index:s[l]})))}}function J9(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=0;s<r;s++){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;const{selectIndex:l}=i;El(e[s].index,(o=e[s+1])==null?void 0:o.index,s-l).forEach((c,u)=>t.push({...e[l+u],index:c})),i={name:"skipping"};break}}}}function Q9(n,e,t){var o;const r=e.length;if(n.size===r)return;let i={name:"skipping"};for(let s=r-1;s>-1;s--){const a=n.has(e[s]);switch(i.name){case"skipping":{if(!a)continue;i={name:"selecting",selectIndex:s};break}case"selecting":{if(a)continue;El((o=e[s-1])==null?void 0:o.index,e[s].index,i.selectIndex-s).forEach((l,c)=>{t.push({...e[s+c+1],index:l})}),i={name:"skipping"};break}}}}function $E({editor:n}){const e=n.getSelectedShapes(),t=n.getSelectionRotation(),r=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=n;if(!r)return null;const o=r.center.clone().rotWith(r.point,t);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:t,shapeSnapshots:e.map(s=>({shape:rs(s),initialPagePoint:n.getShapePageTransform(s.id).point()}))}}function mf({delta:n,editor:e,snapshot:t,stage:r}){const{selectionPageCenter:i,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:a,initialPagePoint:l})=>{const c=Mr(a.parentId)?e.getShapePageTransform(a.parentId):re.Identity(),u=P.RotWith(l,i,n),d=re.applyToPoint(re.Inverse(c),u),h=Jr(a.rotation+n);return{id:a.id,type:a.type,x:d.x,y:d.y,rotation:h}}));const s=[];o.forEach(({shape:a})=>{var d,h,p;const l=e.getShape(a.id);if(!l)return;const c=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const g=(d=c.onRotateStart)==null?void 0:d.call(c,a);g&&s.push(g)}const u=(h=c.onRotate)==null?void 0:h.call(c,a,l);if(u&&s.push(u),r==="end"||r==="one-off"){const g=(p=c.onRotateEnd)==null?void 0:p.call(c,a,l);g&&s.push(g)}}),s.length>0&&e.updateShapes(s)}const e7=n=>{const{store:e}=n,t=e.query.filterHistory("shape"),r=e.query.records("shape",()=>({type:{eq:"arrow"}}));function i(){const o=r.get(),s={};for(const a of o){const{start:l,end:c}=a.props;if(l.type==="binding"){const u=s[l.boundShapeId];u?u.push({arrowId:a.id,handleId:"start"}):s[l.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(c.type==="binding"){const u=s[c.boundShapeId];u?u.push({arrowId:a.id,handleId:"end"}):s[c.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return s}return ee("arrowBindingsIndex",(o,s)=>{if(sl(o))return i();const a=o,l=t.getDiffSince(s);if(l===or)return i();let c;function u(p){c||(c={...a}),c[p]?c[p]===a[p]&&(c[p]=[...c[p]]):c[p]=[]}function d(p,g,f){u(p),c[p]=c[p].filter(m=>m.arrowId!==g||m.handleId!==f),c[p].length===0&&delete c[p]}function h(p,g,f){u(p),c[p].push({arrowId:g,handleId:f})}for(const p of l){for(const g of Object.values(p.added))if(n.isShapeOfType(g,"arrow")){const{start:f,end:m}=g.props;f.type==="binding"&&h(f.boundShapeId,g.id,"start"),m.type==="binding"&&h(m.boundShapeId,g.id,"end")}for(const[g,f]of Object.values(p.updated))if(!(!n.isShapeOfType(g,"arrow")||!n.isShapeOfType(f,"arrow")))for(const m of["start","end"]){const v=g.props[m],b=f.props[m];v.type==="binding"&&b.type==="point"?d(v.boundShapeId,g.id,m):v.type==="point"&&b.type==="binding"?h(b.boundShapeId,f.id,m):v.type==="binding"&&b.type==="binding"&&v.boundShapeId!==b.boundShapeId&&(d(v.boundShapeId,g.id,m),h(b.boundShapeId,f.id,m))}for(const g of Object.values(p.removed))if(n.isShapeOfType(g,"arrow")){const{start:f,end:m}=g.props;f.type==="binding"&&d(f.boundShapeId,g.id,"start"),m.type==="binding"&&d(m.boundShapeId,g.id,"end")}}return c??a})},t7=n=>{const e=n.query.ids("shape");function t(){const r={},i=e.get(),o=Array(i.size);return i.forEach(s=>o.push(n.get(s))),o.sort(mn),o.forEach(s=>{r[s.parentId]||(r[s.parentId]=[]),r[s.parentId].push(s.id)}),r}return ee("parentsToChildrenWithIndexes",(r,i)=>{if(sl(r))return t();const o=n.history.getDiffSince(i);if(o===or)return t();if(o.length===0)return r;let s=null;const a=u=>{s||(s={...r}),s[u]?s[u]===r[u]&&(s[u]=[...s[u]]):s[u]=[]},l=new Set;let c;for(let u=0,d=o.length;u<d;u++){c=o[u];for(const h of Object.values(c.added))Qs(h)&&(a(h.parentId),s[h.parentId].push(h.id),l.add(s[h.parentId]));for(const[h,p]of Object.values(c.updated))if(Qs(p)&&Qs(h)){if(h.parentId!==p.parentId)a(h.parentId),a(p.parentId),s[h.parentId].splice(s[h.parentId].indexOf(p.id),1),s[p.parentId].push(p.id),l.add(s[p.parentId]);else if(h.index!==p.index){a(p.parentId);const g=s[p.parentId].indexOf(p.id);s[p.parentId][g]=p.id,l.add(s[p.parentId])}}for(const h of Object.values(c.removed))Qs(h)&&(a(h.parentId),s[h.parentId].splice(s[h.parentId].indexOf(h.id),1))}for(const u of l){const d=ye(u.map(h=>n.get(h)));d.sort(mn),u.splice(0,u.length,...d.map(h=>h.id))}return s??r})},gb=(n,e,t)=>{for(;!Hn(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},n7=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const o=e();return r=o,new Set([...t.get()].filter(s=>gb(n,o,n.get(s))))}return ee("_shapeIdsInCurrentPage",(o,s)=>{if(sl(o))return i();const a=e();if(a!==r)return i();const l=n.history.getDiffSince(s);if(l===or)return i();const c=new Pp(o);for(const d of l){for(const h of Object.values(d.added))Qs(h)&&gb(n,a,h)&&c.add(h.id);for(const[h,p]of Object.values(d.updated))Qs(p)&&(gb(n,a,p)?c.add(p.id):c.remove(p.id));for(const h of Object.keys(d.removed))Mr(h)&&c.remove(h)}const u=c.get();return u?cu(u.value,u.diff):o})},r7=40;class i7{constructor(e){w(this,"_clickId","");w(this,"_clickTimeout");w(this,"_clickScreenPoint");w(this,"_previousScreenPoint");w(this,"_getClickTimeout",(e,t=Xe())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?e6:t6)});w(this,"_clickState","idle");w(this,"lastPointerInfo",{});w(this,"transformPointerDownEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>r7&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}});w(this,"transformPointerUpEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}});w(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});w(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?Xw:Tu)&&this.cancelDoubleClickTimeout()});this.editor=e}get clickState(){return this._clickState}}class o7{constructor(e){w(this,"isSafari");w(this,"isIos");w(this,"isChromeForIos");w(this,"isFirefox");w(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function ia(n){if(n){let e=BE;for(;n.length;)e=e.push(n.pop());return e}return BE}class s7{constructor(){w(this,"length",0);w(this,"head",null);w(this,"tail",this)}push(e){return new mb(e,this)}toArray(){return no}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const BE=new s7;class mb{constructor(e,t){w(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new mb(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class a7{constructor(e,t){w(this,"_undos",En("HistoryManager.undos",ia()));w(this,"_redos",En("HistoryManager.redos",ia()));w(this,"_batchDepth",0);w(this,"onBatchComplete",()=>{});w(this,"_commands",{});w(this,"createCommand",(e,t,r)=>{if(this._commands[e])throw new Error(`Duplicate command: ${e}`);this._commands[e]=r;const i=(...o)=>{if(!this._batchDepth)return this.batch(()=>i(...o)),this.ctx;const s=t(...o);if(!s)return this.ctx;const{data:a,ephemeral:l,squashing:c,preservesRedoStack:u}=s;if(this.ignoringUpdates((d,h)=>(r.do(a),{undos:d,redos:h})),!l){const d=this._undos.get().head;c&&d&&d.type==="command"&&d.name===e&&d.preservesRedoStack===u?this._undos.update(h=>h.tail.push({...d,id:Xe(),data:r.squash(d.data,a)})):this._undos.update(h=>h.push({type:"command",name:e,data:a,id:Xe(),preservesRedoStack:u})),s.preservesRedoStack||this._redos.set(ia()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return i});w(this,"batch",e=>{try{this._batchDepth++,this._batchDepth===1?Xr(()=>{var r,i;const t=(r=this._undos.get().head)==null?void 0:r.id;e(),t!==((i=this._undos.get().head)==null?void 0:i.id)&&this.onBatchComplete()}):e()}catch(t){throw this.annotateError(t),t}finally{this._batchDepth--}return this});w(this,"ignoringUpdates",e=>{let t=this._undos.get(),r=this._redos.get();this._undos.set(ia()),this._redos.set(ia());try{({undos:t,redos:r}=Xr(()=>e(t,r)))}finally{this._undos.set(t),this._redos.set(r)}});w(this,"_undo",({pushToRedoStack:e,toMark:t=void 0})=>(this.ignoringUpdates((r,i)=>{var o;if(r.length===0)return{undos:r,redos:i};for(;((o=r.head)==null?void 0:o.type)==="STOP";){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}if(r.length===0)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i};for(;r.head;){const s=r.head;if(r=r.tail,e&&(i=i.push(s)),s.type==="STOP"){if(s.onUndo&&(!t||s.id===t))return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}else this._commands[s.name].undo(s.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:r,redos:i}}),this));w(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));w(this,"redo",()=>(this.ignoringUpdates((e,t)=>{var r;if(t.length===0)return{undos:e,redos:t};for(;((r=t.head)==null?void 0:r.type)==="STOP";)e=e.push(t.head),t=t.tail;if(t.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){const i=t.head;if(e=e.push(t.head),t=t.tail,i.type==="STOP"){if(i.onRedo)break}else{const o=this._commands[i.name];o.redo?o.redo(i.data):o.do(i.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this));w(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));w(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));w(this,"mark",(e=Xe(),t=!0,r=!0)=>{const i=this._undos.get().head;return i&&i.type==="STOP"&&i.id===e&&i.onUndo===t&&i.onRedo===r?i.id:(this._undos.update(o=>o.push({type:"STOP",id:e,onUndo:t,onRedo:r})),this.ctx.emit("mark-history",{id:e}),e)});this.ctx=e,this.annotateError=t}getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}clear(){this._undos.set(ia()),this._redos.set(ia())}}class l7{constructor(e){w(this,"scribbleItems",new Map);w(this,"state","paused");w(this,"addScribble",(e,t=Xe())=>{const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),this.state==="paused"&&this.resume(),r});w(this,"stop",e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t});w(this,"addPoint",(e,t,r)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:o}=i,s={x:t,y:r,z:.5};return(!o||P.Dist(o,s)>=1)&&(i.next=s),i});w(this,"tick",e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:l,prev:c}=t;l&&l!==c&&(t.prev=l,t.scribble.points.push(l)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:o,next:s,scribble:a}=t;switch(a.state){case"active":{s&&s!==o?(t.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)}),this.scribbleItems.size===0&&this.pause()})});this.editor=e}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class c7{constructor(e){w(this,"_beforeCreateHandlers",{});w(this,"_afterCreateHandlers",{});w(this,"_beforeChangeHandlers",{});w(this,"_afterChangeHandlers",{});w(this,"_beforeDeleteHandlers",{});w(this,"_afterDeleteHandlers",{});w(this,"_batchCompleteHandlers",[]);this.editor=e,e.store.onBeforeCreate=(r,i)=>{const o=this._beforeCreateHandlers[r.typeName];if(o){let s=r;for(const a of o)s=a(s,i);return s}return r},e.store.onAfterCreate=(r,i)=>{const o=this._afterCreateHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.store.onBeforeChange=(r,i,o)=>{const s=this._beforeChangeHandlers[i.typeName];if(s){let a=i;for(const l of s)a=l(r,a,o);return a}return i};let t=0;e.store.onAfterChange=(r,i,o)=>{if(t++,t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const s=this._afterChangeHandlers[i.typeName];if(s)for(const a of s)a(r,i,o)}t--},e.store.onBeforeDelete=(r,i)=>{const o=this._beforeDeleteHandlers[r.typeName];if(o){for(const s of o)if(s(r,i)===!1)return!1}},e.store.onAfterDelete=(r,i)=>{const o=this._afterDeleteHandlers[r.typeName];if(o)for(const s of o)s(r,i)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>oa(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>oa(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>oa(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>oa(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>oa(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>oa(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>oa(this._batchCompleteHandlers,e)}}function oa(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}var u7=Object.defineProperty,d7=Object.getOwnPropertyDescriptor,sa=(n,e,t,r)=>{for(var i=r>1?void 0:r?d7(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&u7(e,t,i),i};const ge=n=>Math.round(n*10**8)/10**8;function ho(n,e,t,r,i){const o=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&ge(a.length)===ge(t)&&Qr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(o.length===0)return[];const s=new Set;return o.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(l)){s.add(l);const c=ho(n,l,t,r,Qr(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function h7(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(o=>i.gaps.some(s=>ge(o.startEdge[0].x)===ge(s.startEdge[0].x)&&ge(o.startEdge[0].y)===ge(s.startEdge[0].y)&&ge(o.startEdge[1].x)===ge(s.startEdge[1].x)&&ge(o.startEdge[1].y)===ge(s.startEdge[1].y))&&i.gaps.some(s=>ge(o.endEdge[0].x)===ge(s.endEdge[0].x)&&ge(o.endEdge[0].y)===ge(s.endEdge[0].y)&&ge(o.endEdge[1].x)===ge(s.endEdge[1].x)&&ge(o.endEdge[1].y)===ge(s.endEdge[1].y)))){n.splice(e,1);break}}}}class ls{constructor(e){w(this,"_snapLines",En("snapLines",void 0));this.editor=e}getLines(){return this._snapLines.get()??no}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);return r?this.editor.getShapeGeometry(t).snapPoints.map((i,o)=>{const{x:s,y:a}=re.applyToPoint(r,i);return{x:s,y:a,id:`${t.id}:${o}`}}):void 0})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getRenderingBounds(),r=e.getSelectedShapeIds(),i=[],o=s=>{const a=e.getSortedChildIdsForParent(s);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const u=e.getShapePageBounds(l);if(u&&t.includes(u)){if(e.isShapeOfType(c,"group")){o(l);continue}i.push({id:l,pageBounds:u,isClosed:e.getShapeGeometry(c).isClosed})}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.getSnappableShapes(),r=[];return t.forEach(i=>{const o=e.get(i.id);o&&r.push(...o)}),r}getVisibleGaps(){const e=[],t=[];let r,i;const o=this.getSnappableShapes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxX<i.pageBounds.minX&&Iu(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new P(r.pageBounds.maxX,r.pageBounds.minY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(i.pageBounds.minX,i.pageBounds.minY),new P(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Qr(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const s=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxY<i.pageBounds.minY&&Iu(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new P(r.pageBounds.minX,r.pageBounds.maxY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(i.pageBounds.minX,i.pageBounds.minY),new P(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Qr(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var m,v;const o=this.getSnapThreshold(),s=this.getSnappablePoints(),a=t.clone().translate(i),l=r.map(({x:b,y:_},x)=>({id:"selection:"+x,x:b+i.x,y:_+i.y})),c=s,u=[],d=[],h=new P(o,o);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const p=new P(e==="x"?0:((m=u[0])==null?void 0:m.nudge)??0,e==="y"?0:((v=d[0])==null?void 0:v.nudge)??0);h.x=0,h.y=0,u.length=0,d.length=0,l.forEach(b=>{b.x+=p.x,b.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this._snapLines.set([...f,...g]),{nudge:p}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:e,isClosed:t})=>{const r=cn(this.editor.getShapeGeometry(e).vertices);t&&r.push(r[0]);const i=this.editor.getShapePageTransform(e);if(!i)throw Error("No page transform");return re.applyToPoints(i,r)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:t}){const r=this.getSnapThreshold(),i=this.getOutlinesInPageSpace();let o=r,s=null,a,l,c,u;const d=[...i,...t];for(const h of d)for(let p=0;p<h.length-1;p++)a=h[p],l=h[p+1],c=P.NearestPointOnLineSegment(a,l,e),u=P.Dist(e,c),!isNaN(u)&&u<o&&(o=u,s=c);return s?(this._snapLines.set([{id:Xe(),type:"points",points:[s]}]),P.Sub(s,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:o}){var E,I;const s=this.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=de.Resize(e,r,o?t.x*2:t.x,o?t.y*2:t.y,i);let u=r;l<0&&(u=X8(u)),c<0&&(u=Y8(u)),o&&(a.center=e.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",p=UE(u,a),g=this.getSnappablePoints(),f=[],m=[],v=new P(s,s);this.collectPointSnaps({minOffset:v,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:p});const b=new P(d?0:((E=f[0])==null?void 0:E.nudge)??0,h?0:((I=m[0])==null?void 0:I.nudge)??0);if(i&&q8(u)&&b.len()!==0){const T=f.length&&m.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":f.length?"x":"y",A=e.aspectRatio;T==="x"?(m.length=0,b.y=b.x/A,(u==="bottom_left"||u==="top_right")&&(b.y=-b.y)):(f.length=0,b.x=b.y*A,(u==="bottom_left"||u==="top_right")&&(b.x=-b.x))}const _=P.Add(t,b),{box:x}=de.Resize(e,r,o?_.x*2:_.x,o?_.y*2:_.y,i);o&&(x.center=e.center);const C=UE("any",x);f.length=0,m.length=0,v.x=0,v.y=0,this.collectPointSnaps({minOffset:v,nearestSnapsX:f,nearestSnapsY:m,otherNodeSnapPoints:g,selectionSnapPoints:C});const k=this.getPointSnapLines({nearestSnapsX:f,nearestSnapsY:m});return this._snapLines.set([...k]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}){for(const s of e)for(const a of t){const l=P.Sub(s,a),c=Math.abs(l.x),u=Math.abs(l.y);ge(c)<=ge(r.x)&&(ge(c)<ge(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=c),ge(u)<=ge(r.y)&&(ge(u)<ge(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:o,vertical:s}=this.getVisibleGaps();for(const a of o){if(!Iu(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&ge(Math.abs(l))<=ge(t.x)){ge(Math.abs(l))<ge(t.x)&&(r.length=0),t.x=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},m=r.find(({type:b})=>b==="gap_center"),v=m&&Qr(a.breadthIntersection[0],a.breadthIntersection[1],m.gap.breadthIntersection[0],m.gap.breadthIntersection[1]);m&&m.gap.length>a.length&&v?r[r.indexOf(m)]=f:(!m||!v)&&r.push(f)}const c=a.startNode.pageBounds.minX-a.length,u=e.maxX,d=c-u;ge(Math.abs(d))<=ge(t.x)&&(ge(Math.abs(d))<ge(t.x)&&(r.length=0),t.x=Math.abs(d),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:d}));const h=a.endNode.pageBounds.maxX+a.length,p=e.minX,g=h-p;ge(Math.abs(g))<=ge(t.x)&&(ge(Math.abs(g))<ge(t.x)&&(r.length=0),t.x=Math.abs(g),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:g}))}for(const a of s){if(!Iu(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&ge(Math.abs(l))<=ge(t.y)){ge(Math.abs(l))<ge(t.y)&&(i.length=0),t.y=Math.abs(l);const f={type:"gap_center",gap:a,nudge:l},m=i.find(({type:b})=>b==="gap_center"),v=m&&Iu(m.gap.breadthIntersection[0],m.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);m&&m.gap.length>a.length&&v?i[i.indexOf(m)]=f:(!m||!v)&&i.push(f);continue}const c=a.startNode.pageBounds.minY-a.length,u=e.maxY,d=c-u;ge(Math.abs(d))<=ge(t.y)&&(ge(Math.abs(d))<ge(t.y)&&(i.length=0),t.y=Math.abs(d),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:d}));const h=a.endNode.pageBounds.maxY+a.length,p=e.minY,g=h-p;ge(Math.abs(g))<=ge(t.y)&&(ge(Math.abs(g))<ge(t.y)&&(i.length=0),t.y=Math.abs(g),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const o of e)if(o.type==="points"){const s=ge(o.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(o.points)}}if(t.length>0){for(const o of t)if(o.type==="points"){const s=ge(o.points.otherPoint.y);i[s]||(i[s]=[]),i[s].push(o.points)}}return Object.values(r).concat(Object.values(i)).map(o=>({id:Xe(),type:"points",points:Ep(o.map(s=>P.From(s.otherPoint)).concat(o.map(s=>P.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:o}=this.getVisibleGaps(),s={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const l of t){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-e.width)/2,m=Qr(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Xe(),gaps:[...ho(o,d.id,f,"backward",m),{startEdge:u,endEdge:s.left},{startEdge:s.right,endEdge:g},...ho(o,h.id,f,"forward",m)]});break}case"gap_duplicate":{const f=Qr(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Xe(),gaps:l.protrusionDirection==="left"?[{startEdge:s.right,endEdge:u.map(m=>m.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:g},...ho(o,h.id,p,"forward",f)]:[...ho(o,d.id,p,"backward",f),{startEdge:u,endEdge:g},{startEdge:g.map(m=>m.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:u,startNode:d,endNode:h,length:p,endEdge:g}}=l;switch(l.type){case"gap_center":{const f=(p-e.height)/2,m=Qr(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Xe(),gaps:[...ho(i,d.id,f,"backward",m),{startEdge:u,endEdge:s.top},{startEdge:s.bottom,endEdge:g},...ho(i,l.gap.endNode.id,f,"forward",m)]});break}case"gap_duplicate":{const f=Qr(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Xe(),gaps:l.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:u.map(m=>m.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:g},...ho(i,h.id,p,"forward",f)]:[...ho(i,d.id,p,"backward",f),{startEdge:u,endEdge:g},{startEdge:g.map(m=>m.clone().addXY(0,h.pageBounds.height)),endEdge:s.top}]})}break}}return h7(a),a}}sa([ee],ls.prototype,"getSnapPointsCache",1),sa([ee],ls.prototype,"getSnapThreshold",1),sa([ee],ls.prototype,"getSnappableShapes",1),sa([ee],ls.prototype,"getCurrentCommonAncestor",1),sa([ee],ls.prototype,"getSnappablePoints",1),sa([ee],ls.prototype,"getVisibleGaps",1),sa([ee],ls.prototype,"getOutlinesInPageSpace",1);function UE(n,e){const{minX:t,maxX:r,minY:i,maxY:o}=e,s=[];switch(n){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(n){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:t,y:o})}return s}const p7=/\r?\n|\r/g;function VE(n){return n.replace(p7,`
`).split(`
`).map(e=>e||" ").join(`
`)}const f7={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},g7=/\s/;class m7{constructor(e){w(this,"measureText",(e,t)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth??null),r.style.setProperty("padding",t.padding),r.textContent=VE(e);const i=r.getBoundingClientRect();return{x:0,y:0,w:i.width,h:i.height}});this.editor=e}getTextElement(){var t;(t=document.querySelector(".tl-text-measure"))==null||t.remove();const e=document.createElement("div");return this.editor.getContainer().appendChild(e),e.id=`__textMeasure_${Xe()}`,e.classList.add("tl-text"),e.classList.add("tl-text-measure"),e.tabIndex=-1,e}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),o=-i.left,s=-i.top,a=new Range,l=e.childNodes[0];let c=0,u=null,d=null,h=0,p=!1;for(const g of e.childNodes)if(g.nodeType===Node.TEXT_NODE)for(const f of g.textContent??""){a.setStart(l,c),a.setEnd(l,c+f.length);const m=a.getClientRects(),v=m[m.length-1],b=v.top+s,_=v.left+o,x=v.right+o,C=g7.test(f);if(C!==d||b!==h||!u){if(u){if(t&&b!==h){p=!0;break}r.push(u)}u={box:{x:_,y:b,w:v.width,h:v.height},text:f}}else u.box.w=x-u.box.x,u.text+=f;d=C,h=b,c+=f.length}return u&&r.push(u),{spans:r,didTruncate:p}}measureTextSpans(e,t){if(e==="")return[];const r=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip",i=this.getTextElement(),o=Math.ceil(t.width-t.padding*2);i.style.setProperty("width",`${o}px`),i.style.setProperty("height","min-content"),i.style.setProperty("dir","ltr"),i.style.setProperty("font-size",`${t.fontSize}px`),i.style.setProperty("font-family",t.fontFamily),i.style.setProperty("font-weight",t.fontWeight),i.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),i.style.setProperty("text-align",f7[t.textAlign]),r&&(i.style.setProperty("overflow-wrap","anywhere"),i.style.setProperty("word-break","break-all")),e=VE(e),i.textContent=e;const{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:r});if(t.overflow==="truncate-ellipsis"&&a){i.textContent="\u2026";const l=Math.ceil(this.measureElementTextNodeSpans(i).spans[0].box.w);i.style.setProperty("width",`${o-l}px`),i.textContent=e;const c=this.measureElementTextNodeSpans(i,{shouldTruncateToFirstLine:!0}).spans,u=c[c.length-1];return c.push({text:"\u2026",box:{x:Math.min(u.box.x+u.box.w,t.width-t.padding-l),y:u.box.y,w:l,h:u.box.h}}),c}return i.remove(),s}}class y7{constructor(e){w(this,"raf");w(this,"isPaused",!0);w(this,"last",0);w(this,"t",0);w(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});w(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)});w(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});w(this,"prevPoint",new P);w(this,"updatePointerVelocity",e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const o=P.Sub(r,t);this.prevPoint=r.clone();const s=o.len(),a=s?o.div(s):new P(0,0),l=i.clone().lrp(a.mul(s/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var w7=Object.defineProperty,b7=Object.getOwnPropertyDescriptor,po=(n,e,t,r)=>{for(var i=r>1?void 0:r?b7(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&w7(e,t,i),i};class Mi{constructor(e,t){w(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});this.user=e,this.inferDarkMode=t}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(this.inferDarkMode?M9():!1)}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??jr.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??jr.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??jr.name}getLocale(){return this.user.userPreferences.get().locale??jr.locale}getColor(){return this.user.userPreferences.get().color??jr.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??jr.isSnapMode}}po([ee],Mi.prototype,"getUserPreferences",1),po([ee],Mi.prototype,"getIsDarkMode",1),po([ee],Mi.prototype,"getEdgeScrollSpeed",1),po([ee],Mi.prototype,"getAnimationSpeed",1),po([ee],Mi.prototype,"getId",1),po([ee],Mi.prototype,"getName",1),po([ee],Mi.prototype,"getLocale",1),po([ee],Mi.prototype,"getColor",1),po([ee],Mi.prototype,"getIsSnapMode",1);function Fu(n){return Math.abs(n.props.bend)<8}function yf(n,e){if(e.type==="point")return;const t=n.getShape(e.boundShapeId),r=n.getShapePageTransform(t),i=n.getShapeGeometry(t),o=i instanceof os?i.children[0].vertices:i.vertices;return{shape:t,transform:r,isClosed:i.isClosed,isExact:e.isExact,didIntersect:!1,outline:o}}function HE(n,e,t,r){if(t.type==="point")return P.From(t);const i=n.getShape(t.boundShapeId);if(i){const{point:o,size:s}=n.getShapeGeometry(i).bounds,a=P.Add(o,P.MulV(t.isPrecise||r?t.normalizedAnchor:{x:.5,y:.5},s)),l=re.applyToPoint(n.getShapePageTransform(i),a);return re.applyToPoint(re.Inverse(e),l)}else return new P(0,0)}function ni(n,e){const t=n.getShapePageTransform(e);let r,i;e.props.start.type==="binding"&&e.props.end.type==="binding"&&(r=e.props.start.boundShapeId,i=e.props.end.boundShapeId);const o=yb(n,r,i),s=HE(n,t,e.props.start,o==="double-bound"||o==="start-contains-end"),a=HE(n,t,e.props.end,o==="double-bound"||o==="end-contains-start");return{start:s,end:a}}const Il=10,wf=10,v7=10,cs={s:2,m:3.5,l:5,xl:10};function yb(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function $u(n,e){const{start:t,end:r,arrowheadStart:i,arrowheadEnd:o}=e.props,s=ni(n,e),a=s.start.clone(),l=s.end.clone(),c=P.Med(a,l);if(P.Equals(a,l))return{isStraight:!0,start:{handle:a,point:a,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const u=P.Sub(l,a).uni(),d=yf(n,t),h=yf(n,r),p=n.getShapePageTransform(e);WE(l,s.start,p,h),WE(a,s.end,p,d);let g=0,f=0,m=0,v=0,b=Il;const _=d&&h&&d.shape===h.shape,x=d&&h?yb(n,d.shape.id,h.shape.id):"safe";x==="safe"&&d&&h&&!_&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(l.clone().add(u.clone().mul(Il))):h.didIntersect||h.isClosed&&l.setTo(a.clone().sub(u.clone().mul(Il))));const C=P.Sub(l,a).uni(),k=!P.Equals(C,u);_||(x!=="start-contains-end"&&d&&i!=="none"&&!d.isExact&&(m=cs[e.props.size]/2+("size"in d.shape.props?cs[d.shape.props.size]/2:0),g=wf+m,b+=m),x!=="end-contains-start"&&h&&o!=="none"&&!h.isExact&&(v=cs[e.props.size]/2+("size"in h.shape.props?cs[h.shape.props.size]/2:0),f=wf+v,b+=v));const E=a.clone().add(C.clone().mul(g*(k?-1:1))),I=l.clone().sub(C.clone().mul(f*(k?-1:1)));P.Dist(E,I)<b&&(g!==0&&f!==0?(g*=-1.5,f*=-1.5):g!==0?g*=-1:f!==0&&(f*=-1)),a.add(C.clone().mul(g*(k?-1:1))),l.sub(C.clone().mul(f*(k?-1:1))),k?(d&&h&&l.setTo(P.Add(a,C.clone().mul(-Il))),c.setTo(P.Med(s.start,s.end))):c.setTo(P.Med(a,l));const T=P.Dist(a,l);return{isStraight:!0,start:{handle:s.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:T>0,length:T}}function WE(n,e,t,r){if(r===void 0||r.isExact)return;const i=re.applyToPoint(t,e),o=re.applyToPoint(t,n),s=re.applyToPoint(re.Inverse(r.transform),i),a=re.applyToPoint(re.Inverse(r.transform),o),l=r.isClosed,c=(l?N9:CE)(s,a,r.outline);let u;if(c!==null&&(u=c.sort((p,g)=>P.Dist(p,s)-P.Dist(g,s))[0]??(l?void 0:a)),u===void 0)return;const d=re.applyToPoint(r.transform,u),h=re.applyToPoint(re.Inverse(t),d);n.setTo(h),r.didIntersect=!0}function wb(n,e,t=0){const{arrowheadEnd:r,arrowheadStart:i}=e.props,o=e.props.bend+t;if(Math.abs(o)>Math.abs(e.props.bend*v7))return $u(n,e);const s=ni(n,e),a=P.Med(s.start,s.end),l=P.Sub(s.end,s.start).uni(),c=P.Add(a,l.per().mul(-o)),u=yf(n,e.props.start),d=yf(n,e.props.end),h=s.start.clone(),p=s.end.clone(),g=c.clone();if(P.Equals(h,p))return{isStraight:!0,start:{handle:h,point:h,arrowhead:e.props.arrowheadStart},end:{handle:p,point:p,arrowhead:e.props.arrowheadEnd},middle:g,isValid:!1,length:0};const f=e.props.bend<0,m=f?qp:BN,v=KE(h,p,g),b=P.Angle(v.center,h),_=P.Angle(v.center,p),x=m(b,_);if(v.length===0||v.size===0||!CP(v.length)||!CP(v.size))return $u(n,e);const C=h.clone(),k=p.clone(),E=g.clone(),I=n.getShapePageTransform(e);let T=0,A=0,D=Il;if(u&&!u.isExact){const L=re.applyToPoint(I,C),V=re.applyToPoint(I,v.center),J=re.applyToPoint(I,k),le=re.Inverse(u.transform),me=re.applyToPoint(le,L),ve=re.applyToPoint(le,V),fe=re.applyToPoint(le,J),{isClosed:Pe}=u,Rt=Pe?PE:EE;let Ue,Le=Rt(ve,v.radius,u.outline);if(Le){const Ve=ve.angle(me),gi=ve.angle(fe),Zn=m(Ve,gi);Le=Le.filter(Ot=>m(Ve,ve.angle(Ot))<=Zn);const Sr=Zn*.25;Le.sort(Pe?(Ot,Et)=>Math.abs(m(Ve,ve.angle(Ot))-Sr)<Math.abs(m(Ve,ve.angle(Et))-Sr)?-1:1:(Ot,Et)=>m(Ve,ve.angle(Ot))<m(Ve,ve.angle(Et))?-1:1),Ue=Le[0]??(Pe?void 0:me)}else Ue=Pe?void 0:me;if(Ue&&(C.setTo(n.getPointInShapeSpace(e,re.applyToPoint(u.transform,Ue))),u.didIntersect=!0,i!=="none")){const Ve=cs[e.props.size]/2+("size"in u.shape.props?cs[u.shape.props.size]/2:0);T=wf+Ve,D+=Ve}}if(d&&!d.isExact){const L=re.applyToPoint(I,C),V=re.applyToPoint(I,k),J=re.applyToPoint(I,v.center),le=re.Inverse(d.transform),me=re.applyToPoint(le,L),ve=re.applyToPoint(le,J),fe=re.applyToPoint(le,V),Pe=d.isClosed,Rt=Pe?PE:EE;let Ue,Le=Rt(ve,v.radius,d.outline);if(Le){const Ve=ve.angle(me),gi=ve.angle(fe),Zn=m(Ve,gi),Sr=Zn*.75;Le=Le.filter(Ot=>m(Ve,ve.angle(Ot))<=Zn),Le.sort(Pe?(Ot,Et)=>Math.abs(m(Ve,ve.angle(Ot))-Sr)<Math.abs(m(Ve,ve.angle(Et))-Sr)?-1:1:(Ot,Et)=>m(Ve,ve.angle(Ot))<m(Ve,ve.angle(Et))?-1:1),Le[0]?Ue=Le[0]:Ue=Pe?void 0:fe}else Ue=Pe?void 0:fe;if(Ue&&(k.setTo(n.getPointInShapeSpace(e,re.applyToPoint(d.transform,Ue))),d.didIntersect=!0,r!=="none")){const Ve=cs[e.props.size]/2+("size"in d.shape.props?cs[d.shape.props.size]/2:0);A=wf+Ve,D+=Ve}}let N=P.Angle(v.center,C),U=P.Angle(v.center,k),R=m(N,U),B=R*v.radius;const $=C.clone(),q=k.clone();if(T!==0){const L=T/B*(f?1:-1),V=P.FromAngle(N+R*L);$.setTo(v.center).add(V.mul(v.radius))}if(A!==0){const L=A/B*(f?-1:1),V=P.FromAngle(U+R*L);q.setTo(v.center).add(V.mul(v.radius))}if(P.Dist($,q)<D&&(T!==0&&A!==0?(T*=-1.5,A*=-1.5):T!==0?T*=-2:A!==0&&(A*=-2)),T!==0){const L=T/B*(f?1:-1),V=P.FromAngle(N+R*L);C.setTo(v.center).add(V.mul(v.radius))}if(A!==0){const L=A/B*(f?-1:1),V=P.FromAngle(U+R*L);k.setTo(v.center).add(V.mul(v.radius))}if(u&&d&&!u.isExact&&!d.isExact){N=P.Angle(v.center,C),U=P.Angle(v.center,k),R=m(N,U),B=R*v.radius;const L=yb(n,u.shape.id,d.shape.id);if(L==="double-bound"&&B<30)C.setTo(h),k.setTo(p),E.setTo(g);else if(L==="safe"&&(u&&!u.didIntersect&&C.setTo(h),d&&!d.didIntersect||m(b,N)>m(b,U))){const V=Math.min(.9,Il/B)*(f?1:-1),J=P.FromAngle(N+R*V);k.setTo(v.center).add(J.mul(v.radius))}}S7(v.center,v.radius,C,k,E,x,f),C.equals(k)&&(C.setTo(E.clone().addXY(1,1)),k.setTo(E.clone().subXY(1,1))),h.setTo(C),p.setTo(k),g.setTo(E);const G=KE(h,p,g);return{isStraight:!1,start:{point:h,handle:s.start,arrowhead:e.props.arrowheadStart},end:{point:p,handle:s.end,arrowhead:e.props.arrowheadEnd},middle:g,handleArc:v,bodyArc:G,isValid:G.length!==0&&isFinite(G.center.x)&&isFinite(G.center.y)}}function KE(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i={x:((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,y:((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r},o=P.Dist(i,n),s=+P.Clockwise(n,t,e),a=Math.hypot(n.y-e.y,n.x-e.x),l=Math.hypot(e.y-t.y,e.x-t.x),c=Math.hypot(t.y-n.y,t.x-n.x),u=Math.acos((l*l+c*c-a*a)/(2*l*c))*2,d=+(Fe>u),h=(We-u)*(s?1:-1),p=h*o;return{center:i,radius:o,size:h,length:p,largeArcFlag:d,sweepFlag:s}}function S7(n,e,t,r,i,o,s){const a=P.Angle(n,t),l=P.Angle(n,r);let c=qp(a,l);s||(c=We-c);const u=.5*(s?1:-1),d=P.FromAngle(a+c*u);if(i.setTo(n).add(d.mul(e)),c>o){i.rotWith(n,Fe);const h=r.clone();r.setTo(t),t.setTo(h)}}const x7={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class se{constructor(e,t){w(this,"id");w(this,"type");w(this,"shapeType");w(this,"initial");w(this,"children");w(this,"parent");w(this,"_path");w(this,"_current");w(this,"_isActive");w(this,"transition",(e,t={})=>{var o;const r=e.split(".");let i=this;for(let s=0;s<r.length;s++){const a=r[s],l=i.getCurrent(),c=(o=i.children)==null?void 0:o[a];if(!c)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((l==null?void 0:l.id)!==c.id&&(l==null||l.exit(t,a),i._current.set(c),c.enter(t,(l==null?void 0:l.id)||"initial"),!c.getIsActive()))break;i=c}return this});w(this,"handleEvent",e=>{var i;const t=x7[e.name],r=this.getCurrent();(i=this[t])==null||i.call(this,e),this.getCurrent()===r&&this.getIsActive()&&(r==null||r.handleEvent(e))});w(this,"enter",(e,t)=>{var r;if(this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}});w(this,"exit",(e,t)=>{var r,i;this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||((i=this.getCurrent())==null||i.exit(e,t))});w(this,"_currentToolIdMask",En("curent tool id mask",void 0));w(this,"onWheel");w(this,"onPointerDown");w(this,"onPointerMove");w(this,"onPointerUp");w(this,"onDoubleClick");w(this,"onTripleClick");w(this,"onQuadrupleClick");w(this,"onRightClick");w(this,"onMiddleClick");w(this,"onKeyDown");w(this,"onKeyUp");w(this,"onKeyRepeat");w(this,"onCancel");w(this,"onComplete");w(this,"onInterrupt");w(this,"onEnter");w(this,"onExit");w(this,"onTick");this.editor=e;const{id:r,children:i,initial:o}=this.constructor;this.id=r,this._isActive=En("toolIsActive"+this.id,!1),this._current=En("toolState"+this.id,void 0),this._path=ee("toolPath"+this.id,()=>{const s=this.getCurrent();return this.id+(s?`.${s.getPath()}`:"")}),this.parent=t??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(s=>[s.id,new s(this.editor,this)])),this._current.set(this.children[this.initial])))}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}w(se,"id"),w(se,"initial"),w(se,"children");class bf extends se{constructor(){super(...arguments);w(this,"onKeyDown",t=>{var r;switch(t.code){case"KeyZ":{if(!(t.shiftKey||t.ctrlKey)){const i=this.getCurrent();i&&((r=i.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...t,onInteractionEnd:i.id})}break}}})}}w(bf,"id","root"),w(bf,"initial",""),w(bf,"children",()=>[]);var _7=Object.defineProperty,k7=Object.getOwnPropertyDescriptor,pe=(n,e,t,r)=>{for(var i=r>1?void 0:r?k7(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&_7(e,t,i),i};class he extends z9.EventEmitter{constructor({store:t,user:r,shapeUtils:i,tools:o,getContainer:s,initialState:a,inferDarkMode:l}){super();w(this,"store");w(this,"root");w(this,"disposables",new Set);w(this,"_tickManager",new y7(this));w(this,"snaps");w(this,"user");w(this,"textMeasure");w(this,"environment");w(this,"scribbles");w(this,"getContainer");w(this,"sideEffects");w(this,"shapeUtils");w(this,"styleProps");w(this,"history",new a7(this,t=>{this.annotateError(t,{origin:"history.batch",willCrashApp:!0}),this.crash(t)}));w(this,"_crashingError",null);w(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(t,r)=>{const i=this.store.get(this.getInstanceState().id),o={...i,...t};return{data:{prev:i,next:o},ephemeral:!1,squashing:!1,...r}},{do:({next:t})=>{this.store.put([t])},undo:({prev:t})=>{this.store.put([t])},squash({prev:t},{next:r}){return{prev:t,next:r}}}));w(this,"_isChangingStyleTimeout",-1);w(this,"setCursor",t=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...t}},{ephemeral:!0}),this));w(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(t,r)=>({data:{prev:this.store.get(t.id??this.getCurrentPageState().id),partial:t},...r}),{do:({prev:t,partial:r})=>{this.store.update(t.id,i=>({...i,...r}))},undo:({prev:t})=>{this.store.update(t.id,()=>t)}}));w(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",(t,r)=>{const{selectedShapeIds:i}=this.getCurrentPageState(),o=new Set(i);return t.length===o.size&&t.every(s=>o.has(s))?null:{data:{selectedShapeIds:t,prevSelectedShapeIds:i},preservesRedoStack:!0,...r}},{do:({selectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},undo:({prevSelectedShapeIds:t})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},squash({prevSelectedShapeIds:t},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:t}}}));w(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",t=>{const r=this.getCurrentPageState().focusedGroupId;if(r!==t)return{data:{prev:r,next:t},preservesRedoStack:!0,squashing:!0}},{do:({next:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},undo:({prev:t})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},squash({prev:t},{next:r}){return{prev:t,next:r}}}));w(this,"_viewportAnimation",null);w(this,"_willSetInitialBounds",!0);w(this,"_cameraState",En("camera state","idle"));w(this,"_cameraStateTimeoutRemaining",0);w(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());w(this,"_decayCameraStateTimeout",t=>{this._cameraStateTimeoutRemaining-=t,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});w(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=s6;const t=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=t,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):t-this._lastUpdateRenderingBoundsTimestamp>a6&&this.updateRenderingBounds()});w(this,"_renderingBounds",En("rendering viewport",new de));w(this,"_renderingBoundsExpanded",En("rendering viewport expanded",new de));w(this,"renderingBoundsMargin",100);w(this,"_currentPageShapeIds");w(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(t,r)=>{if(!this.store.has(t)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:t,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...r}},{do:({toId:t})=>{if(this.store.has(t)){if(!this.getPageStates().find(r=>r.pageId===t)){const r=un.create({id:un.createId(t)});this.store.put([r,dn.create({id:dn.createId(t),pageId:t})])}this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds()}},undo:({fromId:t})=>{this.store.has(t)&&(this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.updateRenderingBounds())},squash:({fromId:t},{toId:r})=>({toId:r,fromId:t})}));w(this,"_updatePage",this.history.createCommand("updatePage",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=this.getPage(t.id);return i?{data:{prev:i,partial:t},...r}:null},{do:({partial:t})=>{this.store.update(t.id,r=>({...r,...t}))},undo:({prev:t,partial:r})=>{this.store.update(r.id,()=>t)},squash(t,r){return{prev:{...t.prev,...r.prev},partial:r.partial}}}));w(this,"_createPage",this.history.createCommand("createPage",t=>{if(this.getInstanceState().isReadonly||this.getPages().length>=ef)return null;const r=this.getPages(),i=K9(t.name??"Page 1",r.map(c=>c.name));let o=t.index;(!o||r.some(c=>c.index===o))&&(o=uo(r[r.length-1].index));const s=so.create({meta:{},...t,name:i,index:o}),a=un.create({id:un.createId(s.id)}),l=dn.create({id:dn.createId(s.id),pageId:s.id});return{data:{newPage:s,newTabPageState:l,newCamera:a}}},{do:({newPage:t,newTabPageState:r,newCamera:i})=>{this.store.put([t,i,r])},undo:({newPage:t,newTabPageState:r,newCamera:i})=>{this.getPages().length!==1&&this.store.remove([r.id,t.id,i.id])}}));w(this,"_deletePage",this.history.createCommand("delete_page",t=>{if(this.getInstanceState().isReadonly)return null;const r=this.getPages();if(r.length===1)return null;const i=this.getPage(t),o=this.getPageStates().filter(s=>s.pageId===t);if(!i)return null;if(t===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===t),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}return{data:{id:t,deletedPage:i,deletedPageStates:o}}},{do:({deletedPage:t,deletedPageStates:r})=>{const i=this.getPages();if(i.length!==1){if(t.id===this.getCurrentPageId()){const o=i.findIndex(a=>a.id===t.id),s=i[o-1]??i[o+1];this.setCurrentPage(s.id)}this.store.remove(r.map(o=>o.id)),this.store.remove([t.id]),this.updateRenderingBounds()}},undo:({deletedPage:t,deletedPageStates:r})=>{this.store.put([t]),this.store.put(r),this.updateRenderingBounds()}}));w(this,"_createAssets",this.history.createCommand("createAssets",t=>this.getInstanceState().isReadonly||t.length<=0?null:{data:{assets:t}},{do:({assets:t})=>{this.store.put(t)},undo:({assets:t})=>{this.store.remove(t.map(r=>r.id))}}));w(this,"_updateAssets",this.history.createCommand("updateAssets",t=>this.getInstanceState().isReadonly||t.length<=0?void 0:{data:{snapshots:{},assets:t}},{do:({assets:t,snapshots:r})=>{this.store.put(t.map(i=>{const o=this.store.get(i.id);return r[i.id]=o,{...o,...i}}))},undo:({snapshots:t})=>{this.store.put(Object.values(t))}}));w(this,"_deleteAssets",this.history.createCommand("deleteAssets",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return;const r=ye(t.map(i=>this.store.get(i)));return{data:{ids:t,prev:r}}},{do:({ids:t})=>{this.store.remove(t)},undo:({prev:t})=>{this.store.put(t)}}));w(this,"_parentIdsToChildIds");w(this,"_childIdsCache",new pb);w(this,"_createShapes",this.history.createCommand("createShapes",t=>{if(this.getInstanceState().isReadonly||t.length<=0)return null;const r=this.getCurrentPageShapeIds();if(t.length+r.size>lo){vf(this);return}return t.length===0?null:{data:{currentPageId:this.getCurrentPageId(),partials:t.map(i=>i.id?i:{...i,id:tt()})}}},{do:({partials:t})=>{var a,l;const r=this.getFocusedGroupId(),i=this.getCurrentPageShapesSorted();t=t.map(c=>{if(!c.parentId||!(this.store.has(c.parentId)||t.some(u=>u.id===c.parentId))){let u=this.getFocusedGroupId();for(let h=i.length-1;h>=0;h--){const p=i[h];if(this.getShapeUtil(p).canReceiveNewChildrenOfType(p,c.type)&&this.isPointInShape(p,{x:c.x??0,y:c.y??0},{margin:0,hitInside:!0})){u=p.id;break}}const d=c.parentId;if(u===c.id&&(u=r),u!==d&&(c={...c},c.parentId=u,Mr(u))){const h=this.getPointInShapeSpace(this.getShape(u),{x:c.x??0,y:c.y??0});c.x=h.x,c.y=h.y,c.rotation=-this.getShapePageTransform(u).rotation()+(c.rotation??0)}}return c});const o=new Map,s=[];for(const c of t){const u=this.getShapeUtil(c);let d=c.index;if(!d){const f=c.parentId??r;o.has(f)||o.set(f,this.getHighestIndexForParent(f)),d=o.get(f),o.set(f,uo(d))}const h=u.getDefaultProps();for(const[f,m]of this.styleProps[c.type])h[m]=this.getStyleForNextShape(f);let p=this.store.schema.types.shape.create({...c,index:d,opacity:c.opacity??this.getInstanceState().opacityForNextShape,parentId:c.parentId??r,props:"props"in c?{...h,...c.props}:h});if(p.index===void 0)throw Error("no index!");const g=(l=(a=this.getShapeUtil(p)).onBeforeCreate)==null?void 0:l.call(a,p);g&&(p=g),s.push(p)}s.forEach(c=>{c.meta={...this.getInitialMetaForShape(c),...c.meta}}),this.store.put(s)},undo:({partials:t})=>{this.store.remove(t.map(r=>r.id))}}));w(this,"animatingShapes",new Map);w(this,"_updateShapes",this.history.createCommand("updateShapes",(t,r)=>{if(this.getInstanceState().isReadonly)return null;const i=ye(t),o=Object.fromEntries(ye(i.map(({id:l})=>this.getShape(l))).map(l=>[l.id,l]));if(i.length<=0)return null;const s=ye(i.map(l=>{const c=o[l.id];if(!c)return null;let u=null;for(const[d,h]of Object.entries(l))if(h!==void 0)switch(d){case"id":case"type":continue;default:if(h!==c[d])if(u||(u={...c}),d==="props"){const p={...c.props};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);u.props=p}else if(d==="meta"){const p={...c.meta};for(const[g,f]of Object.entries(h))f!==void 0&&(p[g]=f);u.meta=p}else u[d]=h}return u??c})),a=Object.fromEntries(s.map(l=>[l.id,l]));return{data:{snapshots:o,updates:a},...r}},{do:({updates:t})=>{var i,o;const r=Object.values(t);for(let s=0;s<r.length;s++){const a=r[s],l=this.store.get(a.id);if(!l)continue;const c=(o=(i=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:o.call(i,l,a);c&&(r[s]=c)}this.store.put(r)},undo:({snapshots:t})=>{this.store.put(Object.values(t))},squash(t,r){return{snapshots:{...r.snapshots,...t.snapshots},updates:{...t.updates,...r.updates}}}}));w(this,"_deleteShapes",this.history.createCommand("delete_shapes",t=>{if(this.getInstanceState().isReadonly||t.length===0)return null;const r=[...this.getCurrentPageState().selectedShapeIds],i=new Set(t);for(const c of t)this.visitDescendants(c,u=>{i.add(u)});const o=[...i],s=this._getArrowBindingsIndex().get(),a=ye(o.flatMap(c=>{const u=this.getShape(c),d=s[c];return d&&d.length>0?d.map(({arrowId:h})=>this.getShape(h)).concat(u):u})),l=r.filter(c=>!i.has(c));return{data:{deletedIds:o,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:l}}},{do:({deletedIds:t,postSelectedShapeIds:r})=>{this.store.remove(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))},undo:({snapshots:t,prevSelectedShapeIds:r})=>{this.store.put(t),this.store.update(this.getCurrentPageState().id,i=>({...i,selectedShapeIds:r}))}}));w(this,"_selectionSharedStyles",ee("_selectionSharedStyles",()=>{const t=this.getSelectedShapes(),r=new hb;for(const i of t)this._extractSharedStyles(i,r);return r}));w(this,"externalAssetContentHandlers",{file:null,url:null});w(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});w(this,"inputs",{originPagePoint:new P,originScreenPoint:new P,previousPagePoint:new P,previousScreenPoint:new P,currentPagePoint:new P,currentScreenPoint:new P,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new P});w(this,"_clickManager",new i7(this));w(this,"_prevCursor","default");w(this,"_shiftKeyTimeout",-1);w(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});w(this,"_altKeyTimeout",-1);w(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});w(this,"_ctrlKeyTimeout",-1);w(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});w(this,"_restoreToolId","select");w(this,"_pinchStart",1);w(this,"_didPinch",!1);w(this,"_selectedShapeIdsAtPointerDown",[]);w(this,"capturedPointerId",null);w(this,"dispatch",t=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:i}=t;return this.batch(()=>{if(t.type==="misc"){(t.name==="cancel"||t.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(t);return}t.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!t.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),t.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!t.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),t.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!t.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:o,originScreenPoint:s,currentPagePoint:a,currentScreenPoint:l}=r;switch(r.isPointing||(r.isDragging=!1),i){case"pinch":{if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(t),t.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:c,y:u,z:d=1},delta:{x:h,y:p}}=t,{x:g,y:f,z:m}=this.getCamera(),v=Math.min(is,Math.max(Mu,d));this.setCamera({x:g+h/m-c/m+c/v,y:f+p/m-u/m+u/v,z:v});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(c,{squashing:!0})}));return}}}case"wheel":{if(!this.getInstanceState().canMoveCamera)return;if(this._updateInputsFromEvent(t),!this.getIsMenuOpen()){if(r.ctrlKey){const{x:c,y:u}=this.inputs.currentScreenPoint,{x:d,y:h,z:p}=this.getCamera(),g=Math.min(is,Math.max(Mu,p+(t.delta.z??0)*p));this.setCamera({x:d+(c/g-c)-(c/p-c),y:h+(u/g-u)-(u/p-u),z:g});return}this.pan(t.delta),!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?Xw:Tu)/this.getZoomLevel()&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(t);const{isPen:c}=t;switch(t.name){case"pointer_down":{if(this.clearOpenMenus(),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),t.button===0&&(this.capturedPointerId=t.pointerId),r.buttons.add(t.button),r.isPointing=!0,r.isDragging=!1,this.getInstanceState().isPenMode){if(!c)return}else c&&this.updateInstanceState({isPenMode:!0});if(t.button===5?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):t.button===1&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;s.setTo(l),o.setTo(a);break}case"pointer_move":{if(!c&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:u,previousScreenPoint:d}=this.inputs;this.pan(P.Sub(u,d));return}!r.isDragging&&r.isPointing&&o.dist(a)>(this.getInstanceState().isCoarsePointer?Xw:Tu)/this.getZoomLevel()&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(t.button),r.isPointing=!1,r.isDragging=!1,this.getIsMenuOpen()||!c&&this.getInstanceState().isPenMode)return;this.capturedPointerId===t.pointerId&&(this.capturedPointerId=null,t.button=0),r.isPanning?t.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nf}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nf}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):t.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:nf}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):t.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(t.key==="ShiftRight"&&(t.key="ShiftLeft"),t.key==="AltRight"&&(t.key="AltLeft"),t.code==="ControlRight"&&(t.code="ControlLeft"),t.name){case"key_down":{r.keys.add(t.code),!t.ctrlKey&&t.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(t.code),t.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(t.type==="pointer"&&(t.button===1?t.name="middle_click":t.button===2&&(t.name="right_click"),t.isPen===this.getInstanceState().isPenMode))switch(t.name){case"pointer_down":{const c=this._clickManager.transformPointerDownEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_up":{const c=this._clickManager.transformPointerUpEvent(t);if(t.name!==c.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(c),this.emit("event",c);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(t),this.emit("event",t)}),this});this.store=t,this.snaps=new ls(this),this.user=new Mi(r??_E(),l??!1),this.getContainer=s??(()=>document.body),this.textMeasure=new m7(this);class c extends bf{}w(c,"initial",a??""),this.root=new c(this),this.root.children={};const u=AE(i),d=new Set(Object.keys(t.schema.types.shape.migrations.subTypeMigrations));for(const x of u){if(!d.has(x.type))throw Error(`Editor and store have different shapes: "${x.type}" was passed into the editor but not the schema`);d.delete(x.type)}if(d.size>0)throw Error(`Editor and store have different shapes: "${[...d][0]}" is present in the store schema but not provided to the editor`);const h={},p={},g=new Map;for(const x of u){const C=new x(this);h[x.type]=C;const k=lP(x.props??{});p[x.type]=k;for(const E of k.keys())if(!g.has(E.id))g.set(E.id,E);else if(g.get(E.id)!==E)throw Error(`Multiple style props with id "${E.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=h,this.styleProps=p;for(const x of[...o]){if(Tp(this.root.children,x.id))throw Error(`Can't override tool with id "${x.id}"`);this.root.children[x.id]=new x(this,this.root)}this.environment=new o7(this),this.scribbles=new l7(this);const f=new Set,m=x=>{var G;const C=this.getShape(x);if(!C)return;const{start:k,end:E}=C.props,I=k.type==="binding"?this.getShape(k.boundShapeId):void 0,T=E.type==="binding"?this.getShape(E.boundShapeId):void 0,A=this.getAncestorPageId(C);if(!A)return;let D;if(I&&T)D=this.findCommonAncestor([I,T])??A;else if(I||T){const L=(G=I||T)==null?void 0:G.parentId;L&&L===C.parentId?D=C.parentId:D=A}else return;D&&D!==C.parentId&&this.reparentShapes([x],D);const N=this.getShape(x);if(!N)throw Error("no reparented arrow");const U=this.getShapeNearestSibling(N,I),R=this.getShapeNearestSibling(N,T);let B;if(U&&R)B=U.index>R.index?U:R;else if(U&&!R)B=U;else if(R&&!U)B=R;else return;let $;const q=this.getSortedChildIdsForParent(B.parentId).map(L=>this.getShape(L)).filter(L=>L.index>B.index);if(q.length){const L=q.find(V=>V.type!=="arrow");if(N.index>B.index&&(!L||N.index<L.index))return;$=Nu(B.index,q[0].index)}else $=uo(B.index);$!==N.index&&this.updateShapes([{id:x,type:"arrow",index:$}])},v=(x,C)=>{const{x:k,y:E}=ni(this,x)[C];this.store.put([{...x,props:{...x.props,[C]:{type:"point",x:k,y:E}}}])},b=x=>{for(const C of["start","end"]){const k=x.props[C];if(k.type!=="binding")continue;const E=this.getShape(k.boundShapeId),I=this.getAncestorPageId(x)===this.getAncestorPageId(E);(!E||!I)&&v(x,C)}m(x.id)},_=(x,C)=>{let k=null;const E=x.selectedShapeIds.filter(A=>!C.has(A));E.length!==x.selectedShapeIds.length&&(k||(k={...x}),k.selectedShapeIds=E);const I=x.erasingShapeIds.filter(A=>!C.has(A));I.length!==x.erasingShapeIds.length&&(k||(k={...x}),k.erasingShapeIds=I),x.hoveredShapeId&&C.has(x.hoveredShapeId)&&(k||(k={...x}),k.hoveredShapeId=null),x.editingShapeId&&C.has(x.editingShapeId)&&(k||(k={...x}),k.editingShapeId=null);const T=x.hintingShapeIds.filter(A=>!C.has(A));return T.length!==x.hintingShapeIds.length&&(k||(k={...x}),k.hintingShapeIds=T),x.focusedGroupId&&C.has(x.focusedGroupId)&&(k||(k={...x}),k.focusedGroupId=null),k};if(this.sideEffects=new c7(this),this.sideEffects.registerBatchCompleteHandler(()=>{var x,C;for(const k of f){f.delete(k);const E=this.getShape(k);if(!E)continue;const I=(C=(x=this.getShapeUtil(E)).onChildrenChange)==null?void 0:C.call(x,E);I!=null&&I.length&&this.updateShapes(I,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",x=>{x.parentId&&Mr(x.parentId)&&f.add(x.parentId);const C=this._getArrowBindingsIndex().get()[x.id];if(C!=null&&C.length)for(const{arrowId:I,handleId:T}of C){const A=this.getShape(I);A&&v(A,T)}const k=new Set([x.id]),E=ye(this.getPageStates().map(I=>_(I,k)));E.length&&this.store.put(E)}),this.sideEffects.registerBeforeDeleteHandler("page",x=>{var I;if(this.getInstanceState().currentPageId!==x.id)return;const C=(I=this.getPages().find(T=>T.id!==x.id))==null?void 0:I.id;if(!C)return;this.store.put([{...this.getInstanceState(),currentPageId:C}]);const k=un.createId(x.id),E=dn.createId(x.id);this.store.remove([k,E])}),this.sideEffects.registerAfterChangeHandler("shape",(x,C)=>{if(this.isShapeOfType(C,"arrow")&&b(C),x.parentId!==C.parentId){const k=E=>{const I=this._getArrowBindingsIndex().get()[E];if(I!=null&&I.length)for(const T of I)m(T.arrowId)};k(C.id),this.visitDescendants(C.id,k)}if(x.parentId!==C.parentId&&Hn(C.parentId)){const k=new Set([x.id]);this.visitDescendants(x.id,E=>{k.add(E)});for(const E of this.getPageStates()){if(E.pageId===C.parentId)continue;const I=_(E,k);I&&this.store.put([I])}}x.parentId&&Mr(x.parentId)&&f.add(x.parentId),C.parentId!==x.parentId&&Mr(C.parentId)&&f.add(C.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(x,C)=>{if((x==null?void 0:x.selectedShapeIds)!==(C==null?void 0:C.selectedShapeIds)){const k=C.selectedShapeIds.filter(I=>{var A,D;let T=(A=this.getShape(I))==null?void 0:A.parentId;for(;Mr(T);){if(C.selectedShapeIds.includes(T))return!1;T=(D=this.getShape(T))==null?void 0:D.parentId}return!0});let E=null;if(k.length>0){const I=this.findCommonAncestor(ye(k.map(T=>this.getShape(T))),T=>this.isShapeOfType(T,"group"));I&&(E=I)}else C!=null&&C.focusedGroupId&&(E=C.focusedGroupId);(k.length!==C.selectedShapeIds.length||E!==C.focusedGroupId)&&this.store.put([{...C,selectedShapeIds:k,focusedGroupId:E??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",x=>{this.isShapeOfType(x,"arrow")&&b(x)}),this.sideEffects.registerAfterCreateHandler("page",x=>{const C=un.createId(x.id),k=dn.createId(x.id);this.store.has(C)||this.store.put([un.create({id:C})]),this.store.has(k)||this.store.put([dn.create({id:k,pageId:x.id})])}),this._currentPageShapeIds=n7(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=t7(this.store),this.disposables.add(this.store.listen(x=>{this.emit("change",x)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(t=>t()),this.disposables.clear()}getShapeUtil(t){const r=typeof t=="string"?t:t.type,i=Zs(this.shapeUtils,r);return qs(i,`No shape util found for type "${r}"`),i}undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(t,r,i){return this.history.mark(t,r,i),this}bail(){return this.history.bail(),this}bailToMark(t){return this.history.bailToMark(t),this}batch(t){return this.history.batch(t),this}_getArrowBindingsIndex(){return e7(this)}getArrowsBoundTo(t){return this._getArrowBindingsIndex().get()[t]||no}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",t=>Fu(t)?$u(this,t):wb(this,t))}getArrowInfo(t){const r=typeof t=="string"?t:t.id;return this.getArrowInfoCache().get(r)}annotateError(t,{origin:r,willCrashApp:i,tags:o,extras:s}){const a=this.createErrorAnnotations(r,i);return xw(t,{tags:{...a.tags,...o},extras:{...a.extras,...s}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(t,r){try{const i=this.getEditingShapeId();return{tags:{origin:t,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:t,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(t){return this._crashingError=t,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:t}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(t){const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const o=r.pop();if(!o)return!0;const s=i.getCurrent();if((s==null?void 0:s.id)===o){if(r.length===0)return!0;i=s;continue}else return!1}return!1}isInAny(...t){return t.some(r=>this.isIn(r))}setCurrentTool(t,r={}){return this.root.transition(t,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const t=this.getCurrentTool();return t?t.getCurrentToolIdMask()??t.id:""}getStateDescendant(t){var o;const r=t.split(".").reverse();let i=this.root;for(;r.length>0;){const s=r.pop();if(!s)return i;const a=(o=i.children)==null?void 0:o[s];if(!a)return;i=a}return i}getDocumentSettings(){return this.store.get(Fw)}updateDocumentSettings(t){return this.store.put([{...this.getDocumentSettings(),...t}]),this}getInstanceState(){return this.store.get(Tn)}updateInstanceState(t,r){return this._updateInstanceState(t,{ephemeral:!0,squashing:!0,...r}),t.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),t.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)||(r.add(t),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(t){const r=new Set(this.getOpenMenus());return r.has(t)&&(r.delete(t),this.updateInstanceState({openMenus:[...r]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return dn.createId(this.getCurrentPageId())}updateCurrentPageState(t,r){return this._setInstancePageState(t,r),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:t}=this.getCurrentPageState();return ye(t.map(r=>this.store.get(r)))}setSelectedShapes(t,r){const i=t.map(o=>typeof o=="string"?o:o.id);return this._setSelectedShapes(i,r),this}isAncestorSelected(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null,i=this.getShape(r);if(!i)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,s=>o.includes(s.id))}select(...t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.setSelectedShapes(r),this}deselect(...t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=this.getSelectedShapeIds();return i.length>0&&r.length>0&&this.setSelectedShapes(i.filter(o=>!r.includes(o))),this}selectAll(){const t=this.getSortedChildIdsForParent(this.getCurrentPageId());return t.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(t)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){const t=this.getSelectedShapes();return t.length===1?t[0]:null}getSelectionPageBounds(){const t=this.getCurrentPageState().selectedShapeIds;return t.length===0?null:de.Common(ye(t.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const t=this.getSelectedShapeIds();if(t.length===0)return 0;if(t.length===1)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();const r=t.map(i=>this.getShapePageTransform(i).rotation());return r.every(i=>Math.abs(i-r[0])<Math.PI/180)?this.getShapePageTransform(t[0]).rotation():0}getSelectionRotatedPageBounds(){const t=this.getSelectedShapeIds();if(t.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(t.length===1){const o=this.getShapeGeometry(t[0]).bounds.clone(),s=this.getShapePageTransform(t[0]);return o.point=s.applyToPoint(o.point),o}const i=de.FromPoints(this.getSelectedShapeIds().flatMap(o=>{const s=this.getShapePageTransform(o);return s?s.applyToPoints(this.getShapeGeometry(o).vertices):[]}).map(o=>P.Rot(o,-r)));return i.point=i.point.rot(r),i}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const t=this.getFocusedGroupId();return t?this.getShape(t):void 0}setFocusedGroup(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==null){const i=this.getShape(r);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return r===this.getFocusedGroupId()?this:(this._setFocusedGroupId(r),this)}popFocusedGroupId(){const t=this.getFocusedGroup();if(t){const r=this.findShapeAncestor(t,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(t.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const t=this.getEditingShapeId();return t?this.getShape(t):void 0}setEditingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getEditingShapeId()){if(r){const i=this.getShape(r);if(i&&this.getShapeUtil(i).canEdit(i))return this._setInstancePageState({editingShapeId:r}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const t=this.getHoveredShapeId();return t?this.getShape(t):void 0}setHoveredShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;return r===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:r},{ephemeral:!0}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const t=this.getHintingShapeIds();return ye(t.map(r=>this.getShape(r)))}setHintingShapes(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this.updateCurrentPageState({hintingShapeIds:Ep(r)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const t=this.getErasingShapeIds();return ye(t.map(r=>this.getShape(r)))}setErasingShapes(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id);r.sort();const i=this.getErasingShapeIds();if(r.length===i.length){for(let o=0;o<r.length;o++)if(r[o]!==i[o]){this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(t){const r=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(r!==this.getCroppingShapeId())if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(r),o=this.getShapeUtil(i);i&&o.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:r})}return this}getCameraId(){return un.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(t){const r=this.getCamera();return r.x===t.x&&r.y===t.y&&r.z===t.z?this:(this.batch(()=>{this.store.put([{...r,...t}]);const{currentScreenPoint:i}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:i,pointerId:AP.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this)}setCamera(t,r){const i=Number.isFinite(t.x)?t.x:0,o=Number.isFinite(t.y)?t.y:0,s=Number.isFinite(t.z)?t.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),r){const{width:a,height:l}=this.getViewportScreenBounds();return this._animateToViewport(new de(-i,-o,a/s,l/s),r)}else this._setCamera({x:i,y:o,z:s});return this}centerOnPoint(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{width:i,height:o}=this.getViewportPageBounds();return this.setCamera({x:-(t.x-i/2),y:-(t.y-o/2),z:this.getCamera().z},r),this}zoomToContent(){const t=this.getSelectionPageBounds()??this.getCurrentPageBounds();return t&&this.zoomToBounds(t,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(t){if(!this.getInstanceState().canMoveCamera)return this;const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const i=de.Common(ye(r.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(i,void 0,t),this}resetZoom(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera(),{x:a,y:l}=t;return this.setCamera({x:i+(a/1-a)-(a/s-a),y:o+(l/1-l)-(l/s-l),z:1},r),this}zoomIn(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=is;for(let u=1;u<yl.length;u++){const d=yl[u-1],h=yl[u];if(!(h-s<=(h-d)/2)){a=h;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomOut(t=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();let a=Mu;for(let u=yl.length-1;u>0;u--){const d=yl[u-1],h=yl[u];if(!(h-s>=(h-d)/2)){a=d;break}}const{x:l,y:c}=t;return this.setCamera({x:i+(l/a-l)-(l/s-l),y:o+(c/a-c)-(c/s-c),z:a},r),this}zoomToSelection(t){if(!this.getInstanceState().canMoveCamera)return this;const r=this.getSelectionPageBounds();return r?(this.zoomToBounds(r,Math.max(1,this.getZoomLevel()),t),this):this}panZoomIntoView(t,r){if(!this.getInstanceState().canMoveCamera)return this;if(t.length<=0)return this;const i=de.Common(ye(t.map(s=>this.getShapePageBounds(s)))),o=this.getViewportPageBounds();if(o.h<i.h||o.w<i.w)return this.zoomToBounds(i,this.getCamera().z,r),this;{const s=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel());let a=0,l=0;s.maxY<i.maxY?l=s.maxY-i.maxY:s.minY>i.minY&&(l=s.minY-i.minY),s.maxX<i.maxX?a=s.maxX-i.maxX:s.minX>i.minX&&(a=s.minX-i.minX);const c=this.getCamera();this.setCamera({x:c.x+a,y:c.y+l,z:c.z},r)}return this}zoomToBounds(t,r,i){if(!this.getInstanceState().canMoveCamera)return this;const o=this.getViewportScreenBounds(),s=Math.min(256,o.width*.28);let a=Ei(Math.min((o.width-s)/t.width,(o.height-s)/t.height),Mu,is);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-t.minX+(o.width-t.width*a)/2/a,y:-t.minY+(o.height-t.height*a)/2/a,z:a},i),this}pan(t,r){if(!this.getInstanceState().canMoveCamera)return this;const{x:i,y:o,z:s}=this.getCamera();return this.setCamera({x:i+t.x/s,y:o+t.y/s,z:s},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(t){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=t;const{elapsed:i,easing:o,duration:s,start:a,end:l}=this._viewportAnimation;if(i>s){this._setCamera({x:-l.x,y:-l.y,z:this.getViewportScreenBounds().width/l.width}),r();return}const c=s-i,u=o(1-c/s),d=a.minX+(l.minX-a.minX)*u,h=a.minY+(l.minY-a.minY)*u,p=a.maxX+(l.maxX-a.maxX)*u;this._setCamera({x:-d,y:-h,z:this.getViewportScreenBounds().width/(p-d)})}_animateToViewport(t,r={}){const{duration:i=0,easing:o=fn.easeInOutCubic}=r,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||s===0?this._setCamera({x:-t.x,y:-t.y,z:this.getViewportScreenBounds().width/t.width}):(this._viewportAnimation={elapsed:0,duration:i/s,easing:o,start:a.clone(),end:t.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(t={}){if(!this.getInstanceState().canMoveCamera)return this;if(this.stopCameraAnimation(),this.user.getAnimationSpeed()===0)return this;const{speed:r,friction:i,direction:o,speedThreshold:s=.01}=t;let a=Math.min(r,1);const l=()=>{this.removeListener("tick",c),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const c=u=>{const{x:d,y:h,z:p}=this.getCamera(),g=P.Mul(o,a*u/p);a*=1-i,a<s?l():this._setCamera({x:d+g.x,y:h+g.y,z:p})};return this.addListener("tick",c),this}animateToUser(t){const r=[...this.store.query.records("instance_presence",()=>({userId:{eq:t}})).get()].sort((i,o)=>i.lastActivityTimestamp-o.lastActivityTimestamp).pop();return r?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId);const o=i?{duration:500}:void 0;this.centerOnPoint(r.cursor,o);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,t]}),setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(t);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},TP)}),this):this}animateToShape(t,r=r6){if(!this.getInstanceState().canMoveCamera)return this;const i=this.getViewportScreenBounds().clone().expandBy(-32),o=i.width/i.height,s=this.getShapePageBounds(t);if(!s)return this;const a=s.width/s.height,l=s.clone(),c=s.width/i.width;return l.width+=(i.minX+i.maxX)*c,l.height+=(i.minY+i.maxY)*c,l.x-=i.minX*c,l.y-=i.minY*c,a>o?(l.height=s.width/o,l.y-=(l.height-s.height)/2):(l.width=s.height*o,l.x-=(l.width-s.width)/2),this._animateToViewport(l,r)}updateViewportScreenBounds(t=!1){const r=this.getContainer();if(!r)return this;const i=r.getBoundingClientRect(),o=new de(i.left||i.x,i.top||i.y,Math.max(i.width,1),Math.max(i.height,1)),s=o.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:a}=this;if(s)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});else if(t&&!this.getInstanceState().followingUserId){const l=this.getViewportPageCenter();this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:o.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){const{x:t,y:r,w:i,h:o}=this.getInstanceState().screenBounds;return new de(t,r,i,o)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){const{w:t,h:r}=this.getViewportScreenBounds(),{x:i,y:o,z:s}=this.getCamera();return new de(-i,-o,t/s,r/s)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(Tn),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x-r.x)/s-i,y:(t.y-r.y)/s-o,z:t.z??.5}}pageToScreen(t){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(Tn),{x:i,y:o,z:s=1}=this.getCamera();return{x:(t.x+i)*s+r.x,y:(t.y+o)*s+r.y,z:t.z??.5}}startFollowingUser(t){const r=this.store.query.records("instance_presence",()=>({userId:{eq:t}})),i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),r.get().some(l=>l.followingUserId===i))return this;Xr(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:t},{ephemeral:!0})});const o=()=>{this.removeListener("frame",a),this.removeListener("stop-following",o)};let s=!1;const a=()=>{const l=[...r.get()].sort((U,R)=>U.lastActivityTimestamp-R.lastActivityTimestamp).pop();if(!l){this.stopFollowingUser();return}const c=l.currentPageId===this.getCurrentPageId(),u=c?XN:1;if(!c){this.stopFollowingUser(),this.setCurrentPage(l.currentPageId),this.startFollowingUser(t);return}const{center:d,width:h,height:p}=this.getViewportPageBounds(),g=de.From(l.screenBounds),f=g.width/l.camera.z,m=g.height/l.camera.z,v=new P(f/2-l.camera.x,m/2-l.camera.y),b=l.followingUserId===i,_=h+(f-h)*u,x=p+(m-p)*u,C=b?p/x:Math.min(h/_,p/x),k=Ei(this.getCamera().z*C,Mu,is),E=this.getViewportScreenBounds().w/k,I=this.getViewportScreenBounds().h/k,T=v.sub(d),A=P.Add(d,P.Mul(T,u)),D=P.Sub(A,d).len(),N=Math.abs(k-this.getCamera().z);if(D<qN&&N<JN){s=!0;return}s&&D<ZN&&N<QN||(s=!1,this.stopCameraAnimation(),this._setCamera({x:-(A.x-E/2),y:-(A.y-I/2),z:k}))};return this.once("stop-following",o),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}getCameraState(){return this._cameraState.get()}getUnorderedRenderingShapes(t){const r=[];let i=lo*2,o=lo;const s=this.getEditingShapeId(),a=this.getSelectedShapeIds(),l=this.getErasingShapeIds(),c=this.getRenderingBoundsExpanded(),u=Number.isFinite(this.renderingBoundsMargin),d=(h,p,g)=>{const f=this.getShape(h);if(!f)return;p*=f.opacity;let m=!1,v=!1;const b=this.getShapeUtil(f),_=this.getShapeMaskedPageBounds(h);t&&(v=!g&&l.includes(h),v&&(p*=.32),m=u&&b.canUnmount(f)&&s!==h&&(_===void 0||!c.includes(_)&&!a.includes(h))),r.push({id:h,shape:f,util:b,index:i,backgroundIndex:o,opacity:p,isCulled:m,maskedPageBounds:_}),i+=1,o+=1;const x=this.getSortedChildIdsForParent(h);if(!x.length)return;let C=null;b.providesBackgroundForChildren(f)&&(C=o,o=i,i+=lo);for(const k of x)d(k,p,g||v);C!==null&&(o=C)};for(const h of this.getSortedChildIdsForParent(this.getCurrentPageId()))d(h,1,!1);return r}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort($L)}getRenderingBounds(){return this._renderingBounds.get()}getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}updateRenderingBounds(){const t=this.getViewportPageBounds();return t.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(t.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(t.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(t),this)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(mn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(t){return this.store.get(typeof t=="string"?t:t.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(t){const r=typeof t=="string"?t:t.id,i=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(i.map(o=>o.id))}setCurrentPage(t,r){const i=typeof t=="string"?t:t.id;return this._setCurrentPageId(i,r),this}updatePage(t,r){return this._updatePage(t,r),this}createPage(t){return this._createPage(t),this}deletePage(t){const r=typeof t=="string"?t:t.id;return this._deletePage(r),this}duplicatePage(t,r=so.createId()){if(this.getPages().length>=ef)return this;const i=typeof t=="string"?t:t.id,o=this.getPage(i);if(!o)return this;const s={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.batch(()=>{var u;const l=this.getPages(),c=Nu(o.index,(u=l[l.indexOf(o)+1])==null?void 0:u.index);if(this.createPage({name:o.name+" Copy",id:r,index:c}),this.setCurrentPage(r),this.setCamera(s),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(t,r,i){const o=typeof t=="string"?t:t.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:o,name:r},i),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(t){return this._createAssets(t),this}updateAssets(t){return this._updateAssets(t),this}deleteAssets(t){const r=typeof t[0]=="string"?t:t.map(i=>i.id);return this._deleteAssets(r),this}getAsset(t){return this.store.get(typeof t=="string"?t:t.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",t=>this.getShapeUtil(t).getGeometry(t),(t,r)=>t.props===r.props)}getShapeGeometry(t){return this._getShapeGeometryCache().get(typeof t=="string"?t:t.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",t=>this.getShapeUtil(t).getOutlineSegments(t))}getShapeOutlineSegments(t){return this._getShapeOutlineSegmentsCache().get(typeof t=="string"?t:t.id)??no}_getShapeHandlesCache(){return this.store.createComputedCache("handles",t=>{var r,i;return(i=(r=this.getShapeUtil(t)).getHandles)==null?void 0:i.call(r,t)})}getShapeHandles(t){return this._getShapeHandlesCache().get(typeof t=="string"?t:t.id)}getShapeLocalTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);if(!i)throw Error("Editor.getTransform: shape not found");return re.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",t=>{if(Hn(t.parentId))return this.getShapeLocalTransform(t);const r=this._getShapePageTransformCache().get(t.parentId)??re.Identity();return re.Compose(r,this.getShapeLocalTransform(t))})}getShapeParentTransform(t){const r=typeof t=="string"?t:t.id,i=this.getShape(r);return!i||Hn(i.parentId)?re.Identity():this._getShapePageTransformCache().get(i.parentId)??re.Identity()}getShapePageTransform(t){const r=typeof t=="string"?t:this.getShape(t).id;return this._getShapePageTransformCache().get(r)??re.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",t=>{const r=this._getShapePageTransformCache().get(t.id);return r?de.FromPoints(re.applyToPoints(r,this.getShapeGeometry(t).vertices)):new de})}getShapePageBounds(t){return this._getShapePageBoundsCache().get(typeof t=="string"?t:t.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",t=>{const r=this._getShapeMaskCache().get(t.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(t.id);return i?`polygon(${re.applyToPoints(re.Inverse(i),r).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(t){return this._getShapeClipPathCache().get(typeof t=="string"?t:t.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",t=>{if(Hn(t.parentId))return;const r=this.getShapeAncestors(t.id).filter(i=>this.isShapeOfType(i,"frame"));return r.length===0?void 0:r.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,o)=>{if(!(o&&i))return;const s=ub(i,o);return s?s.map(P.Cast):[]})})}getShapeMask(t){return this._getShapeMaskCache().get(typeof t=="string"?t:t.id)}getShapeMaskedPageBounds(t){typeof t!="string"&&(t=t.id);const r=this._getShapePageBoundsCache().get(t);if(!r)return;const i=this._getShapeMaskCache().get(t);if(i){if(i.length===0)return;const{corners:o}=r;if(o.every((a,l)=>a&&P.Equals(a,i[l])))return r.clone();const s=ub(i,o);return s?de.FromPoints(s):void 0}return r}getShapeAncestors(t,r=[]){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return r;const s=o.parentId;if(Hn(s))return r.reverse(),r;const a=this.store.get(s);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return;const s=o.parentId;if(Hn(s))return;const a=this.getShape(s);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(t,r){const i=typeof t=="string"?t:t==null?void 0:t.id,o=i&&this.getShape(i);return o?o.parentId===r?!0:this.hasAncestor(this.getShapeParent(o),r):!1}findCommonAncestor(t,r){var c;if(t.length===0)return;const i=typeof t[0]=="string"?t:t.map(u=>u.id),o=ye(i.map(u=>this.getShape(u)));if(o.length===1){const u=o[0].parentId;return Hn(u)?void 0:r?(c=this.findShapeAncestor(o[0],r))==null?void 0:c.id:u}const[s,...a]=o;let l=this.getShapeParent(s);for(;l;){if(r&&!r(l)){l=this.getShapeParent(l);continue}if(a.every(u=>this.hasAncestor(u,l.id)))return l.id;l=this.getShapeParent(l)}}isShapeOrAncestorLocked(t){const r=typeof t=="string"?this.getShape(t):t;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}getCurrentPageBounds(){let t;return this.getCurrentPageShapeIds().forEach(r=>{const i=this.getShapeMaskedPageBounds(r);i&&(t?t=t.expand(i):t=i.clone())}),t}getSelectedShapeAtPoint(t){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&r.includes(i.id)).reverse().find(i=>this.isPointInShape(i,t,{hitInside:!0,margin:0}))}getShapeAtPoint(t,r={}){const i=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:s,margin:a=0,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:u=!1}=r;let d=1/0,h=null,p=1/0,g=null;const f=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(m=>{if(this.isShapeOfType(m,"group"))return!1;const v=this.getShapeMask(m);return v&&!Ii(t,v)?!1:s?s(m):!0});for(let m=f.length-1;m>=0;m--){const v=f[m],b=this.getShapeGeometry(v),_=b instanceof os,x=this.getPointInShapeSpace(v,t);if((this.isShapeOfType(v,"arrow")||this.isShapeOfType(v,"geo")&&v.props.fill==="none")&&v.props.text.trim()){for(const k of b.children)if(k.isLabel&&k.isPointInBounds(x))return v}if(this.isShapeOfType(v,"frame")){const k=b.distanceToPoint(x,c);if(Math.abs(k)<=a)return g||v;if(b.hitTestPoint(x,0,!0))return g||h||(u?v:void 0);continue}let C;if(_){let k=1/0;for(const E of b.children){if(E.isLabel&&!l)continue;const I=E.distanceToPoint(x,c);I<k&&(k=I)}C=k}else a===0&&(b.bounds.w<1||b.bounds.h<1)||b.bounds.containsPoint(x,a)?C=b.distanceToPoint(x,c):C=1/0;if(b.isClosed){if(C<=a){if(b.isFilled||_&&b.children[0].isFilled)return g||v;if(this.getShapePageBounds(v).contains(o))continue;if(Math.abs(C)<a)Math.abs(C)<p&&(p=Math.abs(C),g=v);else if(!g){const{area:k}=b;k<d&&(d=k,h=v)}}}else if(C<ei/i)return v}return g||h||void 0}getShapesAtPoint(t,r={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,t,r))}isPointInShape(t,r,i={}){const{hitInside:o=!1,margin:s=0}=i,a=typeof t=="string"?t:t.id,l=this.getShapeMask(a);return l&&!Ii(r,l)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(t,r),s,o)}getPointInShapeSpace(t,r){const i=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(r)}getPointInParentSpace(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return new P(0,0);if(Hn(o.parentId))return P.From(r);const s=this.getShapePageTransform(o.parentId);return s?s.clone().invert().applyToPoint(r):P.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),t=>this.store.get(t))}getCurrentPageShapesSorted(){const t=new Set(this.getCurrentPageShapes().sort(mn)),r=[];function i(o){r.push(o),t.delete(o),t.forEach(s=>{s.parentId===o.id&&i(s)})}return t.forEach(o=>{const s=this.getShape(o.parentId);Qs(s)||i(o)}),r}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:t})=>!t).sort((t,r)=>t.index-r.index).map(({shape:t})=>t)}isShapeOfType(t,r){return(typeof t=="string"?this.getShape(t):t).type===r}getShape(t){const r=typeof t=="string"?t:t.id;if(Mr(r))return this.store.get(r)}getShapeParent(t){const r=typeof t=="string"?t:t==null?void 0:t.id;if(!r)return;const i=this.getShape(r);if(!(i===void 0||!Mr(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(t,r){return r?r.parentId===t.parentId?r:this.findShapeAncestor(r,i=>i.parentId===t.parentId):void 0}isShapeInPage(t,r=this.getCurrentPageId()){const i=typeof t=="string"?t:t.id,o=this.getShape(i);if(!o)return!1;let s=!1;if(o.parentId===r)s=!0;else{let a=this.getShape(o.parentId);e:for(;a;){if(a.parentId===r){s=!0;break e}a=this.getShape(a.parentId)}}return s}getAncestorPageId(t){const r=typeof t=="string"?t:t==null?void 0:t.id,i=r&&this.getShape(r);if(i)return Hn(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(g=>g.id);if(o.length===0)return this;const s=[],a=Hn(r)?re.Identity():this.getShapePageTransform(r),l=a.rotation();let c=[];const u=ye(this.getSortedChildIdsForParent(r).map(g=>this.getShape(g)));if(i){const g=u.find(f=>f.index===i);if(g){const f=u[u.indexOf(g)+1];f?c=El(i,f.index,o.length):c=fb(i,o.length)}else{const f=u.sort(mn).find(m=>m.index>i);f?c=El(i,f.index,o.length):c=fb(i,o.length)}}else{const g=u.length&&u[u.length-1];c=g?fb(g.index,o.length):FE(o.length)}const d=a.clone().invert(),h=ye(o.map(g=>this.getShape(g))),p=h.filter(g=>g.isLocked);p.length&&this.updateShapes(p.map(({id:g,type:f})=>({id:g,type:f,isLocked:!1})));for(let g=0;g<h.length;g++){const f=h[g],m=this.getShapePageTransform(f);if(!m)continue;const v=m.point();if(!v)continue;const b=d.applyToPoint(v),_=m.rotation()-l;s.push({id:f.id,type:f.type,parentId:r,x:b.x,y:b.y,rotation:_,index:c[g],isLocked:f.isLocked})}return this.updateShapes(s),this}getHighestIndexForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];if(!i||i.length===0)return"a1";const o=this.getShape(i[i.length-1]);return uo(o.index)}getSortedChildIdsForParent(t){const r=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[r];return i?this._childIdsCache.get(i,()=>i):no}visitDescendants(t,r){const i=typeof t=="string"?t:t.id,o=this.getSortedChildIdsForParent(i);for(const s of o)r(s)!==!1&&this.visitDescendants(s,r);return this}getShapeAndDescendantIds(t){const r=new Set,i=[...t];for(;i.length>0;){const o=i.pop();if(!o)break;if(!r.has(o)){r.add(o);for(const s of this.getSortedChildIdsForParent(o))i.push(s)}}return r}getDroppingOverShape(t,r=[]){const i=this.getCurrentPageShapesSorted();for(let o=i.length-1;o>=0;o--){const s=i[o];if(!this.getShapeUtil(s).canDropShapes(s,r)||r.find(l=>l.id===s.id||this.hasAncestor(s,l.id)))continue;const a=this.getShapeMaskedPageBounds(s.id);if(a&&a.containsPoint(t)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,t),0,!0))return s}}getOutermostSelectableShape(t,r){const i=typeof t=="string"?t:t.id,o=this.getShape(i);let s=o,a=o;const l=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(l==null?void 0:l.id)!==a.id&&!this.hasAncestor(l,a.id)&&((r==null?void 0:r(a))??!0))s=a;else if((l==null?void 0:l.id)===a.id)break;a=this.getShapeParent(a)}return s}rotateShapesBy(t,r){if((typeof t[0]=="string"?t:t.map(o=>o.id)).length<=0)return this;const i=$E({editor:this});return i?(mf({delta:r,snapshot:i,editor:this,stage:"one-off"}),this):this}nudgeShapes(t,r,i){var a,l;const o=typeof t[0]=="string"?t:t.map(c=>c.id);if(o.length<=0)return this;const s=[];for(const c of o){const u=this.getShape(c);if(!u)throw Error(`Could not find a shape with the id ${c}.`);const d=P.Cast(r),h=this.getShapeParentTransform(u);h&&d.rot(-h.rotation());const p=(l=(a=this.getShapeUtil(u)).onTranslateStart)==null?void 0:l.call(a,u);s.push(p?{...p,x:u.x+d.x,y:u.y+d.y}:{id:c,x:u.x+d.x,y:u.y+d.y,type:u.type})}return this.updateShapes(s,{squashing:!0,...i}),this}duplicateShapes(t,r){const i=typeof t[0]=="string"?t:t.map(u=>u.id);if(i.length<=0)return this;const o=new Set(i),s=[],a=[...i];for(;a.length>0;){const u=a.pop();if(!u)break;s.push(u),this.getSortedChildIdsForParent(u).forEach(d=>a.push(d))}s.reverse();const l=new Map(s.map(u=>[u,tt()])),c=ye(s.map(u=>{const d=this.getShape(u);if(!d)return null;const h=l.get(u);let p=0,g=0;if(r&&o.has(u)){const k=this.getShapeParentTransform(d),E=new P(r.x,r.y).rot(-k.rotation());p=E.x,g=E.y}const f=d.parentId??this.getCurrentPageId(),m=this.getSortedChildIdsForParent(f),v=m.indexOf(d.id),b=m[v+1],_=b?this.getShape(b):null,x=_?Nu(d.index,_.index):uo(d.index);let C=cn(d);if(this.isShapeOfType(d,"arrow")&&this.isShapeOfType(C,"arrow")){const k=this.getArrowInfo(d);let E,I;if(d.props.start.type==="binding"&&(E=l.get(d.props.start.boundShapeId),!E))if(k!=null&&k.isValid){const{x:A,y:D}=k.start.point;C.props.start={type:"point",x:A,y:D}}else{const{start:A}=ni(this,d);C.props.start={type:"point",x:A.x,y:A.y}}if(d.props.end.type==="binding"&&(I=l.get(d.props.end.boundShapeId),!I))if(k!=null&&k.isValid){const{x:A,y:D}=k.end.point;C.props.end={type:"point",x:A,y:D}}else{const{end:A}=ni(this,d);C.props.start={type:"point",x:A.x,y:A.y}}const T=Fu(C)?$u(this,C):wb(this,C);if(k!=null&&k.isValid&&(T!=null&&T.isValid)&&!Fu(d)){const A=P.Med(k.start.handle,k.end.handle),D=P.Dist(k.middle,A),N=P.Dist(T.middle,A);C.props.bend<0?C.props.bend+=N-D:C.props.bend-=N-D}C.props.start.type==="binding"&&E&&(C.props.start.boundShapeId=E),C.props.end.type==="binding"&&I&&(C.props.end.boundShapeId=I)}return C={...C,id:h,x:d.x+p,y:d.y+g,index:x},C}));return c.forEach(u=>{Mr(u.parentId)&&l.has(u.parentId)&&(u.parentId=l.get(u.parentId))}),this.history.batch(()=>{const u=c.length+this.getCurrentPageShapeIds().size>lo;u&&vf(this);const d=u?c.slice(0,lo-this.getCurrentPageShapeIds().size):c,h=d.map(p=>p.id);if(this.createShapes(d),this.setSelectedShapes(h),r!==void 0){const p=this.getSelectionPageBounds(),g=this.getViewportPageBounds();p&&!g.contains(p)&&this.centerOnPoint(p.center,{duration:co})}}),this}moveShapesToPage(t,r){const i=typeof t[0]=="string"?t:t.map(l=>l.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const o=this.getCurrentPageId();if(r===o)return this;if(!this.store.has(r))return this;const s=this.getContentFromCurrentPage(i);if(!s)return this;if(this.getPageShapeIds(r).size+s.shapes.length>lo)return vf(this,r),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(i),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let i=!0,o=!0;const s=[];for(const a of r){const l=this.getShape(a);l&&(s.push(l),l.isLocked?o=!1:i=!1)}return this.batch(()=>{o?(this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(s.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=gf(this,"toBack",r);return i&&this.updateShapes(i),this}sendBackward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=gf(this,"backward",r);return i&&this.updateShapes(i),this}bringForward(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=gf(this,"forward",r);return i&&this.updateShapes(i),this}bringToFront(t){const r=typeof t[0]=="string"?t:t.map(o=>o.id),i=gf(this,"toFront",r);return i&&this.updateShapes(i),this}flipShapes(t,r){const i=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let o=ye(i.map(a=>this.getShape(a)));if(!o.length)return this;o=ye(o.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(l=>this.getShape(l)):a).flat());const s=de.Common(ye(o.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of o){const l=this.getShapeGeometry(a).bounds,c=this.getShapePageTransform(a.id);c&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:c,initialShape:a,mode:"scale_shape",scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(t,r,i){const o=typeof t[0]=="string"?t:t.map(m=>m.id);if(this.getInstanceState().isReadonly)return this;const s=ye(o.map(m=>this.getShape(m)).filter(m=>!(!m||this.isShapeOfType(m,"arrow")&&(m.props.start.type==="binding"||m.props.end.type==="binding")))),a=s.length;if(i===0&&a<3||a<2)return this;const l=Object.fromEntries(s.map(m=>[m.id,this.getShapePageBounds(m)]));let c,u,d,h;r==="horizontal"?(c="x",u="minX",d="maxX",h="width"):(c="y",u="minY",d="maxY",h="height");let p;if(i===0){const m=[];s.sort((b,_)=>l[b.id][u]-l[_.id][u]);for(let b=0;b<a-1;b++){const _=s[b],x=s[b+1],C=l[_.id],k=l[x.id][u]-C[d],E=m.find(I=>I.gap===k);E?E.count++:m.push({gap:k,count:1})}let v=0;m.forEach(b=>{b.count>v&&(v=b.count,p=b.gap)}),v===1&&(p=Math.max(0,m.reduce((b,_)=>b+_.gap*_.count,0)/(a-1)))}else p=i;const g=[];let f=l[s[0].id][d];return s.forEach((m,v)=>{var k,E;if(v===0)return;const b={x:0,y:0};b[c]=f+p-l[m.id][c];const _=this.getShapeParent(m),x=_?P.Rot(b,-this.getShapePageTransform(_).decompose().rotation):b,C=(E=(k=this.getShapeUtil(m)).onTranslateStart)==null?void 0:E.call(k,m);g.push(C?{...C,[c]:m[c]+x[c]}:{id:m.id,type:m.type,[c]:m[c]+x[c]}),f+=l[m.id][h]+p}),this.updateShapes(g),this}packShapes(t,r){var E,I;const i=typeof t[0]=="string"?t:t.map(T=>T.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=ye(i.map(T=>this.getShape(T)).filter(T=>!(!T||this.isShapeOfType(T,"arrow")&&(T.props.start.type==="binding"||T.props.end.type==="binding")))),s={},a={};let l,c,u=0;for(let T=0;T<o.length;T++)l=o[T],c=this.getShapePageBounds(l),s[l.id]=c,a[l.id]=c.clone(),u+=c.width*c.height;const d=de.Common(ye(Object.values(s))),h=d.width;o.sort((T,A)=>s[A.id].height-s[T.id].height);const p=Math.max(Math.ceil(Math.sqrt(u/.95)),h),g=[new de(d.x,d.y,p,1/0)];let f=0,m=0,v,b;for(let T=0;T<o.length;T++){l=o[T],c=a[l.id];for(let A=g.length-1;A>=0;A--)if(v=g[A],!(c.width>v.width||c.height>v.height)){c.x=v.x,c.y=v.y,m=Math.max(m,c.maxY),f=Math.max(f,c.maxX),c.width===v.width&&c.height===v.height?(b=g.pop(),A<g.length&&(g[A]=b)):c.height===v.height?(v.x+=c.width+r,v.width-=c.width+r):c.width===v.width?(v.y+=c.height+r,v.height-=c.height+r):(g.push(new de(v.x+(c.width+r),v.y,v.width-(c.width+r),c.height)),v.y+=c.height+r,v.height-=c.height+r);break}}const _=de.Common(Object.values(a)),x=P.Sub(d.center,_.center);let C;const k=[];for(let T=0;T<o.length;T++){l=o[T],c=s[l.id],C=a[l.id];const A=P.Sub(C.point,c.point).add(x),D=this.getShapeParentTransform(l);D&&A.rot(-D.rotation());const N={id:l.id,type:l.type,x:l.x+A.x,y:l.y+A.y},U=(I=(E=this.getShapeUtil(l)).onTranslateStart)==null?void 0:I.call(E,{...l,...N});U?k.push({...N,...U}):k.push(N)}return k.length&&this.updateShapes(k),this}alignShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=ye(i.map(c=>this.getShape(c))),s=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),a=de.Common(ye(Object.values(s))),l=[];return o.forEach(c=>{var f,m;const u=s[c.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const h=this.getShapeParent(c),p=h?P.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d,g=(m=(f=this.getShapeUtil(c)).onTranslateStart)==null?void 0:m.call(f,c);l.push(g?{...g,x:c.x+p.x,y:c.y+p.y}:{id:c.id,type:c.type,x:c.x+p.x,y:c.y+p.y})}),this.updateShapes(l),this}distributeShapes(t,r){const i=typeof t[0]=="string"?t:t.map(_=>_.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const o=i.length,s=ye(i.map(_=>this.getShape(_))),a=Object.fromEntries(s.map(_=>[_.id,this.getShapePageBounds(_)]));let l,c,u,d,h;r==="horizontal"?(l="x",c="minX",u="maxX",d="midX",h="width"):(l="y",c="minY",u="maxY",d="midY",h="height");const p=[],g=s.sort((_,x)=>a[_.id][c]-a[x.id][c])[0],f=s.sort((_,x)=>a[x.id][u]-a[_.id][u])[0],m=a[g.id][d],v=(a[f.id][d]-m)/(o-1),b=m+v;return s.filter(_=>_!==g&&_!==f).sort((_,x)=>a[_.id][d]-a[x.id][d]).forEach((_,x)=>{var T,A;const C={x:0,y:0};C[l]=b+v*x-a[_.id][h]/2-a[_.id][l];const k=this.getShapeParent(_),E=k?P.Rot(C,-this.getShapePageTransform(k).rotation()):C,I=(A=(T=this.getShapeUtil(_)).onTranslateStart)==null?void 0:A.call(T,_);p.push(I?{...I,[l]:_[l]+E[l]}:{id:_.id,type:_.type,[l]:_[l]+E[l]})}),this.updateShapes(p),this}stretchShapes(t,r){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const o=ye(i.map(c=>this.getShape(c))),s=Object.fromEntries(i.map(c=>[c,this.getShapeGeometry(c).bounds])),a=Object.fromEntries(i.map(c=>[c,this.getShapePageBounds(c)])),l=de.Common(ye(Object.values(a)));switch(r){case"vertical":{this.batch(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%We)continue;const u=s[c.id],d=a[c.id],h=new P(0,l.minY-d.minY),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=P.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const m=new P(1,l.height/d.height);this.resizeShape(c.id,m,{initialBounds:u,scaleOrigin:new P(d.center.x,l.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const c of o){const u=s[c.id],d=a[c.id];if(this.getShapePageTransform(c).rotation()%We)continue;const h=new P(l.minX-d.minX,0),p=this.getShapeParentTransform(c);p&&h.rot(-p.rotation());const{x:g,y:f}=P.Add(h,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:f}],{squashing:!0});const m=new P(l.width/d.width,1);this.resizeShape(c.id,m,{initialBounds:u,scaleOrigin:new P(l.minX,d.center.y),scaleAxisRotation:0})}});break}}return this}resizeShape(t,r,i={}){var p;const o=typeof t=="string"?t:t.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new P(1,r.y)),Number.isFinite(r.y)||(r=new P(r.x,1));const s=i.initialShape??this.getShape(o);if(!s)return this;const a=i.scaleOrigin??((p=this.getShapePageBounds(o))==null?void 0:p.center);if(!a)return this;const l=i.initialPageTransform?re.Cast(i.initialPageTransform):this.getShapePageTransform(o);if(!l)return this;const c=l.rotation();if(c==null)return this;const u=i.scaleAxisRotation??c,d=i.initialBounds??this.getShapeGeometry(o).bounds;if(!d)return this;if(!xP(c,u))return this._resizeUnalignedShape(o,r,{...i,initialBounds:d,scaleOrigin:a,scaleAxisRotation:u,initialPageTransform:l,initialShape:s});const h=this.getShapeUtil(s);if(h.isAspectRatioLocked(s)&&(Math.abs(r.x)>Math.abs(r.y)?r=new P(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new P(Math.sign(r.x)*Math.abs(r.y),r.y)),h.onResize&&h.canResize(s)){const g=this._scalePagePoint(re.applyToPoint(l,new P(0,0)),a,r,u),f=this.getPointInParentSpace(s.id,g),m=new P(r.x,r.y),v=Cu((c-u)%Math.PI,0);m.x=v?r.x:r.y,m.y=v?r.y:r.x;const b=re.applyToPoint(l,new P),{x:_,y:x}=this.getPointInParentSpace(s.id,b);this.updateShapes([{id:o,type:s.type,x:f.x,y:f.y,...h.onResize({...s,x:_,y:x},{newPoint:f,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:m.x,scaleY:m.y,initialBounds:d,initialShape:s})}],{squashing:!0})}else{const g=re.applyToPoint(l,d.center),f=this._scalePagePoint(g,a,r,u),m=this.getPointInParentSpace(s.id,g),v=this.getPointInParentSpace(s.id,f),b=P.Sub(v,m);this.updateShapes([{id:o,type:s.type,x:s.x+b.x,y:s.y+b.y}],{squashing:!0})}return this}_scalePagePoint(t,r,i,o){const s=P.RotWith(t,r,-o).sub(r),a=P.MulV(s,i);return P.Add(a,r).rotWith(r,o)}_resizeUnalignedShape(t,r,i){const{type:o}=i.initialShape,s=new P(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?s.x=Math.sign(r.x)*Math.abs(r.y):s.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(t,s,{initialShape:i.initialShape,initialBounds:i.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:v}=re.Decompose(i.initialPageTransform);v-=2*v,this.updateShapes([{id:t,type:o,rotation:v}],{squashing:!0})}const a=re.applyToPoint(i.initialPageTransform,i.initialBounds.center),l=this._scalePagePoint(a,i.scaleOrigin,r,i.scaleAxisRotation),c=this.getShapePageBounds(t),u=this.getShapePageTransform(t),d=c.center,h=u.point();if(!d||!h)return this;const p=P.Sub(l,d),g=P.Add(h,p),{x:f,y:m}=this.getPointInParentSpace(t,g);return this.updateShapes([{id:t,type:o,x:f,y:m}],{squashing:!0}),this}getInitialMetaForShape(t){return{}}createShape(t){return this._createShapes([t]),this}createShapes(t){if(!Array.isArray(t))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(t),this}animateShape(t,r){return this.animateShapes([t],r)}animateShapes(t,r={}){const{duration:i=500,easing:o=fn.linear}=r,s=Xe();let a=i,l;const c=[];t.forEach(h=>{if(!h)return;const p={partial:h,values:[]},g=this.getShape(h.id);if(g){for(const f of["x","y","rotation"])h[f]!==void 0&&g[f]!==h[f]&&p.values.push({prop:f,from:g[f],to:h[f]});c.push(p),this.animatingShapes.set(g.id,s)}});let u;const d=h=>{if(a-=h,a<0){const{animatingShapes:g}=this,f=t.filter(m=>m&&g.get(m.id)===s);f.length&&this.updateShapes(f,{squashing:!1}),this.removeListener("tick",d);return}l=o(1-a/i);const{animatingShapes:p}=this;try{const g=[];for(let f=0;f<c.length;f++)u=c[f],p.get(u.partial.id)===s&&g.push({id:u.partial.id,type:u.partial.type,...u.values.reduce((m,{prop:v,from:b,to:_})=>(m[v]=b+(_-b)*l,m),{})});this._updateShapes(g,{squashing:!0})}catch{}};return this.addListener("tick",d),this}groupShapes(t,r=tt()){var p;if(!Array.isArray(t))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const i=typeof t[0]=="string"?t:t.map(g=>g.id);if(i.length<=1)return this;const o=ye(this._getUnlockedShapeIds(i).map(g=>this.getShape(g))),s=o.sort(mn).map(g=>g.id),a=de.Common(ye(o.map(g=>this.getShapePageBounds(g)))),{x:l,y:c}=a.point,u=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const d=o.filter(g=>g.parentId===u).sort(mn),h=(p=d[d.length-1])==null?void 0:p.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:h,x:l,y:c,opacity:1,props:{}}]),this.reparentShapes(s,r),this.select(r)}),this}ungroupShapes(t){const r=typeof t[0]=="string"?t:t.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;if(r.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,o=ye(r.map(a=>this.getShape(a))),s=[];return o.forEach(a=>{this.isShapeOfType(a,"group")?s.push(a):i.add(a.id)}),s.length===0?this:(this.batch(()=>{let a;for(let l=0,c=s.length;l<c;l++){a=s[l];const u=this.getSortedChildIdsForParent(a.id);for(let d=0,h=u.length;d<h;d++)i.add(u[d]);this.reparentShapes(u,a.parentId,a.index)}this.deleteShapes(s.map(l=>l.id)),this.select(...i)}),this)}updateShape(t,r){return this.updateShapes([t],r),this}updateShapes(t,r){let i=ye(t);return this.animatingShapes.size>0&&i.forEach(o=>this.animatingShapes.delete(o.id)),i=i.filter(o=>{const s=this.getShape(o.id);return!(!s||this.isShapeOrAncestorLocked(s)&&!Object.hasOwn(o,"isLocked"))}),this._updateShapes(i,r),this}_getUnlockedShapeIds(t){return t.filter(r=>{var i;return!((i=this.getShape(r))!=null&&i.isLocked)})}deleteShapes(t){if(!Array.isArray(t))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof t[0]=="string"?t:t.map(r=>r.id))),this}deleteShape(t){return this.deleteShapes([typeof t=="string"?t:t.id]),this}_extractSharedStyles(t,r){if(this.isShapeOfType(t,"group")){const i=this._parentIdsToChildIds.get()[t.id];if(!i)return;for(let o=0,s=i.length;o<s;o++)this._extractSharedStyles(this.getShape(i[o]),r)}else for(const[i,o]of this.styleProps[t.type])r.applyValue(i,Zs(t.props,o))}getStyleForNextShape(t){const r=this.getInstanceState().stylesForNextShape[t.id];return r===void 0?t.defaultValue:r}getShapeStyleIfExists(t,r){const i=this.styleProps[t.type].get(r);if(i!==void 0)return Zs(t.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();const t=this.root.getCurrent(),r=new hb;if(!t)return r;if(t.shapeType)for(const i of this.styleProps[t.shapeType].keys())r.applyValue(i,this.getStyleForNextShape(i));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const t=[],r=o=>{const s=this.getShape(o);if(s)if(this.isShapeOfType(s,"group"))for(const a of this.getSortedChildIdsForParent(s.id))r(a);else t.push(s)};for(const o of this.getSelectedShapeIds())r(o);let i=null;for(const o of t)if(i===null)i=o.opacity;else if(i!==o.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(t,r){return this.updateInstanceState({opacityForNextShape:t},r),this}setOpacityForSelectedShapes(t,r){const i=this.getSelectedShapes();if(i.length>0){const o=[],s=a=>{if(this.isShapeOfType(a,"group")){const l=this.getSortedChildIdsForParent(a);for(const c of l)s(this.getShape(c))}else o.push(a)};for(const a of i)s(a);this.updateShapes(o.map(a=>({id:a.id,type:a.type,opacity:t})),r)}return this}setStyleForNextShapes(t,r,i){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[t.id]:r}},i),this}setStyleForSelectedShapes(t,r,i){const o=this.getSelectedShapes();if(o.length>0){const s=[],a=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const u of c)a(this.getShape(u))}else{const c=this.getShapeUtil(l),u=this.styleProps[l.type].get(t);if(u){const d={id:l.id,type:l.type,props:{[u]:r}};s.push({util:c,originalShape:l,updatePartial:d})}}};for(const l of o)a(l);this.updateShapes(s.map(({updatePartial:l})=>l),i)}return this}registerExternalAssetHandler(t,r){return this.externalAssetContentHandlers[t]=r,this}async getAssetForExternalContent(t){var r,i;return await((i=(r=this.externalAssetContentHandlers)[t.type])==null?void 0:i.call(r,t))}registerExternalContentHandler(t,r){return this.externalContentHandlers[t]=r,this}async putExternalContent(t){var r,i;return(i=(r=this.externalContentHandlers)[t.type])==null?void 0:i.call(r,t)}getContentFromCurrentPage(t){const r=typeof t[0]=="string"?t:t.map(l=>l.id);if(!r||r.length===0)return;const i={};let o=Ep(r.map(l=>this.getShape(l)).sort(mn).flatMap(l=>{const c=[l];return this.visitDescendants(l.id,u=>{c.push(this.getShape(u))}),c}));o=o.map(l=>{if(i[l.id]=this.getShapePageTransform(l.id),l=rs(l),this.isShapeOfType(l,"arrow")){const c=l.props.start.type==="binding"?l.props.start.boundShapeId:void 0,u=l.props.end.type==="binding"?l.props.end.boundShapeId:void 0,d=this.getArrowInfo(l);if(l.props.start.type==="binding"&&!o.some(p=>p.id===c))if(d!=null&&d.isValid){const{x:p,y:g}=d.start.point;l.props.start={type:"point",x:p,y:g}}else{const{start:p}=ni(this,l);l.props.start={type:"point",x:p.x,y:p.y}}if(l.props.end.type==="binding"&&!o.some(p=>p.id===u))if(d!=null&&d.isValid){const{x:p,y:g}=d.end.point;l.props.end={type:"point",x:p,y:g}}else{const{end:p}=ni(this,l);l.props.end={type:"point",x:p.x,y:p.y}}const h=Fu(l)?$u(this,l):wb(this,l);if(d!=null&&d.isValid&&(h!=null&&h.isValid)&&!Fu(l)){const p=P.Med(d.start.handle,d.end.handle),g=P.Dist(d.middle,p),f=P.Dist(h.middle,p);l.props.bend<0?l.props.bend+=f-g:l.props.bend-=f-g}return l}return l});const s=[];o.forEach(l=>{if(o.find(c=>c.id===l.parentId)===void 0){const c=this.getShapePageTransform(l.id),u=c.point(),d=c.rotation();l.x=u.x,l.y=u.y,l.rotation=d,l.parentId=this.getCurrentPageId(),s.push(l.id)}});const a=new Set;return o.forEach(l=>{"assetId"in l.props&&l.props.assetId!==null&&a.add(l.props.assetId)}),{shapes:o,rootShapeIds:s,schema:this.store.schema.serialize(),assets:ye(Array.from(a).map(l=>this.getAsset(l)))}}putContentOntoCurrentPage(t,r={}){if(this.getInstanceState().isReadonly)return this;if(!t.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:o=!1,preservePosition:s=!1}=r;let{point:a=void 0}=r;const l=this.getCurrentPageId(),{assets:c,shapes:u,rootShapeIds:d}=t,h=new Map(u.map(C=>[C.id,tt()]));let p=this.getCurrentPageId(),g=1/0,f=[];for(const C of this.getSelectedShapes()){if(g===0)break;const k=this.isShapeOfType(C,"frame"),E=this.getShapeAncestors(C);k&&E.push(C);const I=k?E.length+1:E.length;if(I<g)g=I,f=E,p=k?C.id:C.parentId;else if(I===g){if(f.length!==E.length)throw Error(`Ancestors: ${f.length} !== ${E.length}`);if(f.length===0){p=l;break}else{p=l;for(let T=0;T<f.length&&E[T]===f[T];T++)p=E[T].id}}}let m=!1;if(!Hn(p)){const C=this.getShape(p);if(C){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(C)))p=l;else if(d.length===1){const k=u.find(E=>E.id===d[0]);this.isShapeOfType(C,"frame")&&this.isShapeOfType(k,"frame")&&k.props.w===(C==null?void 0:C.props.w)&&k.props.h===(C==null?void 0:C.props.h)&&(m=!0)}}else p=l}m||(m=h.has(p)),m&&(p=this.getShape(p).parentId);let v=this.getHighestIndexForParent(p);const b=[],_=u.map(C=>{let k;if(o)k=cn(C),h.set(C.id,C.id);else{const E=h.get(C.id);k=cn({...C,id:E})}if(d.includes(C.id)&&(k.parentId=l,b.push(k)),h.has(k.parentId)?k.parentId=h.get(C.parentId):(d.push(k.id),k.index=v,v=uo(v)),this.isShapeOfType(k,"arrow")){if(k.props.start.type==="binding"){const E=h.get(k.props.start.boundShapeId);k.props.start=E?{...k.props.start,boundShapeId:E}:{type:"point",x:0,y:0}}if(k.props.end.type==="binding"){const E=h.get(k.props.end.boundShapeId);k.props.end=E?{...k.props.end,boundShapeId:E}:{type:"point",x:0,y:0}}}return k});if(_.length+this.getCurrentPageShapeIds().size>lo)return vf(this),this;let x=[];if(c){for(let k=0;k<c.length;k++){const E=c[k],I=this.store.schema.migratePersistedRecord(E,t.schema);if(I.type==="success")c[k]=I.value;else throw Error(`Could not put content:
could not migrate content for asset:
${E.id}
${E.type}
reason:${I.reason}`)}const C=[];x=c.filter(k=>!this.store.has(k.id)).map(k=>{var E;return(k.type==="image"||k.type==="video")&&(k.props.src&&((E=k.props.src)!=null&&E.startsWith("data:image"))?(C.push(rs(k)),k.props.src=null):C.push(rs(k))),k}),Promise.allSettled(C.map(async k=>{const E=await W9(k.props.src,k.props.name,k.props.mimeType??"image/png"),I=await this.getAssetForExternalContent({type:"file",file:E});return I?[k,I]:null})).then(k=>{this.updateAssets(ye(k.map(E=>E.status==="fulfilled"&&E.value?{...E.value[1],id:E.value[0].id}:void 0)))})}for(let C=0;C<_.length;C++){const k=_[C],E=this.store.schema.migratePersistedRecord(k,t.schema);if(E.type==="success")_[C]=E.value;else throw Error(`Could not put content:
could not migrate content for shape:
${k.id}, ${k.type}
reason:${E.reason}`)}return this.batch(()=>{x.length>0&&this.createAssets(x),this.createShapes(_),i&&this.select(...b.map(T=>T.id)),p!==l&&this.reparentShapes(b.map(T=>T.id),p);const C=_.map(T=>this.getShape(T.id)),k=de.Common(C.map(T=>this.getShapePageBounds(T)));if(a===void 0)if(Hn(p)){const T=this.getViewportPageBounds();s||T.includes(de.From(k))?a=k.center:a=T.center}else{const T=this.getShape(p);a=re.applyToPoint(this.getShapePageTransform(T),this.getShapeGeometry(T).bounds.center)}if(b.length===1){const T=b[0];if(this.isShapeOfType(T,"frame"))for(;this.getShapesAtPoint(a).some(A=>this.isShapeOfType(A,"frame")&&A.props.w===T.props.w&&A.props.h===T.props.h);)a.x+=k.w+16}const E=de.Common(ye(b.map(({id:T})=>this.getShapePageBounds(T)))).center,I=P.Sub(a,E);this.updateShapes(b.map(({id:T})=>{const A=this.getShape(T),D=this.getShapeParentTransform(T).decompose().rotation,N=P.Rot(I,-D);return{id:A.id,type:A.type,x:A.x+N.x,y:A.y+N.y}}))}),this}async getSvg(t,r={}){var C,k;const i=typeof t[0]=="string"?t:t.map(E=>E.id);if(i.length===0)return;if(!window.document)throw Error("No document");const{scale:o=1,background:s=!1,padding:a=n6,preserveAspectRatio:l=!1}=r,c=Wn({isDarkMode:this.user.getIsDarkMode()}),u=this.getShapeAndDescendantIds(i),d=this.getUnorderedRenderingShapes(!1).filter(({id:E})=>u.has(E));let h=null;if(r.bounds)h=r.bounds;else for(const{maskedPageBounds:E}of d)E&&(h?h.union(E):h=E.clone());if(!h)return;const p=i.length===1&&this.isShapeOfType(this.getShape(i[0]),"frame")?i[0]:null;p||h.expandBy(a);const g=h.width*o,f=h.height*o,m=window.document.createElementNS("http://www.w3.org/2000/svg","svg");l&&m.setAttribute("preserveAspectRatio",l),m.setAttribute("direction","ltr"),m.setAttribute("width",g+""),m.setAttribute("height",f+""),m.setAttribute("viewBox",`${h.minX} ${h.minY} ${h.width} ${h.height}`),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),s?p?m.style.setProperty("background",c.solid):m.style.setProperty("background-color",c.background):m.style.setProperty("background-color","transparent");try{(k=(C=document.body).focus)==null||k.call(C)}catch{}const v=window.document.createElementNS("http://www.w3.org/2000/svg","defs");m.append(v);const b=new Map,_={addExportDef:E=>{if(b.has(E.key))return;const I=(async()=>{const T=await E.getElement();if(!T)return;const A=document.createComment(`def: ${E.key}`);v.appendChild(A);for(const D of Array.isArray(T)?T:[T])v.appendChild(D)})();b.set(E.key,I)}},x=(await Promise.all(d.map(async({id:E,opacity:I,index:T,backgroundIndex:A})=>{var G,L;if(E===p)return[];const D=this.getShape(E);if(this.isShapeOfType(D,"group"))return[];const N=this.getShapeUtil(D);let U=await((G=N.toSvg)==null?void 0:G.call(N,D,_)),R=await((L=N.toBackgroundSvg)==null?void 0:L.call(N,D,_));if(U){const V=document.createElementNS("http://www.w3.org/2000/svg","g");V.appendChild(U),U=V}if(R){const V=document.createElementNS("http://www.w3.org/2000/svg","g");V.appendChild(R),R=V}if(!U&&!R){const V=this.getShapePageBounds(D),J=window.document.createElementNS("http://www.w3.org/2000/svg","rect");J.setAttribute("width",V.width+""),J.setAttribute("height",V.height+""),J.setAttribute("fill",c.solid),J.setAttribute("stroke",c.grey.pattern),J.setAttribute("stroke-width","1"),U=J}let B=this.getShapePageTransform(D).toCssString();"scale"in D.props&&D.props.scale!==1&&(B=`${B} scale(${D.props.scale}, ${D.props.scale})`),U==null||U.setAttribute("transform",B),R==null||R.setAttribute("transform",B),U==null||U.setAttribute("opacity",I+""),R==null||R.setAttribute("opacity",I+"");const $=this.getShapeMask(D.id);if($){const V=document.createElementNS("http://www.w3.org/2000/svg","clipPath");v.appendChild(V);const J=Xe();V.id=J;const le=document.createElementNS("http://www.w3.org/2000/svg","path");if(le.setAttribute("d",`M${$.map(({x:me,y:ve})=>`${me},${ve}`).join("L")}Z`),V.appendChild(le),U){const me=document.createElementNS("http://www.w3.org/2000/svg","g");me.setAttribute("clip-path",`url(#${J})`),me.appendChild(U),U=me}if(R){const me=document.createElementNS("http://www.w3.org/2000/svg","g");me.setAttribute("clip-path",`url(#${J})`),me.appendChild(R),R=me}}const q=[];return U&&q.push({zIndex:T,element:U}),R&&q.push({zIndex:A,element:R}),q}))).flat();await Promise.all(b.values());for(const{element:E}of x.sort((I,T)=>I.zIndex-T.zIndex))m.appendChild(E);return m}_updateInputsFromEvent(t){var g;const{previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(Tn),{x:l,y:c,z:u}=t.point,{x:d,y:h,z:p}=this.getCamera();r.setTo(o),i.setTo(s),o.set(l,c),s.set((l-a.x)/p-d,(c-a.y)/p-h,u??.5),this.inputs.isPen=t.type==="pointer"&&t.isPen,t.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:Np,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:t.type==="pointer"&&t.pointerId===AP.CAMERA_MOVE?((g=this.store.get(Np))==null?void 0:g.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}pe([ee],he.prototype,"getCanUndo",1),pe([ee],he.prototype,"getCanRedo",1),pe([ee],he.prototype,"_getArrowBindingsIndex",1),pe([ee],he.prototype,"getArrowInfoCache",1),pe([ee],he.prototype,"getPath",1),pe([ee],he.prototype,"getCurrentTool",1),pe([ee],he.prototype,"getCurrentToolId",1),pe([ee],he.prototype,"getDocumentSettings",1),pe([ee],he.prototype,"getInstanceState",1),pe([ee],he.prototype,"getOpenMenus",1),pe([ee],he.prototype,"getIsMenuOpen",1),pe([ee],he.prototype,"getPageStates",1),pe([ee],he.prototype,"_getPageStatesQuery",1),pe([ee],he.prototype,"getCurrentPageState",1),pe([ee],he.prototype,"_getCurrentPageStateId",1),pe([ee],he.prototype,"getSelectedShapeIds",1),pe([ee],he.prototype,"getSelectedShapes",1),pe([ee],he.prototype,"getOnlySelectedShape",1),pe([ee],he.prototype,"getSelectionPageBounds",1),pe([ee],he.prototype,"getSelectionRotation",1),pe([ee],he.prototype,"getSelectionRotatedPageBounds",1),pe([ee],he.prototype,"getFocusedGroupId",1),pe([ee],he.prototype,"getFocusedGroup",1),pe([ee],he.prototype,"getEditingShapeId",1),pe([ee],he.prototype,"getEditingShape",1),pe([ee],he.prototype,"getHoveredShapeId",1),pe([ee],he.prototype,"getHoveredShape",1),pe([ee],he.prototype,"getHintingShapeIds",1),pe([ee],he.prototype,"getHintingShape",1),pe([ee],he.prototype,"getErasingShapeIds",1),pe([ee],he.prototype,"getErasingShapes",1),pe([ee],he.prototype,"getCameraId",1),pe([ee],he.prototype,"getCamera",1),pe([ee],he.prototype,"getZoomLevel",1),pe([ee],he.prototype,"getViewportScreenBounds",1),pe([ee],he.prototype,"getViewportScreenCenter",1),pe([ee],he.prototype,"getViewportPageBounds",1),pe([ee],he.prototype,"getViewportPageCenter",1),pe([ee],he.prototype,"getRenderingShapes",1),pe([ee],he.prototype,"_getAllPagesQuery",1),pe([ee],he.prototype,"getPages",1),pe([ee],he.prototype,"_getAllAssetsQuery",1),pe([ee],he.prototype,"_getShapeGeometryCache",1),pe([ee],he.prototype,"_getShapeOutlineSegmentsCache",1),pe([ee],he.prototype,"_getShapeHandlesCache",1),pe([ee],he.prototype,"_getShapePageTransformCache",1),pe([ee],he.prototype,"_getShapePageBoundsCache",1),pe([ee],he.prototype,"_getShapeClipPathCache",1),pe([ee],he.prototype,"_getShapeMaskCache",1),pe([ee],he.prototype,"getCurrentPageBounds",1),pe([ee],he.prototype,"getCurrentPageShapes",1),pe([ee],he.prototype,"getCurrentPageShapesSorted",1),pe([ee],he.prototype,"getCurrentPageRenderingShapesSorted",1),pe([ee({isEqual:(n,e)=>n.equals(e)})],he.prototype,"getSharedStyles",1),pe([ee],he.prototype,"getSharedOpacity",1);function vf(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:lo})}function Sf(){const n=Y();return Z("isDarkMode",()=>n.user.getIsDarkMode(),[n])}const C7='<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',P7='<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',E7='<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',I7='<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',GE="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",YE="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",xf='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',M7='<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',T7="<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",A7='<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',j7='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',R7='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function qt(n,e,t,r,i,o=16,s=16){const a=(-t-e)*(Fe/180),l=Math.sin(a),c=Math.cos(a),u=1*c-1*l,d=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}const O7={none:()=>"none",default:(n,e,t)=>qt(C7,n,0,e,t,12,8),pointer:(n,e,t)=>qt(P7,n,0,e,t,14,10),cross:(n,e,t)=>qt(E7,n,0,e,t),move:(n,e,t)=>qt(I7,n,0,e,t),grab:(n,e,t)=>qt(A7,n,0,e,t),grabbing:(n,e,t)=>qt(T7,n,0,e,t),text:(n,e,t)=>qt(M7,n,0,e,t,4,10),"ew-resize":(n,e,t)=>qt(YE,n,0,e,t),"ns-resize":(n,e,t)=>qt(YE,n,90,e,t),"nesw-resize":(n,e,t)=>qt(GE,n,0,e,t),"nwse-resize":(n,e,t)=>qt(GE,n,90,e,t),"nwse-rotate":(n,e,t)=>qt(xf,n,0,e,t),"nesw-rotate":(n,e,t)=>qt(xf,n,90,e,t),"senw-rotate":(n,e,t)=>qt(xf,n,180,e,t),"swne-rotate":(n,e,t)=>qt(xf,n,270,e,t),"zoom-in":(n,e,t)=>qt(j7,n,0,e,t),"zoom-out":(n,e,t)=>qt(R7,n,0,e,t)};function dr(n,e=0,t="black"){return O7[n](VN(e),!1,t)}const D7=["default","pointer","cross","move","grab","grabbing","text"];function L7(){const n=Y(),e=pn(),t=Sf();Xs("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(D7.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",dr(r,i,t?"white":"black"))},[n,e,t])}function z7(){const n=Y(),e=pn(),t=Sf(),r=Z(nt.forceSrgb);oe.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function N7(n){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=n}),S.useDebugValue(n),S.useCallback((...t)=>{const r=e.current;return qs(r,"fn does not exist"),r(...t)},[])}function F7(n){const e=Y(),t=pn();S.useLayoutEffect(()=>{n?(e.getInstanceState().isFocused||e.updateInstanceState({isFocused:!0}),e.getContainer().focus()):e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!1})},[e,t,n])}function $7(){const[n,e]=S.useState(0);S.useEffect(()=>e(t=>t+1),[])}const Ml="TLDRAW_TAB_ID_v2",Zt=globalThis.window;function B7(){return Zt?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Zt.navigator.platform)||Zt.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const _f=(Zt==null?void 0:Zt[Ml])??(Zt==null?void 0:Zt.sessionStorage[Ml])??"TLDRAW_INSTANCE_STATE_V1_"+Xe();Zt&&(Zt[Ml]=_f,B7()?Zt.sessionStorage[Ml]=_f:delete Zt.sessionStorage[Ml]),Zt==null||Zt.addEventListener("beforeunload",()=>{Zt.sessionStorage[Ml]=_f});const U7={Initial:0},Bu=U7.Initial,XE=Te({version:be,currentPageId:fu,isFocusMode:Ie,exportBackground:Ie,isDebugMode:Ie,isToolLocked:Ie,isGridMode:Ie,pageStates:Mn(Te({pageId:fu,camera:Te({x:be,y:be,z:be}),selectedShapeIds:Mn(Zr),focusedGroupId:Zr.nullable()}))}),V7=Ne({currentVersion:Bu});function H7(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;const e=Ew({value:n,fromVersion:n.version,toVersion:Bu,migrations:V7});if(e.type==="error")return console.warn(e.reason),null;const t={...e.value,version:Bu};try{XE.validate(t)}catch(r){return console.warn(r),null}return t}function W7(n){const e=n.query.ids("page");return ee("sessionStateSnapshot",()=>{const t=n.get(Tn);if(!t)return null;const r=[...e.get()];return{version:Bu,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const o=n.get(dn.createId(i)),s=n.get(un.createId(i));return{pageId:i,camera:{x:(s==null?void 0:s.x)??0,y:(s==null?void 0:s.y)??0,z:(s==null?void 0:s.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}})}function K7(n,e){const t=H7(e);if(!t)return;const r=n.allRecords().filter(s=>s.typeName==="instance_page_state"||s.typeName==="camera"),i={added:{},updated:{},removed:{...B2(r.map(s=>[s.id,s]))}};n.has(Tn)&&(i.removed[Tn]=n.get(Tn));const o={removed:{},updated:{},added:{[Tn]:n.schema.types.instance.create({id:Tn,currentPageId:t.currentPageId,isDebugMode:t.isDebugMode,isFocusMode:t.isFocusMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,exportBackground:t.exportBackground})}};for(const s of t.pageStates){const a=un.createId(s.pageId),l=dn.createId(s.pageId);o.added[a]=un.create({id:un.createId(s.pageId),x:s.camera.x,y:s.camera.y,z:s.camera.z}),o.added[l]=dn.create({id:dn.createId(s.pageId),pageId:s.pageId,selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId})}Xr(()=>{n.applyDiff(Op([i,o])),n.ensureStoreIsUsable()})}function G7(n){var i;const e=[];for(const o of Object.values(n))(i=o.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(o);const t=e.filter(o=>o.typeName==="instance"&&o.id!==Tn)[0];if(!t)return null;const r={version:Bu,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===t.id).map(o=>{const s=n[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:s.x,y:s.y,z:s.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return XE.validate(r),r}catch{return null}}function Y7(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function X7(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const q7=(n,e)=>e.some(t=>n instanceof t);let qE,ZE;function Z7(){return qE||(qE=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function J7(){return ZE||(ZE=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const JE=new WeakMap,bb=new WeakMap,QE=new WeakMap,vb=new WeakMap,Sb=new WeakMap;function Q7(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",o),n.removeEventListener("error",s)},o=()=>{t(fo(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",o),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&JE.set(t,n)}).catch(()=>{}),Sb.set(e,n),e}function e$(n){if(bb.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",s),n.removeEventListener("abort",s)},o=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",o),n.addEventListener("error",s),n.addEventListener("abort",s)});bb.set(n,e)}let xb={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return bb.get(n);if(e==="objectStoreNames")return n.objectStoreNames||QE.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return fo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function t$(n){xb=n(xb)}function n$(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(_b(this),e,...t);return QE.set(r,e.sort?e.sort():[e]),fo(r)}:J7().includes(n)?function(...e){return n.apply(_b(this),e),fo(JE.get(this))}:function(...e){return fo(n.apply(_b(this),e))}}function r$(n){return typeof n=="function"?n$(n):(n instanceof IDBTransaction&&e$(n),q7(n,Z7())?new Proxy(n,xb):n)}function fo(n){if(n instanceof IDBRequest)return Q7(n);if(vb.has(n))return vb.get(n);const e=r$(n);return e!==n&&(vb.set(n,e),Sb.set(e,n)),e}const _b=n=>Sb.get(n);function i$(n,e,{blocked:t,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(n,e),a=fo(s);return r&&s.addEventListener("upgradeneeded",l=>{r(fo(s.result),l.oldVersion,l.newVersion,fo(s.transaction),l)}),t&&s.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function o$(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),fo(t).then(()=>{})}const s$=["get","getKey","getAll","getAllKeys","count"],a$=["put","add","delete","clear"],kb=new Map;function eI(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(kb.get(e))return kb.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=a$.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||s$.includes(t)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[t](...a),i&&l.done]))[0]};return kb.set(e,o),o}t$(n=>({...n,get:(e,t,r)=>eI(e,t)||n.get(e,t,r),has:(e,t)=>!!eI(e,t)||n.has(e,t)}));const kf="TLDRAW_DOCUMENT_v2",tI="TLDRAW_DB_NAME_INDEX_v2",Ke={Records:"records",Schema:"schema",SessionState:"session_state"};async function Cf(n,e){h$(n);const t=await i$(n,3,{upgrade(r){r.objectStoreNames.contains(Ke.Records)||r.createObjectStore(Ke.Records),r.objectStoreNames.contains(Ke.Schema)||r.createObjectStore(Ke.Schema),r.objectStoreNames.contains(Ke.SessionState)||r.createObjectStore(Ke.SessionState)}});try{return await e(t)}finally{t.close()}}async function l$({persistenceKey:n,sessionId:e,didCancel:t}){const r=kf+n;if(Cb().includes(r))return await d$({persistenceKey:n,didCancel:t}),await Cf(r,async i=>{var d,h;if(t!=null&&t())return;const o=i.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readonly"),s=o.objectStore(Ke.Records),a=o.objectStore(Ke.Schema),l=o.objectStore(Ke.SessionState);let c=e?(d=await l.get(e))==null?void 0:d.snapshot:null;c||(c=(h=(await l.getAll()).sort((p,g)=>p.updatedAt-g.updatedAt).pop())==null?void 0:h.snapshot);const u={records:await s.getAll(),schema:await a.get(Ke.Schema),sessionStateSnapshot:c};if(t!=null&&t()){o.abort();return}return await o.done,u})}async function c$({persistenceKey:n,schema:e,changes:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=kf+n;await Cf(s,async a=>{const l=a.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readwrite"),c=l.objectStore(Ke.Records),u=l.objectStore(Ke.Schema),d=l.objectStore(Ke.SessionState);for(const[h,p]of Object.entries(t.added))await c.put(p,h);for(const[h,p]of Object.values(t.updated))await c.put(p,p.id);for(const h of Object.keys(t.removed))await c.delete(h);if(u.put(e.serialize(),Ke.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function u$({persistenceKey:n,schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i,didCancel:o}){const s=kf+n;await Cf(s,async a=>{const l=a.transaction([Ke.Records,Ke.Schema,Ke.SessionState],"readwrite"),c=l.objectStore(Ke.Records),u=l.objectStore(Ke.Schema),d=l.objectStore(Ke.SessionState);await c.clear();for(const[h,p]of Object.entries(t))await c.put(p,h);if(u.put(e.serialize(),Ke.Schema),i&&r?d.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o==null?void 0:o())return l.abort();await l.done})}async function d$({persistenceKey:n,didCancel:e}){await Cf(kf+n,async t=>{const r=t.transaction([Ke.SessionState],"readwrite"),i=r.objectStore(Ke.SessionState),o=(await i.getAll()).sort((a,l)=>a.updatedAt-l.updatedAt);if(o.length<10){await r.done;return}const s=o.slice(0,o.length-10);for(const{id:a}of s)await i.delete(a);if(e!=null&&e())return r.abort();await r.done})}function Cb(){const n=JSON.parse((window==null?void 0:window.localStorage.getItem(tI))||"[]")??[];return Array.isArray(n)?n:[]}function h$(n){const e=new Set(Cb());e.add(n),window==null||window.localStorage.setItem(tI,JSON.stringify([...e]))}const p$=350,f$=1e4,nI=Symbol("UPDATE_INSTANCE_STATE"),g$=n=>n;class m${constructor(e){w(this,"onmessage")}postMessage(e){}close(){}}const y$=typeof BroadcastChannel>"u"?m$:BroadcastChannel;class w${constructor(e,{persistenceKey:t,sessionId:r=_f,onLoad:i,onLoadError:o},s=new y$(`tldraw-tab-sync-${t}`)){w(this,"disposables",new Set);w(this,"diffQueue",[]);w(this,"didDispose",!1);w(this,"shouldDoFullDBWrite",!0);w(this,"isReloading",!1);w(this,"persistenceKey");w(this,"sessionId");w(this,"serializedSchema");w(this,"isDebugging",!1);w(this,"documentTypes");w(this,"$sessionStateSnapshot");w(this,"initTime",Date.now());w(this,"isPersisting",!1);w(this,"didLastWriteError",!1);w(this,"scheduledPersistTimeout",null);this.store=e,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=W7(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(g$({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(nI),this.schedulePersist()},{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await l$({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(i){t(i),X7(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(a=>[a.id,a])),o=r.sessionStateSnapshot??G7(i),s=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),t(new Error(`Failed to migrate store: ${s.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(s.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),o&&K7(this.store,o)}this.channel.onmessage=({data:i})=>{var a,l;this.debug("got message",i);const o=i,s=qL(this.serializedSchema,o.schema??this.store.schema.serializeEarliestVersion());if(s===-1){if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(l=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||l.call(a);return}else if(s===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}o.type==="diff"&&(this.debug("applying diff"),Xr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?f$:p$))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){qs(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await u$({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=Op(e.filter(r=>r!==nI));await c$({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),Y7(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function b$({initialData:n,defaultName:e="",...t}){const r="schema"in t&&t.schema?t.schema:Vz({shapes:v$(AE("shapeUtils"in t&&t.shapeUtils?t.shapeUtils:[]))});return new G2({schema:r,initialData:n,props:{defaultName:e}})}function v$(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function rI(n){const e=b$(n);return n.snapshot&&e.loadSnapshot(n.snapshot),{store:e,opts:n}}function S$(n){const[e,t]=S.useState(()=>rI(n));if(!V2(e.opts,n)){const r=rI(n);return t(r),r.store}return e.store}function x$({persistenceKey:n,sessionId:e,...t}){const[r,i]=S.useState(null),o=S$(t);return S.useEffect(()=>{const s=Xe();if(!n){i({id:s,storeWithStatus:{status:"not-synced",store:o}});return}i({id:s,storeWithStatus:{status:"loading"}});const a=c=>{i(u=>(u==null?void 0:u.id)===s?{id:s,storeWithStatus:c}:u)},l=new w$(o,{sessionId:e,persistenceKey:n,onLoad(){a({store:o,status:"synced-local"})},onLoadError(c){a({status:"error",error:c})}});return()=>{i(c=>(c==null?void 0:c.id)===s?null:c),l.close()}},[n,o,e]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let iI=!1;if(typeof window<"u"){const n=window.navigator.userAgent,e=!!n.match(/iPad/i)||!!n.match(/iPhone/i),t=!!n.match(/WebKit/i);iI=e&&t&&!n.match(/CriOS/i)}function _$(){const n=Y();S.useEffect(()=>{if(!iI)return;function e(t){(t.target instanceof HTMLInputElement&&t.target.type==="text"||t.target instanceof HTMLTextAreaElement)&&n.complete()}return document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)},[n])}function k$(){const n=Y(),e=pn();S.useEffect(()=>{const t=o=>e.style.setProperty("--tl-zoom",o.toString()),r=D2(t,100),i=new ol("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach()}},[n,e])}const C$=[],P$=[],E$=S.memo(function({store:n,components:e,className:t,user:r,...i}){const[o,s]=oe.useState(null),a=S.useMemo(()=>r??_E(),[r]),l=(e==null?void 0:e.ErrorFallback)===void 0?IP:e==null?void 0:e.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??C$,tools:i.tools??P$,components:e};return y.jsx("div",{ref:s,draggable:!1,className:we("tl-container tl-theme__light",t),onPointerDown:Ft,tabIndex:-1,children:y.jsx(_u,{fallback:l,onError:u=>xw(u,{tags:{origin:"react.tldraw-before-app"}}),children:o&&y.jsx(TN,{container:o,children:y.jsx(S6,{overrides:e,children:n?n instanceof G2?y.jsx(sI,{...c,store:n,user:a}):y.jsx(oI,{...c,store:n,user:a}):y.jsx(I$,{...c,store:n,user:a})})})})})});function I$(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:s,user:a}=n,l=x$({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:s,defaultName:e,snapshot:t});return y.jsx(oI,{...n,store:l,user:a})}const oI=S.memo(function({store:n,user:e,...t}){var i;const r=pn();switch(S.useLayoutEffect(()=>{e.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,e]),n.status){case"error":throw n.error;case"loading":{const o=((i=t.components)==null?void 0:i.LoadingScreen)??E9;return y.jsx(o,{})}}return y.jsx(sI,{...t,store:n.store,user:e})});function sI({onMount:n,children:e,store:t,tools:r,shapeUtils:i,user:o,initialState:s,autoFocus:a=!0,inferDarkMode:l}){const{ErrorFallback:c}=$t(),u=pn(),[d,h]=S.useState(null);S.useLayoutEffect(()=>{const g=new he({store:t,shapeUtils:i,tools:r,getContainer:()=>u,user:o,initialState:s,inferDarkMode:l});return window.app=g,window.editor=g,h(g),()=>{g.dispose()}},[u,i,r,t,o,s,l]);const p=S.useSyncExternalStore(S.useCallback(g=>d?(d.on("crash",g),()=>d.off("crash",g)):()=>{},[d]),()=>(d==null?void 0:d.getCrashingError())??null);return d?y.jsx(_u,{fallback:c,onError:g=>d.annotateError(g,{origin:"react.tldraw",willCrashApp:!0}),children:p?y.jsx(T$,{crashingError:p}):y.jsx(Ww.Provider,{value:d,children:y.jsx(M$,{autoFocus:a,onMount:n,children:e})})}):null}function M$({children:n,onMount:e,autoFocus:t}){return k$(),L7(),z7(),_$(),$7(),F7(t),j$(e),t9(),Y().updateViewportScreenBounds(),n??y.jsx(ab,{})}function T$({crashingError:n}){throw n}function aI({children:n}){const{Spinner:e}=$t();return y.jsxs("div",{className:"tl-loading",children:[e?y.jsx(e,{}):null,n]})}function A$({children:n}){return y.jsx("div",{className:"tl-loading",children:n})}function j$(n){const e=Y(),t=N7(r=>{const i=n==null?void 0:n(r);return r.emit("mount"),window.tldrawReady=!0,i});oe.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function aa({children:n,className:e="",...t}){return y.jsx("div",{...t,className:`tl-html-container ${e}`,children:n})}ze(function({x:n=0,y:e=0,rotation:t=0,...r}){const i=Y(),o=S.useRef(null),s=i.getCamera();return S.useLayoutEffect(()=>{const{x:a,y:l,z:c}=i.getCamera(),u=o.current;u&&a!==void 0&&(u.style.transform=`translate(${a}px, ${l}px) scale(${c}) rotate(${t}rad) translate(${n}px, ${e}px)`)},[s,i,n,e,t]),y.jsx("div",{ref:o,...r,className:we("tl-positioned",r.className)})});function lI(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let d=n.props.w*o,h=n.props.h*s;const p=new P(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(n.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,d),h:Math.min(u,h)}}}class Tl extends ti{constructor(){super(...arguments);w(this,"onResize",(t,r)=>lI(t,r))}getGeometry(t){return new ss({width:t.props.w,height:t.props.h,isFilled:!0})}}let R$=(Sx=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Sx,"id","idle"),Sx),O$=(xx=class extends se{constructor(){super(...arguments);w(this,"markId","");w(this,"wasFocusedOnEnter",!1);w(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});w(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,i=tt();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:r,x:t.x,y:t.y,props:{w:1,h:1}}]).select(i),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const t=this.parent.shapeType,r=tt();this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(r),{w:o,h:s}=this.editor.getShapeUtil(i).getDefaultProps(),a=new P(o/2,s/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:r,type:t,x:i.x-a.x,y:i.y-a.y}]),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},w(xx,"id","pointing"),xx);class Pf extends se{constructor(){super(...arguments);w(this,"onCreate")}}w(Pf,"id","box"),w(Pf,"initial","idle"),w(Pf,"children",()=>[R$,O$]);function cI(n,e){const t=S.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}function uI(n){return cI(n,jL)}function D$(n){return cI(n,V2)}function dI(n){const e=Y();return Z("isCropping",()=>e.getCroppingShapeId()===n,[e,n])}function Ef(n){const e=Y();return Z("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function Ti(n){const e=Y();return S.useMemo(function(){const t=s=>{if(s.isKilled)return;if(s.button===2){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Kn(s)});return}if(s.button!==0)return;const a=Yp(s.currentTarget);function l(){a.removeEventListener("pointerup",l),Su(a,s)}vu(a,s),a.addEventListener("pointerup",l),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Kn(s)}),Ft(s)};let r,i;function o(s){s.isKilled||s.button===0&&(s.clientX===r&&s.clientY===i||(r=s.clientX,i=s.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Kn(s)})))}return{onPointerDown:t,onPointerMove:o,onPointerUp:s=>{s.isKilled||s.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Kn(s)})}}},[e,n])}const L$=20,z$=8;function Pb(n,e=L$){return Math.max(z$,Math.ceil(n/e))}class N$ extends na{constructor(t){super({...t,isFilled:!1,isClosed:!1});w(this,"_center");w(this,"radius");w(this,"start");w(this,"end");w(this,"measure");w(this,"length");w(this,"angleStart");w(this,"angleEnd");const{center:r,radius:i,sweepFlag:o,largeArcFlag:s,start:a,end:l}=t;if(a.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=P.Angle(r,a),this.angleEnd=P.Angle(r,l),this.measure=F$(this.angleStart,this.angleEnd,o,s),this.length=this.measure*i,this.start=a,this.end=l,this._center=r,this.radius=i}nearestPoint(t){const{_center:r,measure:i,radius:o,angleEnd:s,angleStart:a,start:l,end:c}=this,u=hI(i,a,s,r.angle(t));if(u<=0)return l;if(u>=1)return c;const d=r.clone().add(t.clone().sub(r).uni().mul(o));let h=1/0,p;for(const g of[l,c,d])t.dist(g)<h&&(p=g,h=t.dist(g));if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(t,r,i){const{_center:o,radius:s,measure:a,angleStart:l,angleEnd:c}=this,u=df(t,r,o,s);return u===null?!1:u.some(d=>{const h=hI(a,l,c,o.angle(d));return h>=0&&h<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:o,angleStart:s}=this,a=[];for(let l=0,c=Pb(Math.abs(i));l<c+1;l++){const u=l/c*r,d=s+u;a.push(t.clone().add(new P(Math.cos(d),Math.sin(d)).mul(o)))}return a}}function hI(n,e,t,r){let i;if(Math.abs(n)>Fe){i=Eu(e,r);const o=Eu(r,t);return Math.abs(i)<Math.abs(o)?i/n:(n-o)/n}else return i=Eu(e,r),i/n}function F$(n,e,t,r){const i=2*((e-n)%We)%We-(e-n)%We;return r?(We-Math.abs(i))*(t?1:-1):i}class pI extends na{constructor(t){super({isClosed:!0,...t});w(this,"_center");w(this,"radius");w(this,"x");w(this,"y");this.config=t;const{x:r=0,y:i=0,radius:o}=t;this.x=r,this.y=i,this._center=new P(o+r,o+i),this.radius=o}getBounds(){return new de(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=We*r,o=[];for(let s=0,a=Pb(i);s<a;s++){const l=s/a*We;o.push(t.clone().add(P.FromAngle(l).mul(r)))}return o}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?P.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i){const{_center:o,radius:s}=this;return df(t,r,o,s)!==null}}class $$ extends ra{constructor(t){const{start:r,cp1:i,cp2:o,end:s}=t;super({...t,points:[r,s]});w(this,"a");w(this,"b");w(this,"c");w(this,"d");this.a=r,this.b=i,this.c=o,this.d=s}getVertices(){const t=[],{a:r,b:i,c:o,d:s}=this;for(let a=0,l=10;a<=l;a++){const c=a/l;t.push(new P((1-c)*(1-c)*(1-c)*r.x+3*((1-c)*(1-c))*c*i.x+3*(1-c)*(c*c)*o.x+c*c*c*s.x,(1-c)*(1-c)*(1-c)*r.y+3*((1-c)*(1-c))*c*i.y+3*(1-c)*(c*c)*o.y+c*c*c*s.y))}return t}midPoint(){return B$(this,.5)}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}}function B$(n,e){const{a:t,b:r,c:i,d:o}=n;return new P((1-e)*(1-e)*(1-e)*t.x+3*((1-e)*(1-e))*e*r.x+3*(1-e)*(e*e)*i.x+e*e*e*o.x,(1-e)*(1-e)*(1-e)*t.y+3*((1-e)*(1-e))*e*r.y+3*(1-e)*(e*e)*i.y+e*e*e*o.y)}class If extends na{constructor(t){super({...t,isClosed:!1,isFilled:!1});w(this,"points");w(this,"_segments");w(this,"_length");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,o=1.25;for(let s=0;s<r-1;s++){const a=s===0?t[0]:t[s-1],l=t[s],c=t[s+1],u=s===i?c:t[s+2],d=l,h=s===0?a:new P(l.x+(c.x-a.x)/6*o,l.y+(c.y-a.y)/6*o),p=s===i?c:new P(c.x-(u.x-l.x)/6*o,c.y-(u.y-l.y)/6*o),g=c;this._segments.push(new $$({start:d,cp1:h,cp2:p,end:g}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((t,r)=>t+r.length,0)),this._length}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0;for(const o of this.segments){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.segments.some(o=>o.hitTestLineSegment(t,r,i))}}class fI extends na{constructor(t){super({...t,isClosed:!0});w(this,"w");w(this,"h");w(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const o=t[r],s=t[(r+1)%i];this._edges.push(new pf({start:o,end:s}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,o=r/2,s=Math.pow(i-o,2)/Math.pow(i+o,2),a=Fe*(i+o)*(1+3*s/(10+Math.sqrt(4-3*s))),l=Pb(a),c=We/l,u=Math.cos(c),d=Math.sin(c);let h=0,p=1,g=0,f=1;const m=Array(l);for(let v=0;v<l;v++)m[v]=new P(i+i*p,o+o*h),g=d*p+u*h,f=u*p-d*h,h=g,p=f;return m}nearestPoint(t){let r,i=1/0;for(const o of this.edges){const s=o.nearestPoint(t),a=s.dist(t);a<i&&(r=s,i=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r,i){return this.edges.some(o=>o.hitTestLineSegment(t,r,i))}getBounds(){return new de(0,0,this.w,this.h)}}class U$ extends fI{constructor(e){super({...e}),this.config=e}getVertices(){const e=Math.max(1,this.w),t=Math.max(1,this.h),r=e/2,i=t/2,o=10,s=Array(o*2-2);if(t>e)for(let a=0;a<o-1;a++){const l=-Fe+Fe*a/(o-2),c=Fe*a/(o-2);s[a]=new P(r+r*Math.cos(l),r+r*Math.sin(l)),s[a+(o-1)]=new P(r+r*Math.cos(c),t-r+r*Math.sin(c))}else for(let a=0;a<o-1;a++){const l=-rt+Fe*a/(o-2),c=rt+Fe*-a/(o-2);s[a]=new P(e-i+i*Math.cos(l),t-i+i*Math.sin(l)),s[a+(o-1)]=new P(i-i*Math.cos(c),t-i+i*Math.sin(c))}return s}}function gI(n,e){return n<0?1:n>e?-1:n<wl?(wl-n)/wl:n>e-wl?-(wl-e+n)/wl:0}function Eb(n){if(!n.inputs.isDragging||n.inputs.isPanning)return;const{inputs:{currentScreenPoint:{x:e,y:t}}}=n,r=n.getZoomLevel(),i=n.getViewportScreenBounds(),o=i.w<1e3?.612:1,s=i.h<1e3?.612:1,a=gI(e-i.x,i.w),l=gI(t-i.y,i.h);if(a===0&&l===0)return;const c=n.user.getEdgeScrollSpeed()*l6,u=c*a*o/r,d=c*l*s/r,h=n.getCamera();n.setCamera({x:h.x+u,y:h.y+d})}async function V$({shouldReload:n=!0}={}){sessionStorage.clear(),await Promise.all(Cb().map(e=>o$(e))),localStorage.clear(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=V$);function H$(n,e="_blank"){Yw.openWindow(n,e)}var Uu=function(n){return n&&n.Math===Math&&n},Yn=Uu(typeof globalThis=="object"&&globalThis)||Uu(typeof window=="object"&&window)||Uu(typeof self=="object"&&self)||Uu(typeof Ce=="object"&&Ce)||Uu(typeof Ce=="object"&&Ce)||function(){return this}()||Function("return this")(),Ib={},An=function(n){try{return!!n()}catch{return!0}},W$=An,us=!W$(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),K$=An,Mf=!K$(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),G$=Mf,Tf=Function.prototype.call,go=G$?Tf.bind(Tf):function(){return Tf.apply(Tf,arguments)},mI={},yI={}.propertyIsEnumerable,wI=Object.getOwnPropertyDescriptor,Y$=wI&&!yI.call({1:2},1);mI.f=Y$?function(n){var e=wI(this,n);return!!e&&e.enumerable}:yI;var bI=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}},vI=Mf,SI=Function.prototype,Mb=SI.call,X$=vI&&SI.bind.bind(Mb,Mb),Ut=vI?X$:function(n){return function(){return Mb.apply(n,arguments)}},xI=Ut,q$=xI({}.toString),Z$=xI("".slice),Al=function(n){return Z$(q$(n),8,-1)},J$=Ut,Q$=An,eB=Al,Tb=Object,tB=J$("".split),nB=Q$(function(){return!Tb("z").propertyIsEnumerable(0)})?function(n){return eB(n)==="String"?tB(n,""):Tb(n)}:Tb,Af=function(n){return n==null},rB=Af,iB=TypeError,jl=function(n){if(rB(n))throw new iB("Can't call method on "+n);return n},oB=nB,sB=jl,jf=function(n){return oB(sB(n))},Ab=typeof document=="object"&&document.all,jn=typeof Ab>"u"&&Ab!==void 0?function(n){return typeof n=="function"||n===Ab}:function(n){return typeof n=="function"},aB=jn,la=function(n){return typeof n=="object"?n!==null:aB(n)},jb=Yn,lB=jn,cB=function(n){return lB(n)?n:void 0},Rf=function(n,e){return arguments.length<2?cB(jb[n]):jb[n]&&jb[n][e]},uB=Ut,_I=uB({}.isPrototypeOf),dB=typeof navigator<"u"&&String(navigator.userAgent)||"",kI=Yn,Rb=dB,CI=kI.process,PI=kI.Deno,EI=CI&&CI.versions||PI&&PI.version,II=EI&&EI.v8,ri,Of;II&&(ri=II.split("."),Of=ri[0]>0&&ri[0]<4?1:+(ri[0]+ri[1])),!Of&&Rb&&(ri=Rb.match(/Edge\/(\d+)/),(!ri||ri[1]>=74)&&(ri=Rb.match(/Chrome\/(\d+)/),ri&&(Of=+ri[1])));var hB=Of,MI=hB,pB=An,fB=Yn,gB=fB.String,TI=!!Object.getOwnPropertySymbols&&!pB(function(){var n=Symbol("symbol detection");return!gB(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&MI&&MI<41}),mB=TI,AI=mB&&!Symbol.sham&&typeof Symbol.iterator=="symbol",yB=Rf,wB=jn,bB=_I,vB=AI,SB=Object,jI=vB?function(n){return typeof n=="symbol"}:function(n){var e=yB("Symbol");return wB(e)&&bB(e.prototype,SB(n))},xB=String,_B=function(n){try{return xB(n)}catch{return"Object"}},kB=jn,CB=_B,PB=TypeError,Ob=function(n){if(kB(n))return n;throw new PB(CB(n)+" is not a function")},EB=Ob,IB=Af,Db=function(n,e){var t=n[e];return IB(t)?void 0:EB(t)},Lb=go,zb=jn,Nb=la,MB=TypeError,TB=function(n,e){var t,r;if(e==="string"&&zb(t=n.toString)&&!Nb(r=Lb(t,n))||zb(t=n.valueOf)&&!Nb(r=Lb(t,n))||e!=="string"&&zb(t=n.toString)&&!Nb(r=Lb(t,n)))return r;throw new MB("Can't convert object to primitive value")},RI={exports:{}},OI=Yn,AB=Object.defineProperty,Fb=function(n,e){try{AB(OI,n,{value:e,configurable:!0,writable:!0})}catch{OI[n]=e}return e},jB=Yn,RB=Fb,DI="__core-js_shared__",LI=RI.exports=jB[DI]||RB(DI,{});(LI.versions||(LI.versions=[])).push({version:"3.36.1",mode:"global",copyright:"\xA9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"});var $b=RI.exports,zI=$b,Bb=function(n,e){return zI[n]||(zI[n]=e||{})},OB=jl,DB=Object,Vu=function(n){return DB(OB(n))},LB=Ut,zB=Vu,NB=LB({}.hasOwnProperty),ds=Object.hasOwn||function(n,e){return NB(zB(n),e)},FB=Ut,$B=0,BB=Math.random(),UB=FB(1 .toString),NI=function(n){return"Symbol("+(n===void 0?"":n)+")_"+UB(++$B+BB,36)},VB=Yn,HB=Bb,FI=ds,WB=NI,KB=TI,GB=AI,Rl=VB.Symbol,Ub=HB("wks"),YB=GB?Rl.for||Rl:Rl&&Rl.withoutSetter||WB,mo=function(n){return FI(Ub,n)||(Ub[n]=KB&&FI(Rl,n)?Rl[n]:YB("Symbol."+n)),Ub[n]},XB=go,$I=la,BI=jI,qB=Db,ZB=TB,JB=mo,QB=TypeError,eU=JB("toPrimitive"),tU=function(n,e){if(!$I(n)||BI(n))return n;var t=qB(n,eU),r;if(t){if(e===void 0&&(e="default"),r=XB(t,n,e),!$I(r)||BI(r))return r;throw new QB("Can't convert object to primitive value")}return e===void 0&&(e="number"),ZB(n,e)},nU=tU,rU=jI,UI=function(n){var e=nU(n,"string");return rU(e)?e:e+""},iU=Yn,VI=la,Vb=iU.document,oU=VI(Vb)&&VI(Vb.createElement),HI=function(n){return oU?Vb.createElement(n):{}},sU=us,aU=An,lU=HI,WI=!sU&&!aU(function(){return Object.defineProperty(lU("div"),"a",{get:function(){return 7}}).a!==7}),cU=us,uU=go,dU=mI,hU=bI,pU=jf,fU=UI,gU=ds,mU=WI,KI=Object.getOwnPropertyDescriptor;Ib.f=cU?KI:function(n,e){if(n=pU(n),e=fU(e),mU)try{return KI(n,e)}catch{}if(gU(n,e))return hU(!uU(dU.f,n,e),n[e])};var Ol={},yU=us,wU=An,GI=yU&&wU(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),bU=la,vU=String,SU=TypeError,ca=function(n){if(bU(n))return n;throw new SU(vU(n)+" is not an object")},xU=us,_U=WI,kU=GI,Df=ca,YI=UI,CU=TypeError,Hb=Object.defineProperty,PU=Object.getOwnPropertyDescriptor,Wb="enumerable",Kb="configurable",Gb="writable";Ol.f=xU?kU?function(n,e,t){if(Df(n),e=YI(e),Df(t),typeof n=="function"&&e==="prototype"&&"value"in t&&Gb in t&&!t[Gb]){var r=PU(n,e);r&&r[Gb]&&(n[e]=t.value,t={configurable:Kb in t?t[Kb]:r[Kb],enumerable:Wb in t?t[Wb]:r[Wb],writable:!1})}return Hb(n,e,t)}:Hb:function(n,e,t){if(Df(n),e=YI(e),Df(t),_U)try{return Hb(n,e,t)}catch{}if("get"in t||"set"in t)throw new CU("Accessors not supported");return"value"in t&&(n[e]=t.value),n};var EU=us,IU=Ol,MU=bI,Yb=EU?function(n,e,t){return IU.f(n,e,MU(1,t))}:function(n,e,t){return n[e]=t,n},XI={exports:{}},Xb=us,TU=ds,qI=Function.prototype,AU=Xb&&Object.getOwnPropertyDescriptor,qb=TU(qI,"name"),jU=qb&&(function(){}).name==="something",RU=qb&&(!Xb||Xb&&AU(qI,"name").configurable),OU={EXISTS:qb,PROPER:jU,CONFIGURABLE:RU},DU=Ut,LU=jn,Zb=$b,zU=DU(Function.toString);LU(Zb.inspectSource)||(Zb.inspectSource=function(n){return zU(n)});var ZI=Zb.inspectSource,NU=Yn,FU=jn,JI=NU.WeakMap,$U=FU(JI)&&/native code/.test(String(JI)),BU=Bb,UU=NI,QI=BU("keys"),eM=function(n){return QI[n]||(QI[n]=UU(n))},Jb={},VU=$U,tM=Yn,HU=la,WU=Yb,Qb=ds,ev=$b,KU=eM,GU=Jb,nM="Object already initialized",tv=tM.TypeError,YU=tM.WeakMap,Lf,Hu,zf,XU=function(n){return zf(n)?Hu(n):Lf(n,{})},qU=function(n){return function(e){var t;if(!HU(e)||(t=Hu(e)).type!==n)throw new tv("Incompatible receiver, "+n+" required");return t}};if(VU||ev.state){var Ai=ev.state||(ev.state=new YU);Ai.get=Ai.get,Ai.has=Ai.has,Ai.set=Ai.set,Lf=function(n,e){if(Ai.has(n))throw new tv(nM);return e.facade=n,Ai.set(n,e),e},Hu=function(n){return Ai.get(n)||{}},zf=function(n){return Ai.has(n)}}else{var Dl=KU("state");GU[Dl]=!0,Lf=function(n,e){if(Qb(n,Dl))throw new tv(nM);return e.facade=n,WU(n,Dl,e),e},Hu=function(n){return Qb(n,Dl)?n[Dl]:{}},zf=function(n){return Qb(n,Dl)}}var rM={set:Lf,get:Hu,has:zf,enforce:XU,getterFor:qU},nv=Ut,ZU=An,JU=jn,Nf=ds,rv=us,QU=OU.CONFIGURABLE,eV=ZI,iM=rM,tV=iM.enforce,nV=iM.get,oM=String,Ff=Object.defineProperty,rV=nv("".slice),iV=nv("".replace),oV=nv([].join),sV=rv&&!ZU(function(){return Ff(function(){},"length",{value:8}).length!==8}),aV=String(String).split("String"),lV=XI.exports=function(n,e,t){rV(oM(e),0,7)==="Symbol("&&(e="["+iV(oM(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Nf(n,"name")||QU&&n.name!==e)&&(rv?Ff(n,"name",{value:e,configurable:!0}):n.name=e),sV&&t&&Nf(t,"arity")&&n.length!==t.arity&&Ff(n,"length",{value:t.arity});try{t&&Nf(t,"constructor")&&t.constructor?rv&&Ff(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var r=tV(n);return Nf(r,"source")||(r.source=oV(aV,typeof e=="string"?e:"")),n};Function.prototype.toString=lV(function(){return JU(this)&&nV(this).source||eV(this)},"toString");var cV=XI.exports,uV=jn,dV=Ol,hV=cV,pV=Fb,sM=function(n,e,t,r){r||(r={});var i=r.enumerable,o=r.name!==void 0?r.name:e;if(uV(t)&&hV(t,o,r),r.global)i?n[e]=t:pV(e,t);else{try{r.unsafe?n[e]&&(i=!0):delete n[e]}catch{}i?n[e]=t:dV.f(n,e,{value:t,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return n},aM={},fV=Math.ceil,gV=Math.floor,mV=Math.trunc||function(n){var e=+n;return(e>0?gV:fV)(e)},yV=mV,ua=function(n){var e=+n;return e!==e||e===0?0:yV(e)},wV=ua,bV=Math.max,vV=Math.min,SV=function(n,e){var t=wV(n);return t<0?bV(t+e,0):vV(t,e)},xV=ua,_V=Math.min,lM=function(n){var e=xV(n);return e>0?_V(e,9007199254740991):0},kV=lM,Wu=function(n){return kV(n.length)},CV=jf,PV=SV,EV=Wu,cM=function(n){return function(e,t,r){var i=CV(e),o=EV(i);if(o===0)return!n&&-1;var s=PV(r,o),a;if(n&&t!==t){for(;o>s;)if(a=i[s++],a!==a)return!0}else for(;o>s;s++)if((n||s in i)&&i[s]===t)return n||s||0;return!n&&-1}},IV={includes:cM(!0),indexOf:cM(!1)},MV=Ut,iv=ds,TV=jf,AV=IV.indexOf,jV=Jb,uM=MV([].push),dM=function(n,e){var t=TV(n),r=0,i=[],o;for(o in t)!iv(jV,o)&&iv(t,o)&&uM(i,o);for(;e.length>r;)iv(t,o=e[r++])&&(~AV(i,o)||uM(i,o));return i},ov=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],RV=dM,OV=ov,DV=OV.concat("length","prototype");aM.f=Object.getOwnPropertyNames||function(n){return RV(n,DV)};var hM={};hM.f=Object.getOwnPropertySymbols;var LV=Rf,zV=Ut,NV=aM,FV=hM,$V=ca,BV=zV([].concat),UV=LV("Reflect","ownKeys")||function(n){var e=NV.f($V(n)),t=FV.f;return t?BV(e,t(n)):e},pM=ds,VV=UV,HV=Ib,WV=Ol,KV=function(n,e,t){for(var r=VV(e),i=WV.f,o=HV.f,s=0;s<r.length;s++){var a=r[s];!pM(n,a)&&!(t&&pM(t,a))&&i(n,a,o(e,a))}},GV=An,YV=jn,XV=/#|\.prototype\./,Ku=function(n,e){var t=ZV[qV(n)];return t===QV?!0:t===JV?!1:YV(e)?GV(e):!!e},qV=Ku.normalize=function(n){return String(n).replace(XV,".").toLowerCase()},ZV=Ku.data={},JV=Ku.NATIVE="N",QV=Ku.POLYFILL="P",eH=Ku,$f=Yn,tH=Ib.f,nH=Yb,rH=sM,iH=Fb,oH=KV,sH=eH,Ll=function(n,e){var t=n.target,r=n.global,i=n.stat,o,s,a,l,c,u;if(r?s=$f:i?s=$f[t]||iH(t,{}):s=$f[t]&&$f[t].prototype,s)for(a in e){if(c=e[a],n.dontCallGetSet?(u=tH(s,a),l=u&&u.value):l=s[a],o=sH(r?a:t+(i?".":"#")+a,n.forced),!o&&l!==void 0){if(typeof c==typeof l)continue;oH(c,l)}(n.sham||l&&l.sham)&&nH(c,"sham",!0),rH(s,a,c,n)}},fM={},aH=dM,lH=ov,cH=Object.keys||function(n){return aH(n,lH)},uH=us,dH=GI,hH=Ol,pH=ca,fH=jf,gH=cH;fM.f=uH&&!dH?Object.defineProperties:function(n,e){pH(n);for(var t=fH(e),r=gH(e),i=r.length,o=0,s;i>o;)hH.f(n,s=r[o++],t[s]);return n};var mH=Rf,yH=mH("document","documentElement"),wH=ca,bH=fM,gM=ov,vH=Jb,SH=yH,xH=HI,_H=eM,mM=">",yM="<",sv="prototype",av="script",wM=_H("IE_PROTO"),lv=function(){},bM=function(n){return yM+av+mM+n+yM+"/"+av+mM},vM=function(n){n.write(bM("")),n.close();var e=n.parentWindow.Object;return n=null,e},kH=function(){var n=xH("iframe"),e="java"+av+":",t;return n.style.display="none",SH.appendChild(n),n.src=String(e),t=n.contentWindow.document,t.open(),t.write(bM("document.F=Object")),t.close(),t.F},Bf,Uf=function(){try{Bf=new ActiveXObject("htmlfile")}catch{}Uf=typeof document<"u"?document.domain&&Bf?vM(Bf):kH():vM(Bf);for(var n=gM.length;n--;)delete Uf[sv][gM[n]];return Uf()};vH[wM]=!0;var SM=Object.create||function(n,e){var t;return n!==null?(lv[sv]=wH(n),t=new lv,lv[sv]=null,t[wM]=n):t=Uf(),e===void 0?t:bH.f(t,e)},CH=mo,PH=SM,EH=Ol.f,cv=CH("unscopables"),uv=Array.prototype;uv[cv]===void 0&&EH(uv,cv,{configurable:!0,value:PH(null)});var dv=function(n){uv[cv][n]=!0},IH=Ll,MH=Vu,TH=Wu,AH=ua,jH=dv;IH({target:"Array",proto:!0},{at:function(n){var e=MH(this),t=TH(e),r=AH(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:e[i]}}),jH("at");var RH=Yn,OH=Ut,Gu=function(n,e){return OH(RH[n].prototype[e])},DH=Gu;DH("Array","at");var LH=Al,xM=Array.isArray||function(n){return LH(n)==="Array"},zH=TypeError,NH=9007199254740991,FH=function(n){if(n>NH)throw zH("Maximum allowed index exceeded");return n},$H=Al,BH=Ut,UH=function(n){if($H(n)==="Function")return BH(n)},_M=UH,VH=Ob,HH=Mf,WH=_M(_M.bind),KH=function(n,e){return VH(n),e===void 0?n:HH?WH(n,e):function(){return n.apply(e,arguments)}},GH=xM,YH=Wu,XH=FH,qH=KH,kM=function(n,e,t,r,i,o,s,a){for(var l=i,c=0,u=s?qH(s,a):!1,d,h;c<r;)c in t&&(d=u?u(t[c],c,e):t[c],o>0&&GH(d)?(h=YH(d),l=kM(n,e,d,h,l,o-1)-1):(XH(l+1),n[l]=d),l++),c++;return l},CM=kM,ZH=mo,JH=ZH("toStringTag"),PM={};PM[JH]="z";var QH=String(PM)==="[object z]",eW=QH,tW=jn,Vf=Al,nW=mo,rW=nW("toStringTag"),iW=Object,oW=Vf(function(){return arguments}())==="Arguments",sW=function(n,e){try{return n[e]}catch{}},EM=eW?Vf:function(n){var e,t,r;return n===void 0?"Undefined":n===null?"Null":typeof(t=sW(e=iW(n),rW))=="string"?t:oW?Vf(e):(r=Vf(e))==="Object"&&tW(e.callee)?"Arguments":r},aW=Ut,lW=An,IM=jn,cW=EM,uW=Rf,dW=ZI,MM=function(){},TM=uW("Reflect","construct"),hv=/^\s*(?:class|function)\b/,hW=aW(hv.exec),pW=!hv.test(MM),Yu=function(n){if(!IM(n))return!1;try{return TM(MM,[],n),!0}catch{return!1}},AM=function(n){if(!IM(n))return!1;switch(cW(n)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return pW||!!hW(hv,dW(n))}catch{return!0}};AM.sham=!0;var fW=!TM||lW(function(){var n;return Yu(Yu.call)||!Yu(Object)||!Yu(function(){n=!0})||n})?AM:Yu,jM=xM,gW=fW,mW=la,yW=mo,wW=yW("species"),RM=Array,bW=function(n){var e;return jM(n)&&(e=n.constructor,gW(e)&&(e===RM||jM(e.prototype))?e=void 0:mW(e)&&(e=e[wW],e===null&&(e=void 0))),e===void 0?RM:e},vW=bW,OM=function(n,e){return new(vW(n))(e===0?0:e)},SW=Ll,xW=CM,_W=Vu,kW=Wu,CW=ua,PW=OM;SW({target:"Array",proto:!0},{flat:function(){var n=arguments.length?arguments[0]:void 0,e=_W(this),t=kW(e),r=PW(e,0);return r.length=xW(r,e,e,t,0,n===void 0?1:CW(n)),r}});var EW=dv;EW("flat");var IW=Gu;IW("Array","flat");var MW=Ll,TW=CM,AW=Ob,jW=Vu,RW=Wu,OW=OM;MW({target:"Array",proto:!0},{flatMap:function(n){var e=jW(this),t=RW(e),r;return AW(n),r=OW(e,0),r.length=TW(r,e,e,t,0,1,n,arguments.length>1?arguments[1]:void 0),r}});var DW=dv;DW("flatMap");var LW=Gu;LW("Array","flatMap");var zW=EM,NW=String,Xu=function(n){if(zW(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return NW(n)},FW=Ll,$W=Ut,BW=jl,UW=ua,VW=Xu,HW=An,WW=$W("".charAt),KW=HW(function(){return"\u{20BB7}".at(-2)!=="\uD842"});FW({target:"String",proto:!0,forced:KW},{at:function(n){var e=VW(BW(this)),t=e.length,r=UW(n),i=r>=0?r:t+r;return i<0||i>=t?void 0:WW(e,i)}});var GW=Gu;GW("String","at");var YW=ca,DM=function(){var n=YW(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},pv=An,XW=Yn,fv=XW.RegExp,gv=pv(function(){var n=fv("a","y");return n.lastIndex=2,n.exec("abcd")!==null}),qW=gv||pv(function(){return!fv("a","y").sticky}),ZW=gv||pv(function(){var n=fv("^r","gy");return n.lastIndex=2,n.exec("str")!==null}),JW={BROKEN_CARET:ZW,MISSED_STICKY:qW,UNSUPPORTED_Y:gv},QW=An,eK=Yn,tK=eK.RegExp,nK=QW(function(){var n=tK(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),rK=An,iK=Yn,oK=iK.RegExp,sK=rK(function(){var n=oK("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),zl=go,Hf=Ut,aK=Xu,lK=DM,cK=JW,uK=Bb,dK=SM,hK=rM.get,pK=nK,fK=sK,gK=uK("native-string-replace",String.prototype.replace),Wf=RegExp.prototype.exec,mv=Wf,mK=Hf("".charAt),yK=Hf("".indexOf),wK=Hf("".replace),yv=Hf("".slice),wv=function(){var n=/a/,e=/b*/g;return zl(Wf,n,"a"),zl(Wf,e,"a"),n.lastIndex!==0||e.lastIndex!==0}(),LM=cK.BROKEN_CARET,bv=/()??/.exec("")[1]!==void 0,bK=wv||bv||LM||pK||fK;bK&&(mv=function(n){var e=this,t=hK(e),r=aK(n),i=t.raw,o,s,a,l,c,u,d;if(i)return i.lastIndex=e.lastIndex,o=zl(mv,i,r),e.lastIndex=i.lastIndex,o;var h=t.groups,p=LM&&e.sticky,g=zl(lK,e),f=e.source,m=0,v=r;if(p&&(g=wK(g,"y",""),yK(g,"g")===-1&&(g+="g"),v=yv(r,e.lastIndex),e.lastIndex>0&&(!e.multiline||e.multiline&&mK(r,e.lastIndex-1)!==`
`)&&(f="(?: "+f+")",v=" "+v,m++),s=new RegExp("^(?:"+f+")",g)),bv&&(s=new RegExp("^"+f+"$(?!\\s)",g)),wv&&(a=e.lastIndex),l=zl(Wf,p?s:e,v),p?l?(l.input=yv(l.input,m),l[0]=yv(l[0],m),l.index=e.lastIndex,e.lastIndex+=l[0].length):e.lastIndex=0:wv&&l&&(e.lastIndex=e.global?l.index+l[0].length:a),bv&&l&&l.length>1&&zl(gK,l[0],s,function(){for(c=1;c<arguments.length-2;c++)arguments[c]===void 0&&(l[c]=void 0)}),l&&h)for(l.groups=u=dK(null),c=0;c<h.length;c++)d=h[c],u[d[0]]=l[d[1]];return l});var vv=mv,vK=Ll,zM=vv;vK({target:"RegExp",proto:!0,forced:/./.exec!==zM},{exec:zM});var SK=Mf,NM=Function.prototype,FM=NM.apply,$M=NM.call,xK=typeof Reflect=="object"&&Reflect.apply||(SK?$M.bind(FM):function(){return $M.apply(FM,arguments)}),BM=go,UM=sM,_K=vv,VM=An,HM=mo,kK=Yb,CK=HM("species"),Sv=RegExp.prototype,PK=function(n,e,t,r){var i=HM(n),o=!VM(function(){var c={};return c[i]=function(){return 7},""[n](c)!==7}),s=o&&!VM(function(){var c=!1,u=/a/;return n==="split"&&(u={},u.constructor={},u.constructor[CK]=function(){return u},u.flags="",u[i]=/./[i]),u.exec=function(){return c=!0,null},u[i](""),!c});if(!o||!s||t){var a=/./[i],l=e(i,""[n],function(c,u,d,h,p){var g=u.exec;return g===_K||g===Sv.exec?o&&!p?{done:!0,value:BM(a,u,d,h)}:{done:!0,value:BM(c,d,u,h)}:{done:!1}});UM(String.prototype,n,l[0]),UM(Sv,i,l[1])}r&&kK(Sv[i],"sham",!0)},xv=Ut,EK=ua,IK=Xu,MK=jl,TK=xv("".charAt),WM=xv("".charCodeAt),AK=xv("".slice),KM=function(n){return function(e,t){var r=IK(MK(e)),i=EK(t),o=r.length,s,a;return i<0||i>=o?n?"":void 0:(s=WM(r,i),s<55296||s>56319||i+1===o||(a=WM(r,i+1))<56320||a>57343?n?TK(r,i):s:n?AK(r,i,i+2):(s-55296<<10)+(a-56320)+65536)}},jK={codeAt:KM(!1),charAt:KM(!0)},RK=jK.charAt,OK=function(n,e,t){return e+(t?RK(n,e).length:1)},_v=Ut,DK=Vu,LK=Math.floor,kv=_v("".charAt),zK=_v("".replace),Cv=_v("".slice),NK=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,FK=/\$([$&'`]|\d{1,2})/g,GM=function(n,e,t,r,i,o){var s=t+n.length,a=r.length,l=FK;return i!==void 0&&(i=DK(i),l=NK),zK(o,l,function(c,u){var d;switch(kv(u,0)){case"$":return"$";case"&":return n;case"`":return Cv(e,0,t);case"'":return Cv(e,s);case"<":d=i[Cv(u,1,-1)];break;default:var h=+u;if(h===0)return c;if(h>a){var p=LK(h/10);return p===0?c:p<=a?r[p-1]===void 0?kv(u,1):r[p-1]+kv(u,1):c}d=r[h-1]}return d===void 0?"":d})},YM=go,$K=ca,BK=jn,UK=Al,VK=vv,HK=TypeError,WK=function(n,e){var t=n.exec;if(BK(t)){var r=YM(t,n,e);return r!==null&&$K(r),r}if(UK(n)==="RegExp")return YM(VK,n,e);throw new HK("RegExp#exec called on incompatible receiver")},KK=xK,XM=go,Kf=Ut,GK=PK,YK=An,XK=ca,qK=jn,ZK=Af,JK=ua,QK=lM,Nl=Xu,eG=jl,tG=OK,nG=Db,rG=GM,iG=WK,oG=mo,Pv=oG("replace"),sG=Math.max,aG=Math.min,lG=Kf([].concat),Ev=Kf([].push),qM=Kf("".indexOf),ZM=Kf("".slice),cG=function(n){return n===void 0?n:String(n)},uG=function(){return"a".replace(/./,"$0")==="$0"}(),JM=function(){return/./[Pv]?/./[Pv]("a","$0")==="":!1}(),dG=!YK(function(){var n=/./;return n.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(n,"$<a>")!=="7"});GK("replace",function(n,e,t){var r=JM?"$":"$0";return[function(i,o){var s=eG(this),a=ZK(i)?void 0:nG(i,Pv);return a?XM(a,i,s,o):XM(e,Nl(s),i,o)},function(i,o){var s=XK(this),a=Nl(i);if(typeof o=="string"&&qM(o,r)===-1&&qM(o,"$<")===-1){var l=t(e,s,a,o);if(l.done)return l.value}var c=qK(o);c||(o=Nl(o));var u=s.global,d;u&&(d=s.unicode,s.lastIndex=0);for(var h=[],p;p=iG(s,a),!(p===null||(Ev(h,p),!u));){var g=Nl(p[0]);g===""&&(s.lastIndex=tG(a,QK(s.lastIndex),d))}for(var f="",m=0,v=0;v<h.length;v++){p=h[v];for(var b=Nl(p[0]),_=sG(aG(JK(p.index),a.length),0),x=[],C,k=1;k<p.length;k++)Ev(x,cG(p[k]));var E=p.groups;if(c){var I=lG([b],x,_,a);E!==void 0&&Ev(I,E),C=Nl(KK(o,void 0,I))}else C=rG(b,a,_,x,E,o);_>=m&&(f+=ZM(a,m,_)+C,m=_+b.length)}return f+ZM(a,m)}]},!dG||!uG||JM);var hG=la,pG=Al,fG=mo,gG=fG("match"),mG=function(n){var e;return hG(n)&&((e=n[gG])!==void 0?!!e:pG(n)==="RegExp")},yG=go,wG=ds,bG=_I,vG=DM,QM=RegExp.prototype,SG=function(n){var e=n.flags;return e===void 0&&!("flags"in QM)&&!wG(n,"flags")&&bG(QM,n)?yG(vG,n):e},xG=Ll,_G=go,Iv=Ut,eT=jl,kG=jn,CG=Af,PG=mG,qu=Xu,EG=Db,IG=SG,MG=GM,TG=mo,AG=TG("replace"),jG=TypeError,Mv=Iv("".indexOf);Iv("".replace);var tT=Iv("".slice),RG=Math.max;xG({target:"String",proto:!0},{replaceAll:function(n,e){var t=eT(this),r,i,o,s,a,l,c,u,d,h=0,p=0,g="";if(!CG(n)){if(r=PG(n),r&&(i=qu(eT(IG(n))),!~Mv(i,"g")))throw new jG("`.replaceAll` does not allow non-global regexes");if(o=EG(n,AG),o)return _G(o,n,t,e)}for(s=qu(t),a=qu(n),l=kG(e),l||(e=qu(e)),c=a.length,u=RG(1,c),h=Mv(s,a);h!==-1;)d=l?qu(e(a,h,s)):MG(a,s,h,[],void 0,e),g+=tT(s,p,h)+d,p=h+c,h=h+u>s.length?-1:Mv(s,a,h+u);return p<s.length&&(g+=tT(s,p)),g}});var OG=Gu;OG("String","replaceAll");const DG=({children:n})=>{const e=Y();return Z("shouldDisplayHandles",()=>e.isInAny("select.idle","select.pointing_handle"),[e])?y.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null},LG=({shapeId:n})=>{const e=Y();return Z("show hovered",()=>e.isIn("select.editing_shape")?e.getHoveredShapeId()!==e.getEditingShapeId():e.isInAny("select.idle"),[e])?y.jsx(ku,{className:"tl-user-indicator__hovered",id:n}):null},{PI:zG}=Math,Fl=zG+1e-4;function nT(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],o=n[n.length-1],s=o.runningLength,a=Math.pow(t*r,2),l=[],c=[];let u=n[0].vector,d=n[0].point,h=d,p=d,g=h,f=!1,m;for(let v=0;v<n.length;v++){m=n[v];const{point:b,vector:_}=n[v],x=m.vector.dpr(u),C=(v<n.length-1?n[v+1]:n[v]).vector,k=v<n.length-1?C.dpr(m.vector):1,E=x<0&&!f,I=k!==null&&k<.2;if(E||I){if(k>-.62&&s-m.runningLength>m.radius){const A=u.clone().mul(m.radius);u.clone().cpr(C)<0?(p=P.Add(b,A),g=P.Sub(b,A)):(p=P.Sub(b,A),g=P.Add(b,A)),l.push(p),c.push(g)}else{const A=u.clone().mul(m.radius).per(),D=P.Sub(m.input,A);for(let N=1/13,U=0;U<1;U+=N)p=P.RotWith(D,m.input,Fl*U),l.push(p),g=P.RotWith(D,m.input,Fl+Fl*-U),c.push(g)}d=p,h=g,I&&(f=!0);continue}if(f=!1,m===i||m===o){const A=P.Per(_).mul(m.radius);l.push(P.Sub(b,A)),c.push(P.Add(b,A));continue}const T=P.Lrp(C,_,k).per().mul(m.radius);p=P.Sub(b,T),(v<=1||P.Dist2(d,p)>a)&&(l.push(p),d=p),g=P.Add(b,T),(v<=1||P.Dist2(h,g)>a)&&(c.push(g),h=g),u=_}return{left:l,right:c}}function Zu(n,e={}){const{size:t=16,start:r={},end:i={},last:o=!1}=e,{cap:s=!0}=r,{cap:a=!0}=i;if(n.length===0||t<=0)return[];const l=n[0],c=n[n.length-1],u=c.runningLength,d=r.taper===!1?0:r.taper===!0?Math.max(t,u):r.taper,h=i.taper===!1?0:i.taper===!0?Math.max(t,u):i.taper,{left:p,right:g}=nT(n,e),f=l.point,m=n.length>1?n[n.length-1].point:P.AddXY(l.point,1,1);if(n.length===1&&(!(d||h)||o)){const x=P.Add(f,P.Sub(f,m).uni().per().mul(-l.radius)),C=[];for(let k=1/13,E=k;E<=1;E+=k)C.push(P.RotWith(x,f,Fl*2*E));return C}const v=[];if(!(d||h&&n.length===1))if(s)for(let x=1/8,C=x;C<=1;C+=x){const k=P.RotWith(g[0],f,Fl*C);v.push(k)}else{const x=P.Sub(p[0],g[0]),C=P.Mul(x,.5),k=P.Mul(x,.51);v.push(P.Sub(f,C),P.Sub(f,k),P.Add(f,k),P.Add(f,C))}const b=[],_=c.vector.clone().per().neg();if(h||d&&n.length===1)b.push(m);else if(a){const x=P.Add(m,P.Mul(_,c.radius));for(let C=1/29,k=C;k<1;k+=C)b.push(P.RotWith(x,m,Fl*3*k))}else b.push(P.Add(m,P.Mul(_,c.radius)),P.Add(m,P.Mul(_,c.radius*.99)),P.Sub(m,P.Mul(_,c.radius*.99)),P.Sub(m,P.Mul(_,c.radius)));return p.concat(b,g.reverse(),v)}const NG=.025,FG=.01;function ii(n,e={}){var m;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const o=.15+(1-t)*.85;let s=n.map(P.From),a=0;if(!i){let v=s[0];for(;v&&!(v.z>=NG);)s.shift(),v=s[0]}if(!i){let v=s[s.length-1];for(;v&&!(v.z>=FG);)s.pop(),v=s[s.length-1]}if(s.length===0)return[{point:P.From(n[0]),input:P.From(n[0]),pressure:i?.5:.15,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let l=s[1];for(;l&&!(P.Dist(l,s[0])>r/3);)s[0].z=Math.max(s[0].z,l.z),s.splice(1,1),l=s[1];const c=s.pop();for(l=s[s.length-1];l&&!(P.Dist(l,c)>r/3);)s.pop(),l=s[s.length-1],a++;s.push(c);const u=e.last||!e.simulatePressure||s.length>1&&P.Dist(s[s.length-1],s[s.length-2])<r||a>0;if(s.length===2&&e.simulatePressure){const v=s[1];s=s.slice(0,-1);for(let b=1;b<5;b++){const _=P.Lrp(s[0],v,b/4);_.z=(s[0].z+(v.z-s[0].z))*b/4,s.push(_)}}const d=[{point:s[0],input:s[0],pressure:i?.5:s[0].z,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let h=0,p=d[0],g,f;u&&t>0&&s.push(s[s.length-1].clone());for(let v=1,b=s.length;v<b;v++)g=!o||e.last&&v===b-1?s[v].clone():s[v].clone().lrp(p.point,1-o),!p.point.equals(g)&&(f=P.Dist(g,p.point),h+=f,!(v<4&&h<r)&&(p={input:s[v],point:g,pressure:i?.5:s[v].z,vector:P.Sub(p.point,g).uni(),distance:f,runningLength:h,radius:1},d.push(p)));if((m=d[1])!=null&&m.vector&&(d[0].vector=d[1].vector.clone()),h<1){const v=Math.max(.5,...d.map(b=>b.pressure));d.forEach(b=>b.pressure=v)}return d}const{min:hs}=Math,Tv=.275;function $l(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:o=m=>m,start:s={},end:a={}}=e,{easing:l=fn.easeOutQuad}=s,{easing:c=fn.easeOutCubic}=a,u=n[n.length-1].runningLength;let d,h=n[0].pressure,p;if(!i&&u<t){const m=n.reduce((v,b)=>Math.max(v,b.pressure),.5);return n.forEach(v=>{v.pressure=m,v.radius=t*o(.5-r*(.5-v.pressure))}),n}else{let m;for(let v=0,b=n.length;v<b&&(p=n[v],!(p.runningLength>t*5));v++){const _=hs(1,p.distance/t);if(i){const x=hs(1,1-_);m=hs(1,h+(x-h)*(_*Tv))}else m=hs(1,h+(p.pressure-h)*.5);h=h+(m-h)*.5}for(let v=0;v<n.length;v++){if(p=n[v],r){let{pressure:b}=p;const _=hs(1,p.distance/t);if(i){const x=hs(1,1-_);b=hs(1,h+(x-h)*(_*Tv))}else b=hs(1,h+(b-h)*(_*Tv));p.radius=t*o(.5-r*(.5-b)),h=b}else p.radius=t/2;d===void 0&&(d=p.radius)}}const g=s.taper===!1?0:s.taper===!0?Math.max(t,u):s.taper,f=a.taper===!1?0:a.taper===!0?Math.max(t,u):a.taper;if(g||f)for(let m=0;m<n.length;m++){p=n[m];const{runningLength:v}=p,b=v<g?l(v/g):1,_=u-v<f?c((u-v)/f):1;p.radius=Math.max(.01,p.radius*Math.min(b,_))}return n}function $G(n,e={}){return Zu($l(ii(n,e),e),e)}const rT=({scribble:n,zoom:e,color:t,opacity:r,className:i})=>{if(!n.points.length)return null;const o=$G(n.points,{size:n.size/e,start:{taper:n.taper,easing:fn.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(o.length<4){const a=n.size/e/2,{x:l,y:c}=n.points[n.points.length-1];s=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=Au(o);return y.jsx("svg",{className:i&&we("tl-overlays__item",i),children:y.jsx("path",{className:"tl-scribble",d:s,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})},BG=({bounds:n,rotation:e})=>{const t=Y();return Z("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?y.jsx(RP,{bounds:n,rotation:e}):null};function Rr(){const n=Y();return Z("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function UG({size:n,width:e,height:t,hideAlternateHandles:r}){const i=O(n/3),o=i/2;return y.jsxs("svg",{className:"tl-overlays__item",children:[y.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${O(0-o)},${O(n)} 
						${O(0-o)},${O(0-o)} 
						${O(n)},${O(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),y.jsx("line",{className:we("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(e/2-n),y1:O(0-o),x2:O(e/2+n),y2:O(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),y.jsx("polyline",{className:we("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${O(e-n)},${O(0-o)} 
						${O(e+o)},${O(0-o)} 
						${O(e+o)},${O(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),y.jsx("line",{className:we("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(e+o),y1:O(t/2-n),x2:O(e+o),y2:O(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),y.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${O(e+o)},${O(t-n)} 
						${O(e+o)},${O(t+o)}
						${O(e-n)},${O(t+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),y.jsx("line",{className:we("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(e/2-n),y1:O(t+o),x2:O(e/2+n),y2:O(t+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),y.jsx("polyline",{className:we("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${O(0+n)},${O(t+o)} 
						${O(0-o)},${O(t+o)}
						${O(0-o)},${O(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),y.jsx("line",{className:we("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:O(0-o),y1:O(t/2-n),x2:O(0-o),y2:O(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const VG=ze(function({bounds:n,rotation:e}){const t=Y(),r=S.useRef(null),i=Rr(),o=Ti("top"),s=Ti("right"),a=Ti("bottom"),l=Ti("left"),c=Ti("top_left"),u=Ti("top_right"),d=Ti("bottom_right"),h=Ti("bottom_left"),p=!t.getIsMenuOpen()&&t.getInstanceState().cursor.type==="default",g=t.getInstanceState().isCoarsePointer,f=t.getOnlySelectedShape(),m=f&&t.isShapeOrAncestorLocked(f),v=f?t.getShapeUtil(f).expandSelectionOutlinePx(f):0;if(ml(r,n==null?void 0:n.x,n==null?void 0:n.y,1,t.getSelectionRotation(),{x:-v,y:-v}),!n)return null;n=n.clone().expandBy(v).zeroFix();const b=t.getZoomLevel(),_=t.getInstanceState().isChangingStyle,x=n.width,C=n.height,k=8/b,E=x<k*2,I=C<k*2,T=x<k*4,A=C<k*4,D=x<k*5,N=C<k*5,U=g?1.75:1,R=6/b*U,B=(T?R/2:R)*(U*.75),$=(A?R/2:R)*(U*.75),q=(f?!t.getShapeUtil(f).hideSelectionBoundsFg(f):!0)&&!_;let G=q&&t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||q&&t.isIn("select.resizing")&&f&&t.isShapeOfType(f,"text");f&&G&&t.environment.isFirefox&&t.isShapeOfType(f,"embed")&&(G=!1);const L=t.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!_&&!i,V=t.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!i,J=!g&&!(E||I)&&(V||L)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!m,le=g&&(!T||!A)&&(V||L)&&(f?!t.getShapeUtil(f).hideRotateHandle(f):!0)&&!m,me=V&&(f?t.getShapeUtil(f).canResize(f)&&!t.getShapeUtil(f).hideResizeHandles(f):!0)&&!L&&!m,ve=E||I,fe=E&&I,Pe=D||N,Rt=me||L,Ue=!J,Le=!V||!le,Ve=!V||!Rt,gi=!V||!Rt||ve,Zn=!V||!Rt||ve,Sr=!V||!Rt||fe&&!L;let Ot=g;Ot&&f&&f.type==="text"&&(Ot=!1);let Et=!0;L?Et=Pe:me&&(Et=ve||fe||Ot);const jo=Math.min(24/b,C-$*3),ih=V&&g&&f&&t.isShapeOfType(f,"text")&&jo*b>=4;return y.jsx("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:y.jsxs("g",{ref:r,children:[G&&y.jsx("rect",{className:we("tl-selection__fg__outline"),width:O(x),height:O(C)}),y.jsx(Gf,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:R,corner:"top_left_rotate",cursor:p?dr("nwse-rotate",e):void 0,isHidden:Ue}),y.jsx(Gf,{"data-testid":"selection.rotate.top-right",cx:x+R*3,cy:0,targetSize:R,corner:"top_right_rotate",cursor:p?dr("nesw-rotate",e):void 0,isHidden:Ue}),y.jsx(Gf,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:C+R*3,targetSize:R,corner:"bottom_left_rotate",cursor:p?dr("swne-rotate",e):void 0,isHidden:Ue}),y.jsx(Gf,{"data-testid":"selection.rotate.bottom-right",cx:x+R*3,cy:C+R*3,targetSize:R,corner:"bottom_right_rotate",cursor:p?dr("senw-rotate",e):void 0,isHidden:Ue}),y.jsx(WG,{"data-testid":"selection.rotate.mobile",cx:T?-R*1.5:x/2,cy:T?C/2:-R*1.5,size:k,isHidden:Le}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:O(0-(A?$*2:$)),width:O(x),height:O(Math.max(1,$*2)),style:p?{cursor:dr("ns-resize",e)}:void 0,...o}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:O(x-(T?0:B)),y:0,height:O(C),width:O(Math.max(1,B*2)),style:p?{cursor:dr("ew-resize",e)}:void 0,...s}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:O(C-(A?0:$)),width:O(x),height:O(Math.max(1,$*2)),style:p?{cursor:dr("ns-resize",e)}:void 0,...a}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Et}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:O(0-(T?B*2:B)),y:0,height:O(C),width:O(Math.max(1,B*2)),style:p?{cursor:dr("ew-resize",e)}:void 0,...l}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Ve}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:O(0-(T?B*2:B*1.5)),y:O(0-(A?$*2:$*1.5)),width:O(B*3),height:O($*3),style:p?{cursor:dr("nwse-resize",e)}:void 0,...c}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":gi}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:O(x-(T?0:B*1.5)),y:O(0-(A?$*2:$*1.5)),width:O(B*3),height:O($*3),style:p?{cursor:dr("nesw-resize",e)}:void 0,...u}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Sr}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:O(x-(T?B:B*1.5)),y:O(C-(A?$:$*1.5)),width:O(B*3),height:O($*3),style:p?{cursor:dr("nwse-resize",e)}:void 0,...d}),y.jsx("rect",{className:we("tl-transparent",{"tl-hidden":Zn}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:O(0-(T?B*3:B*1.5)),y:O(C-(A?0:$*1.5)),width:O(B*3),height:O($*3),style:p?{cursor:dr("nesw-resize",e)}:void 0,...h}),me&&y.jsxs(y.Fragment,{children:[y.jsx("rect",{"data-testid":"selection.resize.top-left",className:we("tl-corner-handle",{"tl-hidden":Ve}),"aria-label":"top_left handle",x:O(0-k/2),y:O(0-k/2),width:O(k),height:O(k)}),y.jsx("rect",{"data-testid":"selection.resize.top-right",className:we("tl-corner-handle",{"tl-hidden":gi}),"aria-label":"top_right handle",x:O(x-k/2),y:O(0-k/2),width:O(k),height:O(k)}),y.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:we("tl-corner-handle",{"tl-hidden":Sr}),"aria-label":"bottom_right handle",x:O(x-k/2),y:O(C-k/2),width:O(k),height:O(k)}),y.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:we("tl-corner-handle",{"tl-hidden":Zn}),"aria-label":"bottom_left handle",x:O(0-k/2),y:O(C-k/2),width:O(k),height:O(k)})]}),ih&&y.jsxs(y.Fragment,{children:[y.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:O(0-k/4),y:O(C/2-jo/2),rx:k/4,width:O(k/2),height:O(jo)}),y.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:k/4,x:O(x-k/4),y:O(C/2-jo/2),width:O(k/2),height:O(jo)})]}),L&&y.jsx(UG,{size:k,width:x,height:C,hideAlternateHandles:Pe})]})})}),Gf=function({cx:n,cy:e,targetSize:t,corner:r,cursor:i,isHidden:o,"data-testid":s}){const a=Ti(r);return y.jsx("rect",{className:we("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:O(n-t*3),y:O(e-t*3),width:O(Math.max(1,t*3)),height:O(Math.max(1,t*3)),cursor:i,...a})},HG=Math.sqrt(Math.PI),WG=function({cx:n,cy:e,size:t,isHidden:r,"data-testid":i}){const o=Ti("mobile_rotate"),s=Y(),a=Z("zoom level",()=>s.getZoomLevel(),[s]),l=Math.max(14*(1/a),20/Math.max(1,a));return y.jsxs("g",{children:[y.jsx("circle",{"data-testid":i,pointerEvents:"all",className:we("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:n,cy:e,r:l,...o}),y.jsx("circle",{className:we("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:n,cy:e,r:t/HG})]})},Jt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},yn={s:2,m:3.5,l:5,xl:10},ps={s:18,m:24,l:36,xl:44},Bl={s:18,m:22,l:26,xl:32},fs={s:18,m:20,l:24,xl:28},yo={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};var iT={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():e.downscale=t()})(Ce,function(){function e(I,v,b,_,x,C,k,E){var I=document.createElement("canvas");I.width=b,I.height=_;var T=I.getContext("2d");return T.mozImageSmoothingEnabled=!0,T.imageSmoothingQuality="high",T.webkitImageSmoothingEnabled=!0,T.msImageSmoothingEnabled=!0,T.imageSmoothingEnabled=!0,T.drawImage(v,x,C,k,E,0,0,b,_),I}function t(m){return m+.49<<0}function r(m,v,b,_,x,C,k){for(var E=new ImageData(v,b),I=new Int32Array(m.data.buffer),T=m.width,A=new Int32Array(E.data.buffer),D=E.width,N=v/C,U=b/k,R=t(1/N),B=t(1/U),$=R*B,q=0;q<E.height;q++)for(var G=0;G<D;G++){for(var L=_+t(G/N)+(x+t(q/U))*T,V=0,J=0,le=0,me=0,ve=0;ve<B;ve++)for(var fe=0;fe<R;fe++){var Pe=I[L+fe+ve*T];V+=Pe<<24>>>24,J+=Pe<<16>>>24,le+=Pe<<8>>>24,me+=Pe>>>24}V=t(V/$),J=t(J/$),le=t(le/$),me=t(me/$),A[G+q*D]=me<<24|le<<16|J<<8|V}return E}function i(m,v,b,_){var x=new Date,C={},k=x,E="01";return{mark:m?function(I){I=E+". "+(I||"..."),C[I]={"time (ms)":new Date-k},k=new Date,E=("0"+((E>>0)+1)).substr(-2)}:new Function,finish:m?function(){C[E+" TOTAL"]={"time (ms)":new Date-x},console.log("IMAGE SOURCE:",v),console.log("DOWNSCALE TO:",b+"x"+_),console.table(C)}:new Function}}function o(){var m=[],v=[],b=[],_=new Object;return{createSetter:function(x){if(!this.get(x)){var C=m.push(x)-1;return v.push(_),b.push([]),function(k){v[C]=k,b[C]=b[C].reduce(function(E,I){I(k)},[])}}},get:function(x,C){var k=m.indexOf(x);if(~k){if(v[k]===_){b[k].push(C);return}C(v[k])}},has:function(x){return!!~m.indexOf(x)}}}function s(m,v,b,_){m.width=b,m.height=_;var x=m.getContext("2d");return x.drawImage(v,0,0),x.getImageData(0,0,b,_)}function a(m,v){m.width=v.width,m.height=v.height;var b=m.getContext("2d");return b.putImageData(v,0,0),m}function l(m,v,A,D,x,C){var k=x,E=C,I=x/C;m===0&&(m=v*I>>0),v===0&&(v=m/I>>0);var T=m/v;T>I?C=x/T>>0:x=C*T>>0;var A=A||(k-x)/2>>0,D=D||(E-C)/2>>0;return{destWidth:m,destHeight:v,sourceX:A,sourceY:D,sourceWidth:x,sourceHeight:C}}function c(m,v,b){if(v.returnCanvas){b(m);return}if(v.returnBlob){m.toBlob(b,"image/"+(v.imageType||"jpeg"),v.quality||.85);return}var _=m.toDataURL("image/"+(v.imageType||"jpeg"),v.quality||.85);b(_)}function u(m,v){var b=new XMLHttpRequest;b.open("GET",m),b.responseType="arraybuffer",b.addEventListener("load",function(){v(this.response)}),b.send()}function d(m,v){m.complete?v():m.addEventListener("load",v)}function h(m,v){m.readyState>1?v():m.addEventListener("loadeddata",v)}function p(m){if(m instanceof File)return"File";if(m instanceof HTMLImageElement)return"HTMLImageElement";if(m instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof m=="string")return"URL"}function g(m){if(m.length<3)return new TypeError("3 arguments required, but only "+m.length+" present.");if(!p(m[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof m[1]!="number")return new TypeError("Second argument should be a number");if(typeof m[2]!="number")return new TypeError("Third argument should be a number")}function f(m,v,b,_){var x=i(_&&_.debug||!1,m,v,b),C=g(arguments);if(C instanceof TypeError)return Promise.reject(C);_=_||{};var k,E=new Promise(function(U,R){k=U});f.canvas=f.canvas||document.createElement("canvas"),f.cache=f.cache||o();var I=f.canvas,T=f.cache;if(T.has(m))return x.mark(),T.get(m,function(U){x.mark("PENDING CACHE");var R=U[0],B=U[1],$=l(v,b,_.sourceX,_.sourceY,B.width,B.height);if($.sourceWidth/$.destWidth>=2&&$.sourceHeight/$.destHeight>=2){x.mark();var q=r(B,$.destWidth,$.destHeight,$.sourceX,$.sourceY,$.sourceWidth,$.sourceHeight);x.mark("DOWNSCALE"),I=a(I,q)}else I=e(I,R,$.destWidth,$.destHeight,$.sourceX,$.sourceY,$.sourceWidth,$.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(G){x.mark("PRODUCE RESULT"),k(G),x.finish()})}),E;var A=function(U,R,B){var $=l(v,b,_.sourceX,_.sourceY,R,B);if($.sourceWidth/$.destWidth>=2&&$.sourceHeight/$.destHeight>=2){x.mark();var q=s(I,U,R,B);x.mark("GET IMAGE DATA");var G=r(q,$.destWidth,$.destHeight,$.sourceX,$.sourceY,$.sourceWidth,$.sourceHeight);x.mark("DOWNSCALE"),I=a(I,G),p(U)!=="HTMLVideoElement"&&T.createSetter(U)([U,q])}else I=e(I,U,$.destWidth,$.destHeight,$.sourceX,$.sourceY,$.sourceWidth,$.sourceHeight),x.mark("RESIZE WITH CANVAS");c(I,_,function(L){x.mark("PRODUCE RESULT"),k(L),x.finish()})},D=window.URL||window.webkitURL;switch(p(m)){case"File":var N=document.createElement("img");x.mark(),N.src=D.createObjectURL(m),x.mark("READ FILE"),d(N,function(){x.mark("LOAD IMAGE"),A(N,N.naturalWidth,N.naturalHeight)});break;case"HTMLImageElement":x.mark(),d(m,function(){x.mark("LOAD IMAGE"),A(m,m.naturalWidth,m.naturalHeight)});break;case"HTMLVideoElement":h(m,function(){A(m,m.videoWidth,m.videoHeight)});break;case"URL":x.mark(),setTimeout(function(){u(m,function(U){x.mark("LOAD ARRAY BUFFER");var R=new Uint8Array(U),B=new Blob([R],{type:"image/jpeg"}),$=document.createElement("img");$.src=D.createObjectURL(B),x.mark(),d($,function(){x.mark("LOAD IMAGE"),A($,$.naturalWidth,$.naturalHeight)})})});break}return E}return f})})(iT);var KG=iT.exports;const GG=Jn(KG);function YG(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(r=o.call(t)).done)&&(a.push(r.value),a.length!==e);l=!0);}catch(u){c=!0,i=u}finally{try{if(!l&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}function oT(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function hr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?oT(Object(t),!0).forEach(function(r){XG(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):oT(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function XG(n,e,t){return e=iY(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function qG(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function ZG(n,e){if(n==null)return{};var t=qG(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function sT(n,e){return QG(n)||YG(n,e)||aT(n,e)||nY()}function Yf(n){return JG(n)||eY(n)||aT(n)||tY()}function JG(n){if(Array.isArray(n))return Av(n)}function QG(n){if(Array.isArray(n))return n}function eY(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function aT(n,e){if(n){if(typeof n=="string")return Av(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Av(n,e)}}function Av(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function tY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rY(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function iY(n){var e=rY(n,"string");return typeof e=="symbol"?e:String(e)}function Ju(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],o=Date.now(),s=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,l;s?(a=new OffscreenCanvas(1,1),l=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,l=document.createElement("canvas"),l.width=t,l.height=r);var c=a.getContext("2d"),u=l.getContext("2d");u&&(u.fillRect.apply(u,i),c.drawImage(l,t-1,r-1,1,1,0,0,1,1));var d=c&&c.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-o;return[a,l].forEach(function(p){p.height=0,p.width=0}),s?(postMessage({width:t,height:r,benchmark:h,isTestPass:d}),!d&&n.sizes.length&&Ju(n)):d?n.onSuccess(t,r,h):(n.onError(t,r,h),n.sizes.length&&Ju(n)),d}var jv={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},oY=["onError","onSuccess"],Ul={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Qu={};function Rv(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(u){var d=e||t?u:1,h=e||r?u:1;i.push([d,h])});else for(var o=n.min||Ul.min,s=n.step||Ul.step,a=Math.max(n.width,n.height);a>=o;){var l=e||t?a:1,c=e||r?a:1;i.push([l,c]),a-=s}return i}function Xf(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),i=n.onError,o=n.onSuccess,s=ZG(n,oY),a=null;if(!e)return!1;if(n.useWorker&&t){var l=`
            var canvasTest = `.concat(Ju.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),c=new Blob([l],{type:"application/javascript"}),u=URL.createObjectURL(c);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(d){var h=d.data,p=h.width,g=h.height,f=h.benchmark,m=h.isTestPass;m?(Qu[r].onSuccess(p,g,f),delete Qu[r]):Qu[r].onError(p,g,f)}}if(n.usePromise)return new Promise(function(d,h){var p=hr(hr({},n),{},{onError:function(m,v,b){var _;if(n.sizes.length===0)_=!0;else{var x=n.sizes.slice(-1),C=sT(x,1),k=sT(C[0],2),E=k[0],I=k[1];_=m===E&&v===I}i(m,v,b),_&&h({width:m,height:v,benchmark:b})},onSuccess:function(m,v,b){o(m,v,b),d({width:m,height:v,benchmark:b})}});if(a){var g=p.onError,f=p.onSuccess;Qu[r]={onError:g,onSuccess:f},a.postMessage(s)}else Ju(p)});if(a)Qu[r]={onError:i,onSuccess:o},a.postMessage(s);else return Ju(n)}var Ov={maxArea:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rv({width:n.max,height:n.max,min:n.min,step:n.step,sizes:Yf(jv.area)}),t=hr(hr(hr({},Ul),n),{},{sizes:e});return Xf(t)},maxHeight:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rv({width:1,height:n.max,min:n.min,step:n.step,sizes:Yf(jv.height)}),t=hr(hr(hr({},Ul),n),{},{sizes:e});return Xf(t)},maxWidth:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Rv({width:n.max,height:1,min:n.min,step:n.step,sizes:Yf(jv.width)}),t=hr(hr(hr({},Ul),n),{},{sizes:e});return Xf(t)},test:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=hr(hr({},Ul),n);return e.sizes=Yf(e.sizes),e.width&&e.height&&(e.sizes=[[e.width,e.height]]),Xf(e)}};let Dv=null;function lT(){return Dv||(Dv=sY()),Dv}async function sY(){const n=await Ov.maxWidth({usePromise:!0}),e=await Ov.maxHeight({usePromise:!0}),t=await Ov.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}function cT(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function aY(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function lY(n){const e=new Uint8Array(n);let t,r,i=0,o=0;if(!aY(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;o<2&&i<e.length;)switch(e[i]){case 44:o+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=cT(e,i+1)+1;break;case 33:i+=2,i+=cT(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return o>1}function cY(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}async function uY(n,e,t,r={}){let i=e*2,o=t*2;const{type:s="image/jpeg",quality:a=.92}=r,l=await lT(),c=e/t;if(i>l.maxWidth&&(i=l.maxWidth,o=i/c),o>l.maxHeight&&(o=l.maxHeight,i=o*c),i*o>l.maxArea){const u=Math.sqrt(l.maxArea/(i*o));i*=u,o*=u}return await GG(n,i,o,{imageType:s.replace("image/",""),quality:a})}async function dY(n){return await new Promise((e,t)=>{const r=new FileReader;r.onerror=()=>t(r.error),r.onload=()=>{e(r.result?lY(r.result):!1)},r.readAsArrayBuffer(n)})}function hY(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function pY(n){const e=new URL(n).host.replace("www.","");for(const t of fl)if(uT(t.hostnames,e)){const r=t.fromEmbedUrl(n);if(r)return{definition:t,url:r,embedUrl:n}}}const fY=n=>n.split("*").map(e=>hY(e)).join(".+"),uT=(n,e)=>!!n.find(t=>{const r=new RegExp(fY(t));return e.match(r)});function gY(n){const e=new URL(n).host.replace("www.","");for(const t of fl)if(uT(t.hostnames,e)){const r=t.toEmbedUrl(n);if(r)return{definition:t,embedUrl:r,url:n}}}function dT(n){return gY(n)??pY(n)}function wo(n){try{return dT(n)}catch(e){console.error(e)}}const Vl="  ",Dn=class Dn{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||Dn.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),Dn.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:o}=e,s=Dn.getSelection(e);Dn.insert(e,t+s+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(o||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...o)=>{const s=i+o[o.length-2],a=o[0].length;e.selectionStart=s,e.selectionEnd=s+a;const l=typeof r=="string"?r:r(...o);return Dn.insert(e,l),e.selectionStart=s,i+=l.length-a,l})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.slice(t,r),s=(a=/\n/g.exec(o))==null?void 0:a.length;if(s&&s>0){const l=i.lastIndexOf(`
`,t-1)+1,c=e.value.slice(l,r-1),u=c.replace(/^|\n/g,`$&${Vl}`),d=u.length-c.length;e.setSelectionRange(l,r-1),Dn.insert(e,u),e.setSelectionRange(t+1,r+d)}else Dn.insert(e,Vl)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,o=i.lastIndexOf(`
`,t-1)+1,s=Dn.findLineEnd(i,r),a=e.value.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(o,s),Dn.insert(e,l);const u=/\t| {1,2}/.exec(i.slice(o,t)),d=u?u[0].length:0,h=t-d;e.setSelectionRange(t-d,Math.max(h,r-c))}static indentCE(e){var l;const t=window.getSelection(),r=e.innerText,i=qf(e)??0,o=qf(e)??0,s=r.slice(i,o),a=(l=/\n/g.exec(s))==null?void 0:l.length;if(a&&a>0){const c=r.lastIndexOf(`
`,i-1)+1,u=r.slice(c,o-1),d=u.replace(/^|\n/g,`$&${Vl}`).length-u.length;t&&t.setBaseAndExtent(e,i+1,e,o+d)}else{const c=window.getSelection();e.innerText=r.slice(0,i)+Vl+r.slice(i),c==null||c.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=qf(e)??0,o=qf(e)??0,s=r.lastIndexOf(`
`,i-1)+1,a=Dn.findLineEnd(r,o),l=r.slice(s,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=l.length-c.length;if(t){t.setBaseAndExtent(e,s,e,a);const d=/\t| {1,2}/.exec(r.slice(s,i)),h=d?d[0].length:0,p=i-h;t.setBaseAndExtent(e,i-h,e,Math.max(p,o-u))}}static normalizeText(e){return e.replace(Dn.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Dn.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};w(Dn,"fixNewLines",/\r?\n|\r/g);let gs=Dn;function qf(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const mY=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function yY(n){return mY.test(n)}function wY(n){return n.replace(/\t/g,Vl)}function bY(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}function vY(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function SY(n){return vY(bY(wY(n)))}const ed=(n,e)=>n.length<=e?n:n.substring(0,e-3)+"...";function xY(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i}){n.registerExternalAssetHandler("file",async({file:o})=>await new Promise((s,a)=>{!r.includes(o.type)&&!i.includes(o.type)&&(console.warn(`File type not allowed: ${o.type}`),a()),o.size>t&&(console.warn(`File size too big: ${(o.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),a());const l=new FileReader;l.onerror=()=>a(l.error),l.onload=async()=>{let c=l.result;o.type==="video/quicktime"&&c.includes("video/quicktime")&&(c=c.replace("video/quicktime","video/mp4"));const u=r.includes(o.type);let d,h;if(u?(d=await F2.getImageSizeFromSrc(c),h=o.type==="image/gif"&&await dY(o)):(h=!0,d=await F2.getVideoSizeFromSrc(c)),isFinite(e)){const f=cY(d,{w:e,h:e});d!==f&&(o.type==="image/jpeg"||o.type==="image/png")&&(d=f)}(o.type==="image/jpeg"||o.type==="image/png")&&(c=await uY(c,d.w,d.h,{type:o.type,quality:.92}));const p=Js.createId(Ip(c)),g=Js.create({id:p,type:u?"image":"video",typeName:"asset",props:{name:o.name,src:c,w:d.w,h:d.h,mimeType:o.type,isAnimated:h}});s(g)},l.readAsDataURL(o)})),n.registerExternalAssetHandler("url",async({url:o})=>{var a,l,c;let s;try{const u=await(await fetch(o,{method:"GET",mode:"no-cors"})).text(),d=new DOMParser().parseFromString(u,"text/html");s={image:((a=d.head.querySelector('meta[property="og:image"]'))==null?void 0:a.getAttribute("content"))??"",title:((l=d.head.querySelector('meta[property="og:title"]'))==null?void 0:l.getAttribute("content"))??ed(o,32),description:((c=d.head.querySelector('meta[property="og:description"]'))==null?void 0:c.getAttribute("content"))??""}}catch(u){console.error(u),s={image:"",title:ed(o,32),description:""}}return{id:Js.createId(Ip(o)),typeName:"asset",type:"bookmark",props:{src:o,description:s.description,image:s.image,title:s.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new DOMParser().parseFromString(s,"image/svg+xml").querySelector("svg");if(!l)throw new Error("No <svg/> element present");let c=parseFloat(l.getAttribute("width")||"0"),u=parseFloat(l.getAttribute("height")||"0");if(!(c&&u)){document.body.appendChild(l);const h=l.getBoundingClientRect();document.body.removeChild(l),c=h.width,u=h.height}const d=await n.getAssetForExternalContent({type:"file",file:new File([s],"asset.svg",{type:"image/svg+xml"})});if(!d)throw Error("Could not create an asset");hT(n,[d],a)}),n.registerExternalContentHandler("embed",({point:o,url:s,embed:a})=>{const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),{width:c,height:u}=a,d=tt(),h={id:d,type:"embed",x:l.x-(c||450)/2,y:l.y-(u||450)/2,props:{w:c,h:u,url:s}};n.createShapes([h]).select(d)}),n.registerExternalContentHandler("files",async({point:o,files:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=new P(a.x,a.y),c=[];await Promise.all(s.map(async(u,d)=>{if(u.size>t)return console.warn(`File size too big: ${(u.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),null;if(!u.type)throw new Error("No mime type");if(!r.concat(i).includes(u.type))return console.warn(`${u.name} not loaded - Extension not allowed.`),null;try{const h=await n.getAssetForExternalContent({type:"file",file:u});if(!h)throw Error("Could not create an asset");c[d]=h}catch(h){return console.error(h),null}})),hT(n,ye(c),l)}),n.registerExternalContentHandler("text",async({point:o,text:s})=>{const a=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),l=n.getShapeUtil("text").getDefaultProps(),c=SY(s);let u,d,h,p="middle";const g=c.split(`
`).length>1,f=yY(c);g&&(p=g?f?"end":"start":"middle");const m=n.textMeasure.measureText(c,{...Jt,fontFamily:yo[l.font],fontSize:ps[l.size],maxWidth:null}),v=Math.min(g?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(m.w>v){const b=n.textMeasure.measureText(c,{...Jt,fontFamily:yo[l.font],fontSize:ps[l.size],maxWidth:v});u=b.w,d=b.h,h=!1,p=f?"end":"start"}else u=m.w,d=m.h,h=!0;a.y-d/2<n.getViewportPageBounds().minY+40&&(a.y=n.getViewportPageBounds().minY+40+d/2),n.createShapes([{id:tt(),type:"text",x:a.x-u/2,y:a.y-d/2,props:{text:c,align:p,autoSize:h,w:u}}])}),n.registerExternalContentHandler("url",async({point:o,url:s})=>{const a=wo(s);if(a)return n.putExternalContent({type:"embed",url:a.url,point:o,embed:a.definition});const l=o??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageCenter()),c=Js.createId(Ip(s)),u=_Y(n,s,l);let d=n.getAsset(c),h=!1;if(!d){h=!0;const p=await n.getAssetForExternalContent({type:"url",url:s});if(!p)throw Error("Could not create an asset");d=p}n.batch(()=>{h&&n.createAssets([d]),n.updateShapes([{id:u.id,type:u.type,props:{assetId:d.id}}])})})}async function hT(n,e,t){if(!e.length)return[];const r=P.From(t),i=[];for(const o of e)switch(o.type){case"bookmark":{i.push({id:tt(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{i.push({id:tt(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:tt(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}return n.batch(()=>{const o=e.filter(s=>!n.getAsset(s.id));o.length&&n.createAssets(o),n.createShapes(i).select(...i.map(s=>s.id)),pT(n,t)}),i.map(o=>o.id)}function pT(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(o=>{const s=n.getShapeParentTransform(o).decompose().rotation,a=P.Rot(i,-s);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection()}function _Y(n,e,t){const r={id:tt(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.batch(()=>{n.createShapes([r]).select(r.id),pT(n,t)}),n.getShape(r.id)}let kY=(_x=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")});w(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}})}},w(_x,"id","idle"),_x),CY=(kx=class extends se{constructor(){super(...arguments);w(this,"shape");w(this,"markId","");w(this,"onEnter",()=>{this.didTimeout=!1;const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:t=>!t.isLocked&&this.editor.getShapeUtil(t).canBind(t),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()});w(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});w(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>e.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});w(this,"onPointerUp",()=>{this.cancel()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()});w(this,"preciseTimeout",-1);w(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var c,u;const{originPagePoint:e}=this.editor.inputs,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);const r=this.editor.getShape(t);if(!r)throw Error("expected shape");const i=this.editor.getShapeHandles(r);if(!i)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),s=this.shape,a=i.find(d=>d.id==="start"),l=(c=o.onHandleChange)==null?void 0:c.call(o,r,{handle:{...a,x:0,y:0},isPrecise:!0,initial:s});if(l){const d=(u=l.props)==null?void 0:u.start;(d==null?void 0:d.type)==="binding"&&this.editor.setHintingShapes([d.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){var i,o,s;const e=this.shape;if(!e)throw Error("expected shape");const t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");const r={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),u=t.find(h=>h.id==="end"),d=(i=a.onHandleChange)==null?void 0:i.call(a,r,{handle:{...u,x:c.x,y:c.y},isPrecise:!1,initial:l});if(d){const h=(o=d.props)==null?void 0:o.end;(h==null?void 0:h.type)==="binding"&&this.editor.setHintingShapes([h.boundShapeId]),this.editor.updateShapes([d],{squashing:!0})}}{const a=this.editor.getShapeUtil("arrow"),l=this.shape,c=t.find(d=>d.id==="start"),u=(s=a.onHandleChange)==null?void 0:s.call(a,r,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});u&&this.editor.updateShapes([u],{squashing:!0})}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},w(kx,"id","pointing"),kx);class Zf extends se{constructor(){super(...arguments);w(this,"shapeType","arrow")}}w(Zf,"id","arrow"),w(Zf,"initial","idle"),w(Zf,"children",()=>[kY,CY]);class Lv extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"initialShape");w(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");w(this,"util",this.editor.getShapeUtil(this.shapeType));w(this,"isPen",!1);w(this,"segmentMode","free");w(this,"didJustShiftClickToExtendPreviousShapeLine",!1);w(this,"pagePointWhereCurrentSegmentChanged",{});w(this,"pagePointWhereNextSegmentChanged",null);w(this,"lastRecordedPoint",{});w(this,"mergeNextPoint",!1);w(this,"currentLineLength",0);w(this,"canDraw",!1);w(this,"markId",null);w(this,"onEnter",t=>{this.markId=null,this.info=t,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});w(this,"onPointerMove",()=>{const{editor:{inputs:t}}=this;if(this.isPen!==t.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&t.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(t.isPen?P.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())});w(this,"onKeyDown",t=>{if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()});w(this,"onKeyUp",t=>{if(t.key==="Shift")switch(this.editor.snaps.clear(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateShapes()});w(this,"onExit",()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r){if(!this.canClose())return!1;const i=yn[r],o=t[0].points[0],s=t[t.length-1],a=s.points[s.points.length-1];return o!==a&&this.currentLineLength>i*4&&P.Dist(o,a)<i*2}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId="draw start "+Xe(),this.editor.mark(this.markId),this.isPen=r;const i=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const s=this.editor.getShape(this.initialShape.id);if(s&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=Bn(s.props.segments);if(!a)throw Error("Expected a previous segment!");const l=Bn(a.points);if(!l)throw Error("Expected a previous point!");const{x:c,y:u}=this.editor.getPointInShapeSpace(s,t).toFixed(),d=this.isPen?this.info.point.z*1.25:.5,h={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+d.toFixed(2)},{x:c,y:u,z:+d.toFixed(2)}]},p=re.applyToPoint(this.editor.getShapePageTransform(s.id),l);this.pagePointWhereCurrentSegmentChanged=p,this.pagePointWhereNextSegmentChanged=null;const g=[...s.props.segments,h];this.currentLineLength=this.getLineLength(g);const f={id:s.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(f.props.isClosed=this.getIsClosed(g,s.props.size)),this.editor.updateShapes([f]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=tt();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateShapes(){const{inputs:t}=this.editor,{initialShape:r}=this;if(!r)return;const{id:i,props:{size:o}}=r,s=this.editor.getShape(i);if(!s)return;const{segments:a}=s.props,{x:l,y:c,z:u}=this.editor.getPointInShapeSpace(s,t.currentPagePoint).toFixed(),d={x:l,y:c,z:this.isPen?+(u*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(P.Dist(h,t.currentPagePoint)>Tu){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const p=Bn(a);if(!p)throw Error("Expected a previous segment!");const g=Bn(p.points);if(!g)throw Error("Expected a previous last point!");let f;const m=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(p.type==="straight"){this.currentLineLength+=P.Dist(g,m),f={type:"straight",points:[{...g},m]};const b=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=re.applyToPoint(b,g)}else f={type:"straight",points:[m,d]};const v={id:i,type:this.shapeType,props:{segments:[...a,f]}};this.canClose()&&(v.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([v],{squashing:!0})}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(P.Dist(h,t.currentPagePoint)>Tu){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const p=a.slice(),g=p[p.length-1],f=Bn(g.points);if(!f)throw Error("No previous point!");const m={type:"free",points:[...P.PointsBetween(f,d,6).map(_=>_.toFixed().toJson())]},v=[...p,m];this.currentLineLength=this.getLineLength(v);const b={id:i,type:this.shapeType,props:{segments:v}};this.canClose()&&(b.props.isClosed=this.getIsClosed(v,o)),this.editor.updateShapes([b],{squashing:!0})}break}case"straight":{const h=a.slice(),p=h[h.length-1],{pagePointWhereCurrentSegmentChanged:g}=this,{currentPagePoint:f,ctrlKey:m}=this.editor.inputs;if(!g)throw Error("We should have a point where the segment changed");let v,b=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(b=!m,this.didJustShiftClickToExtendPreviousShapeLine=!1):b=!m;let _=this.editor.getPointInShapeSpace(s,f).toFixed().toJson(),x=!1,C;if((this.editor.user.getIsSnapMode()?!m:m)&&h.length>2){let E,I=8/this.editor.getZoomLevel();for(let T=0,A=a.length-2;T<A;T++){const D=a[T];if(!D)break;if(D.type==="free")continue;const N=D.points[0],U=Bn(D.points);if(!(N&&U))continue;const R=P.NearestPointOnLineSegment(N,U,_),B=P.Dist(R,_);if(B<I){E=R.toFixed().toJson(),I=B,C=D;break}}E&&(x=!0,_=E)}if(x&&C){const E=this.editor.getShapePageTransform(s),I=C.points[0],T=Bn(C.points);if(!T)throw Error("Expected a last point!");const A=re.applyToPoint(E,I),D=re.applyToPoint(E,T),N=re.applyToPoint(E,_);this.editor.snaps.setLines([{id:Xe(),type:"points",points:[A,N,D]}])}else{if(this.editor.snaps.clear(),b){const E=P.Angle(g,f),I=Zp(E,24)-E;v=P.RotWith(f,g,I)}else v=f;_=this.editor.getPointInShapeSpace(s,v).toFixed().toJson()}this.currentLineLength+=P.Dist(p.points[0],_),h[h.length-1]={...p,type:"straight",points:[p.points[0],_]};const k={id:i,type:this.shapeType,props:{segments:h}};this.canClose()&&(k.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([k],{squashing:!0});break}case"free":{const h=a.slice(),p=h[h.length-1],g=[...p.points];if(g.length&&this.mergeNextPoint){const{z:m}=g[g.length-1];g[g.length-1]={x:d.x,y:d.y,z:m?Math.max(m,d.z):d.z}}else this.currentLineLength+=P.Dist(g[g.length-1],d),g.push(d);h[h.length-1]={...p,points:g},this.currentLineLength=this.getLineLength(h);const f={id:i,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(f.props.isClosed=this.getIsClosed(h,o)),this.editor.updateShapes([f],{squashing:!0}),g.length>500){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:m}=this.editor.inputs,v=tt();this.editor.createShapes([{id:v,type:this.shapeType,x:Jp(m.x),y:Jp(m.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(u*1.25).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(v)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let o=0;o<i.points.length-1;o++){const s=i.points[o],a=i.points[o+1];r+=P.Sub(a,s).len2()}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}w(Lv,"id","drawing");let fT=(Cx=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("drawing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Cx,"id","idle"),Cx);class Jf extends se{constructor(){super(...arguments);w(this,"shapeType","draw");w(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}w(Jf,"id","draw"),w(Jf,"initial","idle"),w(Jf,"children",()=>[fT,Lv]);class zv extends Pf{constructor(){super(...arguments);w(this,"shapeType","frame");w(this,"onCreate",t=>{if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],o=this.editor.getShapeAncestors(t).map(s=>s.id);this.editor.getCurrentPageShapes().map(s=>{if(s.id===t.id||s.isLocked)return;const a=this.editor.getShapePageBounds(s);a&&r.contains(a)&&PY(s,o,t)&&i.push(s.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}w(zv,"id","frame"),w(zv,"initial","idle");function PY(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}let EY=(Px=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onKeyUp",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Px,"id","idle"),Px),IY=(Ex=class extends se{constructor(){super(...arguments);w(this,"markId","");w(this,"onPointerUp",()=>{this.complete()});w(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=tt();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Pi)}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:e}=this.editor.inputs,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Pi),w:1,h:1}}]);const r=this.editor.getShape(t);if(!r)return;const i=r.props.geo==="star"?new de(0,0,200,190):r.props.geo==="cloud"?new de(0,0,300,180):new de(0,0,200,200),o=i.center,s=this.editor.getShapeParentTransform(r);s&&o.rot(-s.rotation()),this.editor.select(t),this.editor.updateShapes([{id:r.id,type:"geo",x:r.x-o.x,y:r.y-o.y,props:{geo:this.editor.getStyleForNextShape(Pi),w:i.width,h:i.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},w(Ex,"id","pointing"),Ex);class Qf extends se{constructor(){super(...arguments);w(this,"shapeType","geo")}}w(Qf,"id","geo"),w(Qf,"initial","idle"),w(Qf,"children",()=>[EY,IY]);class eg extends se{constructor(){super(...arguments);w(this,"shapeType","highlight");w(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}w(eg,"id","highlight"),w(eg,"initial","idle"),w(eg,"children",()=>[fT,Lv]);let MY=(Ix=class extends se{constructor(){super(...arguments);w(this,"shapeId","");w(this,"onEnter",e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})});w(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Ix,"id","idle"),Ix);const gT=2;let TY=(Mx=class extends se{constructor(){super(...arguments);w(this,"shape",{});w(this,"markId");w(this,"onEnter",e=>{const{inputs:t}=this.editor,{currentPagePoint:r}=t;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&t.shiftKey){this.markId=`creating:${i.id}`,this.editor.mark(this.markId),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const s=o.filter(f=>f.type==="vertex").sort(mn),a=s[s.length-1],l=s[s.length-2],c=re.applyToPoint(this.editor.getShapeParentTransform(this.shape),new P(this.shape.x,this.shape.y));let u,d,h;const p=P.Sub(r,c);P.Dist(a,l)<gT||P.Dist(p,a)<gT?(u=a.index,d=a.id,h={...a,x:p.x+.1,y:p.y+.1}):(u=uo(a.index),d="handle:"+u,h={id:d,type:"vertex",index:u,x:p.x+.1,y:p.y+.1,canBind:!1});const g=rs(this.shape.props.handles);g[h.id]=h,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:g}}])}else{const o=tt();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:r.x,y:r.y}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});w(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const t=Bn(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}},w(Mx,"id","pointing"),Mx);class tg extends se{constructor(){super(...arguments);w(this,"shapeType","line")}}w(tg,"id","line"),w(tg,"initial","idle"),w(tg,"children",()=>[MY,TY]);let AY=(Tx=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Tx,"id","idle"),Tx),jY=(Ax=class extends se{constructor(){super(...arguments);w(this,"dragged",!1);w(this,"info",{});w(this,"wasFocusedOnEnter",!1);w(this,"markId","");w(this,"shape",{});w(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())});w(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))});w(this,"onPointerUp",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:e}}=this.editor,t=tt();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);const r=this.editor.getShape(t),i=this.editor.getShapeGeometry(r).bounds;return this.editor.updateShapes([{id:t,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),this.editor.getShape(t)}},w(Ax,"id","pointing"),Ax);class ng extends se{constructor(){super(...arguments);w(this,"shapeType","note")}}w(ng,"id","note"),w(ng,"initial","idle"),w(ng,"children",()=>[AY,jY]);function td(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:ei/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}let RY=(jx=class extends se{constructor(){super(...arguments);w(this,"onPointerMove",e=>{switch(e.target){case"shape":case"canvas":td(this.editor)}});w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onKeyDown",e=>{var t;if(e.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(jx,"id","idle"),jx),OY=(Rx=class extends se{constructor(){super(...arguments);w(this,"shape");w(this,"markId","");w(this,"onExit",()=>{this.editor.setHintingShapes([])});w(this,"onPointerMove",e=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:t}}=this.editor,r=tt();if(this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(r),this.shape=this.editor.getShape(r),!this.shape)return;const{shape:i}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(i.id),this.editor.setCurrentTool("select.editing_shape")}})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.cancel()});w(this,"onCancel",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){var i;this.editor.mark("creating text shape");const e=tt(),{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:r,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),(i=this.editor.root.getCurrent())==null||i.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}},w(Rx,"id","pointing"),Rx);class rg extends se{constructor(){super(...arguments);w(this,"shapeType","text")}}w(rg,"id","text"),w(rg,"initial","idle"),w(rg,"children",()=>[RY,OY]);const DY=[rg,Jf,Qf,ng,tg,zv,Zf,eg];function Vt(){return Wn({isDarkMode:Sf()})}const Tt=oe.memo(function({theme:n,d:e,color:t,fill:r}){switch(r){case"none":return null;case"solid":return y.jsx("path",{fill:n[t].semi,d:e});case"semi":return y.jsx("path",{fill:n.solid,d:e});case"pattern":return y.jsx(LY,{theme:n,color:t,fill:r,d:e})}}),LY=function({d:n,color:e,theme:t}){const r=Y(),i=Z("zoomLevel",()=>r.getZoomLevel(),[r]),o=Math.ceil(i),s=r.getZoomLevel()<=.18;return y.jsxs(y.Fragment,{children:[y.jsx("path",{fill:t[e].pattern,d:n}),y.jsx("path",{fill:s?t[e].semi:`url(#${tf[`${o}_${t.id}`]})`,d:n})]})};function pr({d:n,color:e,fill:t,theme:r}){if(t==="none")return;if(t==="pattern"){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",n),s.setAttribute("fill",r[e].pattern);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",n),a.setAttribute("fill","url(#hash_pattern)"),o.appendChild(s),o.appendChild(a),o}const i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",n),t){case"semi":{i.setAttribute("fill",r.solid);break}case"solid":{i.setAttribute("fill",r[e].semi);break}}return i}function oi(n,e){if(e){const t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.appendChild(e),t.appendChild(n),t}else return n}function zY(n){return n.replace(/\s/g,"\xA0")}function ig(n,e,t){const{padding:r=0}=t,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",t.fontSize+"px"),i.setAttribute("font-family",t.fontFamily),i.setAttribute("font-style",t.fontStyle),i.setAttribute("font-weight",t.fontWeight),i.setAttribute("line-height",t.lineHeight*t.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),e.length===0)return i;const o=de.From(e[0].box);for(const{box:c}of e)o.union(c);const s=r+(t.offsetX??0),a=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-o.height:(Math.ceil(t.height)-o.height)/2);let l=null;for(const{text:c,box:u}of e){if(l!==null&&u.y>l){const p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttribute("alignment-baseline","mathematical"),p.setAttribute("x",s+"px"),p.setAttribute("y",u.y+a+"px"),p.textContent=`
`,i.appendChild(p)}const d=document.createElementNS("http://www.w3.org/2000/svg","tspan");d.setAttribute("alignment-baseline","mathematical"),d.setAttribute("x",u.x+s+"px"),d.setAttribute("y",u.y+a+"px");const h=zY(c);d.textContent=h,i.appendChild(d),l=u.y}return t.stroke&&t.strokeWidth&&(i.setAttribute("stroke",t.stroke),i.setAttribute("stroke-width",t.strokeWidth+"px")),t.fill&&i.setAttribute("fill",t.fill),i}function og(n){return{key:`${ki.id}:${n}`,getElement:async()=>{const e=NY(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const i=await(await fetch(t)).blob(),o=await new Promise((l,c)=>{const u=new FileReader;u.onload=()=>l(u.result),u.onerror=c,u.readAsDataURL(i)}),s=r.replace(t,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=s,a}}}function NY(n){const e=mu[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function Nv(n,e){return{key:`${ki.id}:${n}`,getElement:async()=>{if(n!=="pattern")return null;const t=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${t*1}" y1="${t*3}" x2="${t*3}" y2="${t*1}" />
								<line x1="${t*5}" y1="${t*7}" x2="${t*7}" y2="${t*5}" />
								<line x1="${t*9}" y1="${t*11}" x2="${t*11}" y2="${t*9}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${e.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function Fv(){return{key:`${ki.id}:pattern`,component:BY}}const nd=8,mT=(n,e,t)=>new Promise((r,i)=>{const o=nd*e*n,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=t?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const l=8/12,c=u=>u*e*n;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),s.toBlob(u=>{!u||nt.throwToBlob.get()?i():r(u)})}),yT=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""},FY=()=>{const n=[];for(let e=1;e<=Math.ceil(is);e++){const t=yT([1,1],i=>{i.fillStyle=Up.lightMode.black.semi,i.fillRect(0,0,1,1)}),r=yT([1,1],i=>{i.fillStyle=Up.darkMode.black.semi,i.fillRect(0,0,1,1)});n.push({zoom:e,url:t,darkMode:!1}),n.push({zoom:e,url:r,darkMode:!0})}return n};function $Y(){const n=Y().getInstanceState().devicePixelRatio,[e,t]=S.useState(!1),r=S.useMemo(()=>FY(),[]),[i,o]=S.useState(r);return S.useEffect(()=>{const s=[];for(let l=1;l<=Math.ceil(is);l++)s.push(mT(n,l,!1).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!1}))),s.push(mT(n,l,!0).then(c=>({zoom:l,url:URL.createObjectURL(c),darkMode:!0})));let a=!1;return Promise.all(s).then(l=>{a||(o(l),t(!0))}),()=>{a=!0,t(!1)}},[n]),{defs:y.jsx(y.Fragment,{children:i.map(s=>{const a=s.zoom+(s.darkMode?"_dark":"_light");return y.jsx("pattern",{id:tf[a],width:nd,height:nd,patternUnits:"userSpaceOnUse",children:y.jsx("image",{href:s.url,width:nd,height:nd})},a)})}),isReady:e}}function BY(){const n=Y(),e=S.useRef(null),{defs:t,isReady:r}=$Y();return S.useEffect(()=>{if(r&&n.environment.isSafari){const i=wT(e.current);i&&requestAnimationFrame(()=>{i.style.display="none",requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),y.jsx("g",{ref:e,children:t})}function wT(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?wT(n.parentElement):null}function wn(n,e,t={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=t;let c=0,u=0,d=1,h=0,p=0;switch(l){case"dashed":{d=1,c=Math.min(e*a,n/4);break}case"dotted":{d=100,c=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(n+=c/2,p+=c/2):o==="skip"&&(n-=c,p-=c),s==="outset"?n+=c/2:s==="skip"&&(n-=c)),u=Math.floor(n/c/(2*d)),u-=u%i,u<3&&l==="dashed"?n/e<5?(c=n,u=1,h=0):(c=n*.333,h=n*.333):(u=Math.max(u,3),c=n/u/(2*d),r?(p=c/2,h=(n-u*c)/u):h=(n-u*c)/Math.max(1,u-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}function UY(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,o=n.isStraight?P.Dist(i,r):Math.abs(n.bodyArc.length),s=Math.max(Math.min(o/5,t*3),t);let a;if(n.isStraight)a=P.Nudge(r,i,s);else{const l=F9(r,s,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?l[0]:l[1]:n.handleArc.sweepFlag?l[1]:l[0]}return{point:r,int:a}}function VY({point:n,int:e}){const t=P.RotWith(e,n,Fe/6),r=P.RotWith(e,n,-Fe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function HY({point:n,int:e}){const t=P.RotWith(e,n,Fe/6),r=P.RotWith(e,n,-Fe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function WY({point:n,int:e}){const t=P.Sub(e,n).div(2),r=P.Add(n,P.Rot(t,rt)),i=P.Sub(n,P.Rot(t,rt));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function KY({point:n,int:e}){const t=P.Lrp(n,e,.45),r=P.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function GY({point:n,int:e}){const t=P.Lrp(n,e,.75),r=P.RotWith(t,n,Fe/4),i=P.RotWith(t,n,-Fe/4),o=P.Lrp(r,i,.5);return o.add(P.Sub(o,n)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function YY({int:n,point:e}){const t=P.Lrp(e,n,.85),r=P.Sub(t,e).div(2),i=P.Add(e,P.Rot(r,rt)),o=P.Sub(e,P.Rot(r,rt)),s=P.Add(t,P.Rot(r,rt)),a=P.Sub(t,P.Rot(r,rt));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function XY({int:n,point:e}){const t=P.Sub(n,e).div(2),r=P.Add(e,P.Rot(t,rt)),i=P.Sub(e,P.Rot(t,rt));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function Hl(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=UY(n,e,t);if(i){switch(r){case"bar":return XY(i);case"square":return YY(i);case"diamond":return GY(i);case"dot":return KY(i);case"inverted":return WY(i);case"arrow":return VY(i);case"triangle":return HY(i)}return""}}function qY(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${o} ${t.handle.x},${t.handle.y}`}function $v(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${o} ${t.point.x},${t.point.y}`}function bT(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function ZY(n){return bT(n.start.handle,n.end.handle)}function Bv(n){return bT(n.start.point,n.end.point)}function Uv(n,e,t){const r=Y(),i=S.useRef(null),o=S.useRef(!1),s=S.useRef(),a=Z("isEditing",()=>r.getEditingShapeId()===n,[r,n]);S.useEffect(()=>{const g=i.current;g&&a&&document.activeElement!==g&&g.focus()},[a]);const l=S.useCallback(()=>{const g=o.current;o.current=!1,requestAnimationFrame(()=>{const f=i.current;if(!f)return;const m=r.getShape(n);m&&(f.value=m.props.text,f.value.length&&!g&&f.select())})},[r,n]),c=S.useCallback(()=>{const g=s.current;requestAnimationFrame(()=>{var v;const f=i.current,m=r.getEditingShapeId();if(f&&m){if(m===n)if(g)if(!g.length)f.focus();else{o.current=!0,f.focus();const b=window.getSelection();b&&g.forEach(_=>b.addRange(_))}else f.focus()}else(v=window.getSelection())==null||v.removeAllRanges(),r.complete()})},[r,n]),u=S.useCallback(g=>{if(a)switch((g.ctrlKey||g.metaKey)&&Ft(g),g.key){case"Enter":{(g.ctrlKey||g.metaKey)&&r.complete();break}case"Tab":{Oe(g),g.shiftKey?gs.unindent(g.currentTarget):gs.indent(g.currentTarget);break}}},[r,a]),d=S.useCallback(g=>{if(!a)return;let f=gs.normalizeText(g.currentTarget.value);const m=f.replace(/\t/g,Vl);if(m!==f){const v=g.currentTarget.selectionStart;g.currentTarget.value=m,g.currentTarget.selectionStart=v+(m.length-f.length),g.currentTarget.selectionEnd=v+(m.length-f.length),f=m}r.updateShapes([{id:n,type:e,props:{text:f}}])},[r,n,e,a]),h=t.trim().length===0;S.useEffect(()=>{if(a&&i.current){let g=function(){var m,v;const f=(m=window.getSelection)==null?void 0:m.call(window);if(f&&f.type!=="None"){const b=[];if(f)for(let _=0;_<f.rangeCount;_++)b.push((v=f.getRangeAt)==null?void 0:v.call(f,_));s.current=b}};return document.addEventListener("selectionchange",g),()=>{document.removeEventListener("selectionchange",g)}}},[a]);const p=S.useCallback(g=>{r.dispatch({...Kn(g),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),Ft(g)},[r,n]);return{rInput:i,isEditing:a,handleFocus:l,handleBlur:c,handleKeyDown:u,handleChange:d,handleInputPointerDown:p,handleDoubleClick:Ft,isEmpty:h}}const JY=S.memo(function({id:n,text:e,size:t,font:r,position:i,width:o,labelColor:s}){const{rInput:a,isEditing:l,handleFocus:c,handleBlur:u,handleKeyDown:d,handleChange:h,isEmpty:p,handleInputPointerDown:g,handleDoubleClick:f}=Uv(n,"arrow",e),m=gs.normalizeTextForDom(e).trim().length>0;return!l&&!m?null:y.jsx("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:fs[t],lineHeight:fs[t]*Jt.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:s},children:y.jsxs("div",{className:"tl-arrow-label__inner",children:[y.jsx("p",{style:{width:o||"9px"},children:e?gs.normalizeTextForDom(e):" "}),l&&y.jsx("textarea",{ref:a,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:e,onFocus:c,onChange:h,onKeyDown:d,onBlur:u,onContextMenu:Ft,onPointerDown:g,onDoubleClick:f})]})})});let QY=0;class sg extends ti{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"canBind",()=>!1);w(this,"canSnap",()=>!1);w(this,"hideResizeHandles",()=>!0);w(this,"hideRotateHandle",()=>!0);w(this,"hideSelectionBoundsBg",()=>!0);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"onHandleChange",(t,{handle:r,isPrecise:i})=>{const o=r.id;if(o==="middle"){const{start:f,end:m}=ni(this.editor,t),v=P.Sub(m,f),b=P.Per(v),_=P.Med(m,f),x=P.Sub(_,b),C=P.Add(_,b),k=P.NearestPointOnLineSegment(x,C,r,!1);let E=P.Dist(k,_);return P.Clockwise(k,m,_)&&(E*=-1),{id:t.id,type:t.type,props:{bend:E}}}const s=cn(t),a=this.editor.getShapePageTransform(s.id).applyToPoint(r);if(this.editor.inputs.ctrlKey)return s.props[o]={type:"point",x:r.x,y:r.y},s;const l=this.editor.getShapePageTransform(t.id).applyToPoint(r),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:f=>!f.isLocked&&this.editor.getShapeUtil(f).canBind(f)});if(!c)return s.props[o]={type:"point",x:r.x,y:r.y},s;const u=this.editor.getShapeGeometry(c),d=de.ZeroFix(u.bounds),h=this.editor.getPointInShapeSpace(c,a);let p=i;if(!p){const f=s.props[o];(f.type==="point"||f.type==="binding"&&c.id!==f.boundShapeId)&&(p=this.editor.inputs.pointerVelocity.len()<.5)}if(!i){u.isClosed||(p=!0);const f=s.props[o==="start"?"end":"start"];f.type==="binding"&&c.id===f.boundShapeId&&f.isPrecise&&(p=!0)}const g={x:(h.x-d.minX)/d.width,y:(h.y-d.minY)/d.height};return p&&P.Dist(h,d.center)<Math.max(4,Math.min(Math.min(d.width,d.height)*.15,16))/this.editor.getZoomLevel()&&(g.x=.5,g.y=.5),s.props[o]={type:"binding",boundShapeId:c.id,normalizedAnchor:g,isPrecise:p,isExact:this.editor.inputs.altKey},s.props.start.type==="binding"&&s.props.end.type==="binding"&&s.props.start.boundShapeId===s.props.end.boundShapeId&&P.Equals(s.props.start.normalizedAnchor,s.props.end.normalizedAnchor)&&(s.props.end.normalizedAnchor.x+=.05),s});w(this,"onTranslateStart",t=>{const r=t.props.start.type==="binding"?t.props.start.boundShapeId:null,i=t.props.end.type==="binding"?t.props.end.boundShapeId:null,o=this.editor.getSelectedShapeIds();if(r&&(o.includes(r)||this.editor.isAncestorSelected(r))||i&&(o.includes(i)||this.editor.isAncestorSelected(i)))return;const{start:s,end:a}=ni(this.editor,t);return{id:t.id,type:t.type,props:{...t.props,start:{type:"point",x:s.x,y:s.y},end:{type:"point",x:a.x,y:a.y}}}});w(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=ni(this.editor,t),{start:a,end:l}=cn(t.props);let{bend:c}=t.props;a.type==="point"&&(a.x=s.start.x*i,a.y=s.start.y*o),l.type==="point"&&(l.x=s.end.x*i,l.y=s.end.y*o);const u=Math.abs(i),d=Math.abs(o);return i<0&&o>=0?(c!==0&&(c*=-1,c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x)):i>=0&&o<0?(c!==0&&(c*=-1,c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.y=1-l.normalizedAnchor.y)):i>=0&&o>=0?c!==0&&(c*=Math.max(u,d)):i<0&&o<0&&(c!==0&&(c*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y),l.type==="binding"&&(l.normalizedAnchor.x=1-l.normalizedAnchor.x,l.normalizedAnchor.y=1-l.normalizedAnchor.y)),{props:{start:a,end:l,bend:c}}});w(this,"onDoubleClickHandle",(t,r)=>{switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}});w(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(t){const r=this.editor.getArrowInfo(t),i=r.isStraight?new pf({start:P.From(r.start.point),end:P.From(r.end.point)}):new N$({center:P.Cast(r.handleArc.center),radius:r.handleArc.radius,start:P.Cast(r.start.point),end:P.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const s=i.bounds,{w:a,h:l}=this.editor.textMeasure.measureText(t.props.text,{...Jt,fontFamily:yo[t.props.font],fontSize:fs[t.props.size],maxWidth:null});let c=a,u=l;if(s.width>s.height){c=Math.max(Math.min(a,64),Math.min(s.width-64,a));const{w:d,h}=this.editor.textMeasure.measureText(t.props.text,{...Jt,fontFamily:yo[t.props.font],fontSize:fs[t.props.size],maxWidth:c});c=d,u=h}if(c>16*fs[t.props.size]){c=16*fs[t.props.size];const{w:d,h}=this.editor.textMeasure.measureText(t.props.text,{...Jt,fontFamily:yo[t.props.font],fontSize:fs[t.props.size],maxWidth:c});c=d,u=h}o=new ss({x:r.middle.x-c/2-4.25,y:r.middle.y-u/2-4.25,width:c+8.5,height:u+8.5,isFilled:!0,isLabel:!0})}return new os({children:o?[i,o]:[i],isSnappable:!1})}getHandles(t){const r=this.editor.getArrowInfo(t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y,canBind:!0}]}component(t){const r=Vt(),i=this.editor.getOnlySelectedShape(),o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,s=this.editor.getArrowInfo(t),a=de.ZeroFix(this.editor.getShapeGeometry(t).bounds),l=oe.useMemo(()=>this.editor.environment.isSafari?QY+=1:0,[t]);if(!(s!=null&&s.isValid))return null;const c=yn[t.props.size],u=s.start.arrowhead&&Hl(s,"start",c),d=s.end.arrowhead&&Hl(s,"end",c),h=s.isStraight?Bv(s):$v(s);let p=null;if(i===t&&o){const{strokeDasharray:x,strokeDashoffset:C}=wn(s.isStraight?P.Dist(s.start.handle,s.end.handle):Math.abs(s.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});p=t.props.start.type==="binding"||t.props.end.type==="binding"?y.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?ZY(s):qY(s),strokeDasharray:x,strokeDashoffset:C,strokeWidth:2,markerStart:t.props.start.type==="binding"?t.props.start.isExact?"":t.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:t.props.end.type==="binding"?t.props.end.isExact?"":t.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:f}=wn(s.isStraight?s.length:Math.abs(s.bodyArc.length),c,{style:t.props.dash}),m=t.props.text.trim()?this.editor.getShapeGeometry(t).children[1]:null,v=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow"),_=(t.id+"_clip_"+l).replace(":","_");return y.jsxs(y.Fragment,{children:[y.jsxs(cr,{id:t.id,style:{minWidth:50,minHeight:50},children:[y.jsx("defs",{children:y.jsxs("mask",{id:_,children:[y.jsx("rect",{x:O(-100+a.minX),y:O(-100+a.minY),width:O(a.width+200),height:O(a.height+200),fill:"white"}),m&&y.jsx("rect",{x:m.x,y:m.y,width:m.w,height:m.h,fill:"black",rx:4,ry:4}),u&&v&&y.jsx("path",{d:u,fill:s.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),d&&b&&y.jsx("path",{d,fill:s.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),y.jsxs("g",{fill:"none",stroke:r[t.props.color].solid,strokeWidth:c,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,y.jsxs("g",{mask:`url(#${_})`,children:[y.jsx("rect",{x:O(a.minX-100),y:O(a.minY-100),width:O(a.width+200),height:O(a.height+200),opacity:0}),y.jsx("path",{d:h,strokeDasharray:g,strokeDashoffset:f})]}),u&&v&&t.props.fill!=="none"&&y.jsx(Tt,{theme:r,d:u,color:t.props.color,fill:t.props.fill}),d&&b&&t.props.fill!=="none"&&y.jsx(Tt,{theme:r,d,color:t.props.color,fill:t.props.fill}),u&&y.jsx("path",{d:u}),d&&y.jsx("path",{d})]})]}),y.jsx(JY,{id:t.id,text:t.props.text,font:t.props.font,size:t.props.size,position:s.middle,width:(m==null?void 0:m.w)??0,labelColor:r[t.props.labelColor].solid})]})}indicator(t){const{start:r,end:i}=ni(this.editor,t),o=this.editor.getArrowInfo(t),s=this.editor.getShapeGeometry(t),a=s.bounds,l=t.props.text.trim()?s.children[1]:null,c=Ef(t.id);if(!o||P.Equals(r,i))return null;const u=yn[t.props.size],d=o.start.arrowhead&&Hl(o,"start",u),h=o.end.arrowhead&&Hl(o,"end",u),p=o.isStraight?Bv(o):$v(o),g=d&&o.start.arrowhead!=="arrow"||h&&o.end.arrowhead!=="arrow"||!!l,f=(t.id+"_clip").replace(":","_");return c&&l?y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5}):y.jsxs("g",{children:[g&&y.jsx("defs",{children:y.jsxs("mask",{id:f,children:[y.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),l&&y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,fill:"black",rx:3.5,ry:3.5}),d&&y.jsx("path",{d,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&y.jsx("path",{d:h,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),y.jsxs("g",{...g?{mask:`url(#${f})`}:void 0,children:[g&&y.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),y.jsx("path",{d:p})]}),d&&y.jsx("path",{d}),h&&y.jsx("path",{d:h}),l&&y.jsx("rect",{x:O(l.x),y:O(l.y),width:l.w,height:l.h,rx:3.5,ry:3.5})]})}toSvg(t,r){const i=Wn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Nv(t.props.fill,i));const o=i[t.props.color].solid,s=this.editor.getArrowInfo(t),a=yn[t.props.size],l=document.createElementNS("http://www.w3.org/2000/svg","g");if(!s)return l;const c=s.start.arrowhead&&Hl(s,"start",a),u=s.end.arrowhead&&Hl(s,"end",a),d=this.editor.getShapeGeometry(t),h=d.bounds,p=t.props.text.trim()?d.children[1]:null,g=(t.id+"_clip").replace(":","_");if(c||u||p){const x=document.createElementNS("http://www.w3.org/2000/svg","defs"),C=document.createElementNS("http://www.w3.org/2000/svg","mask");C.id=g;const k=document.createElementNS("http://www.w3.org/2000/svg","rect");if(k.setAttribute("x",h.minX-100+""),k.setAttribute("y",h.minY-100+""),k.setAttribute("width",h.width+200+""),k.setAttribute("height",h.height+200+""),k.setAttribute("fill","white"),C.appendChild(k),c&&C.appendChild(vT(c,s.start.arrowhead)),u&&C.appendChild(vT(u,s.end.arrowhead)),p){const E=document.createElementNS("http://www.w3.org/2000/svg","rect");E.setAttribute("x",p.x+""),E.setAttribute("y",p.y+""),E.setAttribute("width",p.w+""),E.setAttribute("height",p.h+""),E.setAttribute("fill","black"),C.appendChild(E)}x.appendChild(C),l.appendChild(x)}const f=document.createElementNS("http://www.w3.org/2000/svg","g");f.setAttribute("mask",`url(#${g})`),l.appendChild(f);const m=document.createElementNS("http://www.w3.org/2000/svg","rect");m.setAttribute("x","-100"),m.setAttribute("y","-100"),m.setAttribute("width",h.width+200+""),m.setAttribute("height",h.height+200+""),m.setAttribute("fill","transparent"),m.setAttribute("stroke","none"),f.appendChild(m);const v=eX(s.isStraight?Bv(s):$v(s),o,a),{strokeDasharray:b,strokeDashoffset:_}=wn(s.isStraight?s.length:Math.abs(s.bodyArc.length),a,{style:t.props.dash});if(v.setAttribute("stroke-dasharray",b),v.setAttribute("stroke-dashoffset",_),f.appendChild(v),c&&l.appendChild(ST(c,t.props.color,a,t.props.arrowheadStart==="arrow"?"none":t.props.fill,i)),u&&l.appendChild(ST(u,t.props.color,a,t.props.arrowheadEnd==="arrow"?"none":t.props.fill,i)),p){r.addExportDef(og(t.props.font));const x={fontSize:fs[t.props.size],lineHeight:Jt.lineHeight,fontFamily:mu[t.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},C=ig(this.editor,this.editor.textMeasure.measureTextSpans(t.props.text,x),x);C.setAttribute("fill",i[t.props.labelColor].solid),Array.from(C.children).forEach(E=>{const I=parseFloat(E.getAttribute("x")||"0"),T=parseFloat(E.getAttribute("y")||"0");E.setAttribute("x",I+4+p.x+"px"),E.setAttribute("y",T+p.y+"px")});const k=C.cloneNode(!0);k.setAttribute("stroke-width","2"),k.setAttribute("fill",i.background),k.setAttribute("stroke",i.background),l.appendChild(k),l.appendChild(C)}return l}getCanvasSvgDefs(){return[Fv()]}}w(sg,"type","arrow"),w(sg,"props",Hz),w(sg,"migrations",Wz);function vT(n,e){const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d",n),t.setAttribute("fill",e==="arrow"?"none":"black"),t.setAttribute("stroke","none"),t}function eX(n,e,t){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",n),r.setAttribute("fill","none"),r.setAttribute("stroke",e),r.setAttribute("stroke-width",t+""),r}function ST(n,e,t,r,i){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",n),o.setAttribute("fill","none"),o.setAttribute("stroke",i[e].solid),o.setAttribute("stroke-width",t+"");const s=pr({d:n,fill:r,color:e,theme:i});if(s){const a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.appendChild(s),a.appendChild(o),a}else return o}const xT="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function rd({url:n,zoomLevel:e}){return y.jsx("a",{className:we("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Ft,onPointerUp:Ft,title:n,draggable:!1,children:y.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${xT}") center 100% / 100% no-repeat`,WebkitMask:`url("${xT}") center 100% / 100% no-repeat`}})})}const tX=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Vv(n){return tX.map(e=>{const{offsetX:t,offsetY:r,blur:i,spread:o,color:s}=e,a=new P(t,r),{x:l,y:c}=a.rot(-n);return`${l}px ${c}px ${i}px ${o}px ${s}`}).join(", ")}class ag extends Tl{constructor(){super(...arguments);w(this,"canResize",()=>!1);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"onBeforeCreate",t=>{_T(this.editor,t)});w(this,"onBeforeUpdate",(t,r)=>{if(t.props.url!==r.props.url)if(ar.isValid(r.props.url))_T(this.editor,r);else return{...r,props:{...r.props,url:t.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(t){const r=t.props.assetId?this.editor.getAsset(t.props.assetId):null,i=this.editor.getShapePageTransform(t).rotation(),o=nX(t);return y.jsx(aa,{children:y.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:Vv(i)},children:[y.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?y.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):y.jsx("div",{className:"tl-bookmark__placeholder"}),y.jsx(rd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]}),y.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&y.jsx("h2",{className:"tl-bookmark__heading",children:ed((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&y.jsx("p",{className:"tl-bookmark__description",children:ed((r==null?void 0:r.props.description)||"",128)}),y.jsx("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Ft,onPointerUp:Ft,onClick:Ft,children:ed(o,45)})]})]})})}indicator(t){return y.jsx("rect",{width:O(t.props.w),height:O(t.props.h),rx:"6",ry:"6"})}}w(ag,"type","bookmark"),w(ag,"props",Kz),w(ag,"migrations",Gz);const nX=n=>{try{const e=new URL(n.props.url),t=e.pathname.replace(/\/*$/,"");return`${e.hostname}${t}`}catch{return n.props.url}};function _T(n,e){const{url:t}=e.props,r=Js.createId(Ip(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),rX(n,e))}const rX=D2(async(n,e)=>{const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.batch(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function ms(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${Yt(r)}L${Yt(i)}`;let o="";for(let s=2,a=t-1;s<a;s++)r=n[s].point,i=n[s+1].point,o+=Gn(r,i);return e?`M${Gn(n[0].point,n[1].point)}Q${Yt(n[1].point)}${Gn(n[1].point,n[2].point)}T${o}${Gn(n[t-1].point,n[0].point)}${Gn(n[0].point,n[1].point)}Z`:`M${Yt(n[0].point)}Q${Yt(n[1].point)}${Gn(n[1].point,n[2].point)}${n.length>3?"T":""}${o}L${Yt(n[t-1].point)}`}function iX(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:o=!0}=r;qs(!t.taper&&!r.taper,"cap taper not supported here"),qs(!t.easing&&!r.easing,"cap easing not supported here"),qs(i&&o,"cap must be true");const s=ii(n,e);$l(s,e);const a=oX(s);let l="";for(const c of a)l+=aX(c,e);return l}function oX(n){if(n.length<=2)return[n];const e=[];let t=[n[0]];for(let r=1;r<n.length-1;r++){const i=n[r-1],o=n[r],s=n[r+1],a=P.Angle(i.point,o.point),l=P.Angle(o.point,s.point),c=Math.abs(Eu(a,l))/Math.PI;if(c>.8){const p={...o,point:o.input};t.push(p),e.push(Hv(t)),t=[p];continue}if(t.push(o),c<.25)continue;const u=(i.radius+o.radius+s.radius)/3,d=P.Dist(i.point,o.point)/u,h=P.Dist(o.point,s.point)/u;if(d+h<1.5){t.push(o),e.push(Hv(t)),t=[o];continue}}return t.push(n[n.length-1]),e.push(Hv(t)),e}function Hv(n){const e=n[0];for(;n.length>2;){const r=n[1],i=P.Dist(e.point,r.point),o=(e.radius+r.radius)/2;if(i<o*.5)n.splice(1,1);else break}const t=n[n.length-1];for(;n.length>2;){const r=n[n.length-2],i=P.Dist(t.point,r.point),o=(t.radius+r.radius)/2;if(i<o*.5)n.splice(n.length-2,1);else break}return n.length>1&&(n[0]={...n[0],vector:P.FromAngle(P.Angle(n[1].point,n[0].point))},n[n.length-1]={...n[n.length-1],vector:P.FromAngle(P.Angle(n[n.length-1].point,n[n.length-2].point))}),n}function sX(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function aX(n,e={}){if(n.length===0)return"";if(n.length===1)return sX(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=nT(n,e);r.reverse();let i=`M${Yt(t[0])}T`;for(let o=1;o<t.length;o++)i+=Gn(t[o-1],t[o]);{const o=n[n.length-1],s=o.radius,a=o.vector.clone().per().neg(),l=P.Add(o.point,P.Mul(a,s)),c=P.Add(o.point,P.Mul(a,-s));i+=`${Yt(l)}A${O(s)},${O(s)} 0 0 1 ${Yt(c)}T`}for(let o=1;o<r.length;o++)i+=Gn(r[o-1],r[o]);{const o=n[0],s=o.radius,a=o.vector.clone().per(),l=P.Add(o.point,P.Mul(a,s)),c=P.Add(o.point,P.Mul(a,-s));i+=`${Yt(l)}A${O(s)},${O(s)} 0 0 1 ${Yt(c)}Z`}return i}function lg(){const n=Y();return Z("zoom",()=>n.getZoomLevel()<.35,[n])}const lX=n=>n*.65+$N(n*Fe/2)*.35,cX=n=>({size:1+n,thinning:.5,streamline:.62+(1+n)/8*.06,smoothing:.62,easing:fn.easeOutSine,simulatePressure:!0}),uX=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:lX}),kT=n=>({size:1+n,thinning:0,streamline:.62+(1+n)/8*.06,smoothing:.62,simulatePressure:!1,easing:fn.linear});function Wv({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:fn.easeOutSine,last:e}}function cg(n,e,t,r){return{...r?kT(e):n.dash==="draw"?n.isPen?uX(e):cX(e):kT(e),last:n.isComplete||t}}function Wl(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(P.Cast));else{const r=Math.max(4,Math.floor(P.Dist(t.points[0],t.points[1])/16));e.push(...P.PointsBetween(t.points[0],t.points[1],r))}return e}function CT(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class ug extends ti{constructor(){super(...arguments);w(this,"hideResizeHandles",t=>Gv(t));w(this,"hideRotateHandle",t=>Gv(t));w(this,"hideSelectionBoundsFg",t=>Gv(t));w(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:Jp(i*l),y:Jp(o*c),z:u}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(t){const r=Wl(t.props.segments),i=yn[t.props.size];if(t.props.segments.length===1){const s=de.FromPoints(r);if(s.width<i*2&&s.height<i*2)return new pI({x:-i,y:-i,radius:i,isFilled:!0})}const o=ii(r,cg(t.props,i,!0,!0)).map(s=>s.point);return t.props.isClosed?new Bt({points:o,isFilled:t.props.fill!=="none"}):new ra({points:o})}component(t){var p;const r=Vt(),i=lg(),o=yn[t.props.size],s=Wl(t.props.segments),a=t.props.isComplete||((p=Bn(t.props.segments))==null?void 0:p.type)==="straight";let l=o;!i&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(l+=ns(t.id)()*(o/6));const c=cg(t.props,l,a,i);if(!i&&t.props.dash==="draw")return y.jsxs(cr,{id:t.id,children:[t.props.isClosed&&t.props.fill&&s.length>1?y.jsx(Tt,{theme:r,fill:t.props.isClosed?t.props.fill:"none",color:t.props.color,d:ms(ii(s,c),t.props.isClosed)}):null,y.jsx("path",{d:iX(s,c),strokeLinecap:"round",fill:r[t.props.color].solid})]});const u=ii(s,c),d=u.length<2,h=d?Kv(s[0],0):ms(u,t.props.isClosed);return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{theme:r,color:t.props.color,fill:d||t.props.isClosed?t.props.fill:"none",d:h}),y.jsx("path",{d:h,strokeLinecap:"round",fill:d?r[t.props.color].solid:"none",stroke:r[t.props.color].solid,strokeWidth:o,strokeDasharray:d?"none":CT(t,o),strokeDashoffset:"0"})]})}indicator(t){var d;const r=lg(),i=yn[t.props.size],o=Wl(t.props.segments);let s=i;!r&&!t.props.isPen&&t.props.dash==="draw"&&o.length===1&&(s+=ns(t.id)()*(i/6));const a=t.props.isComplete||((d=Bn(t.props.segments))==null?void 0:d.type)==="straight",l=cg(t.props,s,a,!0),c=ii(o,l),u=c.length>1?ms(c,t.props.isClosed):Kv(o[0],s);return y.jsx("path",{d:u})}toSvg(t,r){var f;const i=Wn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Nv(t.props.fill,i));const{color:o}=t.props,s=yn[t.props.size],a=Wl(t.props.segments),l=t.props.isComplete||((f=Bn(t.props.segments))==null?void 0:f.type)==="straight";let c=s;!t.props.isPen&&t.props.dash==="draw"&&a.length===1&&(c+=ns(t.id)()*(s/6));const u=cg(t.props,c,l,!1),d=ii(a,u),h=d.length>1?ms(d,t.props.isClosed):Kv(a[0],c);let p;if(t.props.dash==="draw"||d.length<2){$l(d,u);const m=Zu(d,u),v=document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d",Au(m,!0)),v.setAttribute("fill",i[o].solid),v.setAttribute("stroke-linecap","round"),p=v}else{const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",h),m.setAttribute("stroke",i[o].solid),m.setAttribute("fill","none"),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-width",s.toString()),m.setAttribute("stroke-dasharray",CT(t,s)),m.setAttribute("stroke-dashoffset","0"),p=m}const g=pr({fill:t.props.isClosed?t.props.fill:"none",d:h,color:t.props.color,theme:i});if(g){const m=document.createElementNS("http://www.w3.org/2000/svg","g");return m.appendChild(g),m.appendChild(p),m}return p}getCanvasSvgDefs(){return[Fv()]}expandSelectionOutlinePx(t){const r=t.props.dash==="draw"?1.6:1;return yn[t.props.size]*r/2}}w(ug,"type","draw"),w(ug,"props",Yz),w(ug,"migrations",Xz);function Kv(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Gv(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function dX(n,e,t={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:u=1/0}=t;let d=n.props.w*o,h=n.props.h*s;const p=new P(0,0);if(d>0){if(d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(i){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=h-c;break}case"right":case"left":{p.y=(h-c)/2;break}default:p.y=0}h=c}}else if(p.y=h,h=-h,h<c){switch(i){case"top_left":case"top":case"top_right":{p.y=-h;break}default:p.y=-c}h=c}const{x:g,y:f}=p.rot(n.rotation).add(r);return{x:g,y:f,props:{w:Math.min(l,d),h:Math.min(u,h)}}}const hX=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class dg extends Tl{constructor(){super(...arguments);w(this,"hideSelectionBoundsFg",t=>!this.canResize(t));w(this,"canEdit",()=>!0);w(this,"canUnmount",t=>{var r,i;return!!((i=(r=wo(t.props.url))==null?void 0:r.definition)!=null&&i.canUnmount)});w(this,"canResize",t=>{var r,i;return!!((i=(r=wo(t.props.url))==null?void 0:r.definition)!=null&&i.doesResize)});w(this,"canEditInReadOnly",()=>!0);w(this,"isAspectRatioLocked",t=>{var r;return((r=wo(t.props.url))==null?void 0:r.definition.isAspectRatioLocked)??!1});w(this,"onResize",(t,r)=>{const i=this.isAspectRatioLocked(t),o=wo(t.props.url);let s=(o==null?void 0:o.definition.minWidth)??200,a=(o==null?void 0:o.definition.minHeight)??200;if(i){const l=t.props.w/t.props.h;l>1?s*=l:a/=l}return dX(t,r,{minWidth:s,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(t){const{w:r,h:i,url:o}=t.props,s=Ef(t.id),a=S.useMemo(()=>dT(o),[o]),l=Z("is hovering",()=>{const{editingShapeId:h,hoveredShapeId:p}=this.editor.getCurrentPageState();if(h&&p!==h){const g=this.editor.getShape(h);if(g&&this.editor.isShapeOfType(g,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(t).rotation(),u=s||l;if((a==null?void 0:a.definition.type)==="github_gist"){const h=a.url.split("/").pop();if(!h)throw Error("No gist id!");return y.jsx(aa,{className:"tl-embed-container",id:t.id,children:y.jsx(pX,{id:h,width:O(r),height:O(i),isInteractive:u,pageRotation:c})})}const d=hX({...qz,...(a==null?void 0:a.definition.overridePermissions)??{}});return y.jsx(aa,{className:"tl-embed-container",id:t.id,children:a!=null&&a.definition?y.jsx("iframe",{className:"tl-embed",sandbox:d,src:a.embedUrl,width:O(r),height:O(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:Vv(c),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(t){const r=S.useMemo(()=>wo(t.props.url),[t.props.url]);return y.jsx("rect",{width:O(t.props.w),height:O(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}w(dg,"type","embed"),w(dg,"props",Zz),w(dg,"migrations",Jz);function pX({id:n,file:e,isInteractive:t,width:r,height:i,style:o,pageRotation:s}){return y.jsx("iframe",{className:"tl-embed",draggable:!1,width:O(r),height:O(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:Vv(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const fX=S.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=Y(),o=S.useCallback(l=>{l.key==="Enter"&&!l.nativeEvent.isComposing&&(Ft(l),l.currentTarget.blur(),i.setEditingShape(null))},[i]),s=S.useCallback(l=>{const c=i.getShape(n);if(!c)return;const u=c.props.name,d=l.currentTarget.value.trim();u!==d&&i.updateShapes([{id:n,type:"frame",props:{name:d}}],{squashing:!0})},[n,i]),a=S.useCallback(l=>{const c=i.getShape(n);if(!c)return;const u=c.props.name,d=l.currentTarget.value;u!==d&&i.updateShapes([{id:n,type:"frame",props:{name:d}}],{squashing:!0})},[n,i]);return y.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[y.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),PT(e,"Frame")+String.fromCharCode(8203)]})}),gX=function({id:n,name:e,width:t,height:r}){const i=Y(),o=Z("shape rotation",()=>Jr(i.getShapePageTransform(n).rotation()),[i,n]),s=Ef(n),a=S.useRef(null),l=S.useCallback(h=>{const p=Kn(h);i.getEditingShapeId()!==n&&(i.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:i.getShape(n),...p}),h.preventDefault())},[i,n]);S.useEffect(()=>{const h=a.current;h&&s&&(h.focus(),h.select(),requestAnimationFrame(()=>{document.activeElement!==h&&(h.focus(),h.select())}))},[a,s]);const c=((o+Math.PI/4)*(2/Math.PI)+4)%4,u=["top","left","bottom","right"][Math.floor(c)];let d;switch(u){case"top":d="";break;case"right":d=`translate(${O(t)}px, 0px) rotate(90deg)`;break;case"bottom":d=`translate(${O(t)}px, ${O(r)}px) rotate(180deg)`;break;case"left":d=`translate(0px, ${O(r)}px) rotate(270deg)`;break}return y.jsx("div",{className:"tl-frame-heading",style:{overflow:s?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(u==="top"||u==="bottom"?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${d} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:y.jsx("div",{className:"tl-frame-heading-hit-area",children:y.jsx(fX,{ref:a,id:n,name:e,isEditing:s})})})};function PT(n,e){return n.match(/^\s*$/)?e:n}class hg extends Tl{constructor(){super(...arguments);w(this,"canBind",()=>!0);w(this,"canEdit",()=>!0);w(this,"canReceiveNewChildrenOfType",(t,r)=>!t.isLocked);w(this,"canDropShapes",(t,r)=>!t.isLocked);w(this,"onDragShapesOver",(t,r)=>r.every(i=>i.parentId===t.id)?{shouldHint:!1}:(this.editor.reparentShapes(r.map(i=>i.id),t.id),{shouldHint:!0}));w(this,"onDragShapesOut",(t,r)=>{const i=this.editor.getShape(t.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(r,i.id):this.editor.reparentShapes(r,this.editor.getCurrentPageId())});w(this,"onResizeEnd",t=>{const r=this.editor.getShapePageBounds(t),i=this.editor.getSortedChildIdsForParent(t.id),o=[];for(const s of i){const a=this.editor.getShapePageBounds(s);r.includes(a)||o.push(s)}o.length>0&&this.editor.reparentShapes(o,this.editor.getCurrentPageId())});w(this,"onResize",(t,r)=>lI(t,r))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(t){return new ss({width:t.props.w,height:t.props.h,isFilled:!1})}component(t){const r=this.editor.getShapeGeometry(t).bounds,i=Vt(),o=Z("is creating this shape",()=>{var l;const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const a=s==null?void 0:s.info;return a?a.isCreating&&((l=this.editor.getOnlySelectedShape())==null?void 0:l.id)===t.id:!1},[t.id]);return y.jsxs(y.Fragment,{children:[y.jsx(cr,{children:y.jsx("rect",{className:we("tl-frame__body",{"tl-frame__creating":o}),width:r.width,height:r.height,fill:i.solid,stroke:i.text})}),o?null:y.jsx(gX,{id:t.id,name:t.props.name,width:r.width,height:r.height})]})}toSvg(t){const r=Wn({isDarkMode:this.editor.user.getIsDarkMode()}),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),i.appendChild(o);const s=((Jr(this.editor.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,a=["top","left","bottom","right"][Math.floor(s)];let l;switch(a){case"top":l="";break;case"right":l=`translate(${O(t.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":l=`translate(${O(t.props.w)}px, ${O(t.props.h)}px) rotate(180deg)`;break;case"left":l=`translate(0px, ${O(t.props.h)}px) rotate(270deg)`;break;default:l=""}const c={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:t.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},u=this.editor.textMeasure.measureTextSpans(PT(t.props.name,"Frame")+String.fromCharCode(8203),c),d=u[0],h=Bn(u),p=h.box.w+h.box.x-d.box.x,g=ig(this.editor,u,{offsetY:-c.height-2,...c});g.style.setProperty("transform",l);const f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-c.height-4+"px"),f.setAttribute("width",p+16+"px"),f.setAttribute("height",`${c.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),i.appendChild(f),i.appendChild(g),i}indicator(t){const r=this.editor.getShapeGeometry(t).bounds;return y.jsx("rect",{width:O(r.width),height:O(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}w(hg,"type","frame"),w(hg,"props",Qz),w(hg,"migrations",eN);function mX(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=de.From(t[0].box);for(const{box:o}of t)i.union(o);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function yX(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}const ET=oe.memo(function({id:n,type:e,text:t,size:r,labelColor:i,font:o,align:s,verticalAlign:a,wrap:l,bounds:c}){const{rInput:u,isEmpty:d,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:m,handleInputPointerDown:v,handleDoubleClick:b}=Uv(n,e,t),_=gs.normalizeTextForDom(t),x=_.length>0,C=yX(s),k=Vt();return!h&&!x?null:y.jsx("div",{className:"tl-text-label","data-font":o,"data-align":s,"data-hastext":!d,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:s==="middle"||C?"center":s,alignItems:a==="middle"?"center":a,...c?{top:c.minY,left:c.minX,width:c.width,height:c.height,position:"absolute"}:{}},children:y.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:Bl[r],lineHeight:Bl[r]*Jt.lineHeight+"px",minHeight:Jt.lineHeight+32,minWidth:0,color:k[i].solid},children:[y.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:_}),h&&y.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:p,onChange:g,onKeyDown:f,onBlur:m,onContextMenu:Ft,onPointerDown:v,onDoubleClick:b})]})})});function IT({bounds:n,editor:e,font:t,shape:r}){const i={fontSize:Bl[r.props.size],fontFamily:t,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(n.width),height:Math.ceil(n.height),padding:16,lineHeight:Jt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=e.textMeasure.measureTextSpans(r.props.text,i),s=mX(r.props.align,16,o,n.width);return s&&(i.offsetX=s),ig(e,o,i)}function bn(n){return`${O(n.x)},${O(n.y)} `}function MT(n=""){let e=0,t=0,r=0,i=0;function o(){const s=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<n.length+64;s++)e^=n.charCodeAt(s)|0,o();return o}function id(n){let e="M";const t=n.length;let r,i,o;for(let s=0,a=t;s<a;s+=3)r=n[s],i=n[s+1],o=n[s+2],e+=`${bn(r)}L${bn(i)}Q${bn(o)}`;return e+=`${bn(n[0])}`,e}function od(n,e,t,r,i){const o=[],s=MT(n);let a=e[0],l;const c=e.length;for(let u=0,d=c*i;u<d;u++){l=P.AddXY(e[(u+1)%c],s()*t,s()*t);const h=P.Sub(l,a),p=P.Len(h),g=P.Div(h,p).mul(Math.min(p/4,r));o.push(P.Add(a,g),P.Add(l,g.neg()),l),a=l}return o}function Yv(n,e,t){let r=`M ${bn(e[0])}L`,i=`M ${bn(e[0])}L`;const o=t/3,s=t*2,a=MT(n);let l=e[0],c,u=e[0],d;const h=e.length;for(let p=0,g=h-1;p<g;p++){c=e[p+1],d=P.AddXY(e[p+1],a()*o,a()*o);const f=P.Sub(c,l),m=P.Len(f),v=P.Div(f,m).mul(Math.min(m/4,s)),b=P.Add(l,v),_=P.Add(c,v.neg()),x=P.Sub(d,u),C=P.Len(x),k=P.Div(x,C).mul(Math.min(C/4,s)),E=P.Add(u,k),I=P.Add(d,k.neg());p===g-1?(r+=`${bn(b)}L ${bn(c)}`,i+=`${bn(E)}L ${bn(d)}`):(r+=`${bn(b)}L ${bn(_)}Q ${bn(c)}`,i+=`${bn(E)}L ${bn(I)}Q ${bn(d)}`,l=c,u=d)}return[r,r+i]}function TT(n,e){const t=Math.min(n,e)/2,r=Math.max(n,e)-t*2;return Math.PI*(t*2)+2*r}function wX(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*i)/t,s=n>e?[{type:"straight",start:new P(r,0),delta:new P(1,0)},{type:"arc",center:new P(n-r,r),startAngle:-Fe/2},{type:"straight",start:new P(n-r,e),delta:new P(-1,0)},{type:"arc",center:new P(r,r),startAngle:Fe/2}]:[{type:"straight",start:new P(n,r),delta:new P(0,1)},{type:"arc",center:new P(r,e-r),startAngle:0},{type:"straight",start:new P(0,e-r),delta:new P(0,-1)},{type:"arc",center:new P(r,r),startAngle:Fe}];let a=0;const l=[];for(let c=0;c<t;c++){const u=s[0];u.type==="straight"?l.push(P.Add(u.start,P.Mul(u.delta,a))):l.push(_P(u.center.x,u.center.y,r,u.startAngle+a/r)),a+=o;let d=u.type==="straight"?i:Fe*r;for(;a>d;)a-=d,s.push(s.shift()),d=s[0].type==="straight"?i:Fe*r}return l}const bX=(n,e,t,r,i)=>{switch(n){case"s":return e;case"m":return t;case"l":return r;case"xl":return i}};function sd(n,e,t,r){const i=ns(t),o=TT(n,e),s=Math.max(Math.ceil(o/bX(r,50,70,100,130)),6,Math.ceil(o/Math.min(n,e))),a=o/s*.2,l=Math.max(n-a*2,1),c=Math.max(e-a*2,1),u=(n-l)/2,d=(e-c)/2,h=TT(l,c)/s,p=wX(l,c,s).map(b=>b.addXY(u,d)),g=n<20?0:a*.3,f=e<20?0:a*.3,m=p.slice(0);for(let b=0;b<Math.floor(s/2);b++)m[b]=P.AddXY(m[b],i()*g,i()*f),m[s-b-1]=P.AddXY(m[s-b-1],i()*g,i()*f);const v=[];for(let b=0;b<m.length;b++){const _=b===m.length-1?0:b+1,x=m[b],C=m[_],k=p[b],E=p[_],I=P.Average([k,E]),T=P.Angle(k,E)-Math.PI/2,A=P.Dist(k,E),D=h-A,N=P.Dist(x,C)/A,U=(Math.max(u,d)+D)*N,R=P.Add(I,P.FromAngle(T,U));R.x<0?R.x=0:R.x>n&&(R.x=n),R.y<0?R.y=0:R.y>e&&(R.y=e);const B=AT(x,C,R),$=P.Dist(B||P.Average([x,C]),x);v.push({leftPoint:x,rightPoint:C,arcPoint:R,center:B,radius:$})}return v}function AT(n,e,t){const r=n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y,i=(n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y),o=(n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x),s=-i/(2*r),a=-o/(2*r);return!Number.isFinite(s)||!Number.isFinite(a)?null:new P(s,a)}function vX(n,e,t,r){const i=[],o=sd(n,e,t,r);for(const{center:s,radius:a,leftPoint:l,rightPoint:c}of o)i.push(...SX(l,c,s,a,10));return i}function ad(n,e,t,r){const i=sd(n,e,t,r);let o=`M${O(i[0].leftPoint.x)},${O(i[0].leftPoint.y)}`;for(const{leftPoint:s,rightPoint:a,radius:l,center:c}of i){if(c===null){o+=` L${O(a.x)},${O(a.y)}`;continue}const u=RT(s,a,c)?"0":"1";o+=` A${O(l)},${O(l)} 0 ${u},1 ${O(a.x)},${O(a.y)}`}return o+=" Z",o}function jT(n,e,t,r){const i=ns(t),o=r==="s"?.5:r==="m"?.7:r==="l"?.9:1.6,s=h=>h+i()*o*2,a=sd(n,e,t,r),l=a.reduce((h,p)=>h+P.Dist(p.leftPoint,p.rightPoint),0)/a.length>o*15?h=>new P(s(h.x),s(h.y)):h=>h;let c=`M${O(a[0].leftPoint.x)},${O(a[0].leftPoint.y)}`,u=l(a[0].leftPoint),d=`M${O(u.x)},${O(u.y)}`;for(const{leftPoint:h,center:p,rightPoint:g,radius:f,arcPoint:m}of a){if(p===null){c+=` L${O(g.x)},${O(g.y)}`;const k=l(g);d+=` L${O(k.x)},${O(k.y)}`,u=k;continue}const v=RT(h,g,p)?"0":"1";c+=` A${O(f)},${O(f)} 0 ${v},1 ${O(g.x)},${O(g.y)}`;const b=l(g),_=l(m),x=AT(u,b,_);if(!x){d+=` L${O(b.x)},${O(b.y)}`,u=b;continue}const C=Math.abs(P.Dist(x,u));d+=` A${O(C)},${O(C)} 0 ${v},1 ${O(b.x)},${O(b.y)}`,u=b}return c+d+" Z"}function SX(n,e,t,r,i){if(t===null)return[P.From(n),P.From(e)];const o=[],s=P.Angle(t,n),a=P.Angle(t,e),l=qp(s,a);for(let c=0;c<i;c++){const u=c/(i-1),d=s+l*u,h=_P(t.x,t.y,r,d);o.push(h)}return o}function RT(n,e,t){return(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x)>0}const xX=S.memo(function({dash:n,fill:e,color:t,strokeWidth:r,w:i,h:o,id:s,size:a}){const l=Vt(),c=ad(i,o,s,a),u=sd(i,o,s,a);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:l,d:c,fill:e,color:t}),y.jsx("g",{strokeWidth:r,stroke:l[t].solid,fill:"none",pointerEvents:"all",children:u.map(({leftPoint:d,rightPoint:h,center:p,radius:g},f)=>{const m=p?g*Jr(Jr(P.Angle(p,h))-Jr(P.Angle(p,d))):P.Dist(d,h),{strokeDasharray:v,strokeDashoffset:b}=wn(m,r,{style:n,start:"outset",end:"outset"});return y.jsx("path",{d:p?`M${d.x},${d.y}A${g},${g},0,0,1,${h.x},${h.y}`:`M${d.x},${d.y}L${h.x},${h.y}`,strokeDasharray:v,strokeDashoffset:b},f)})})]})});function _X({dash:n,fill:e,color:t,theme:r,strokeWidth:i,w:o,h:s,id:a,size:l}){const c=ad(o,s,a,l),u=sd(o,s,a,l),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("stroke-width",i.toString()),d.setAttribute("stroke",r[t].solid),d.setAttribute("fill","none");for(const{leftPoint:p,rightPoint:g,center:f,radius:m}of u){const v=f?m*Jr(Jr(P.Angle(f,g))-Jr(P.Angle(f,p))):P.Dist(p,g),{strokeDasharray:b,strokeDashoffset:_}=wn(v,i,{style:n,start:"outset",end:"outset"}),x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("d",f?`M${p.x},${p.y}A${m},${m},0,0,1,${g.x},${g.y}`:`M${p.x},${p.y}L${g.x},${g.y}`),x.setAttribute("stroke-dasharray",b.toString()),x.setAttribute("stroke-dashoffset",_.toString()),d.appendChild(x)}const h=pr({d:c,fill:e,color:t,theme:r});return oi(d,h)}const kX=S.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Vt(),a=n/2,l=e/2,c=Math.max(0,a),u=Math.max(0,l),d=Pu(c,u),{strokeDasharray:h,strokeDashoffset:p}=wn(d<64?d*2:d,t,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${u},0,1,1,${c*2},0a${c},${u},0,1,1,-${c*2},0`;return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:s,d:g,color:i,fill:o}),y.jsx("path",{d:g,strokeWidth:t,width:O(n),height:O(e),fill:"none",stroke:s[i].solid,strokeDasharray:h,strokeDashoffset:p,pointerEvents:"all"})]})});function CX({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=n/2,l=e/2,c=Math.max(0,a-t/2),u=Math.max(0,l-t/2),d=Pu(c,u),{strokeDasharray:h,strokeDashoffset:p}=wn(d<64?d*2:d,t,{style:r,snap:4,closed:!0}),g=`M${a-c},${l}a${c},${u},0,1,1,${c*2},0a${c},${u},0,1,1,-${c*2},0`,f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",g),f.setAttribute("stroke-width",t.toString()),f.setAttribute("width",n.toString()),f.setAttribute("height",e.toString()),f.setAttribute("fill","none"),f.setAttribute("stroke",o[i].solid),f.setAttribute("stroke-dasharray",h),f.setAttribute("stroke-dashoffset",p);const m=pr({d:g,fill:s,color:i,theme:o});return oi(f,m)}function OT(n,e){if(e>n){const r=n/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const t=e/2;return`
    M${t},0
    L${n-t},0
    a${t},${t},0,1,1,0,${t*2}
    L${t},${e}
    a${t},${t},0,1,1,0,${-t*2}
    Z`}function DT(n,e){if(n>e){const r=e/2;return Pu(r,r)+(n-r*2)*2}const t=n/2;return Pu(t,t)+(e-t*2)*2}const PX=S.memo(function({w:n,h:e,strokeWidth:t,dash:r,color:i,fill:o}){const s=Vt(),a=OT(n,e),l=DT(n,e),{strokeDasharray:c,strokeDashoffset:u}=wn(l<64?l*2:l,t,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:s,d:a,color:i,fill:o}),y.jsx("path",{d:a,strokeWidth:t,width:O(n),height:O(e),fill:"none",stroke:s[i].solid,strokeDasharray:c,strokeDashoffset:u,pointerEvents:"all"})]})});function LT({w:n,h:e,strokeWidth:t,dash:r,color:i,theme:o,fill:s}){const a=OT(n,e),l=DT(n,e),{strokeDasharray:c,strokeDashoffset:u}=wn(l<64?l*2:l,t,{style:r,snap:4,closed:!0}),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a),d.setAttribute("stroke-width",t.toString()),d.setAttribute("width",n.toString()),d.setAttribute("height",e.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),d.setAttribute("stroke-dasharray",c),d.setAttribute("stroke-dashoffset",u);const h=pr({d:a,fill:s,color:i,theme:o});return oi(d,h)}const EX=S.memo(function({dash:n,fill:e,color:t,strokeWidth:r,outline:i,lines:o}){const s=Vt(),a="M"+i[0]+"L"+i.slice(1)+"Z";return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:s,d:a,fill:e,color:t}),y.jsxs("g",{strokeWidth:r,stroke:s[t].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((l,c)=>{const u=i[c],d=i[(c+1)%i.length],h=P.Dist(u,d),{strokeDasharray:p,strokeDashoffset:g}=wn(h,r,{style:n,start:"outset",end:"outset"});return y.jsx("line",{x1:u.x,y1:u.y,x2:d.x,y2:d.y,strokeDasharray:p,strokeDashoffset:g},c)}),o&&o.map(([l,c],u)=>{const d=P.Dist(l,c),{strokeDasharray:h,strokeDashoffset:p}=wn(d,r,{style:n,start:"skip",end:"outset",snap:n==="dotted"?4:void 0});return y.jsx("path",{d:`M${l.x},${l.y}L${c.x},${c.y}`,stroke:s[t].solid,strokeWidth:r,fill:"none",strokeDasharray:h,strokeDashoffset:p},`line_fg_${u}`)})]})]})});function IX({dash:n,fill:e,color:t,theme:r,strokeWidth:i,outline:o,lines:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",i.toString()),a.setAttribute("stroke",r[t].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((c,u)=>{const d=o[u],h=o[(u+1)%o.length],p=P.Dist(d,h),{strokeDasharray:g,strokeDashoffset:f}=wn(p,i,{style:n}),m=document.createElementNS("http://www.w3.org/2000/svg","line");m.setAttribute("x1",d.x.toString()),m.setAttribute("y1",d.y.toString()),m.setAttribute("x2",h.x.toString()),m.setAttribute("y2",h.y.toString()),m.setAttribute("stroke-dasharray",g.toString()),m.setAttribute("stroke-dashoffset",f.toString()),a.appendChild(m)}),s)for(const[c,u]of s){const d=P.Dist(c,u),{strokeDasharray:h,strokeDashoffset:p}=wn(d,i,{style:n,start:"skip",end:"skip",snap:n==="dotted"?4:2}),g=document.createElementNS("http://www.w3.org/2000/svg","line");g.setAttribute("x1",c.x.toString()),g.setAttribute("y1",c.y.toString()),g.setAttribute("x2",u.x.toString()),g.setAttribute("y2",u.y.toString()),g.setAttribute("stroke-dasharray",h.toString()),g.setAttribute("stroke-dashoffset",p.toString()),a.appendChild(g)}const l=pr({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:e,color:t,theme:r});return oi(a,l)}const MX=S.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Vt(),l=jT(r,i,o,s);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:a,d:l,fill:n,color:e}),y.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function TX({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=jT(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const u=pr({d:l,fill:n,color:e,theme:r});return oi(c,u)}S.memo(function({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o}){const s=Vt(),a=Xv(n,e,t,r),l=FT(n,e,t,r);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:s,d:a,color:o,fill:i}),y.jsx("path",{d:l,fill:s[o].solid,strokeWidth:0,pointerEvents:"all"})]})});function AX({id:n,w:e,h:t,strokeWidth:r,fill:i,color:o,theme:s}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",FT(n,e,t,r)),a.setAttribute("fill",s[o].solid);const l=pr({d:Xv(n,e,t,r),fill:i,color:o,theme:s});return oi(a,l)}function zT(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function NT(n,e,t,r){const i=ns(n),o=e/2,s=t/2,a=Pu(o,s),l=[],c=We*i(),u=We+rt/2+Math.abs(i())*rt,d=Math.max(16,a/10);for(let h=0;h<d;h++){const p=h/(d-1),g=c+p*u,f=Math.cos(g),m=Math.sin(g);l.push(new P(o*f+e*.5+.05*i(),s*m+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?fn.easeInOutSine(p):fn.easeInExpo(p)))/2)))}return ii(l,zT(r))}function FT(n,e,t,r){const i=zT(r);return Au(Zu($l(NT(n,e,t,r),i),i))}function Xv(n,e,t,r){return ms(NT(n,e,t,r))}const jX=S.memo(function({id:n,outline:e,lines:t,fill:r,color:i,strokeWidth:o}){const s=Vt(),a=od(n,e,o/3,o*2,2);let l=id(a);if(t)for(const[d,h]of t)l+=`M${d.x},${d.y}L${h.x},${h.y}`;const c=od(n,e,0,o*2,1),u=id(c);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{d:u,fill:r,color:i,theme:s}),y.jsx("path",{d:l,stroke:s[i].solid,strokeWidth:o,fill:"none"})]})});function RX({id:n,outline:e,lines:t,fill:r,color:i,theme:o,strokeWidth:s}){const a=od(n,e,s/3,s*2,2);let l=id(a);if(t)for(const[p,g]of t)l+=`M${p.x},${p.y}L${g.x},${g.y}`;const c=od(n,e,0,s*2,1),u=id(c),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",l),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid),d.setAttribute("stroke-width",s.toString());const h=pr({d:u,fill:r,color:i,theme:o});return oi(d,h)}const OX=S.memo(function({fill:n,color:e,strokeWidth:t,w:r,h:i,id:o,size:s}){const a=Vt(),l=ad(r,i,o,s);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{theme:a,d:l,fill:n,color:e}),y.jsx("path",{d:l,stroke:a[e].solid,strokeWidth:t,fill:"none"})]})});function DX({fill:n,color:e,strokeWidth:t,theme:r,w:i,h:o,id:s,size:a}){const l=ad(i,o,s,a),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",t.toString()),c.setAttribute("stroke",r[e].solid),c.setAttribute("fill","none");const u=pr({d:l,fill:n,color:e,theme:r});return oi(c,u)}const $T=S.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Vt(),s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`;return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{d:u,color:i,fill:r,theme:o}),y.jsx("path",{d:u,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function LX({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=n/2,a=e/2,l=Math.max(0,s),c=Math.max(0,a),u=`M${s-l},${a}a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",u),d.setAttribute("stroke-width",t.toString()),d.setAttribute("width",n.toString()),d.setAttribute("height",e.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[i].solid);const h=pr({d:u,fill:r,color:i,theme:o});return oi(d,h)}const BT=S.memo(function({w:n,h:e,strokeWidth:t,fill:r,color:i}){const o=Vt(),s=qv(n,e);return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{d:s,color:i,fill:r,theme:o}),y.jsx("path",{d:s,stroke:o[i].solid,strokeWidth:t,fill:"none"})]})});function zX({w:n,h:e,strokeWidth:t,fill:r,color:i,theme:o}){const s=qv(n,e),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",s),a.setAttribute("stroke-width",t.toString()),a.setAttribute("width",n.toString()),a.setAttribute("height",e.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[i].solid);const l=pr({d:s,fill:r,color:i,theme:o});return oi(a,l)}function qv(n,e){let t;if(e>n){const r=n/2;t=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${n},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=e/2;t=`
    M${r},0
    L${n-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${e}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return t}const NX=S.memo(function({outline:n,lines:e,fill:t,color:r,strokeWidth:i}){const o=Vt();let s="M"+n[0]+"L"+n.slice(1)+"Z";if(e)for(const[a,l]of e)s+=`M${a.x},${a.y}L${l.x},${l.y}`;return y.jsxs(y.Fragment,{children:[y.jsx(Tt,{d:s,fill:t,color:r,theme:o}),y.jsx("path",{d:s,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});function FX({outline:n,lines:e,fill:t,color:r,strokeWidth:i,theme:o}){const s="M"+n[0]+"L"+n.slice(1)+"Z",a=s;let l=s;if(e)for(const[d,h]of e)l+=`M${d.x},${d.y}L${h.x},${h.y}`;const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",i.toString()),c.setAttribute("stroke",o[r].solid),c.setAttribute("fill","none");const u=pr({d:a,fill:t,color:r,theme:o});return oi(c,u)}const Zv=16,Or=17*3;class pg extends Tl{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});w(this,"onResize",(t,{handle:r,newPoint:i,scaleX:o,scaleY:s,initialShape:a})=>{let l=a.props.w*o,c=(a.props.h+a.props.growY)*s,u=0,d=0;if(t.props.text.trim()){let f=Math.max(Math.abs(l),Or),m=Math.max(Math.abs(c),Or);f<Or&&m===Or&&(f=Or),f===Or&&m<Or&&(m=Or);const v=fg(this.editor,{...t,props:{...t.props,w:f,h:m}}),b=Math.max(Math.abs(l),v.w)*Math.sign(l),_=Math.max(Math.abs(c),v.h)*Math.sign(c);u=Math.abs(b)-Math.abs(l),d=Math.abs(_)-Math.abs(c),l=b,c=_}const h=new P(0,0);o<0&&(h.x+=l),(r==="left"||r==="top_left"||r==="bottom_left")&&(h.x+=o<0?u:-u),s<0&&(h.y+=c),(r==="top"||r==="top_left"||r==="top_right")&&(h.y+=s<0?d:-d);const{x:p,y:g}=h.rot(t.rotation).add(i);return{x:p,y:g,props:{w:Math.max(Math.abs(l),1),h:Math.max(Math.abs(c),1),growY:0}}});w(this,"onBeforeCreate",t=>{if(!t.props.text)return t.props.growY?{...t,props:{...t.props,growY:0}}:void 0;const r=t.props.h,i=fg(this.editor,t).h;let o=null;if(i>r?o=i-r:t.props.growY&&(o=0),o!==null)return{...t,props:{...t.props,growY:o}}});w(this,"onBeforeUpdate",(t,r)=>{const i=t.props.text,o=r.props.text;if(i===o&&t.props.font===r.props.font&&t.props.size===r.props.size)return;if(i&&!o)return{...r,props:{...r.props,growY:0}};const s=t.props.w,a=t.props.h,l=fg(this.editor,r),c=l.w,u=l.h;if(!i&&o&&o.length===1){let h=Math.max(s,c),p=Math.max(a,u);return t.props.w<Or&&t.props.h<Or&&(h=Math.max(h,Or),p=Math.max(p,Or),h=Math.max(h,p),p=Math.max(h,p)),{...r,props:{...r.props,w:h,h:p,growY:0}}}let d=null;if(u>a?d=u-a:t.props.growY&&(d=0),d!==null)return{...r,props:{...r.props,growY:d,w:Math.max(r.props.w,c)}};if(c>t.props.w)return{...r,props:{...r.props,w:c}}});w(this,"onDoubleClick",t=>{if(this.editor.inputs.altKey)switch(t.props.geo){case"rectangle":return{...t,props:{geo:"check-box"}};case"check-box":return{...t,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(t){const r=Math.max(1,t.props.w),i=Math.max(1,t.props.h+t.props.growY),o=r/2,s=i/2,a=yn[t.props.size],l=t.props.fill!=="none";let c;switch(t.props.geo){case"cloud":{c=new Bt({points:vX(r,i,t.id,t.props.size),isFilled:l});break}case"triangle":{c=new Bt({points:[new P(o,0),new P(r,i),new P(0,i)],isFilled:l});break}case"diamond":{c=new Bt({points:[new P(o,0),new P(r,s),new P(o,i),new P(0,s)],isFilled:l});break}case"pentagon":{c=new Bt({points:Gw(r,i,5),isFilled:l});break}case"hexagon":{c=new Bt({points:Gw(r,i,6),isFilled:l});break}case"octagon":{c=new Bt({points:Gw(r,i,8),isFilled:l});break}case"ellipse":{c=new fI({width:r,height:i,isFilled:l});break}case"oval":{c=new U$({width:r,height:i,isFilled:l});break}case"star":{const f=We/5/2,m=Math.floor(5/4)*2,v=5*2-m,b=0,_=Math.floor(5/2)*2,x=Math.cos(-rt+m*f)*r/2,C=Math.cos(-rt+v*f)*r/2,k=Math.sin(-rt+b*f)*i/2,E=Math.sin(-rt+_*f)*i/2,I=r-Math.abs(x-C),T=i-Math.abs(E-k),A=r/2+C-(r/2-x),D=i/2+k-(i/2-E),N=1,U=(r-A)/2,R=(i-D)/2,B=(r+I)/2,$=(i+T)/2,q=B*N/2,G=$*N/2;c=new Bt({points:Array.from(Array(5*2)).map((L,V)=>{const J=-rt+V*f;return new P(U+(V%2?q:B)*Math.cos(J),R+(V%2?G:$)*Math.sin(J))}),isFilled:l});break}case"rhombus":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new P(f,0),new P(r,0),new P(r-f,i),new P(0,i)],isFilled:l});break}case"rhombus-2":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new P(0,0),new P(r-f,0),new P(r,i),new P(f,i)],isFilled:l});break}case"trapezoid":{const f=Math.min(r*.38,i*.38);c=new Bt({points:[new P(f,0),new P(r-f,0),new P(r,i),new P(0,i)],isFilled:l});break}case"arrow-right":{const f=Math.min(r,i)*.38,m=i*.16;c=new Bt({points:[new P(0,m),new P(r-f,m),new P(r-f,0),new P(r,i/2),new P(r-f,i),new P(r-f,i-m),new P(0,i-m)],isFilled:l});break}case"arrow-left":{const f=Math.min(r,i)*.38,m=i*.16;c=new Bt({points:[new P(f,0),new P(f,m),new P(r,m),new P(r,i-m),new P(f,i-m),new P(f,i),new P(0,i/2)],isFilled:l});break}case"arrow-up":{const f=r*.16,m=Math.min(r,i)*.38;c=new Bt({points:[new P(r/2,0),new P(r,m),new P(r-f,m),new P(r-f,i),new P(f,i),new P(f,m),new P(0,m)],isFilled:l});break}case"arrow-down":{const f=r*.16,m=Math.min(r,i)*.38;c=new Bt({points:[new P(f,0),new P(r-f,0),new P(r-f,i-m),new P(r,i-m),new P(r/2,i),new P(0,i-m),new P(f,i-m)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new ss({width:r,height:i,isFilled:l,isSnappable:!0});break}}const u=fg(this.editor,t),d=Math.min(r,Math.max(u.w,Math.min(32,Math.max(1,r-8)))),h=Math.min(i,Math.max(u.h,Math.min(32,Math.max(1,r-8)))),p=gg(t.props,a),g=p?p.map(f=>new ra({points:f})):[];return new os({children:[c,new ss({x:t.props.align==="start"?0:t.props.align==="end"?r-d:(r-d)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?i-h:(i-h)/2,width:d,height:h,isFilled:!0,isSnappable:!1,isLabel:!0}),...g],isSnappable:!1})}component(t){const{id:r,type:i,props:o}=t,s=yn[o.size],{w:a,color:l,labelColor:c,fill:u,dash:d,growY:h,font:p,align:g,verticalAlign:f,size:m,text:v}=o,b=()=>{const _=o.h+h;switch(o.geo){case"cloud":{if(d==="solid")return y.jsx(OX,{color:l,fill:u,strokeWidth:s,w:a,h:_,id:r,size:m});if(d==="dashed"||d==="dotted")return y.jsx(xX,{color:l,fill:u,strokeWidth:s,w:a,h:_,id:r,size:m,dash:d});if(d==="draw")return y.jsx(MX,{color:l,fill:u,strokeWidth:s,w:a,h:_,id:r,size:m});break}case"ellipse":{if(d==="solid")return y.jsx($T,{strokeWidth:s,w:a,h:_,color:l,fill:u});if(d==="dashed"||d==="dotted")return y.jsx(kX,{id:r,strokeWidth:s,w:a,h:_,dash:d,color:l,fill:u});if(d==="draw")return y.jsx($T,{strokeWidth:s,w:a,h:_,color:l,fill:u});break}case"oval":{if(d==="solid")return y.jsx(BT,{strokeWidth:s,w:a,h:_,color:l,fill:u});if(d==="dashed"||d==="dotted")return y.jsx(PX,{id:r,strokeWidth:s,w:a,h:_,dash:d,color:l,fill:u});if(d==="draw")return y.jsx(BT,{strokeWidth:s,w:a,h:_,color:l,fill:u});break}default:{const x=this.editor.getShapeGeometry(t),C=x instanceof os?x.children[0].vertices:x.vertices,k=gg(t.props,s);if(d==="solid")return y.jsx(NX,{fill:u,color:l,strokeWidth:s,outline:C,lines:k});if(d==="dashed"||d==="dotted")return y.jsx(EX,{dash:d,fill:u,color:l,strokeWidth:s,outline:C,lines:k});if(d==="draw")return y.jsx(jX,{id:r,fill:u,color:l,strokeWidth:s,outline:C,lines:k})}}};return y.jsxs(y.Fragment,{children:[y.jsx(cr,{id:r,children:b()}),y.jsxs(aa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h+o.growY},children:[y.jsx(ET,{id:r,type:i,font:p,fill:u,size:m,align:g,verticalAlign:f,text:v,labelColor:c,wrap:!0,bounds:o.geo==="cloud"?this.getGeometry(t).bounds:void 0}),t.props.url&&y.jsx(rd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){const{id:r,props:i}=t,{w:o,size:s}=i,a=i.h+i.growY,l=yn[s];switch(i.geo){case"ellipse":return i.dash==="draw"?y.jsx("path",{d:Xv(r,o,a,l)}):y.jsx("ellipse",{cx:o/2,cy:a/2,rx:o/2,ry:a/2});case"oval":return y.jsx("path",{d:qv(o,a)});case"cloud":return y.jsx("path",{d:ad(o,a,r,s)});default:{const c=this.editor.getShapeGeometry(t),u=c instanceof os?c.children[0].vertices:c.vertices;let d;if(i.dash==="draw"){const p=od(r,u,0,l*2,1);d=id(p)}else d="M"+u[0]+"L"+u.slice(1)+"Z";const h=gg(t.props,l);if(h)for(const[p,g]of h)d+=`M${p.x},${p.y}L${g.x},${g.y}`;return y.jsx("path",{d})}}}toSvg(t,r){const{id:i,props:o}=t,s=yn[o.size],a=Wn({isDarkMode:this.editor.user.getIsDarkMode()});r.addExportDef(Nv(t.props.fill,a));let l;switch(o.geo){case"ellipse":{switch(o.dash){case"draw":l=AX({id:i,w:o.w,h:o.h,color:o.color,fill:o.fill,strokeWidth:s,theme:a});break;case"solid":l=LX({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=CX({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break}break}case"oval":{switch(o.dash){case"draw":l=LT({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break;case"solid":l=zX({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:l=LT({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a})}break}case"cloud":{switch(o.dash){case"draw":l=TX({id:i,strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,theme:a});break;case"solid":l=DX({strokeWidth:s,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,id:i,theme:a});break;default:l=_X({id:i,strokeWidth:s,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a,size:o.size})}break}default:{const c=this.editor.getShapeGeometry(t),u=c instanceof os?c.children[0].vertices:c.vertices,d=gg(t.props,s);switch(o.dash){case"draw":l=RX({id:i,fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break;case"solid":l=FX({fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break;default:l=IX({dash:o.dash,fill:o.fill,color:o.color,strokeWidth:s,outline:u,lines:d,theme:a});break}break}}if(o.text){const c=this.editor.getShapeGeometry(t).bounds;r.addExportDef(og(t.props.font));const u=IT({editor:this.editor,shape:t,font:mu[t.props.font],bounds:c}),d=u.cloneNode(!0);d.setAttribute("fill",a[t.props.labelColor].solid),d.setAttribute("stroke","none");const h=u.cloneNode(!0);h.setAttribute("stroke-width","2"),h.setAttribute("fill",a.background),h.setAttribute("stroke",a.background);const p=document.createElementNS("http://www.w3.org/2000/svg","g");if(p.append(h),p.append(d),l.nodeName==="g")return l.appendChild(p),l;{const g=document.createElementNS("http://www.w3.org/2000/svg","g");return g.appendChild(l),g.appendChild(p),g}}return l}getCanvasSvgDefs(){return[Fv()]}}w(pg,"type","geo"),w(pg,"props",tN),w(pg,"migrations",nN);function fg(n,e){const t=e.props.text;if(!t)return{w:0,h:0};const r=n.textMeasure.measureText("w",{...Jt,fontFamily:yo[e.props.font],fontSize:Bl[e.props.size],maxWidth:100}),i={s:2,m:3.5,l:5,xl:10},o=n.textMeasure.measureText(t,{...Jt,fontFamily:yo[e.props.font],fontSize:Bl[e.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+i[e.props.size]),Math.ceil(e.props.w-Zv*2))});return{w:o.w+Zv*2,h:o.h+Zv*2}}function gg(n,e){switch(n.geo){case"x-box":return $X(n.w,n.h,e,n.dash);case"check-box":return BX(n.w,n.h);default:return}}function $X(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new P(0,0),new P(n/2,e/2)],[new P(n,e),new P(n/2,e/2)],[new P(0,e),new P(n/2,e/2)],[new P(n,0),new P(n/2,e/2)]];const o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new P(o(t*i),s(t*i)),new P(o(n-t*i),s(e-t*i))],[new P(o(t*i),s(e-t*i)),new P(o(n-t*i),s(t*i))]]}function BX(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,o=a=>Math.max(0,Math.min(n,a)),s=a=>Math.max(0,Math.min(e,a));return[[new P(o(r+t*.25),s(i+t*.52)),new P(o(r+t*.45),s(i+t*.82))],[new P(o(r+t*.45),s(i+t*.82)),new P(o(r+t*.82),s(i+t*.22))]]}function UX(){const[n,e]=S.useState(!1);return S.useEffect(()=>{const t=CSS.supports("color","color(display-p3 1 1 1)"),r=matchMedia("(color-gamut: p3)");e(t&&r.matches);const i=()=>e(t&&r.matches);return r.addEventListener("change",i),()=>r.removeEventListener("change",i)},[]),Z(nt.forceSrgb)||!n?"srgb":"p3"}const UT=.35,VT=.82;class mg extends ti{constructor(){super(...arguments);w(this,"hideResizeHandles",t=>yg(t));w(this,"hideRotateHandle",t=>yg(t));w(this,"hideSelectionBoundsFg",t=>yg(t));w(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=[];for(const a of t.props.segments)s.push({...a,points:a.points.map(({x:l,y:c,z:u})=>({x:i*l,y:o*c,z:u}))});return{props:{segments:s}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(t){const r=Kl(t);if(yg(t))return new pI({x:-r/2,y:-r/2,radius:r/2,isFilled:!0});const{strokePoints:i,sw:o}=HT(t,r,!0),s=Wv({strokeWidth:o,showAsComplete:!0});return $l(i,s),new Bt({points:Zu(i,s),isFilled:!0})}component(t){return y.jsx(KT,{strokeWidth:Kl(t),shape:t,opacity:UT})}backgroundComponent(t){return y.jsx(KT,{strokeWidth:Kl(t),shape:t,opacity:VT})}indicator(t){var d;const r=lg(),i=Kl(t),o=Wl(t.props.segments);let s=i;!r&&!t.props.isPen&&o.length===1&&(s+=ns(t.id)()*(i/6));const a=t.props.isComplete||((d=Bn(t.props.segments))==null?void 0:d.type)==="straight",l=Wv({strokeWidth:i,showAsComplete:a}),c=ii(o,l);let u;return c.length<2?u=HX(o[0],s):u=ms(c,!1),y.jsx("path",{d:u})}toSvg(t){const r=Wn({isDarkMode:this.editor.user.getIsDarkMode()});return GT(Kl(t),t,UT,r)}toBackgroundSvg(t){const r=Wn({isDarkMode:this.editor.user.getIsDarkMode()});return GT(Kl(t),t,VT,r)}}w(mg,"type","highlight"),w(mg,"props",oN),w(mg,"migrations",sN);function VX(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function HX(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function HT(n,e,t){var a;const r=Wl(n.props.segments),i=n.props.isComplete||((a=Bn(n.props.segments))==null?void 0:a.type)==="straight";let o=e;!t&&!n.props.isPen&&r.length===1&&(o+=ns(n.id)()*(e/6));const s=Wv({strokeWidth:o,showAsComplete:i});return{strokePoints:ii(r,s),sw:o}}function WT(n,e,t){const{strokePoints:r,sw:i}=HT(n,e,t);return{solidStrokePath:r.length>1?ms(r,!1):VX(n.props.segments[0].points[0]),sw:i}}function KT({strokeWidth:n,shape:e,opacity:t}){const r=Vt(),i=lg(),{solidStrokePath:o,sw:s}=WT(e,n,i),a=UX(),l=r[e.props.color].highlight[a];return y.jsx(cr,{id:e.id,style:{opacity:t},children:y.jsx("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:l,strokeWidth:s})})}function GT(n,e,t,r){const{solidStrokePath:i,sw:o}=WT(e,n,!1),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d",i),s.setAttribute("fill","none"),s.setAttribute("stroke",r[e.props.color].highlight.srgb),s.setAttribute("stroke-width",`${o}`),s.setAttribute("opacity",`${t}`),s}function Kl(n){return ps[n.props.size]*1.12}function yg(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function YT(){const[n,e]=S.useState(!1);return S.useEffect(()=>{const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}const WX=async n=>new Promise((e,t)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>t(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=n}),KX=async n=>{const e=await WX(n),t=document.createElement("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");if(r)return r.drawImage(e,0,0),t.toDataURL()};async function GX(n){const e=await(await fetch(n)).blob();return new Promise((t,r)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=r,i.readAsDataURL(e)})}class wg extends Tl{constructor(){super(...arguments);w(this,"isAspectRatioLocked",()=>!0);w(this,"canCrop",()=>!0);w(this,"onDoubleClick",t=>{const r=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;!r||!(r.props.src&&"mimeType"in r.props&&r.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:t.id,props:{playing:!t.props.playing}}])});w(this,"onDoubleClickEdge",t=>{const r=t.props;if(!r||this.editor.getCroppingShapeId()!==t.id)return;const i=cn(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,s=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,a=new P(i.topLeft.x*o,i.topLeft.y*s).rot(t.rotation),l={id:t.id,type:t.type,x:t.x-a.x,y:t.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:s}};this.editor.updateShapes([l])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(t){var d,h;const r=XT(t),i=dI(t.id),o=YT(),[s,a]=S.useState(""),l=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;if((l==null?void 0:l.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const c=Z("onlySelectedShape",()=>{var p;return t.id===((p=this.editor.getOnlySelectedShape())==null?void 0:p.id)},[this.editor])&&i&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),u=o&&(((d=l==null?void 0:l.props.mimeType)==null?void 0:d.includes("video"))||((h=l==null?void 0:l.props.mimeType)==null?void 0:h.includes("gif")));return S.useEffect(()=>{if(l!=null&&l.props.src&&"mimeType"in l.props&&(l==null?void 0:l.props.mimeType)==="image/gif"){let p=!1;return(async()=>{const g=await KX(l.props.src);p||g&&a(g)})(),()=>{p=!0}}},[o,l==null?void 0:l.props]),y.jsxs(y.Fragment,{children:[(l==null?void 0:l.props.src)&&c&&y.jsx("div",{style:r,children:y.jsx("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!t.props.playing||u?s:l.props.src})`},draggable:!1})}),y.jsxs(aa,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h},children:[y.jsxs("div",{className:"tl-image-container",style:r,children:[l!=null&&l.props.src?y.jsx("div",{className:"tl-image",style:{backgroundImage:`url(${!t.props.playing||u?s:l.props.src})`},draggable:!1}):null,(l==null?void 0:l.props.isAnimated)&&!t.props.playing&&y.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in t.props&&t.props.url&&y.jsx(rd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(t){return dI(t.id)?null:y.jsx("rect",{width:O(t.props.w),height:O(t.props.h)})}async toSvg(t){var l;const r=document.createElementNS("http://www.w3.org/2000/svg","g");let i=((l=t.props.assetId?this.editor.getAsset(t.props.assetId):null)==null?void 0:l.props.src)||"";i&&i.startsWith("http")&&(i=await GX(i)||"");const o=document.createElementNS("http://www.w3.org/2000/svg","image");o.setAttributeNS("http://www.w3.org/1999/xlink","href",i);const s=XT(t),a=t.props.crop;if(s.transform&&a){const{transform:c,width:u,height:d}=s,h=(a.bottomRight.x-a.topLeft.x)*u,p=(a.bottomRight.y-a.topLeft.y)*d,g=[new P(0,0),new P(h,0),new P(h,p),new P(0,p)],f=document.createElementNS("http://www.w3.org/2000/svg","polygon");f.setAttribute("points",g.map(_=>`${_.x},${_.y}`).join(" "));const m=document.createElementNS("http://www.w3.org/2000/svg","clipPath");m.setAttribute("id","cropClipPath"),m.appendChild(f);const v=document.createElementNS("http://www.w3.org/2000/svg","defs");v.appendChild(m),r.appendChild(v);const b=document.createElementNS("http://www.w3.org/2000/svg","g");b.setAttribute("clip-path","url(#cropClipPath)"),o.setAttribute("width",u.toString()),o.setAttribute("height",d.toString()),o.style.transform=c,b.appendChild(o),r.appendChild(b)}else o.setAttribute("width",t.props.w.toString()),o.setAttribute("height",t.props.h.toString()),r.appendChild(o);return r}}w(wg,"type","image"),w(wg,"props",lN),w(wg,"migrations",cN);function XT(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,o=-t.x*r,s=-t.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function Jv(n,e){const{start:t,end:r}=n;return e?`M${O(t.x)},${O(t.y)} L${O(r.x)},${O(r.y)} `:`${O(r.x)},${O(r.y)} `}function Qv(n,e){const{a:t,b:r,c:i,d:o}=n;return P.Equals(t,o)?"":`${e?`M${O(t.x)},${O(t.y)}`:""}C${O(r.x)},${O(r.y)} ${O(i.x)},${O(i.y)} ${O(o.x)},${O(o.y)}`}function qT(n,e){let t=n.segments.reduce((r,i,o)=>r+Qv(i,o===0),"");return e&&(t+="Z"),t}function YX(n,e){let t=n.segments.reduce((r,i,o)=>r+Jv(i,o===0),"");return e&&(t+="Z"),t}function ZT(n,e=!1){return n instanceof ra?YX(n,e):qT(n,e)}function JT(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function QT(n,e,t){const r=e.vertices,i=JT(t);return ii(r,i)}function XX(n,e,t){const r=JT(t);return Zu($l(QT(n,e,t),r),r)}function eA(n,e,t){const r=XX(n,e,t);return Au(r)}function qX(n,e,t){if(n.props.dash==="draw"){const r=QT(n,e,t);return ms(r)}return ZT(e)}const ZX=new pb;class bg extends ti{constructor(){super(...arguments);w(this,"hideResizeHandles",()=>!0);w(this,"hideRotateHandle",()=>!0);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"hideSelectionBoundsBg",()=>!0);w(this,"onResize",(t,r)=>{const{scaleX:i,scaleY:o}=r,s=cn(t.props.handles);return Object.values(t.props.handles).forEach(({id:a,x:l,y:c})=>{s[a].x=l*i,s[a].y=c*o}),{props:{handles:s}}});w(this,"onHandleChange",(t,{handle:r})=>{const i=cn(t);switch(r.id){case"start":case"end":{i.props.handles[r.id]={...i.props.handles[r.id],x:r.x,y:r.y};break}default:{const o="handle:"+r.index,s=t.props.handles[o];s?i.props.handles[o]={...s,x:r.x,y:r.y}:i.props.handles[o]={id:o,type:"vertex",canBind:!1,index:r.index,x:r.x,y:r.y};break}}return i})}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,canSnap:!0,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,canSnap:!0,index:"a2",x:.1,y:.1}}}}getGeometry(t){return ld(t)}getHandles(t){return ZX.get(t.props,()=>{const r=t.props.handles,i=ld(t),o=Object.values(r).sort(mn),s=o.slice();for(let a=0;a<i.segments.length;a++){const l=i.segments[a].midPoint(),c=Nu(o[a].index,o[a+1].index);s.push({id:`mid-${a}`,type:"create",index:c,x:l.x,y:l.y})}return s.sort(mn)})}getOutlineSegments(t){return this.editor.getShapeGeometry(t).segments.map(r=>r.vertices)}component(t){const r=Vt(),i=ld(t),o=yn[t.props.size],{dash:s,color:a}=t.props;if(t.props.spline==="line"){if(s==="solid"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:c,fill:"none",color:a,theme:r}),y.jsx("path",{d:c,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}if(s==="dashed"||s==="dotted"){const l=i.points,c="M"+l[0]+"L"+l.slice(1);return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:c,fill:"none",color:a,theme:r}),y.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((u,d)=>{const{strokeDasharray:h,strokeDashoffset:p}=wn(u.length,o,{style:s,start:d>0?"outset":"none",end:d<i.segments.length-1?"outset":"none"});return y.jsx("path",{strokeDasharray:h,strokeDashoffset:p,d:Jv(u,!0),fill:"none"},d)})})]})}if(s==="draw"){const l=i.points,[c,u]=Yv(t.id,l,o);return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:c,fill:"none",color:a,theme:r}),y.jsx("path",{d:u,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}}if(t.props.spline==="cubic"){const l=ZT(i);if(s==="solid")return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:l,fill:"none",color:a,theme:r}),y.jsx("path",{strokeWidth:o,stroke:r[a].solid,fill:"none",d:l})]});if(s==="dashed"||s==="dotted")return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:l,fill:"none",color:a,theme:r}),y.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:i.segments.map((c,u)=>{const{strokeDasharray:d,strokeDashoffset:h}=wn(c.length,o,{style:s,start:u>0?"outset":"none",end:u<i.segments.length-1?"outset":"none"});return y.jsx("path",{strokeDasharray:d,strokeDashoffset:h,d:Qv(c,!0),fill:"none"},u)})})]});if(s==="draw")return y.jsxs(cr,{id:t.id,children:[y.jsx(Tt,{d:l,fill:"none",color:a,theme:r}),y.jsx("path",{d:eA(t,i,o),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid})]})}}indicator(t){const r=yn[t.props.size],i=ld(t),{dash:o}=t.props;let s;if(t.props.spline==="line"){const a=i.points;if(o==="solid"||o==="dotted"||o==="dashed")s="M"+a[0]+"L"+a.slice(1);else{const[l]=Yv(t.id,a,r);s=l}}else s=qX(t,i,r);return y.jsx("path",{d:s})}toSvg(t){const r=Wn({isDarkMode:this.editor.user.getIsDarkMode()})[t.props.color].solid,i=ld(t),o=yn[t.props.size];switch(t.props.dash){case"draw":{let s;if(i instanceof If)s=eA(t,i,o);else{const[l,c]=Yv(t.id,i.points,o);s=c}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}case"solid":{let s;if(i instanceof If)s=qT(i,!1);else{const l=i.points;s="M"+l[0]+"L"+l.slice(1)}const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("stroke-width",o+"px"),a.setAttribute("stroke",r),a.setAttribute("fill","none"),a.setAttribute("d",s),a}default:{const{segments:s}=i,a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("stroke",r),a.setAttribute("stroke-width",o.toString());const l=i instanceof If?Qv:Jv;return s.forEach((c,u)=>{const d=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:h,strokeDashoffset:p}=wn(c.length,o,{style:t.props.dash,start:u>0?"outset":"none",end:u<s.length-1?"outset":"none"});d.setAttribute("stroke-dasharray",h.toString()),d.setAttribute("stroke-dashoffset",p.toString()),d.setAttribute("d",l(c,!0)),d.setAttribute("fill","none"),a.appendChild(d)}),a}}}}w(bg,"type","line"),w(bg,"props",hN),w(bg,"migrations",pN);function ld(n){const{spline:e,handles:t}=n.props,r=Object.values(t).sort(mn).map(P.From);switch(e){case"cubic":return new If({points:r});case"line":return new ra({points:r})}}const bo=200;class vg extends ti{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"hideResizeHandles",()=>!0);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"onBeforeCreate",t=>tA(this.editor,t,t.props.growY));w(this,"onBeforeUpdate",(t,r)=>{if(!(t.props.text===r.props.text&&t.props.font===r.props.font&&t.props.size===r.props.size))return tA(this.editor,r,t.props.growY)});w(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t;o.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(t){return bo+t.props.growY}getGeometry(t){const r=this.getHeight(t);return new ss({width:bo,height:r,isFilled:!0})}component(t){const{id:r,type:i,props:{color:o,font:s,size:a,align:l,text:c,verticalAlign:u}}=t,d=Vt(),h=o==="black"?"yellow":o;return y.jsxs(y.Fragment,{children:[y.jsx("div",{style:{position:"absolute",width:bo,height:this.getHeight(t)},children:y.jsxs("div",{className:"tl-note__container",style:{color:d[h].solid,backgroundColor:d[h].solid},children:[y.jsx("div",{className:"tl-note__scrim"}),y.jsx(ET,{id:r,type:i,font:s,size:a,align:l,verticalAlign:u,text:c,labelColor:"black",wrap:!0})]})}),"url"in t.props&&t.props.url&&y.jsx(rd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){return y.jsx("rect",{rx:"7",width:O(bo),height:O(this.getHeight(t))})}toSvg(t,r){r.addExportDef(og(t.props.font));const i=Wn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=document.createElementNS("http://www.w3.org/2000/svg","g"),a=t.props.color==="black"?"yellow":t.props.color,l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width",bo.toString()),l.setAttribute("height",o.height.toString()),l.setAttribute("fill",i[a].solid),l.setAttribute("stroke",i[a].solid),l.setAttribute("stroke-width","1"),s.appendChild(l);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("rx","10"),c.setAttribute("width",bo.toString()),c.setAttribute("height",o.height.toString()),c.setAttribute("fill",i.background),c.setAttribute("opacity",".28"),s.appendChild(c);const u=IT({editor:this.editor,shape:t,font:mu[t.props.font],bounds:o});return u.setAttribute("fill",i.text),u.setAttribute("stroke","none"),s.appendChild(u),s}}w(vg,"type","note"),w(vg,"props",fN),w(vg,"migrations",gN);function tA(n,e,t=0){const r=n.textMeasure.measureText(e.props.text,{...Jt,fontFamily:yo[e.props.font],fontSize:Bl[e.props.size],maxWidth:bo-34}).h+34;let i=null;if(r>bo?i=r-bo:t&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}}function JX(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i}){const o=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),s=new P(0,0);t<0&&(s.x=-(e.width*o)),r<0&&(s.y=-(e.height*o));const{x:a,y:l}=P.Add(i,s.rot(n.rotation));return{x:a,y:l,props:{scale:o*n.props.scale}}}const QX=new pb;class Sg extends ti{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"isAspectRatioLocked",()=>!0);w(this,"onResize",(t,r)=>{const{initialBounds:i,initialShape:o,scaleX:s,handle:a}=r;if(r.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:t.id,type:t.type,...JX(t,r)};{const l=i.width;let c=l*s;const u=new P(0,0);c=Math.max(1,Math.abs(c)),a==="left"?(u.x=l-c,s<0&&(u.x+=c)):s<0&&(u.x-=c);const{x:d,y:h}=u.rot(t.rotation).add(o);return{id:t.id,type:t.type,x:d,y:h,props:{w:c/o.props.scale,autoSize:!1}}}});w(this,"onBeforeCreate",t=>{if(!t.props.autoSize||t.props.text.trim())return;const r=this.getMinDimensions(t);return{...t,x:t.x-r.width/2,y:t.y-r.height/2}});w(this,"onEditEnd",t=>{const{id:r,type:i,props:{text:o}}=t,s=t.props.text.trimEnd();s.length===0?this.editor.deleteShapes([t.id]):s!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:o.trimEnd()}}])});w(this,"onBeforeUpdate",(t,r)=>{if(!r.props.autoSize)return;const i=t.props.size!==r.props.size||t.props.align!==r.props.align||t.props.font!==r.props.font||t.props.scale!==1&&r.props.scale===1,o=t.props.text!==r.props.text;if(!i&&!o)return;const s=this.getMinDimensions(t),a=nA(this.editor,r.props),l=s.width*t.props.scale,c=s.height*t.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.align){case"middle":{h=new P((u-l)/2,o?0:(d-c)/2);break}case"end":{h=new P(u-l,o?0:(d-c)/2);break}default:{if(o)break;h=new P(0,(d-c)/2);break}}if(h){h.rot(r.rotation);const{x:p,y:g}=r;return{...r,x:p-h.x,y:g-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}});w(this,"onDoubleClickEdge",t=>{if(!t.props.autoSize)return{id:t.id,type:t.type,props:{autoSize:!0}};if(t.props.scale!==1)return{id:t.id,type:t.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(t){return QX.get(t.props,r=>nA(this.editor,r))}getGeometry(t){const{scale:r}=t.props,{width:i,height:o}=this.getMinDimensions(t);return new ss({width:i*r,height:o*r,isFilled:!0})}component(t){const{id:r,type:i,props:{text:o,color:s}}=t,a=Wn({isDarkMode:this.editor.user.getIsDarkMode()}),{width:l,height:c}=this.getMinDimensions(t),{rInput:u,isEmpty:d,isEditing:h,handleFocus:p,handleChange:g,handleKeyDown:f,handleBlur:m,handleInputPointerDown:v,handleDoubleClick:b}=Uv(r,i,o);return y.jsx(aa,{id:t.id,children:y.jsxs("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":t.props.font,"data-align":t.props.align,"data-hastext":!d,"data-isediting":h,"data-textwrap":!0,style:{fontSize:ps[t.props.size],lineHeight:ps[t.props.size]*Jt.lineHeight+"px",transform:`scale(${t.props.scale})`,transformOrigin:"top left",width:Math.max(1,l),height:Math.max(ps[t.props.size]*Jt.lineHeight,c),color:a[s].solid},children:[y.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:o}),h?y.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:o,onFocus:p,onChange:g,onKeyDown:f,onBlur:m,onTouchEnd:Ft,onContextMenu:Ft,onPointerDown:v,onDoubleClick:b}):null]})})}indicator(t){const r=this.editor.getShapeGeometry(t).bounds,i=Y();return t.props.autoSize&&i.getEditingShapeId()===t.id?null:y.jsx("rect",{width:O(r.width),height:O(r.height)})}toSvg(t,r){r.addExportDef(og(t.props.font));const i=Wn({isDarkMode:this.editor.user.getIsDarkMode()}),o=this.editor.getShapeGeometry(t).bounds,s=t.props.text,a=o.width/(t.props.scale??1),l=o.height/(t.props.scale??1),c={fontSize:ps[t.props.size],fontFamily:mu[t.props.font],textAlign:t.props.align,verticalTextAlign:"middle",width:a,height:l,padding:0,lineHeight:Jt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},u=i[t.props.color].solid,d=document.createElementNS("http://www.w3.org/2000/svg","g"),h=ig(this.editor,this.editor.textMeasure.measureTextSpans(s,c),{...c,stroke:i.background,strokeWidth:2,fill:i.background,padding:0}),p=h.cloneNode(!0);return p.setAttribute("fill",u),p.setAttribute("stroke","none"),d.append(h),d.append(p),d}}w(Sg,"type","text"),w(Sg,"props",mN),w(Sg,"migrations",yN);function nA(n,e){const{font:t,text:r,autoSize:i,size:o,w:s}=e,a=i?16:Math.max(16,s),l=ps[o],c=i?null:Math.floor(Math.max(a,s)),u=n.textMeasure.measureText(r,{...Jt,fontFamily:yo[t],fontSize:l,maxWidth:c});return i&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(l,u.h)}}class xg extends Tl{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(t){return y.jsx(tq,{shape:t,videoUtil:this})}indicator(t){return y.jsx("rect",{width:O(t.props.w),height:O(t.props.h)})}toSvg(t){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","image");return i.setAttributeNS("http://www.w3.org/1999/xlink","href",eq(t.id)),i.setAttribute("width",t.props.w.toString()),i.setAttribute("height",t.props.h.toString()),r.appendChild(i),r}}w(xg,"type","video"),w(xg,"props",wN),w(xg,"migrations",bN);function eq(n){const e=n.split(":")[1],t=document.querySelector(`.tl-video-shape-${e}`);if(t){const r=document.createElement("canvas");return r.width=t.videoWidth,r.height=t.videoHeight,r.getContext("2d").drawImage(t,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+e+" not found")}const tq=ze(function(n){const{shape:e,videoUtil:t}=n,r=t.editor.getShapeGeometry(e).bounds.w*t.editor.getZoomLevel()>=110,i=e.props.assetId?t.editor.getAsset(e.props.assetId):null,{time:o,playing:s}=e.props,a=Ef(e.id),l=YT(),c=oe.useRef(null),u=oe.useCallback(m=>{const v=m.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:v.currentTime}}])},[e.id,t.editor]),d=oe.useCallback(m=>{const v=m.currentTarget;t.editor.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:v.currentTime}}])},[e.id,t.editor]),h=oe.useCallback(m=>{const v=m.currentTarget;a&&t.editor.updateShapes([{type:"video",id:e.id,props:{time:v.currentTime}}])},[a,e.id,t.editor]),[p,g]=oe.useState(!1),f=oe.useCallback(m=>{const v=m.currentTarget;o!==v.currentTime&&(v.currentTime=o),s||v.pause(),g(!0)},[s,o]);return oe.useEffect(()=>{const m=c.current;m&&(p&&!a&&o!==m.currentTime&&(m.currentTime=o),a&&document.activeElement!==m&&m.focus())},[a,p,o]),oe.useEffect(()=>{if(l){const m=c.current;m.pause(),m.currentTime=0}},[c,l]),y.jsxs(y.Fragment,{children:[y.jsx(aa,{id:e.id,children:y.jsx("div",{className:"tl-counter-scaled",children:i!=null&&i.props.src?y.jsx("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&r,onPlay:u,onPause:d,onTimeUpdate:h,onLoadedData:f,hidden:!p,children:y.jsx("source",{src:i.props.src})}):null})}),"url"in e.props&&e.props.url&&y.jsx(rd,{url:e.props.url,zoomLevel:t.editor.getZoomLevel()})]})}),nq=[Sg,ag,ug,pg,vg,bg,hg,sg,mg,dg,wg,xg];function rq(n){return[n.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?(n.getContainer().focus(),n.updateViewportScreenBounds()):(n.complete(),n.getContainer().blur(),n.updateViewportScreenBounds()))}),n.sideEffects.registerAfterChangeHandler("instance_page_state",(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))})]}class rA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"scribbleId","id");w(this,"markId","");w(this,"excludedShapeIds",new Set);w(this,"onEnter",t=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>{if(this.editor.isShapeOrAncestorLocked(o))return!0;if(this.editor.isShapeOfType(o,"group")||this.editor.isShapeOfType(o,"frame")){const s=this.editor.getPointInShapeSpace(o,r);return this.editor.getShapeGeometry(o).bounds.containsPoint(s)}return!1}).map(o=>o.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});w(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()})}update(){const t=this.editor.getErasingShapeIds(),r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:s}}=this.editor,{excludedShapeIds:a}=this;this.pushPointToScribble();const l=new Set(t);for(const c of i){if(this.editor.isShapeOfType(c,"group"))continue;const u=this.editor.getShapeMask(c.id);if(u&&!Ii(o,u))continue;const d=this.editor.getShapeGeometry(c),h=this.editor.getPointInShapeSpace(c,s),p=this.editor.getPointInShapeSpace(c,o);d.hitTestLineSegment(h,p,ei/r)&&l.add(this.editor.getOutermostSelectableShape(c).id)}this.editor.setErasingShapes([...l].filter(c=>!a.has(c)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}w(rA,"id","erasing");let iq=(Ox=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Ox,"id","idle"),Ox),oq=(Dx=class extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let s=t.length,a=s-1;a>=0;a--){const l=t[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:ei/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>o)break;i.add(c.id)}}this.editor.setErasingShapes([...i])});w(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},w(Dx,"id","pointing"),Dx);class _g extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}w(_g,"id","eraser"),w(_g,"initial","idle"),w(_g,"children",()=>[iq,oq,rA]);class iA extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.update()});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()})}update(){const{currentScreenPoint:t,previousScreenPoint:r}=this.editor.inputs,i=P.Sub(t,r);(Math.abs(i.x)>0||Math.abs(i.y)>0)&&this.editor.pan(i)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:nf}),this.parent.transition("idle")}}w(iA,"id","dragging");let sq=(Lx=class extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});w(this,"onPointerDown",e=>{this.parent.transition("pointing",e)});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Lx,"id","idle"),Lx),aq=(zx=class extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});w(this,"onPointerMove",e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.complete()})}complete(){this.parent.transition("idle")}},w(zx,"id","pointing"),zx);class kg extends se{constructor(){super(...arguments);w(this,"onDoubleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{duration:220,easing:fn.easeOutQuint})}});w(this,"onTripleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{duration:320,easing:fn.easeOutQuint})}});w(this,"onQuadrupleClick",t=>{if(t.phase==="settle"){const r=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;r===1?this.editor.zoomToFit({duration:400,easing:fn.easeOutQuint}):this.editor.resetZoom(i,{duration:320,easing:fn.easeOutQuint})}})}}w(kg,"id","hand"),w(kg,"initial","idle"),w(kg,"children",()=>[sq,aq,iA]);let lq=(Nx=class extends se{constructor(){super(...arguments);w(this,"onPointerDown",e=>{this.parent.transition("lasering",e)})}},w(Nx,"id","idle"),Nx);class oA extends se{constructor(){super(...arguments);w(this,"scribbleId","id");w(this,"onEnter",()=>{const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.pushPointToScribble()});w(this,"onPointerUp",()=>{this.complete()});w(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}w(oA,"id","lasering");class Cg extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}w(Cg,"id","laser"),w(Cg,"initial","idle"),w(Cg,"children",()=>[lq,oA]);class sA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"brush",new de);w(this,"initialSelectedShapeIds",[]);w(this,"excludedShapeIds",new Set);w(this,"initialStartShape",null);w(this,"onEnter",t=>{const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.onPointerMove()});w(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});w(this,"onTick",()=>{Eb(this.editor)});w(this,"onPointerMove",()=>{this.hitTestShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",t=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",t)});w(this,"onKeyDown",t=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()});w(this,"onKeyUp",()=>{this.hitTestShapes()});w(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.parent.transition("idle")}hitTestShapes(){const t=this.editor.getZoomLevel(),r=this.editor.getCurrentPageShapes(),i=this.editor.getCurrentPageId(),{inputs:{originPagePoint:o,currentPagePoint:s,shiftKey:a,ctrlKey:l}}=this.editor;this.brush.setTo(de.FromPoints([o,s]));const c=new Set(a?this.initialSelectedShapeIds:[]);let u,d,h,p,g,f;const{corners:m}=this.brush,{excludedShapeIds:v}=this;e:for(let b=0,_=r.length;b<_;b++){if(h=r[b],v.has(h.id)||c.has(h.id)||(p=this.editor.getShapePageBounds(h),!p))continue e;if(this.brush.contains(p)){this.handleHit(h,s,i,c,m);continue e}if(l||this.editor.isShapeOfType(h,"frame"))continue e;if(this.brush.collides(p)){const x=this.editor.getShapeGeometry(h);if(g=this.editor.getShapePageTransform(h),!g)continue e;f=g.clone().invert().applyToPoints(m);t:for(let C=0;C<f.length;C++)if(u=f[C],d=f[(C+1)%f.length],x.hitTestLineSegment(u,d,ei/t)){this.handleHit(h,s,i,c,m);break t}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(c),{squashing:!0})}handleHit(t,r,i,o,s){if(t.parentId===i){o.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),l=this.editor.getShapeMask(a.id);l&&!B9(l,s)&&!Ii(r,l)||o.add(a.id)}}w(sA,"id","brushing");function e1(n){const e=n.getZoomLevel(),{inputs:{currentPagePoint:t}}=n;return n.getShapeAtPoint(t,{hitInside:!1,hitLabels:!1,margin:ei/e,renderingOnly:!0})??n.getSelectedShapeAtPoint(t)}function aA(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=cn(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-t.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-t.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:e.id,type:e.type,props:{crop:c}}}let cq=(Fx=class extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});const e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))});w(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)});w(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});w(this,"onPointerDown",e=>{var t;if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=e1(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});w(this,"onDoubleClick",e=>{var o;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);i&&e.target==="selection"&&((o=i.onDoubleClickEdge)==null||o.call(i,r))});w(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});w(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});w(this,"onKeyUp",e=>{switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}});w(this,"cleanupCroppingState",()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new P(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new P(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const s=aA(this.editor,o,i);s&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([s]))}},w(Fx,"id","idle"),Fx);class lA extends se{constructor(){super(...arguments);w(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",t)});w(this,"onPointerUp",t=>{this.editor.setCurrentTool("select.crop.idle",t)})}}w(lA,"id","pointing_crop");class cA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","translating crop");w(this,"snapshot",{});w(this,"onEnter",t=>{this.info=t,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});w(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onKeyDown",t=>{switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}});w(this,"onKeyUp",t=>{switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,o=i.clone().sub(r),s=aA(this.editor,t,o);s&&this.editor.updateShapes([s],{squashing:!0})}}w(cA,"id","translating_crop");class Pg extends se{}w(Pg,"id","crop"),w(Pg,"initial","idle"),w(Pg,"children",()=>[cq,cA,lA]);const Dr=8,Gl={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class uA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.updateCursor()});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectedShapes(),r=Gl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.length===1?t[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}w(uA,"id","pointing_resize_handle");class dA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","");w(this,"snapshot",{});w(this,"onEnter",t=>{this.info=t,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){const t=this.editor.getSelectedShapes()[0];if(!t)return;const r=Gl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const i=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),s=this.editor.inputs.originPagePoint.clone().sub(r),a=o.clone().sub(s).rot(-t.rotation),l=i.crop??this.getDefaultCrop(),c=cn(l),u=new P(t.x,t.y),d=new P(0,0),h=1/(l.bottomRight.x-l.topLeft.x)*i.w,p=1/(l.bottomRight.y-l.topLeft.y)*i.h;let g=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(p<Dr)break;g=!0,c.topLeft.y=c.topLeft.y+a.y/p,p*(c.bottomRight.y-c.topLeft.y)<Dr?(c.topLeft.y=c.bottomRight.y-Dr/p,d.y=(c.topLeft.y-l.topLeft.y)*p):c.topLeft.y<=0?(c.topLeft.y=0,d.y=(c.topLeft.y-l.topLeft.y)*p):d.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(p<Dr)break;g=!0,c.bottomRight.y=Math.min(1,c.bottomRight.y+a.y/p),p*(c.bottomRight.y-c.topLeft.y)<Dr&&(c.bottomRight.y=c.topLeft.y+Dr/p);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(h<Dr)break;g=!0,c.topLeft.x=c.topLeft.x+a.x/h,h*(c.bottomRight.x-c.topLeft.x)<Dr?(c.topLeft.x=c.bottomRight.x-Dr/h,d.x=(c.topLeft.x-l.topLeft.x)*h):c.topLeft.x<=0?(c.topLeft.x=0,d.x=(c.topLeft.x-l.topLeft.x)*h):d.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(h<Dr)break;g=!0,c.bottomRight.x=Math.min(1,c.bottomRight.x+a.x/h),h*(c.bottomRight.x-c.topLeft.x)<Dr&&(c.bottomRight.x=c.topLeft.x+Dr/h);break}}if(!g)return;u.add(d.rot(t.rotation));const f={id:t.id,type:t.type,x:u.x,y:u.y,props:{crop:c,w:(c.bottomRight.x-c.topLeft.x)*h,h:(c.bottomRight.y-c.topLeft.y)*p}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),o=this.editor.getSelectionRotatedPageBounds(),s=P.RotWith(o.getHandlePoint(this.info.handle),o.point,t),a=P.Sub(r,s);return{shape:i,cursorHandleOffset:a}}}w(dA,"id","cropping");class hA extends se{constructor(){super(...arguments);w(this,"shapeId","");w(this,"initialHandle",{});w(this,"initialAdjacentHandle",null);w(this,"initialPagePoint",{});w(this,"markId","");w(this,"initialPageTransform");w(this,"initialPageRotation");w(this,"info",{});w(this,"isPrecise",!1);w(this,"isPreciseId",null);w(this,"pointingId",null);w(this,"onEnter",t=>{const{shape:r,isCreating:i,handle:o}=t;this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId=i?`creating:${r.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=cn(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:i?"cross":"grabbing",rotation:0}},{ephemeral:!0});const s=this.editor.getShapeHandles(r).sort(mn),a=s.findIndex(c=>c.id===t.handle.id);this.initialAdjacentHandle=null;for(let c=a+1;c<s.length;c++){const u=s[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}if(!this.initialAdjacentHandle)for(let c=s.length-1;c>=0;c--){const u=s[c];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}const l=r.props[t.handle.id];this.isPrecise=!1,(l==null?void 0:l.type)==="binding"?(this.editor.setHintingShapes([l.boundShapeId]),this.isPrecise=l.isPrecise,this.isPrecise?this.isPreciseId=l.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([]),this.update(),this.editor.select(this.shapeId)});w(this,"exactTimeout",-1);w(this,"onPointerMove",()=>{this.update()});w(this,"onKeyDown",()=>{this.update()});w(this,"onKeyUp",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var k;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:o,initialPageRotation:s,initialAdjacentHandle:a}=this,l=this.editor.getHintingShapeIds(),c=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:p,altKey:g,pointerVelocity:f}}=t,m=this.info.shape,v=t.getShape(r);if(!v)return;const b=t.getShapeUtil(v);let _=d.clone().sub(i).rot(-s).add(o);if(h&&a&&o.id!=="middle"){const E=P.Angle(a,_),I=Zp(E,24)-E;_=P.RotWith(_,a,I)}if(t.snaps.clear(),o.canSnap&&(c?!p:p)){const E=t.getShapePageTransform(v.id);if(!E)throw Error("Expected a page transform");const I=t.getShapeHandles(v).filter(({type:D})=>D==="vertex").sort(mn).findIndex(({index:D})=>o.index===D),T=b.getOutlineSegments(v).map(D=>re.applyToPoints(E,D)).filter((D,N)=>N!==I-1&&N!==I),A=u.getSnappingHandleDelta({additionalSegments:T,handlePoint:re.applyToPoint(E,_)});A&&(A.rot(-t.getShapeParentTransform(v).rotation()),_.add(A))}const x=(k=b.onHandleChange)==null?void 0:k.call(b,v,{handle:{...o,x:_.x,y:_.y},isPrecise:this.isPrecise||g,initial:m}),C={...v,...x};if(o.canBind){const E=C.props[o.id];(E==null?void 0:E.type)==="binding"?l[0]!==E.boundShapeId&&(t.setHintingShapes([E.boundShapeId]),this.pointingId=E.boundShapeId,this.isPrecise=f.len()<.5||g,this.isPreciseId=this.isPrecise?E.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&t.updateShapes([C],{squashing:!0})}}w(hA,"id","dragging_handle");class pA extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");td(this.editor),this.editor.select(t)});w(this,"onExit",()=>{var i,o;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null);const r=this.editor.getShape(t);(o=(i=this.editor.getShapeUtil(r)).onEditEnd)==null||o.call(i,r),setTimeout(()=>{this.editor.updateViewportScreenBounds()},500)});w(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":{td(this.editor);return}}});w(this,"onPointerDown",t=>{switch(t.target){case"canvas":{const r=e1(this.editor);if(r){this.onPointerDown({...t,shape:r,target:"shape"});return}break}case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");if(r.type===i.type)if(this.editor.isShapeOfType(r,"geo")||this.editor.isShapeOfType(r,"arrow")){const o=this.editor.getShapeUtil(r).getGeometry(r).children[1];if(o){const s=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(o.bounds.containsPoint(s)){if(r.id===i.id)return;this.parent.transition("pointing_shape",t);return}}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&this.editor.setEditingShape(null);else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)});w(this,"onComplete",t=>{this.parent.transition("idle",t)});w(this,"onCancel",t=>{this.parent.transition("idle",t)})}}w(pA,"id","editing_shape");function fA(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function Eg(n){const e=n.getSelectedShapeIds(),{shiftKey:t,altKey:r,currentPagePoint:i}=n.inputs,o=n.getShapeAtPoint(i,{hitInside:!1,margin:ei/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:s=>!s.isLocked});if(o){const s=n.getOutermostSelectableShape(o);if(t&&!r)n.cancelDoubleClick(),e.includes(s.id)?(n.mark("deselecting shape"),n.deselect(s)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,s.id]));else{let a;s===o||s.id===n.getFocusedGroupId()||e.includes(s.id)?a=o:a=s,a&&!e.includes(a.id)&&(n.mark("selecting shape"),n.select(a.id))}}else{if(t)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const s=n.getFocusedGroupId();if(Mr(s)){const a=n.getShape(s);n.isPointInShape(a,i,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}let uq=($x=class extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),td(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});w(this,"onPointerMove",()=>{td(this.editor)});w(this,"onPointerDown",e=>{if(this.editor.getIsMenuOpen())return;const t=e.ctrlKey&&fA(this.editor);if(e.ctrlKey&&!t){if(e.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{const r=e1(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&gA(this.editor,s)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{if(this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}});w(this,"onDoubleClick",e=>{var t,r,i,o,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up"))switch(e.target){case"canvas":{const a=this.editor.getHoveredShape(),l=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:ei/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(l){if(this.editor.isShapeOfType(l,"group")){Eg(this.editor);return}else{const u=this.editor.getShape(l.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(c&&u.id===c)){Eg(this.editor);return}}this.onDoubleClick({...e,shape:l,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const a=this.editor.getOnlySelectedShape();if(a){const l=this.editor.getShapeUtil(a);if(!this.canInteractWithShapeInReadOnly(a))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=l.onDoubleClickEdge)==null?void 0:t.call(l,a);if(c){this.editor.mark("double click edge"),this.editor.updateShapes([c]);return}}if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}break}case"shape":{const{shape:a}=e,l=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(l.onDoubleClick){const c=(r=l.onDoubleClick)==null?void 0:r.call(l,a);if(c){this.editor.updateShapes([c]);return}else if(l.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:a,handle:l}=e,c=(s=(o=this.editor.getShapeUtil(a)).onDoubleClickHandle)==null?void 0:s.call(o,a,l);c?this.editor.updateShapes([c]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,e)}}});w(this,"onRightClick",e=>{switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:ei/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&gA(this.editor,s)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,o=>!t.includes(o.id));t.includes(i.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}});w(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});w(this,"onKeyDown",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);break}}});w(this,"onKeyRepeat",e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});w(this,"onKeyUp",e=>{switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r});return}fA(this.editor)&&this.parent.transition("crop",e);break}}});w(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const t=tt(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(t);if(!o)return;const s=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!s.canEditInReadOnly(o)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new P(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new P(0,0)))return;e||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?o*pq:o:r?dq:hq;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),i.mul(s))}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},w($x,"id","idle"),$x);const dq=10,hq=1,pq=5;function gA(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?Ii(e,t.corners.map(i=>P.RotWith(i,t.point,r))):t.containsPoint(e)}class mA extends se{constructor(){super(...arguments);w(this,"onEnter",()=>{const{inputs:t}=this.editor;t.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",t)});w(this,"onPointerUp",()=>{Eg(this.editor),this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}w(mA,"id","pointing_canvas");class yA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];r&&(this.updateCursor(r),this.editor.setCroppingShape(r.id))});w(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})});w(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(t){const r=Gl[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:t.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}}w(yA,"id","pointing_crop_handle");class wA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t;const r=t.shape.props[t.handle.id];(r==null?void 0:r.type)==="binding"&&this.editor.setHintingShapes([r.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})});w(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});w(this,"onPointerUp",()=>{this.parent.transition("idle",this.info)});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}w(wA,"id","pointing_handle");class bA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})});w(this,"onPointerMove",()=>{const{isDragging:t}=this.editor.inputs;t&&this.parent.transition("rotating",this.info)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:Gl[this.info.handle],rotation:t}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}w(bA,"id","pointing_rotate_handle");class vA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerUp",t=>{Eg(this.editor),this.parent.transition("idle",t)});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});w(this,"onDoubleClick",t=>{var o,s;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(s=(o=this.parent).onDoubleClick)==null||s.call(o,{...t,target:"shape",shape:this.editor.getShape(i)});return}});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}w(vA,"id","pointing_selection");class SA extends se{constructor(){super(...arguments);w(this,"hitShape",{});w(this,"hitShapeForPointerUp",{});w(this,"didSelectOnEnter",!1);w(this,"onEnter",t=>{const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),o=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:s,shiftKey:a,altKey:l}}=this.editor;this.hitShape=t.shape;const c=this.editor.getOutermostSelectableShape(t.shape);if(this.editor.getShapeUtil(t.shape).onClick||c.id===o||r.includes(c.id)||this.editor.isAncestorSelected(c.id)||r.length>1&&(i!=null&&i.containsPoint(s))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,a&&!l?(this.editor.cancelDoubleClick(),r.includes(c.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...r,c.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([c.id]))});w(this,"onPointerUp",t=>{var u;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),o=this.editor.getZoomLevel(),{inputs:{currentPagePoint:s,shiftKey:a}}=this.editor,l=this.editor.getShapeAtPoint(s,{margin:ei/o,hitInside:!0,renderingOnly:!0})??this.hitShape,c=l?this.editor.getOutermostSelectableShape(l):this.hitShapeForPointerUp;if(c){const d=this.editor.getShapeUtil(c);if(d.onClick){const h=(u=d.onClick)==null?void 0:u.call(d,c);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",t);return}}if(c.id===i){r.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const d=this.editor.getOutermostSelectableShape(l,h=>!r.includes(h.id));if(r.includes(d.id))if(a)this.editor.mark("deselecting on pointer up"),this.editor.deselect(c);else if(r.includes(c.id)){if(r.length===1&&(this.editor.isShapeOfType(c,"geo")||this.editor.isShapeOfType(c,"arrow"))){const h=this.editor.getShapeGeometry(c).children[1];if(h){const p=this.editor.getPointInShapeSpace(c,s);if(h.bounds.containsPoint(p,0)&&h.hitTestPoint(p)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(c.id);const g=this.editor.getShapeUtil(c);this.editor.getInstanceState().isReadonly&&!g.canEditInReadOnly(c)||(this.editor.setEditingShape(c.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(c.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(c);else if(a){const h=this.editor.getShapeAncestors(d);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(p=>!h.find(g=>g.id===p)),d.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([d.id])}this.parent.transition("idle",t)});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly)return;this.parent.transition("translating",t)}});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle")}}w(SA,"id","pointing_shape");class xA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","");w(this,"didHoldCommand",!1);w(this,"creationCursorOffset",{x:0,y:0});w(this,"snapshot",{});w(this,"onEnter",t=>{const{isCreating:r=!1,creationCursorOffset:i={x:0,y:0}}=t;this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),r?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});w(this,"onTick",()=>{Eb(this.editor)});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onKeyDown",()=>{this.updateShapes()});w(this,"onKeyUp",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clear()});w(this,"_createSnapshot",()=>{const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,o=this.editor.getSelectionRotatedPageBounds(),s=P.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=P.Sub(i,s),l=new Map,c=[];t.forEach(d=>{const h=this.editor.getShape(d);if(h){if(h.type==="frame"&&c.push({id:d,children:ye(this.editor.getSortedChildIdsForParent(h).map(p=>this.editor.getShape(p)))}),l.set(h.id,this._createShapeSnapshot(h)),this.editor.isShapeOfType(h,"frame")&&t.length===1)return;this.editor.visitDescendants(h.id,p=>{const g=this.editor.getShape(p);if(g&&(l.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...l.values()].some(d=>!xP(d.pageRotation,r)||d.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}});w(this,"_createShapeSnapshot",t=>{const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:re.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onResizeEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:o,selectionBounds:s,cursorHandleOffset:a,selectedShapeIds:l,selectionRotation:c,canShapesDeform:u}=this.snapshot,d=r||!u,{ctrlKey:h}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!h){const{gridSize:E}=this.editor.getDocumentSettings();p.snapToGrid(E)}const f=this.info.handle,m=_A(f,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.getIsSnapMode()?!h:h)&&c%rt===0){const{nudge:E}=this.editor.snaps.snapResize({dragDelta:P.Sub(p,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:_A(f,c),isAspectRatioLocked:d,isResizingFromCenter:t});p.add(E)}const v=P.RotWith(t?s.center:s.getHandlePoint(m),s.point,c),b=P.Sub(p,v).rot(-c),_=P.Sub(g,v).rot(-c),x=P.DivV(b,_);Number.isFinite(x.x)||(x.x=1),Number.isFinite(x.y)||(x.y=1);const C=f==="top"||f==="bottom",k=f==="left"||f==="right";d?k?x.y=Math.abs(x.x):C?x.x=Math.abs(x.y):Math.abs(x.x)>Math.abs(x.y)?x.y=Math.abs(x.x)*(x.y<0?-1:1):x.x=Math.abs(x.y)*(x.x<0?-1:1):(C&&(x.x=1),k&&(x.y=1)),this.info.isCreating||this.updateCursor({dragHandle:f,isFlippedX:x.x<0,isFlippedY:x.y<0,rotation:c});for(const E of o.keys()){const I=o.get(E);this.editor.resizeShape(E,x,{initialShape:I.shape,initialBounds:I.bounds,initialPageTransform:I.pageTransform,dragHandle:f,mode:l.length===1&&E===l[0]?"resize_bounds":"scale_shape",scaleOrigin:v,scaleAxisRotation:c})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:E,children:I}of i){if(!I.length)continue;const T=o.get(E).shape,A=this.editor.getShape(E);if(!(T&&A))continue;const D=A.x-T.x,N=A.y-T.y,U=new P(D,N).rot(-T.rotation);if(U.x!==0||U.y!==0)for(const R of I)this.editor.updateShape({id:R.id,type:R.type,x:R.x-U.x,y:R.y-U.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:E}of i)if(E.length)for(const I of E)this.editor.updateShape({id:I.id,type:I.type,x:I.x,y:I.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:o}){const s={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{s.type="nwse-resize",r!==i&&(s.type="nesw-resize");break}case"top_right":case"bottom_left":{s.type="nesw-resize",r!==i&&(s.type="nwse-resize");break}}s.rotation=o,this.editor.setCursor(s)}}w(xA,"id","resizing");const t1=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function _A(n,e){e=e%We;const t=Math.round(e/(Fe/4)),r=t1.indexOf(n);return t1[(r+t)%t1.length]}const kA=Math.PI/180;class CA extends se{constructor(){super(...arguments);w(this,"snapshot",{});w(this,"info",{});w(this,"markId","");w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const r=$E({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r,this.handleStart()});w(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});w(this,"onPointerMove",()=>{this.update()});w(this,"onKeyDown",()=>{this.update()});w(this,"onKeyUp",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"update",()=>{const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});mf({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:Gl[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})});w(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});w(this,"complete",()=>{mf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}handleStart(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});mf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:Gl[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:o,currentPagePoint:s}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:l}=this.snapshot;if(!i)return l;const c=i.center.clone().rotWith(i.point,r).angle(s)-a;let u=l+c;if(o)u=Zp(u,24);else if(t&&(u=Math.round(u/kA)*kA,this.editor.getInstanceState().isCoarsePointer)){const d=Zp(u,4),h=Eu(u,d);Math.abs(h)<UN(5)&&(u=d)}return u-l}}w(CA,"id","rotating");class PA extends se{constructor(){super(...arguments);w(this,"hits",new Set);w(this,"size",0);w(this,"scribbleId","id");w(this,"initialSelectedShapeIds",new Set);w(this,"newlySelectedShapeIds",new Set);w(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});w(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"pushPointToScribble",()=>{const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)})}updateScribbleSelection(t){const r=this.editor.getZoomLevel(),i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:o,originPagePoint:s,previousPagePoint:a,currentPagePoint:l}}=this.editor,{newlySelectedShapeIds:c,initialSelectedShapeIds:u}=this;t&&this.pushPointToScribble();const d=i;let h,p,g,f;for(let m=0,v=d.length;m<v;m++)if(h=d[m],p=this.editor.getShapeGeometry(h),!(this.editor.isShapeOfType(h,"group")||c.has(h.id)||this.editor.isShapeOrAncestorLocked(h))){if(this.editor.isShapeOfType(h,"frame")){const b=this.editor.getPointInShapeSpace(h,s);if(p.bounds.containsPoint(b))continue}if(g=this.editor.getPointInShapeSpace(h,a),f=this.editor.getPointInShapeSpace(h,l),p.hitTestLineSegment(g,f,ei/r)){const b=this.editor.getOutermostSelectableShape(h),_=this.editor.getShapeMask(b.id);if(_&&CE(a,l,_)!==null&&!Ii(l,_))continue;c.add(b.id)}}this.editor.setSelectedShapes([...new Set(o?[...c,...u]:[...c])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}}w(PA,"id","scribble_brushing");const EA=100;class fq{constructor(e){w(this,"prevDroppingShapeId",null);w(this,"droppingNodeTimer",null);w(this,"first",!0);w(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,EA*10,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,EA,t))}setDragTimer(e,t,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var l,c,u,d,h;t=ye(t.map(p=>this.editor.getShape(p.id)));const i=((l=this.editor.getDroppingOverShape(e,t))==null?void 0:l.id)??null;if(i===this.prevDroppingShapeId)return;const{prevDroppingShapeId:o}=this,s=o&&this.editor.getShape(o),a=i&&this.editor.getShape(i);if(s&&((u=(c=this.editor.getShapeUtil(s)).onDragShapesOut)==null||u.call(c,s,t)),a){const p=(h=(d=this.editor.getShapeUtil(a)).onDragShapesOver)==null?void 0:h.call(d,a,t);p&&p.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);r==null||r(),this.prevDroppingShapeId=i}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const o=this.editor.getShape(t);if(!o)return;(i=(r=this.editor.getShapeUtil(o)).onDropShapesOver)==null||i.call(r,o,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class IA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"selectionSnapshot",{});w(this,"snapshot",{});w(this,"markId","");w(this,"isCloning",!1);w(this,"isCreating",!1);w(this,"onCreate",()=>{});w(this,"dragAndDropManager",new fq(this.editor));w(this,"onEnter",t=>{const{isCreating:r=!1,onCreate:i=()=>{}}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.isCreating=r,this.onCreate=i,r?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=t,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=MA(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()});w(this,"onTick",()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),Eb(this.editor)});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});w(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"updateParentTransforms",()=>{const{editor:t,snapshot:{shapeSnapshots:r}}=this;r.forEach(i=>{const o=t.getShape(i.shape.id);if(!o)return null;const s=Hn(o.parentId)?null:re.Inverse(t.getShapePageTransform(o.parentId));i.parentTransform=s})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=MA(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var t;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(t=this.onCreate)==null||t.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var s,a;const o=(a=(s=this.editor.getShapeUtil(i)).onTranslateStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslateEnd)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}handleChange(){const{movingShapes:t}=this.snapshot,r=[];t.forEach(i=>{var a,l;const o=this.editor.getShape(i.id),s=(l=(a=this.editor.getShapeUtil(i)).onTranslate)==null?void 0:l.call(a,i,o);s&&r.push(s)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:t}=this;this.dragAndDropManager.updateDroppingNode(t.movingShapes,this.updateParentTransforms),gq({editor:this.editor,shapeSnapshots:t.shapeSnapshots,averagePagePoint:t.averagePagePoint,initialSelectionPageBounds:t.initialPageBounds,initialSelectionSnapPoints:t.initialSnapPoints}),this.handleChange()}}w(IA,"id","translating");function MA(n){const e=[],t=[],r=ye(n.getSelectedShapeIds().map(o=>{const s=n.getShape(o);if(!s)return null;e.push(s);const a=n.getShapePageTransform(o).point();if(!a)return null;t.push(a);const l=so.isId(s.parentId)?null:re.Inverse(n.getShapePageTransform(s.parentId));return{shape:s,pagePoint:a,parentTransform:l}}));let i=[];if(n.getSelectedShapeIds().length===1)i=n.snaps.getSnapPointsCache().get(n.getSelectedShapeIds()[0]);else{const o=n.getSelectionPageBounds();o&&(i=o.snapPoints.map((s,a)=>({id:"selection:"+a,x:s.x,y:s.y})))}return{averagePagePoint:P.Average(t),movingShapes:e,shapeSnapshots:r,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:i}}function gq({editor:n,shapeSnapshots:e,averagePagePoint:t,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){const{inputs:o}=n,s=n.getInstanceState().isGridMode,a=n.getDocumentSettings().gridSize,l=P.Sub(o.currentPagePoint,o.originPagePoint),c=n.inputs.shiftKey?Math.abs(l.x)<Math.abs(l.y)?"x":"y":null;if(c==="x"?l.x=0:c==="y"&&(l.y=0),n.snaps.clear(),(n.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:h}=n.snaps.snapTranslate({dragDelta:l,initialSelectionPageBounds:r,lockedAxis:c,initialSelectionSnapPoints:i});l.add(h)}const u=P.Add(t,l);s&&!o.ctrlKey&&u.snapToGrid(a);const d=P.Sub(u,t);n.updateShapes(ye(e.map(({shape:h,pagePoint:p,parentTransform:g})=>{const f=P.Add(p,d),m=g?re.applyToPoint(g,f):f;return{id:h.id,type:h.type,x:m.x,y:m.y}})),{squashing:!0})}class Ig extends se{constructor(){super(...arguments);w(this,"onExit",()=>{this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}w(Ig,"id","select"),w(Ig,"initial","idle"),w(Ig,"children",()=>[Pg,dA,uq,mA,SA,IA,sA,PA,yA,vA,uA,pA,xA,CA,bA,wA,hA]);class TA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}w(TA,"id","idle");class AA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerUp",()=>{this.complete()});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});w(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{duration:220}):this.editor.zoomIn(t,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}w(AA,"id","pointing");class jA extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"zoomBrush",new de);w(this,"onEnter",t=>{this.info=t,this.update()});w(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(de.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{duration:220}):this.editor.zoomIn(i,{duration:220})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,i,{duration:220})}this.parent.transition("idle",this.info)}}w(jA,"id","zoom_brushing");class Mg extends se{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)});w(this,"onKeyDown",()=>{this.updateCursor()});w(this,"onKeyUp",t=>{this.updateCursor(),t.code==="KeyZ"&&this.complete()});w(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}}w(Mg,"id","zoom"),w(Mg,"initial","idle"),w(Mg,"children",()=>[TA,jA,AA]);const mq=[_g,kg,Cg,Mg,Ig];function te(){return te=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},te.apply(this,arguments)}function ae(n,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(n==null||n(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}function yq(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function Tg(...n){return e=>n.forEach(t=>yq(t,e))}function it(...n){return S.useCallback(Tg(...n),n)}function ji(n,e=[]){let t=[];function r(o,s){const a=S.createContext(s),l=t.length;t=[...t,s];function c(d){const{scope:h,children:p,...g}=d,f=(h==null?void 0:h[n][l])||a,m=S.useMemo(()=>g,Object.values(g));return S.createElement(f.Provider,{value:m},p)}function u(d,h){const p=(h==null?void 0:h[n][l])||a,g=S.useContext(p);if(g)return g;if(s!==void 0)return s;throw new Error(`\`${d}\` must be used within \`${o}\``)}return c.displayName=o+"Provider",[c,u]}const i=()=>{const o=t.map(s=>S.createContext(s));return function(s){const a=(s==null?void 0:s[n])||o;return S.useMemo(()=>({[`__scope${n}`]:{...s,[n]:a}}),[s,a])}};return i.scopeName=n,[r,wq(i,...e)]}function wq(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(i){const o=r.reduce((s,{useScope:a,scopeName:l})=>{const c=a(i)[`__scope${l}`];return{...s,...c}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}const da=S.forwardRef((n,e)=>{const{children:t,...r}=n,i=S.Children.toArray(t),o=i.find(vq);if(o){const s=o.props.children,a=i.map(l=>l===o?S.Children.count(s)>1?S.Children.only(null):S.isValidElement(s)?s.props.children:null:l);return S.createElement(n1,te({},r,{ref:e}),S.isValidElement(s)?S.cloneElement(s,void 0,a):null)}return S.createElement(n1,te({},r,{ref:e}),t)});da.displayName="Slot";const n1=S.forwardRef((n,e)=>{const{children:t,...r}=n;return S.isValidElement(t)?S.cloneElement(t,{...Sq(r,t.props),ref:e?Tg(e,t.ref):t.ref}):S.Children.count(t)>1?S.Children.only(null):null});n1.displayName="SlotClone";const bq=({children:n})=>S.createElement(S.Fragment,null,n);function vq(n){return S.isValidElement(n)&&n.type===bq}function Sq(n,e){const t={...e};for(const r in e){const i=n[r],o=e[r];/^on[A-Z]/.test(r)?i&&o?t[r]=(...s)=>{o(...s),i(...s)}:i&&(t[r]=i):r==="style"?t[r]={...i,...o}:r==="className"&&(t[r]=[i,o].filter(Boolean).join(" "))}return{...n,...t}}function Ag(n){const e=n+"CollectionProvider",[t,r]=ji(e),[i,o]=t(e,{collectionRef:{current:null},itemMap:new Map}),s=p=>{const{scope:g,children:f}=p,m=oe.useRef(null),v=oe.useRef(new Map).current;return oe.createElement(i,{scope:g,itemMap:v,collectionRef:m},f)},a=n+"CollectionSlot",l=oe.forwardRef((p,g)=>{const{scope:f,children:m}=p,v=o(a,f),b=it(g,v.collectionRef);return oe.createElement(da,{ref:b},m)}),c=n+"CollectionItemSlot",u="data-radix-collection-item",d=oe.forwardRef((p,g)=>{const{scope:f,children:m,...v}=p,b=oe.useRef(null),_=it(g,b),x=o(c,f);return oe.useEffect(()=>(x.itemMap.set(b,{ref:b,...v}),()=>void x.itemMap.delete(b))),oe.createElement(da,{[u]:"",ref:_},m)});function h(p){const g=o(n+"CollectionConsumer",p);return oe.useCallback(()=>{const f=g.collectionRef.current;if(!f)return[];const m=Array.from(f.querySelectorAll(`[${u}]`));return Array.from(g.itemMap.values()).sort((v,b)=>m.indexOf(v.ref.current)-m.indexOf(b.ref.current))},[g.collectionRef,g.itemMap])}return[{Provider:s,Slot:l,ItemSlot:d},h,r]}const xq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],qe=xq.reduce((n,e)=>{const t=S.forwardRef((r,i)=>{const{asChild:o,...s}=r,a=o?da:e;return S.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),S.createElement(a,te({},s,{ref:i}))});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function r1(n,e){n&&il.flushSync(()=>n.dispatchEvent(e))}function vn(n){const e=S.useRef(n);return S.useEffect(()=>{e.current=n}),S.useMemo(()=>(...t)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...t)},[])}function _q(n,e=globalThis==null?void 0:globalThis.document){const t=vn(n);S.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[t,e])}const i1="dismissableLayer.update",kq="dismissableLayer.pointerDownOutside",Cq="dismissableLayer.focusOutside";let RA;const OA=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),jg=S.forwardRef((n,e)=>{var t;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:a,onDismiss:l,...c}=n,u=S.useContext(OA),[d,h]=S.useState(null),p=(t=d==null?void 0:d.ownerDocument)!==null&&t!==void 0?t:globalThis==null?void 0:globalThis.document,[,g]=S.useState({}),f=it(e,I=>h(I)),m=Array.from(u.layers),[v]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(v),_=d?m.indexOf(d):-1,x=u.layersWithOutsidePointerEventsDisabled.size>0,C=_>=b,k=Eq(I=>{const T=I.target,A=[...u.branches].some(D=>D.contains(T));!C||A||(o==null||o(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p),E=Iq(I=>{const T=I.target;[...u.branches].some(A=>A.contains(T))||(s==null||s(I),a==null||a(I),I.defaultPrevented||(l==null||l()))},p);return _q(I=>{_===u.layers.size-1&&(i==null||i(I),!I.defaultPrevented&&l&&(I.preventDefault(),l()))},p),S.useEffect(()=>{if(d)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(RA=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),DA(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=RA)}},[d,p,r,u]),S.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),DA())},[d,u]),S.useEffect(()=>{const I=()=>g({});return document.addEventListener(i1,I),()=>document.removeEventListener(i1,I)},[]),S.createElement(qe.div,te({},c,{ref:f,style:{pointerEvents:x?C?"auto":"none":void 0,...n.style},onFocusCapture:ae(n.onFocusCapture,E.onFocusCapture),onBlurCapture:ae(n.onBlurCapture,E.onBlurCapture),onPointerDownCapture:ae(n.onPointerDownCapture,k.onPointerDownCapture)}))}),Pq=S.forwardRef((n,e)=>{const t=S.useContext(OA),r=S.useRef(null),i=it(e,r);return S.useEffect(()=>{const o=r.current;if(o)return t.branches.add(o),()=>{t.branches.delete(o)}},[t.branches]),S.createElement(qe.div,te({},n,{ref:i}))});function Eq(n,e=globalThis==null?void 0:globalThis.document){const t=vn(n),r=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){LA(kq,t,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Iq(n,e=globalThis==null?void 0:globalThis.document){const t=vn(n),r=S.useRef(!1);return S.useEffect(()=>{const i=o=>{o.target&&!r.current&&LA(Cq,t,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function DA(){const n=new CustomEvent(i1);document.dispatchEvent(n)}function LA(n,e,t,{discrete:r}){const i=t.originalEvent.target,o=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?r1(i,o):i.dispatchEvent(o)}const Mq=jg,Tq=Pq,Rg=S.forwardRef((n,e)=>{var t;const{container:r=globalThis==null||(t=globalThis.document)===null||t===void 0?void 0:t.body,...i}=n;return r?fL.createPortal(S.createElement(qe.div,te({},i,{ref:e})),r):null}),ha=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{};function Aq(n,e){return S.useReducer((t,r)=>e[t][r]??t,n)}const si=n=>{const{present:e,children:t}=n,r=jq(e),i=typeof t=="function"?t({present:r.isPresent}):S.Children.only(t),o=it(r.ref,i.ref);return typeof t=="function"||r.isPresent?S.cloneElement(i,{ref:o}):null};si.displayName="Presence";function jq(n){const[e,t]=S.useState(),r=S.useRef({}),i=S.useRef(n),o=S.useRef("none"),s=n?"mounted":"unmounted",[a,l]=Aq(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const c=Og(r.current);o.current=a==="mounted"?c:"none"},[a]),ha(()=>{const c=r.current,u=i.current;if(u!==n){const d=o.current,h=Og(c);n?l("MOUNT"):h==="none"||(c==null?void 0:c.display)==="none"?l("UNMOUNT"):l(u&&d!==h?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,l]),ha(()=>{if(e){const c=d=>{const h=Og(r.current).includes(d.animationName);d.target===e&&h&&il.flushSync(()=>l("ANIMATION_END"))},u=d=>{d.target===e&&(o.current=Og(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",c),e.addEventListener("animationend",c),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",c),e.removeEventListener("animationend",c)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:S.useCallback(c=>{c&&(r.current=getComputedStyle(c)),t(c)},[])}}function Og(n){return(n==null?void 0:n.animationName)||"none"}function ys({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=Rq({defaultProp:e,onChange:t}),o=n!==void 0,s=o?n:r,a=vn(t),l=S.useCallback(c=>{if(o){const u=typeof c=="function"?c(n):c;u!==n&&a(u)}else i(c)},[o,n,i,a]);return[s,l]}function Rq({defaultProp:n,onChange:e}){const t=S.useState(n),[r]=t,i=S.useRef(r),o=vn(e);return S.useEffect(()=>{i.current!==r&&(o(r),i.current=r)},[r,i,o]),t}const zA=S.forwardRef((n,e)=>S.createElement(qe.span,te({},n,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}))),NA="ToastProvider",[o1,Oq,Dq]=Ag("Toast"),[FA,Kpe]=ji("Toast",[Dq]),[Lq,Dg]=FA(NA),$A=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=n,[a,l]=S.useState(null),[c,u]=S.useState(0),d=S.useRef(!1),h=S.useRef(!1);return S.createElement(o1.Provider,{scope:e},S.createElement(Lq,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:S.useCallback(()=>u(p=>p+1),[]),onToastRemove:S.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h},s))};$A.propTypes={label(n){if(n.label&&typeof n.label=="string"&&!n.label.trim()){const e=`Invalid prop \`label\` supplied to \`${NA}\`. Expected non-empty \`string\`.`;return new Error(e)}return null}};const zq="ToastViewport",Nq=["F8"],s1="toast.viewportPause",a1="toast.viewportResume",Fq=S.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=Nq,label:i="Notifications ({hotkey})",...o}=n,s=Dg(zq,t),a=Oq(t),l=S.useRef(null),c=S.useRef(null),u=S.useRef(null),d=S.useRef(null),h=it(e,d,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=s.toastCount>0;S.useEffect(()=>{const m=v=>{var b;r.every(_=>v[_]||v.code===_)&&((b=d.current)===null||b===void 0||b.focus())};return document.addEventListener("keydown",m),()=>document.removeEventListener("keydown",m)},[r]),S.useEffect(()=>{const m=l.current,v=d.current;if(g&&m&&v){const b=()=>{if(!s.isClosePausedRef.current){const k=new CustomEvent(s1);v.dispatchEvent(k),s.isClosePausedRef.current=!0}},_=()=>{if(s.isClosePausedRef.current){const k=new CustomEvent(a1);v.dispatchEvent(k),s.isClosePausedRef.current=!1}},x=k=>{!m.contains(k.relatedTarget)&&_()},C=()=>{m.contains(document.activeElement)||_()};return m.addEventListener("focusin",b),m.addEventListener("focusout",x),m.addEventListener("pointermove",b),m.addEventListener("pointerleave",C),window.addEventListener("blur",b),window.addEventListener("focus",_),()=>{m.removeEventListener("focusin",b),m.removeEventListener("focusout",x),m.removeEventListener("pointermove",b),m.removeEventListener("pointerleave",C),window.removeEventListener("blur",b),window.removeEventListener("focus",_)}}},[g,s.isClosePausedRef]);const f=S.useCallback(({tabbingDirection:m})=>{const v=a().map(b=>{const _=b.ref.current,x=[_,...tZ(_)];return m==="forwards"?x:x.reverse()});return(m==="forwards"?v.reverse():v).flat()},[a]);return S.useEffect(()=>{const m=d.current;if(m){const v=b=>{const _=b.altKey||b.ctrlKey||b.metaKey;if(b.key==="Tab"&&!_){const E=document.activeElement,I=b.shiftKey;if(b.target===m&&I){var x;(x=c.current)===null||x===void 0||x.focus();return}const T=f({tabbingDirection:I?"backwards":"forwards"}),A=T.findIndex(D=>D===E);if(l1(T.slice(A+1)))b.preventDefault();else{var C,k;I?(C=c.current)===null||C===void 0||C.focus():(k=u.current)===null||k===void 0||k.focus()}}};return m.addEventListener("keydown",v),()=>m.removeEventListener("keydown",v)}},[a,f]),S.createElement(Tq,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:g?void 0:"none"}},g&&S.createElement(BA,{ref:c,onFocusFromOutsideViewport:()=>{const m=f({tabbingDirection:"forwards"});l1(m)}}),S.createElement(o1.Slot,{scope:t},S.createElement(qe.ol,te({tabIndex:-1},o,{ref:h}))),g&&S.createElement(BA,{ref:u,onFocusFromOutsideViewport:()=>{const m=f({tabbingDirection:"backwards"});l1(m)}}))}),$q="ToastFocusProxy",BA=S.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,o=Dg($q,t);return S.createElement(zA,te({"aria-hidden":!0,tabIndex:0},i,{ref:e,style:{position:"fixed"},onFocus:s=>{var a;const l=s.relatedTarget;!((a=o.viewport)!==null&&a!==void 0&&a.contains(l))&&r()}}))}),Lg="Toast",Bq="toast.swipeStart",Uq="toast.swipeMove",Vq="toast.swipeCancel",Hq="toast.swipeEnd",Wq=S.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:o,...s}=n,[a=!0,l]=ys({prop:r,defaultProp:i,onChange:o});return S.createElement(si,{present:t||a},S.createElement(UA,te({open:a},s,{ref:e,onClose:()=>l(!1),onPause:vn(n.onPause),onResume:vn(n.onResume),onSwipeStart:ae(n.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:ae(n.onSwipeMove,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:ae(n.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:ae(n.onSwipeEnd,c=>{const{x:u,y:d}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),l(!1)})})))}),[Kq,Gq]=FA(Lg,{onClose(){}}),UA=S.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:p,...g}=n,f=Dg(Lg,t),[m,v]=S.useState(null),b=it(e,R=>v(R)),_=S.useRef(null),x=S.useRef(null),C=i||f.duration,k=S.useRef(0),E=S.useRef(C),I=S.useRef(0),{onToastAdd:T,onToastRemove:A}=f,D=vn(()=>{var R;m!=null&&m.contains(document.activeElement)&&((R=f.viewport)===null||R===void 0||R.focus()),s()}),N=S.useCallback(R=>{!R||R===1/0||(window.clearTimeout(I.current),k.current=new Date().getTime(),I.current=window.setTimeout(D,R))},[D]);S.useEffect(()=>{const R=f.viewport;if(R){const B=()=>{N(E.current),c==null||c()},$=()=>{const q=new Date().getTime()-k.current;E.current=E.current-q,window.clearTimeout(I.current),l==null||l()};return R.addEventListener(s1,$),R.addEventListener(a1,B),()=>{R.removeEventListener(s1,$),R.removeEventListener(a1,B)}}},[f.viewport,C,l,c,N]),S.useEffect(()=>{o&&!f.isClosePausedRef.current&&N(C)},[o,C,f.isClosePausedRef,N]),S.useEffect(()=>(T(),()=>A()),[T,A]);const U=S.useMemo(()=>m?KA(m):null,[m]);return f.viewport?S.createElement(S.Fragment,null,U&&S.createElement(Yq,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0},U),S.createElement(Kq,{scope:t,onClose:D},il.createPortal(S.createElement(o1.ItemSlot,{scope:t},S.createElement(Mq,{asChild:!0,onEscapeKeyDown:ae(a,()=>{f.isFocusedToastEscapeKeyDownRef.current||D(),f.isFocusedToastEscapeKeyDownRef.current=!1})},S.createElement(qe.li,te({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":f.swipeDirection},g,{ref:b,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:ae(n.onKeyDown,R=>{R.key==="Escape"&&(a==null||a(R.nativeEvent),R.nativeEvent.defaultPrevented||(f.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:ae(n.onPointerDown,R=>{R.button===0&&(_.current={x:R.clientX,y:R.clientY})}),onPointerMove:ae(n.onPointerMove,R=>{if(!_.current)return;const B=R.clientX-_.current.x,$=R.clientY-_.current.y,q=!!x.current,G=["left","right"].includes(f.swipeDirection),L=["left","up"].includes(f.swipeDirection)?Math.min:Math.max,V=G?L(0,B):0,J=G?0:L(0,$),le=R.pointerType==="touch"?10:2,me={x:V,y:J},ve={originalEvent:R,delta:me};q?(x.current=me,zg(Uq,d,ve,{discrete:!1})):GA(me,f.swipeDirection,le)?(x.current=me,zg(Bq,u,ve,{discrete:!1}),R.target.setPointerCapture(R.pointerId)):(Math.abs(B)>le||Math.abs($)>le)&&(_.current=null)}),onPointerUp:ae(n.onPointerUp,R=>{const B=x.current,$=R.target;if($.hasPointerCapture(R.pointerId)&&$.releasePointerCapture(R.pointerId),x.current=null,_.current=null,B){const q=R.currentTarget,G={originalEvent:R,delta:B};GA(B,f.swipeDirection,f.swipeThreshold)?zg(Hq,p,G,{discrete:!0}):zg(Vq,h,G,{discrete:!0}),q.addEventListener("click",L=>L.preventDefault(),{once:!0})}})})))),f.viewport))):null});UA.propTypes={type(n){if(n.type&&!["foreground","background"].includes(n.type)){const e=`Invalid prop \`type\` supplied to \`${Lg}\`. Expected \`foreground | background\`.`;return new Error(e)}return null}};const Yq=n=>{const{__scopeToast:e,children:t,...r}=n,i=Dg(Lg,e),[o,s]=S.useState(!1),[a,l]=S.useState(!1);return Qq(()=>s(!0)),S.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:S.createElement(Rg,{asChild:!0},S.createElement(zA,r,o&&S.createElement(S.Fragment,null,i.label," ",t)))},Xq=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return S.createElement(qe.div,te({},r,{ref:e}))}),qq=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return S.createElement(qe.div,te({},r,{ref:e}))}),Zq="ToastAction",VA=S.forwardRef((n,e)=>{const{altText:t,...r}=n;return t?S.createElement(WA,{altText:t,asChild:!0},S.createElement(HA,te({},r,{ref:e}))):null});VA.propTypes={altText(n){return n.altText?null:new Error(`Missing prop \`altText\` expected on \`${Zq}\``)}};const Jq="ToastClose",HA=S.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=Gq(Jq,t);return S.createElement(WA,{asChild:!0},S.createElement(qe.button,te({type:"button"},r,{ref:e,onClick:ae(n.onClick,i.onClose)})))}),WA=S.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return S.createElement(qe.div,te({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:e}))});function KA(n){const e=[];return Array.from(n.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&e.push(t.textContent),eZ(t)){const r=t.ariaHidden||t.hidden||t.style.display==="none",i=t.dataset.radixToastAnnounceExclude==="";if(!r)if(i){const o=t.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...KA(t))}}),e}function zg(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,o=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?r1(i,o):i.dispatchEvent(o)}const GA=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),o=r>i;return e==="left"||e==="right"?o&&r>t:!o&&i>t};function Qq(n=()=>{}){const e=vn(n);ha(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function eZ(n){return n.nodeType===n.ELEMENT_NODE}function tZ(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function l1(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}const nZ=Wq,rZ=Xq,iZ=qq,oZ=VA,YA=HA,pa="2.0.0-beta.2";let c1={fonts:{draw:`https://unpkg.com/@tldraw/assets@${pa}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${pa}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${pa}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${pa}/fonts/IBMPlexMono-Medium.woff2`}};function sZ(n){return S.useMemo(()=>n?{fonts:{...c1.fonts,...n==null?void 0:n.fonts}}:c1,[n])}let cd={...c1,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(n=>[n,`https://unpkg.com/@tldraw/assets@${pa}/icons/icon/${n}.svg`])),translations:Object.fromEntries(bu.map(n=>[n.locale,`https://unpkg.com/@tldraw/assets@${pa}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(fl.map(n=>[n.type,`https://unpkg.com/@tldraw/assets@${pa}/embed-icons/${n.type}.png`]))};function aZ(n){return n?{fonts:Object.assign({...cd.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...cd.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...cd.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...cd.translations},{...n==null?void 0:n.translations})}:cd}function lZ(n,e){const t=ye(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.batch(()=>{t.map(i=>{const o=n.getSortedChildIdsForParent(i.id);o.length&&(n.reparentShapes(o,i.parentId,i.index),r.push(...o))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const cZ=50;function uZ(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),o=ye(i.map(p=>n.getShape(p)));if(!o.length)return;const s=de.FromPoints(o.flatMap(p=>{const g=n.getShapeGeometry(p.id);return n.getShapeLocalTransform(p).applyToPoints(g.vertices)})),{padding:a=cZ}=t,l=s.w+2*a,c=s.h+2*a,u=a-s.minX,d=a-s.minY;if(u===0&&d===0&&r.props.w===l&&r.props.h===c)return;const h=new P(u,d).rot(r.rotation);n.batch(()=>{const p=i.map(g=>{const f=n.getShape(g);return{id:f.id,type:f.type,x:f.x+u,y:f.y+d}});p.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),n.updateShapes(p)})}const XA=S.createContext(null);function dZ({assetUrls:n,children:e}){return y.jsx(XA.Provider,{value:n,children:e})}function u1(){const n=S.useContext(XA);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const d1={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Yl={locale:"en",label:"English",messages:d1};async function hZ(n,e){if(!(await fetch(e.translations.en)).ok)return console.warn("No main translations found."),Yl;if(n==="en")return Yl;const t=bu.find(o=>o.locale===n);if(!t)return console.warn(`No translation found for locale ${n}`),Yl;const r=await(await fetch(e.translations[t.locale])).json();if(!r)return console.warn(`No messages found for locale ${n}`),Yl;const i=[];for(const o in Yl.messages)r[o]||i.push(o);return i.length>0,{locale:n,label:t.label,messages:{...Yl.messages,...r}}}const qA=S.createContext({}),pZ=()=>S.useContext(qA),fZ=ze(function({overrides:n,children:e}){const t=Y().user.getLocale(),r=u1(),[i,o]=S.useState(()=>n&&n.en?{locale:"en",label:"English",messages:{...d1,...n.en}}:{locale:"en",label:"English",messages:d1});return S.useEffect(()=>{let s=!1;async function a(){const l=await hZ(t,r);l&&!s&&(n&&n[t]?o({...l,messages:{...l.messages,...n[t]}}):o(l))}return a(),()=>{s=!0}},[r,t,n]),y.jsx(qA.Provider,{value:i,children:e})});function Me(){const n=pZ();return S.useCallback(function(e){return n.messages[e]??e},[n])}function gZ(n){return y.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:y.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[y.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),y.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:y.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const fr=S.memo(function({small:n,invertIcon:e,icon:t,color:r,className:i,...o}){const s=u1(),a=s.icons[t]??s.icons["question-mark-circle"],l=S.useRef(null);return S.useLayoutEffect(()=>{a||console.error(`Icon not found: ${t}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,t]),y.jsx("div",{...o,ref:l,className:we("tlui-icon",{"tlui-icon__small":n},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:e?"scale(-1, 1)":void 0}})}),ZA=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,JA=ZA?"\u2318":"Ctrl",QA=ZA?"\u2325":"Alt";function mZ(n){return n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,JA).replace(/\?/g,QA).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)})}function Ri(n){return"\u2014 "+n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,JA).replace(/\?/g,QA).replace(/!/g,"\u21E7");return t[0].toUpperCase()+t.slice(1)}).join("\u2009")}function Ng({children:n}){return y.jsx("kbd",{className:"tlui-kbd",children:mZ(n).map((e,t)=>y.jsx("span",{children:e},t))})}const ce=S.forwardRef(function({label:n,icon:e,invertIcon:t,iconLeft:r,smallIcon:i,kbd:o,isChecked:s=!1,type:a,children:l,spinner:c,...u},d){const h=Me(),p=n?h(n):"";return y.jsxs("button",{ref:d,draggable:!1,type:"button",...u,title:u.title??p,className:we("tlui-button",`tlui-button__${a}`,u.className),children:[r&&y.jsx(fr,{icon:r,className:"tlui-button__icon-left",small:!0}),l,n&&y.jsxs("span",{className:"tlui-button__label",draggable:!1,children:[p,s&&y.jsx(fr,{icon:"check"})]}),o&&y.jsx(Ng,{children:o}),e&&!c&&y.jsx(fr,{icon:e,small:!!n||i,invertIcon:t}),c&&y.jsx(gZ,{})]})}),yZ=i5["useId".toString()]||(()=>{});let wZ=0;function vo(n){const[e,t]=S.useState(yZ());return ha(()=>{n||t(r=>r??String(wZ++))},[n]),n||(e?`radix-${e}`:"")}const h1="focusScope.autoFocusOnMount",p1="focusScope.autoFocusOnUnmount",ej={bubbles:!1,cancelable:!0},f1=S.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=n,[a,l]=S.useState(null),c=vn(i),u=vn(o),d=S.useRef(null),h=it(e,f=>l(f)),p=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(r){let f=function(_){if(p.paused||!a)return;const x=_.target;a.contains(x)?d.current=x:ws(d.current,{select:!0})},m=function(_){if(p.paused||!a)return;const x=_.relatedTarget;x!==null&&(a.contains(x)||ws(d.current,{select:!0}))},v=function(_){if(document.activeElement===document.body)for(const x of _)x.removedNodes.length>0&&ws(a)};document.addEventListener("focusin",f),document.addEventListener("focusout",m);const b=new MutationObserver(v);return a&&b.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",f),document.removeEventListener("focusout",m),b.disconnect()}}},[r,a,p.paused]),S.useEffect(()=>{if(a){rj.add(p);const f=document.activeElement;if(!a.contains(f)){const m=new CustomEvent(h1,ej);a.addEventListener(h1,c),a.dispatchEvent(m),m.defaultPrevented||(bZ(kZ(tj(a)),{select:!0}),document.activeElement===f&&ws(a))}return()=>{a.removeEventListener(h1,c),setTimeout(()=>{const m=new CustomEvent(p1,ej);a.addEventListener(p1,u),a.dispatchEvent(m),m.defaultPrevented||ws(f??document.body,{select:!0}),a.removeEventListener(p1,u),rj.remove(p)},0)}}},[a,c,u,p]);const g=S.useCallback(f=>{if(!t&&!r||p.paused)return;const m=f.key==="Tab"&&!f.altKey&&!f.ctrlKey&&!f.metaKey,v=document.activeElement;if(m&&v){const b=f.currentTarget,[_,x]=vZ(b);_&&x?!f.shiftKey&&v===x?(f.preventDefault(),t&&ws(_,{select:!0})):f.shiftKey&&v===_&&(f.preventDefault(),t&&ws(x,{select:!0})):v===b&&f.preventDefault()}},[t,r,p.paused]);return S.createElement(qe.div,te({tabIndex:-1},s,{ref:h,onKeyDown:g}))});function bZ(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(ws(r,{select:e}),document.activeElement!==t)return}function vZ(n){const e=tj(n),t=nj(e,n),r=nj(e.reverse(),n);return[t,r]}function tj(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function nj(n,e){for(const t of n)if(!SZ(t,{upTo:e}))return t}function SZ(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function xZ(n){return n instanceof HTMLInputElement&&"select"in n}function ws(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&xZ(n)&&e&&n.select()}}const rj=_Z();function _Z(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=ij(n,e),n.unshift(e)},remove(e){var t;n=ij(n,e),(t=n[0])===null||t===void 0||t.resume()}}}function ij(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function kZ(n){return n.filter(e=>e.tagName!=="A")}let g1=0;function m1(){S.useEffect(()=>{var n,e;const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(n=t[0])!==null&&n!==void 0?n:oj()),document.body.insertAdjacentElement("beforeend",(e=t[1])!==null&&e!==void 0?e:oj()),g1++,()=>{g1===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),g1--}},[])}function oj(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var Oi=function(){return Oi=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Oi.apply(this,arguments)};function sj(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function CZ(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))}var Fg="right-scroll-bar-position",$g="width-before-scroll-bar",PZ="with-scroll-bars-hidden",EZ="--removed-body-scroll-bar-size";function y1(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function IZ(n,e){var t=S.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var MZ=typeof window<"u"?S.useLayoutEffect:S.useEffect,aj=new WeakMap;function TZ(n,e){var t=IZ(e||null,function(r){return n.forEach(function(i){return y1(i,r)})});return MZ(function(){var r=aj.get(t);if(r){var i=new Set(r),o=new Set(n),s=t.current;i.forEach(function(a){o.has(a)||y1(a,null)}),o.forEach(function(a){i.has(a)||y1(a,s)})}aj.set(t,n)},[n]),t}function AZ(n){return n}function jZ(n,e){e===void 0&&(e=AZ);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(o){var s=e(o,r);return t.push(s),function(){t=t.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;t.length;){var s=t;t=[],s.forEach(o)}t={push:function(a){return o(a)},filter:function(){return t}}},assignMedium:function(o){r=!0;var s=[];if(t.length){var a=t;t=[],a.forEach(o),s=t}var l=function(){var u=s;s=[],u.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),t={push:function(u){s.push(u),c()},filter:function(u){return s=s.filter(u),t}}}};return i}function RZ(n){n===void 0&&(n={});var e=jZ(null);return e.options=Oi({async:!0,ssr:!1},n),e}var lj=function(n){var e=n.sideCar,t=sj(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return S.createElement(r,Oi({},t))};lj.isSideCarExport=!0;function OZ(n,e){return n.useMedium(e),lj}var cj=RZ(),w1=function(){},Bg=S.forwardRef(function(n,e){var t=S.useRef(null),r=S.useState({onScrollCapture:w1,onWheelCapture:w1,onTouchMoveCapture:w1}),i=r[0],o=r[1],s=n.forwardProps,a=n.children,l=n.className,c=n.removeScrollBar,u=n.enabled,d=n.shards,h=n.sideCar,p=n.noIsolation,g=n.inert,f=n.allowPinchZoom,m=n.as,v=m===void 0?"div":m,b=sj(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),_=h,x=TZ([t,e]),C=Oi(Oi({},b),i);return S.createElement(S.Fragment,null,u&&S.createElement(_,{sideCar:cj,removeScrollBar:c,shards:d,noIsolation:p,inert:g,setCallbacks:o,allowPinchZoom:!!f,lockRef:t}),s?S.cloneElement(S.Children.only(a),Oi(Oi({},C),{ref:x})):S.createElement(v,Oi({},C,{className:l,ref:x}),a))});Bg.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},Bg.classNames={fullWidth:$g,zeroRight:Fg};var uj,DZ=function(){if(uj)return uj;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function LZ(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=DZ();return e&&n.setAttribute("nonce",e),n}function zZ(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function NZ(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var FZ=function(){var n=0,e=null;return{add:function(t){n==0&&(e=LZ())&&(zZ(e,t),NZ(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},$Z=function(){var n=FZ();return function(e,t){S.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},dj=function(){var n=$Z(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},BZ={left:0,top:0,right:0,gap:0},b1=function(n){return parseInt(n||"",10)||0},UZ=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[b1(t),b1(r),b1(i)]},VZ=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return BZ;var e=UZ(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},HZ=dj(),Xl="data-scroll-locked",WZ=function(n,e,t,r){var i=n.left,o=n.top,s=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(PZ,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Xl,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Fg,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat($g,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Fg," .").concat(Fg,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat($g," .").concat($g,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Xl,`] {
    `).concat(EZ,": ").concat(a,`px;
  }
`)},hj=function(){var n=parseInt(document.body.getAttribute(Xl)||"0",10);return isFinite(n)?n:0},KZ=function(){S.useEffect(function(){return document.body.setAttribute(Xl,(hj()+1).toString()),function(){var n=hj()-1;n<=0?document.body.removeAttribute(Xl):document.body.setAttribute(Xl,n.toString())}},[])},GZ=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;KZ();var o=S.useMemo(function(){return VZ(i)},[i]);return S.createElement(HZ,{styles:WZ(o,!e,i,t?"":"!important")})},v1=!1;if(typeof window<"u")try{var Ug=Object.defineProperty({},"passive",{get:function(){return v1=!0,!0}});window.addEventListener("test",Ug,Ug),window.removeEventListener("test",Ug,Ug)}catch{v1=!1}var ql=v1?{passive:!1}:!1,YZ=function(n){return n.tagName==="TEXTAREA"},pj=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!YZ(n)&&t[e]==="visible")},XZ=function(n){return pj(n,"overflowY")},qZ=function(n){return pj(n,"overflowX")},fj=function(n,e){var t=e;do{typeof ShadowRoot<"u"&&t instanceof ShadowRoot&&(t=t.host);var r=gj(n,t);if(r){var i=mj(n,t),o=i[1],s=i[2];if(o>s)return!0}t=t.parentNode}while(t&&t!==document.body);return!1},ZZ=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},JZ=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},gj=function(n,e){return n==="v"?XZ(e):qZ(e)},mj=function(n,e){return n==="v"?ZZ(e):JZ(e)},QZ=function(n,e){return n==="h"&&e==="rtl"?-1:1},eJ=function(n,e,t,r,i){var o=QZ(n,window.getComputedStyle(e).direction),s=o*r,a=t.target,l=e.contains(a),c=!1,u=s>0,d=0,h=0;do{var p=mj(n,a),g=p[0],f=p[1],m=p[2],v=f-m-o*g;(g||v)&&gj(n,a)&&(d+=v,h+=g),a=a.parentNode}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(u&&(i&&d===0||!i&&s>d)||!u&&(i&&h===0||!i&&-s>h))&&(c=!0),c},Vg=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},yj=function(n){return[n.deltaX,n.deltaY]},wj=function(n){return n&&"current"in n?n.current:n},tJ=function(n,e){return n[0]===e[0]&&n[1]===e[1]},nJ=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},rJ=0,Zl=[];function iJ(n){var e=S.useRef([]),t=S.useRef([0,0]),r=S.useRef(),i=S.useState(rJ++)[0],o=S.useState(function(){return dj()})[0],s=S.useRef(n);S.useEffect(function(){s.current=n},[n]),S.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var f=CZ([n.lockRef.current],(n.shards||[]).map(wj),!0).filter(Boolean);return f.forEach(function(m){return m.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),f.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=S.useCallback(function(f,m){if("touches"in f&&f.touches.length===2)return!s.current.allowPinchZoom;var v=Vg(f),b=t.current,_="deltaX"in f?f.deltaX:b[0]-v[0],x="deltaY"in f?f.deltaY:b[1]-v[1],C,k=f.target,E=Math.abs(_)>Math.abs(x)?"h":"v";if("touches"in f&&E==="h"&&k.type==="range")return!1;var I=fj(E,k);if(!I)return!0;if(I?C=E:(C=E==="v"?"h":"v",I=fj(E,k)),!I)return!1;if(!r.current&&"changedTouches"in f&&(_||x)&&(r.current=C),!C)return!0;var T=r.current||C;return eJ(T,m,f,T==="h"?_:x,!0)},[]),l=S.useCallback(function(f){var m=f;if(!(!Zl.length||Zl[Zl.length-1]!==o)){var v="deltaY"in m?yj(m):Vg(m),b=e.current.filter(function(C){return C.name===m.type&&C.target===m.target&&tJ(C.delta,v)})[0];if(b&&b.should){m.cancelable&&m.preventDefault();return}if(!b){var _=(s.current.shards||[]).map(wj).filter(Boolean).filter(function(C){return C.contains(m.target)}),x=_.length>0?a(m,_[0]):!s.current.noIsolation;x&&m.cancelable&&m.preventDefault()}}},[]),c=S.useCallback(function(f,m,v,b){var _={name:f,delta:m,target:v,should:b};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(x){return x!==_})},1)},[]),u=S.useCallback(function(f){t.current=Vg(f),r.current=void 0},[]),d=S.useCallback(function(f){c(f.type,yj(f),f.target,a(f,n.lockRef.current))},[]),h=S.useCallback(function(f){c(f.type,Vg(f),f.target,a(f,n.lockRef.current))},[]);S.useEffect(function(){return Zl.push(o),n.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",l,ql),document.addEventListener("touchmove",l,ql),document.addEventListener("touchstart",u,ql),function(){Zl=Zl.filter(function(f){return f!==o}),document.removeEventListener("wheel",l,ql),document.removeEventListener("touchmove",l,ql),document.removeEventListener("touchstart",u,ql)}},[]);var p=n.removeScrollBar,g=n.inert;return S.createElement(S.Fragment,null,g?S.createElement(o,{styles:nJ(i)}):null,p?S.createElement(GZ,{gapMode:"margin"}):null)}const oJ=OZ(cj,iJ);var bj=S.forwardRef(function(n,e){return S.createElement(Bg,Oi({},n,{ref:e,sideCar:oJ}))});bj.classNames=Bg.classNames;const S1=bj;var sJ=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Jl=new WeakMap,Hg=new WeakMap,Wg={},x1=0,vj=function(n){return n&&(n.host||vj(n.parentNode))},aJ=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=vj(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},lJ=function(n,e,t,r){var i=aJ(e,Array.isArray(n)?n:[n]);Wg[t]||(Wg[t]=new WeakMap);var o=Wg[t],s=[],a=new Set,l=new Set(i),c=function(d){!d||a.has(d)||(a.add(d),c(d.parentNode))};i.forEach(c);var u=function(d){!d||l.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else try{var p=h.getAttribute(r),g=p!==null&&p!=="false",f=(Jl.get(h)||0)+1,m=(o.get(h)||0)+1;Jl.set(h,f),o.set(h,m),s.push(h),f===1&&g&&Hg.set(h,!0),m===1&&h.setAttribute(t,"true"),g||h.setAttribute(r,"true")}catch(v){console.error("aria-hidden: cannot operate on ",h,v)}})};return u(e),a.clear(),x1++,function(){s.forEach(function(d){var h=Jl.get(d)-1,p=o.get(d)-1;Jl.set(d,h),o.set(d,p),h||(Hg.has(d)||d.removeAttribute(r),Hg.delete(d)),p||d.removeAttribute(t)}),x1--,x1||(Jl=new WeakMap,Jl=new WeakMap,Hg=new WeakMap,Wg={})}},_1=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=e||sJ(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),lJ(r,i,t,"aria-hidden")):function(){return null}};const Sj="Dialog",[xj,Ype]=ji(Sj),[cJ,So]=xj(Sj),uJ=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=n,a=S.useRef(null),l=S.useRef(null),[c=!1,u]=ys({prop:r,defaultProp:i,onChange:o});return S.createElement(cJ,{scope:e,triggerRef:a,contentRef:l,contentId:vo(),titleId:vo(),descriptionId:vo(),open:c,onOpenChange:u,onOpenToggle:S.useCallback(()=>u(d=>!d),[u]),modal:s},t)},_j="DialogPortal",[dJ,kj]=xj(_j,{forceMount:void 0}),hJ=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,o=So(_j,e);return S.createElement(dJ,{scope:e,forceMount:t},S.Children.map(r,s=>S.createElement(si,{present:t||o.open},S.createElement(Rg,{asChild:!0,container:i},s))))},k1="DialogOverlay",pJ=S.forwardRef((n,e)=>{const t=kj(k1,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=So(k1,n.__scopeDialog);return o.modal?S.createElement(si,{present:r||o.open},S.createElement(fJ,te({},i,{ref:e}))):null}),fJ=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=So(k1,t);return S.createElement(S1,{as:da,allowPinchZoom:!0,shards:[i.contentRef]},S.createElement(qe.div,te({"data-state":Pj(i.open)},r,{ref:e,style:{pointerEvents:"auto",...r.style}})))}),ud="DialogContent",gJ=S.forwardRef((n,e)=>{const t=kj(ud,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,o=So(ud,n.__scopeDialog);return S.createElement(si,{present:r||o.open},o.modal?S.createElement(mJ,te({},i,{ref:e})):S.createElement(yJ,te({},i,{ref:e})))}),mJ=S.forwardRef((n,e)=>{const t=So(ud,n.__scopeDialog),r=S.useRef(null),i=it(e,t.contentRef,r);return S.useEffect(()=>{const o=r.current;if(o)return _1(o)},[]),S.createElement(Cj,te({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ae(n.onCloseAutoFocus,o=>{var s;o.preventDefault(),(s=t.triggerRef.current)===null||s===void 0||s.focus()}),onPointerDownOutside:ae(n.onPointerDownOutside,o=>{const s=o.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&o.preventDefault()}),onFocusOutside:ae(n.onFocusOutside,o=>o.preventDefault())}))}),yJ=S.forwardRef((n,e)=>{const t=So(ud,n.__scopeDialog),r=S.useRef(!1),i=S.useRef(!1);return S.createElement(Cj,te({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),Cj=S.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=n,a=So(ud,t),l=S.useRef(null),c=it(e,l);return m1(),S.createElement(S.Fragment,null,S.createElement(f1,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},S.createElement(jg,te({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Pj(a.open)},s,{ref:c,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),wJ="DialogTitle",bJ=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=So(wJ,t);return S.createElement(qe.h2,te({id:i.titleId},r,{ref:e}))}),vJ="DialogClose",SJ=S.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=So(vJ,t);return S.createElement(qe.button,te({type:"button"},r,{ref:e,onClick:ae(n.onClick,()=>i.onOpenChange(!1))}))});function Pj(n){return n?"open":"closed"}const xJ=uJ,_J=hJ,kJ=pJ,CJ=gJ;function Kg({className:n,children:e}){return y.jsx("div",{className:we("tlui-dialog__header",n),children:e})}function Gg({className:n,children:e}){return y.jsx(bJ,{dir:"ltr",className:we("tlui-dialog__header__title",n),children:e})}function Yg(){return y.jsx("div",{className:"tlui-dialog__header__close",children:y.jsx(SJ,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:y.jsx(ce,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:y.jsx(fr,{small:!0,icon:"cross-2"})})})})}function dd({className:n,children:e,style:t}){return y.jsx("div",{className:we("tlui-dialog__body",n),style:t,children:e})}function C1({className:n,children:e}){return y.jsx("div",{className:we("tlui-dialog__footer",n),children:e})}const P1=S.forwardRef(function({className:n,label:e,icon:t,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:u,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:p,value:g},f){const m=Y(),v=S.useRef(null);S.useImperativeHandle(f,()=>v.current);const b=Me(),_=S.useRef(s??""),x=S.useRef(s??""),[C,k]=S.useState(!1),E=S.useCallback(D=>{k(!0);const N=D.currentTarget;x.current=N.value,requestAnimationFrame(()=>{i&&N.select()})},[i]),I=S.useCallback(D=>{const N=D.currentTarget.value;x.current=N,c==null||c(N)},[c]),T=S.useCallback(D=>{switch(D.key){case"Enter":{D.currentTarget.blur(),Ft(D),l==null||l(D.currentTarget.value);break}case"Escape":{D.currentTarget.value=_.current,D.currentTarget.blur(),Ft(D),u==null||u(D.currentTarget.value);break}}},[l,u]),A=S.useCallback(D=>{k(!1);const N=D.currentTarget.value;d==null||d(N)},[d]);return S.useEffect(()=>{if(!m.environment.isIos)return;const D=window.visualViewport;if(C&&h&&D){const N=()=>{var U;(U=v.current)==null||U.scrollIntoView({block:"center"})};return D.addEventListener("resize",N),D.addEventListener("scroll",N),requestAnimationFrame(()=>{var U;(U=v.current)==null||U.scrollIntoView({block:"center"})}),()=>{D.removeEventListener("resize",N),D.removeEventListener("scroll",N)}}},[m,C,h]),y.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,e&&y.jsx("label",{children:b(e)}),r&&y.jsx(fr,{icon:r,className:"tlui-icon-left",small:!0}),y.jsx("input",{ref:v,className:we("tlui-input",n),type:"text",defaultValue:s,onKeyUp:T,onChange:I,onFocus:E,onBlur:A,autoFocus:o,placeholder:a,value:g}),t&&y.jsx(fr,{icon:t,small:!!e})]})});function Ej(n){return ar.isValid(n)?{isValid:!0,hasProtocol:!0}:ar.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const PJ=ze(function({onClose:n}){const e=Y().getOnlySelectedShape();return e&&"url"in e.props&&typeof e.props.url=="string"?y.jsx(EJ,{onClose:n,selectedShape:e}):null}),EJ=ze(function({onClose:n,selectedShape:e}){const t=Y(),r=Me(),i=S.useRef(null);S.useEffect(()=>{requestAnimationFrame(()=>{var p;return(p=i.current)==null?void 0:p.focus()})},[]);const o=S.useRef(e.props.url),[s,a]=S.useState(()=>{const p=Ej(e.props.url),g=p.isValid===!0?p.hasProtocol?e.props.url:"https://"+e.props.url:"https://";return{actual:g,safe:g,valid:!0}}),l=S.useCallback(p=>{const g=p.replace(/https?:\/\/(https?:\/\/)/,(v,b)=>b),f=Ej(g),m=f.isValid===!0?f.hasProtocol?g:"https://"+g:"https://";a({actual:g,safe:m,valid:f.isValid})},[]),c=S.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(t.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),n())},[t,n]),u=S.useCallback(()=>{const p=t.getOnlySelectedShape();p&&(p&&"url"in p.props&&p.props.url!==s.safe&&t.updateShapes([{id:p.id,type:p.type,props:{url:s.safe}}]),n())},[t,n,s]),d=S.useCallback(()=>{n()},[n]);if(!e)return n(),null;const h=o.current&&!s.valid;return y.jsxs(y.Fragment,{children:[y.jsxs(Kg,{children:[y.jsx(Gg,{children:r("edit-link-dialog.title")}),y.jsx(Yg,{})]}),y.jsx(dd,{children:y.jsxs("div",{className:"tlui-edit-link-dialog",children:[y.jsx(P1,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:s.actual,onValueChange:l,onComplete:u,onCancel:d}),y.jsx("div",{children:s.valid?r("edit-link-dialog.detail"):r("edit-link-dialog.invalid-url")})]})}),y.jsxs(C1,{className:"tlui-dialog__footer__actions",children:[y.jsx(ce,{type:"normal",onClick:d,onTouchEnd:d,children:r("edit-link-dialog.cancel")}),h?y.jsx(ce,{type:"danger",onTouchEnd:c,onClick:c,children:r("edit-link-dialog.clear")}):y.jsx(ce,{type:"primary",disabled:!s.valid,onTouchEnd:u,onClick:u,children:r("edit-link-dialog.save")})]})]})}),Ij=ze(function({onClose:n}){const e=Y(),t=Me(),r=u1(),[i,o]=S.useState(null),[s,a]=S.useState(""),[l,c]=S.useState(null),[u,d]=S.useState(!1),h=S.useRef(-1);return y.jsxs(y.Fragment,{children:[y.jsxs(Kg,{children:[y.jsx(Gg,{children:i?`${t("embed-dialog.title")} \u2014 ${i.title}`:t("embed-dialog.title")}),y.jsx(Yg,{})]}),i?y.jsxs(y.Fragment,{children:[y.jsxs(dd,{className:"tlui-embed-dialog__enter",children:[y.jsx(P1,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:p=>{a(p);const g=wo(p);c(g&&g.definition.type===i.type?g:null),d(!1),clearTimeout(h.current),h.current=setTimeout(()=>d(!g),320)}}),s===""?y.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[y.jsx("span",{children:t("embed-dialog.instruction")})," ",i.instructionLink&&y.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",y.jsx(fr,{icon:"external-link",small:!0})]})]}):y.jsx("div",{className:"tlui-embed-dialog__warning",children:u?t("embed-dialog.invalid-url"):"\xA0"})]}),y.jsxs(C1,{className:"tlui-dialog__footer__actions",children:[y.jsx(ce,{type:"normal",onClick:()=>{o(null),c(null),a("")},label:"embed-dialog.back"}),y.jsx("div",{className:"tlui-embed__spacer"}),y.jsx(ce,{type:"normal",label:"embed-dialog.cancel",onClick:n}),y.jsx(ce,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(e.putExternalContent({type:"embed",url:s,point:e.getViewportPageCenter(),embed:l.definition}),n())}})]})]}):y.jsx(y.Fragment,{children:y.jsx(dd,{className:"tlui-embed-dialog__list",children:fl.map(p=>y.jsx(ce,{type:"menu",onClick:()=>o(p),label:p.title,children:y.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[p.type]})`}})},p.type))})})]})});var E1={exports:{}};E1.exports,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,c){if(!o[l]){o[l]={};for(var u=0;u<l.length;u++)o[l][l.charAt(u)]=u}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(u){return r.charAt(u)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return s(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return t(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),u=new Uint8Array(c.length*2),d=0,h=c.length;d<h;d++){var p=c.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),u=0,d=c.length;u<d;u++)c[u]=l[u*2]*256+l[u*2+1];var h=[];return c.forEach(function(p){h.push(t(p))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return s(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return t(c)})},_compress:function(l,c,u){if(l==null)return"";var d,h,p={},g={},f="",m="",v="",b=2,_=3,x=2,C=[],k=0,E=0,I;for(I=0;I<l.length;I+=1)if(f=l.charAt(I),Object.prototype.hasOwnProperty.call(p,f)||(p[f]=_++,g[f]=!0),m=v+f,Object.prototype.hasOwnProperty.call(p,m))v=m;else{if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(d=0;d<x;d++)k=k<<1,E==c-1?(E=0,C.push(u(k)),k=0):E++;for(h=v.charCodeAt(0),d=0;d<8;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1}else{for(h=1,d=0;d<x;d++)k=k<<1|h,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=0;for(h=v.charCodeAt(0),d=0;d<16;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete g[v]}else for(h=p[v],d=0;d<x;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++),p[m]=_++,v=String(f)}if(v!==""){if(Object.prototype.hasOwnProperty.call(g,v)){if(v.charCodeAt(0)<256){for(d=0;d<x;d++)k=k<<1,E==c-1?(E=0,C.push(u(k)),k=0):E++;for(h=v.charCodeAt(0),d=0;d<8;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1}else{for(h=1,d=0;d<x;d++)k=k<<1|h,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=0;for(h=v.charCodeAt(0),d=0;d<16;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1}b--,b==0&&(b=Math.pow(2,x),x++),delete g[v]}else for(h=p[v],d=0;d<x;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1;b--,b==0&&(b=Math.pow(2,x),x++)}for(h=2,d=0;d<x;d++)k=k<<1|h&1,E==c-1?(E=0,C.push(u(k)),k=0):E++,h=h>>1;for(;;)if(k=k<<1,E==c-1){C.push(u(k));break}else E++;return C.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,u){var d=[],h=4,p=4,g=3,f="",m=[],v,b,_,x,C,k,E,I={val:u(0),position:c,index:1};for(v=0;v<3;v+=1)d[v]=v;for(_=0,C=Math.pow(2,2),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;switch(_){case 0:for(_=0,C=Math.pow(2,8),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;E=t(_);break;case 1:for(_=0,C=Math.pow(2,16),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;E=t(_);break;case 2:return""}for(d[3]=E,b=E,m.push(E);;){if(I.index>l)return"";for(_=0,C=Math.pow(2,g),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;switch(E=_){case 0:for(_=0,C=Math.pow(2,8),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;d[p++]=t(_),E=p-1,h--;break;case 1:for(_=0,C=Math.pow(2,16),k=1;k!=C;)x=I.val&I.position,I.position>>=1,I.position==0&&(I.position=c,I.val=u(I.index++)),_|=(x>0?1:0)*k,k<<=1;d[p++]=t(_),E=p-1,h--;break;case 2:return m.join("")}if(h==0&&(h=Math.pow(2,g),g++),d[E])f=d[E];else if(E===p)f=b+b.charAt(0);else return null;m.push(f),d[p++]=b+f.charAt(0),h--,b=f,h==0&&(h=Math.pow(2,g),g++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(E1);var Mj=E1.exports;async function IJ(n,e,t){var v,b,_;const{elements:r,files:i}=e,o={shapes:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},s=new Map,a=new Map,l=n.getCurrentPageId(),c=new Map,u=[],d=new Set;r.forEach(x=>{if(c.set(x.id,tt()),x.boundElements!==null)for(const C of x.boundElements)C.type==="text"&&d.add(C.id)});let h="a1";for(const x of r){if(d.has(x.id))continue;const C=c.get(x.id),k={id:C,typeName:"shape",parentId:l,index:h,x:x.x,y:x.y,rotation:0,isLocked:x.locked,opacity:MJ(x.opacity),meta:{}};switch(x.angle!==0&&a.set(C,x.angle),x.groupIds&&x.groupIds.length>0?s.has(x.groupIds[0])?(v=s.get(x.groupIds[0]))==null||v.push(C):s.set(x.groupIds[0],[C]):u.push(C),x.type){case"rectangle":case"ellipse":case"diamond":{let E="",I="middle";if(x.boundElements!==null){for(const A of x.boundElements)if(A.type==="text"){const D=r.find(N=>N.id===A.id);D&&(E=D.text,I=Tj[D.textAlign])}}const T=x.backgroundColor==="transparent"?x.strokeColor:x.backgroundColor;o.shapes.push({...k,type:"geo",props:{geo:x.type,url:x.link??"",w:x.width,h:x.height,size:Xg[x.strokeWidth]??"draw",color:hd[T]??"black",text:E,align:I,dash:qg(x),fill:LJ(x)}});break}case"freedraw":{o.shapes.push({...k,type:"draw",props:{dash:qg(x),size:Xg[x.strokeWidth],color:hd[x.strokeColor]??"black",segments:[{type:"free",points:x.points.map(([E,I,T=.5])=>({x:E,y:I,z:T}))}]}});break}case"line":{const E=x.points[0],I=x.points[x.points.length-1],T=FE(x.points.length);o.shapes.push({...k,type:"line",props:{dash:qg(x),size:Xg[x.strokeWidth],color:hd[x.strokeColor]??"black",spline:x.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:T[0],x:E[0],y:E[1]},end:{id:"end",type:"vertex",index:T[T.length-1],x:I[0],y:I[1]},...Object.fromEntries(x.points.slice(1,-1).map(([A,D],N)=>{const U=Xe();return[U,{id:U,type:"vertex",index:T[N+1],x:A,y:D}]}))}}});break}case"arrow":{let E="";if(x.boundElements!==null){for(const N of x.boundElements)if(N.type==="text"){const U=r.find(R=>R.id===N.id);U&&(E=U.text)}}const I=x.points[0],T=x.points[x.points.length-1],A=c.get((b=x.startBinding)==null?void 0:b.elementId),D=c.get((_=x.endBinding)==null?void 0:_.elementId);o.shapes.push({...k,type:"arrow",props:{text:E,bend:DJ(x,I,T),dash:qg(x),size:Xg[x.strokeWidth]??"m",color:hd[x.strokeColor]??"black",start:A?{type:"binding",boundShapeId:A,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:I[0],y:I[1]},end:D?{type:"binding",boundShapeId:D,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:T[0],y:T[1]},arrowheadEnd:Aj[x.endArrowhead]??"none",arrowheadStart:Aj[x.startArrowhead]??"none"}});break}case"text":{const{size:E,scale:I}=AJ(x.fontSize);o.shapes.push({...k,type:"text",props:{size:E,scale:I,font:jJ[x.fontFamily]??"draw",color:hd[x.strokeColor]??"black",text:x.text,align:Tj[x.textAlign]}});break}case"image":{const E=i[x.fileId];if(!E)break;const I=Js.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:x.width,h:x.height,name:x.id??"Untitled",isAnimated:!1,mimeType:E.mimeType,src:E.dataURL},meta:{}}),o.shapes.push({...k,type:"image",props:{w:x.width,h:x.height,assetId:I}})}}h=uo(h)}const p=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0});for(const x of s.values())if(x.length>1){n.groupShapes(x);const C=n.getShape(x[0]);C!=null&&C.parentId&&Mr(C.parentId)&&u.push(C.parentId)}for(const[x,C]of a)n.select(x),n.rotateShapesBy([x],C);const g=ye(u.map(x=>n.getShape(x))),f=de.Common(g.map(x=>n.getShapePageBounds(x))),m=n.getViewportPageBounds().center;n.updateShapes(g.map(x=>{const C={x:(x.x??0)-(f.x+f.w/2),y:(x.y??0)-(f.y+f.h/2)};return{id:x.id,type:x.type,x:m.x+C.x,y:m.y+C.y}})),n.setSelectedShapes(u)}const MJ=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Xg={1:"s",2:"m",3:"l",4:"xl"},TJ={16:"s",20:"m",28:"l",36:"xl"};function AJ(n){const e=TJ[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const jJ={1:"draw",2:"sans",3:"mono"},hd={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},RJ={solid:"draw",dashed:"dashed",dotted:"dotted"},OJ={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Tj={left:"start",center:"middle",right:"end"},Aj={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function DJ(n,e,t){let r=0;if(n.points.length>2){const i=new P(e[0],e[1]),o=new P(t[0],t[1]),s=new P(n.points[1][0],n.points[1][1]),a=P.Sub(o,i),l=P.Per(a),c=P.Med(o,i),u=P.Sub(c,l),d=P.Add(c,l),h=P.NearestPointOnLineSegment(u,d,s,!1);r=P.Dist(h,c),P.Clockwise(h,o,c)&&(r*=-1)}return r}const qg=n=>{let e=RJ[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},LJ=n=>n.backgroundColor==="transparent"?"none":OJ[n.fillStyle]??"solid";async function jj(n,e,t,r){const i=(await Promise.all(e.map(async o=>await(await fetch(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:i,point:t,ignoreParent:!1,sources:r}),e.forEach(o=>URL.revokeObjectURL(o))}function zJ(n,e,t){const r=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(e,{point:r,select:!0})}async function I1(n,e,t,r){var i;try{if(new URL(e).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&((i=(await fetch(e,{method:"HEAD"})).headers.get("content-type"))!=null&&i.match(/^image\//))){n.mark("paste"),jj(n,[e]);return}}catch(o){o.message!=="Failed to fetch"&&console.error(o)}return n.mark("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const Rj=()=>{},Oj=S.createContext({});function NJ({onEvent:n,children:e}){return y.jsx(Oj.Provider,{value:n??Rj,children:e})}function Ql(){return S.useContext(Oj)??Rj}function FJ(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const $J=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},BJ=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return uE(e)},UJ=n=>/^<svg/.test(n),VJ=["input","select","textarea"];function Zg(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||VJ.indexOf(e.tagName.toLowerCase())>-1)}async function M1(n){return new Promise((e,t)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const i=r.result;e(i)}),r.addEventListener("error",()=>{t(r.error)}),r.readAsText(n)})}const HJ=n=>n.types.find(e=>e.match(/^image\//)),T1=(n,e,t,r)=>{const i=BJ(e);if(i)for(const o of i)I1(n,o,t);else $J(e)?I1(n,e,t):UJ(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},WJ=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(o=>i.getAsString(o))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(o=>i.getAsString(o))}):r.push({type:i.type,source:new Promise(o=>i.getAsString(o))});break}}Lj(n,r,t)},Dj=async(n,e,t)=>{const r=[];for(const i of e){if(HJ(i))for(const o of i.types)o.match(/^image\//)&&r.push({type:"blob",source:i.getType(o)});i.types.includes("text/html")&&r.push({type:"html",source:new Promise(o=>i.getType("text/html").then(s=>M1(s).then(o)))}),i.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(o=>i.getType("text/uri-list").then(s=>M1(s).then(o)))}),i.types.includes("text/plain")&&r.push({type:"text",source:new Promise(o=>i.getType("text/plain").then(s=>M1(s).then(o)))})}return await Lj(n,r,t)};async function Lj(n,e,t){const r=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){const o=(await Promise.all(r.map(s=>s.source))).filter(Boolean).map(s=>URL.createObjectURL(s));return await jj(n,o,t)}const i=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(s=>{const a=o;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{var u;const c=(u=l.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:u[1];if(c)try{const d=Mj.decompressFromBase64(c);if(d===null){s({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(d);if(h.type!=="application/tldraw"&&s({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){s({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:h.data});return}}catch{s({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){s({type:"excalidraw",data:d});return}else{s({type:"text",data:l,subtype:"json"});return}}catch{s({type:"text",data:l,subtype:"text"});return}}s({type:"error",data:l,reason:"unhandled case"})})})));for(const o of i)if(o.type==="tldraw"){zJ(n,o.data,t);return}for(const o of i)if(o.type==="excalidraw"){IJ(n,o.data,t);return}for(const o of i)if(o.type==="text"&&o.subtype==="html"){const s=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(s&&Array.from(s.children).filter(a=>a.nodeType===1).length===1&&s.firstElementChild&&s.firstElementChild.tagName==="A"&&s.firstElementChild.hasAttribute("href")&&s.firstElementChild.getAttribute("href")!==""){const a=s.firstElementChild.getAttribute("href");T1(n,a,t,i);return}if(!i.some(a=>a.type==="text"&&a.subtype!=="html")&&o.data.trim()){T1(n,FJ(o.data),t,i);return}}for(const o of i)if(o.type==="text"&&o.subtype==="url"){I1(n,o.data,t,i);return}for(const o of i)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){T1(n,o.data,t,i);return}}const Jg=n=>{var r;const e=n.getContentFromCurrentPage(n.getSelectedShapeIds());if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=Mj.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(o=>n.isShapeOfType(o,"text")||n.isShapeOfType(o,"geo")||n.isShapeOfType(o,"arrow")?o.props.text:n.isShapeOfType(o,"bookmark")||n.isShapeOfType(o,"embed")?o.props.url:null).filter(BL);if((r=navigator.clipboard)!=null&&r.write){const o=new Blob([`<tldraw>${t}</tldraw>`],{type:"text/html"});let s=i.join(" ");s===""&&(s=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([s],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${t}</tldraw>`)}};function KJ(){const n=Y(),e=Ql(),t=S.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Jg(n),e("copy",{source:o}))},[n,e]),r=S.useCallback(function(o){n.getSelectedShapeIds().length!==0&&(Jg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=S.useCallback(async function(o,s,a){n.getEditingShapeId()!==null||Zg(n)||(Array.isArray(o)&&o[0]instanceof ClipboardItem?(Dj(n,o,a),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{i(l,s,a)}))},[n,e]);return{copy:t,cut:r,paste:i}}function GJ(){const n=Y(),e=Ql(),t=Z("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(!t)return;const r=()=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Zg(n)||(Jg(n),e("copy",{source:"kbd"}))};function i(){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Zg(n)||(Jg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const s=l=>{l.button===1&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=l=>{if(o){l.stopPropagation();return}n.getEditingShapeId()!==null||Zg(n)||(l.clipboardData&&!n.inputs.shiftKey?WJ(n,l.clipboardData):navigator.clipboard.read().then(c=>{Array.isArray(c)&&c[0]instanceof ClipboardItem&&Dj(n,c,n.inputs.currentPagePoint)}),e("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[n,e,t])}async function YJ(n,e,t){const{type:r,quality:i,scale:o}=t,s=+n.getAttribute("width"),a=+n.getAttribute("height");let l=s*o,c=a*o;const u=await zj(n),d=URL.createObjectURL(new Blob([u],{type:"image/svg+xml"})),h=await lT();if(s>h.maxWidth&&(l=h.maxWidth,c=l/s*a),a>h.maxHeight&&(c=h.maxHeight,l=c/a*s),l*c>h.maxArea){const v=Math.sqrt(h.maxArea/(l*c));l*=v,c*=v}l=Math.floor(l),c=Math.floor(c);const p=l/s,g=await new Promise(v=>{const b=new Image;b.crossOrigin="anonymous",b.onload=async()=>{e&&await new Promise(C=>setTimeout(C,250));const _=document.createElement("canvas"),x=_.getContext("2d");_.width=l,_.height=c,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(b,0,0,l,c),URL.revokeObjectURL(d),v(_)},b.onerror=()=>{v(null)},b.src=d});if(!g)return null;const f=await new Promise(v=>g.toBlob(b=>{(!b||nt.throwToBlob.get())&&v(null),v(b)},"image/"+r,i));if(!f)return null;const m=new DataView(await f.arrayBuffer());return xi.setPhysChunk(m,p,{type:"image/"+r})}async function zj(n){const e=n.cloneNode(!0);n.setAttribute("width",+n.getAttribute("width")+""),n.setAttribute("height",+n.getAttribute("height")+"");const t=new FileReader,r=Array.from(e.querySelectorAll("image"));for(const i of r){const o=i.getAttribute("xlink:href");if(o&&!o.startsWith("data:")){const s=await(await fetch(o)).blob(),a=await new Promise((l,c)=>{t.onload=()=>l(t.result),t.onerror=()=>c(t.error),t.readAsDataURL(s)});i.setAttribute("xlink:href",a)}}return new XMLSerializer().serializeToString(e).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function Nj(n,e,t){const r=await n.getSvg(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function A1(n,e,t,r={}){switch(t){case"svg":return zj(await Nj(n,e,r));case"json":{const i=n.getContentFromCurrentPage(e);return JSON.stringify(i)}default:al(t)}}async function Fj(n,e,t,r={}){switch(t){case"svg":return new Blob([await A1(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await A1(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await YJ(await Nj(n,e,r),n.environment.isSafari,{type:t,quality:1,scale:2});if(!i)throw new Error("Could not construct image.");return i}default:al(t)}}const XJ={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function qJ(n,e,t,r={}){return{blobPromise:Fj(n,e,t,r),mimeType:XJ[t]}}function ZJ(n,e,t="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:o}=qJ(n,e,t,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(s=>(console.error(s),i.then(a=>window.navigator.clipboard.write([new ClipboardItem({[o]:a})]))))}switch(t){case"json":case"svg":return JJ(async()=>A1(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:al(t)}}async function JJ(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}const $j=S.createContext({});function QJ({children:n}){const[e,t]=S.useState([]),r=S.useCallback(s=>{const a=s.id??Xe();return t(l=>[...l.filter(c=>c.id!==s.id),{...s,id:a}]),a},[]),i=S.useCallback(s=>(t(a=>a.filter(l=>l.id!==s)),s),[]),o=S.useCallback(()=>{t(()=>[])},[]);return y.jsx($j.Provider,{value:{toasts:e,addToast:r,removeToast:i,clearToasts:o},children:n})}function Di(){const n=S.useContext($j);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}function eQ(){const n=Y(),{addToast:e}=Di(),t=Me();return S.useCallback((r,i="svg")=>{ZJ(n,r,i).catch(()=>{e({id:"copy-fail",icon:"warning-triangle",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}const Bj=S.createContext({});function tQ({children:n}){const e=Y(),t=Ql(),[r,i]=S.useState([]),o=S.useCallback(c=>{const u=c.id??Xe();return i(d=>[...d.filter(h=>h.id!==c.id),{...c,id:u}]),t("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u},[e,t]),s=S.useCallback((c,u)=>(i(d=>d.map(h=>h.id===c?{...h,...u}:h)),t("open-menu",{source:"dialog",id:c}),e.addOpenMenu(c),c),[e,t]),a=S.useCallback(c=>(i(u=>u.filter(d=>{var h;return d.id===c?((h=d.onClose)==null||h.call(d),!1):!0})),t("close-menu",{source:"dialog",id:c}),e.deleteOpenMenu(c),c),[e,t]),l=S.useCallback(()=>{i(c=>(c.forEach(u=>{var d;(d=u.onClose)==null||d.call(u),t("close-menu",{source:"dialog",id:u.id}),e.deleteOpenMenu(u.id)}),[]))},[e,t]);return y.jsx(Bj.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:n})}function fa(){const n=S.useContext(Bj);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}async function nQ(n,e,t="png",r={}){let i=`shapes at ${Uj()}`;if(e.length===1){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?i=a.props.name??"frame":i=`${a.id.replace(/:/,"_")} at ${Uj()}`}i+=`.${t}`;const o=await Fj(n,e,t,r),s=new File([o],i,{type:o.type});rQ(s)}function Uj(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),o=String(n.getMinutes()).padStart(2,"0"),s=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${o}.${s}`}function rQ(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function iQ(){const n=Y(),{addToast:e}=Di(),t=Me();return S.useCallback((r,i="png")=>{nQ(n,r,i,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc")})})},[n,e,t])}function Vj(){const n=Y(),e=S.useRef();return S.useEffect(()=>{const t=window.document.createElement("input");t.type="file",t.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",t.multiple=!0,e.current=t;async function r(i){const o=i.target.files;!o||o.length===0||(await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),t.value="")}return t.addEventListener("change",r),()=>{e.current=void 0,t.removeEventListener("change",r)}},[n]),S.useCallback(()=>{var t;(t=e.current)==null||t.click()},[e])}function oQ(){const n=Y(),e=S.useRef(null),t=S.useRef(null);return S.useCallback(async function(){const r=document.createElement("div"),i=document.createElement("style"),o=(f,m)=>{f&&(f.innerHTML=""),m&&document.head.contains(m)&&document.head.removeChild(m),f&&document.body.contains(f)&&document.body.removeChild(f)};o(e.current,t.current),e.current=r,t.current=i;const s=`tl-print-surface-${Xe()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;const a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{n.once("change-history",()=>{o(r,i)})};window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);function c(f,m,v){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${f.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${v.outerHTML}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${m?"":"hide"}">
          ${m??""}
        </div>
      </div>`}catch(b){console.error(b)}}function u(){n.environment.isChromeForIos?(a(),window.print()):n.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}const d=n.getSelectedShapeIds(),h=n.getCurrentPageId(),p=n.getPages(),g={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const f=await n.getSvg(d,g);if(f){const m=p.find(v=>v.id===h);c(`tldraw \u2014 ${m==null?void 0:m.name}`,null,f),u()}}else{const f=n.getCurrentPage(),m=await n.getSvg(n.getSortedChildIdsForParent(f.id),g);m&&(c(`tldraw \u2014 ${f.name}`,null,m),u())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[n])}const Hj=S.createContext({});function sQ(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function aQ({overrides:n,children:e}){const t=Y(),{addDialog:r,clearDialogs:i}=fa(),{clearToasts:o}=Di(),s=Vj(),a=oQ(),{cut:l,copy:c,paste:u}=KJ(),d=eQ(),h=iQ(),p=Ql(),g=S.useMemo(()=>{function f(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function m(){return t.getSelectedShapeIds().length>0}const v=sQ([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(b){m()&&(f()||(p("edit-link",{source:b}),t.mark("edit-link"),r({component:PJ})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(b){p("insert-embed",{source:b}),r({component:Ij})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(b){p("insert-media",{source:b}),s()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(b){p("undo",{source:b}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(b){p("redo",{source:b}),t.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"svg",source:b}),h(t.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"png",source:b}),h(t.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(b){p("export-as",{format:"json",source:b}),h(t.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(b){p("copy-as",{format:"svg",source:b}),d(t.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"png",source:b}),d(t.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(b){p("copy-as",{format:"json",source:b}),d(t.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(b){m()&&(f()||(p("toggle-auto-size",{source:b}),t.mark("toggling auto size"),t.updateShapes(t.getSelectedShapes().filter(_=>t.isShapeOfType(_,"text")&&_.props.autoSize===!1).map(_=>({id:_.id,type:_.type,props:{..._.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(b){p("open-embed-link",{source:b});const _=t.getSelectedShapeIds(),x="No embed shapes selected";if(_.length!==1){console.error(x);return}const C=t.getShape(_[0]);if(!C||!t.isShapeOfType(C,"embed")){console.error(x);return}H$(C.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(b){var _,x;if(((_=t.root.getCurrent())==null?void 0:_.id)!=="zoom"&&(p("zoom-tool",{source:b}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const C=t.root.getCurrent();C&&((x=C.getCurrent())==null?void 0:x.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:C.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(b){m()&&(f()||t.batch(()=>{p("convert-to-bookmark",{source:b});const _=t.getSelectedShapes(),x=[],C=[];for(const k of _){if(!k||!t.isShapeOfType(k,"embed")||!k.props.url)continue;const E=new P(k.x,k.y);E.rot(-k.rotation),E.add(new P(k.props.w/2-300/2,k.props.h/2-320/2)),E.rot(k.rotation);const I={id:tt(),type:"bookmark",rotation:k.rotation,x:E.x,y:E.y,opacity:1,props:{url:k.props.url}};x.push(I),C.push(k.id)}t.mark("convert shapes to bookmark"),t.deleteShapes(C),t.createShapes(x)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(b){m()&&(f()||(p("convert-to-embed",{source:b}),t.batch(()=>{const _=t.getSelectedShapeIds(),x=ye(_.map(E=>t.getShape(E))),C=[],k=[];for(const E of x){if(!t.isShapeOfType(E,"bookmark"))continue;const{url:I}=E.props,T=wo(E.props.url);if(!T||!T.definition)continue;const{width:A,height:D}=T.definition,N=new P(E.x,E.y);N.rot(-E.rotation),N.add(new P(E.props.w/2-A/2,E.props.h/2-D/2)),N.rot(E.rotation);const U={id:tt(),type:"embed",x:N.x,y:N.y,rotation:E.rotation,props:{url:I,w:A,h:D}};C.push(U),k.push(E.id)}t.mark("convert shapes to embed"),t.deleteShapes(k),t.createShapes(C)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("duplicate-shapes",{source:b});const _=t.getSelectedShapeIds(),x=de.Common(ye(_.map(k=>t.getShapePageBounds(k)))),C=t.getInstanceState().canMoveCamera?{x:x.width+10,y:0}:{x:16/t.getZoomLevel(),y:16/t.getZoomLevel()};t.mark("duplicate shapes"),t.duplicateShapes(_,C)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(b){m()&&(f()||(p("ungroup-shapes",{source:b}),t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("group-shapes",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"group")?(t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.mark("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(b){if(!m())return;p("remove-frame",{source:b});const _=t.getSelectedShapes();_.length>0&&_.every(x=>t.isShapeOfType(x,"frame"))&&(t.mark("remove-frame"),lZ(t,_.map(x=>x.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(b){if(!m())return;p("fit-frame-to-content",{source:b});const _=t.getOnlySelectedShape();_&&t.isShapeOfType(_,"frame")&&(t.mark("fit-frame-to-content"),uZ(t,_.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"left",source:b}),t.mark("align left"),t.alignShapes(t.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"center-horizontal",source:b}),t.mark("align center horizontal"),t.alignShapes(t.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"right",source:b}),t.mark("align right"),t.alignShapes(t.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"center-vertical",source:b}),t.mark("align center vertical"),t.alignShapes(t.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"top",source:b}),t.mark("align top"),t.alignShapes(t.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(b){m()&&(f()||(p("align-shapes",{operation:"bottom",source:b}),t.mark("align bottom"),t.alignShapes(t.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(b){m()&&(f()||(p("distribute-shapes",{operation:"horizontal",source:b}),t.mark("distribute horizontal"),t.distributeShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(b){m()&&(f()||(p("distribute-shapes",{operation:"vertical",source:b}),t.mark("distribute vertical"),t.distributeShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stretch-shapes",{operation:"horizontal",source:b}),t.mark("stretch horizontal"),t.stretchShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stretch-shapes",{operation:"vertical",source:b}),t.mark("stretch vertical"),t.stretchShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(b){m()&&(f()||(p("flip-shapes",{operation:"horizontal",source:b}),t.mark("flip horizontal"),t.flipShapes(t.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(b){m()&&(f()||(p("flip-shapes",{operation:"vertical",source:b}),t.mark("flip vertical"),t.flipShapes(t.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(b){m()&&(f()||(p("pack-shapes",{source:b}),t.mark("pack"),t.packShapes(t.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stack-shapes",{operation:"vertical",source:b}),t.mark("stack-vertical"),t.stackShapes(t.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(b){m()&&(f()||(p("stack-shapes",{operation:"horizontal",source:b}),t.mark("stack-horizontal"),t.stackShapes(t.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"toFront",source:b}),t.mark("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"forward",source:b}),t.mark("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"backward",source:b}),t.mark("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(b){m()&&(f()||(p("reorder-shapes",{operation:"toBack",source:b}),t.mark("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(b){m()&&(f()||(t.mark("cut"),l(b)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(b){m()&&(f()||c(b))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(b){var _;(_=navigator.clipboard)==null||_.read().then(x=>{u(x,b,b==="context-menu"?t.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(b){t.batch(()=>{f()||(p("select-all-shapes",{source:b}),t.mark("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(b){m()&&(f()||(p("select-none-shapes",{source:b}),t.mark("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"\u232B,del,backspace",icon:"trash",readonlyOk:!1,onSelect(b){m()&&(f()||(p("delete-shapes",{source:b}),t.mark("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("rotate-cw",{source:b}),t.mark("rotate-cw");const _=t.getSelectionRotation()%(rt/2),x=Cu(_,0)||Cu(_,rt/2);t.rotateShapesBy(t.getSelectedShapeIds(),rt/2-(x?0:_))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(b){if(!m()||f())return;p("rotate-ccw",{source:b}),t.mark("rotate-ccw");const _=t.getSelectionRotation()%(rt/2),x=Cu(_,0);t.rotateShapesBy(t.getSelectedShapeIds(),x?-(rt/2):-_)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(b){p("zoom-in",{source:b}),t.zoomIn(t.getViewportScreenCenter(),{duration:co})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(b){p("zoom-out",{source:b}),t.zoomOut(t.getViewportScreenCenter(),{duration:co})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(b){p("reset-zoom",{source:b}),t.resetZoom(t.getViewportScreenCenter(),{duration:co})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(b){p("zoom-to-fit",{source:b}),t.zoomToFit({duration:co})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(b){m()&&(f()||(p("zoom-to-selection",{source:b}),t.zoomToSelection({duration:co})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(b){p("toggle-snap-mode",{source:b}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(b){p("toggle-dark-mode",{source:b}),t.user.updateUserPreferences({isDarkMode:!t.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(b){p("toggle-reduce-motion",{source:b}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(b){p("toggle-edge-scrolling",{source:b}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(b){p("toggle-transparent",{source:b}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(b){p("toggle-tool-lock",{source:b}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(b){p("unlock-all",{source:b});const _=[];for(const x of t.getCurrentPageShapes())x.isLocked&&_.push({id:x.id,type:x.type,isLocked:!1});_.length>0&&t.updateShapes(_)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(b){requestAnimationFrame(()=>{t.batch(()=>{p("toggle-focus-mode",{source:b}),i(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(b){p("toggle-grid-mode",{source:b}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(b){p("toggle-debug-mode",{source:b}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(b){p("print",{source:b}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(b){p("exit-pen-mode",{source:b}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(b){p("stop-following",{source:b}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(b){p("zoom-to-content",{source:b}),t.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(b){t.mark("locking"),p("toggle-lock",{source:b}),t.toggleLock(t.getSelectedShapeIds())}}]);return n?n(t,v,void 0):v},[t,p,n,r,s,h,d,l,c,u,i,o,a]);return y.jsx(Hj.Provider,{value:g,children:e})}function Sn(){const n=S.useContext(Hj);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Qg(n){return n.filter(e=>e!=null&&e!==!1)}function _e(n,...e){const t=Qg(e);return t.length===0?null:{id:n,type:"group",checkbox:t.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:t.every(r=>r.disabled),readonlyOk:t.some(r=>r.readonlyOk),children:t}}function Li(n,e,...t){const r=Qg(t);return r.length===0?null:{id:n,type:"submenu",label:e,children:r,disabled:r.every(i=>i.disabled),readonlyOk:r.some(i=>i.readonlyOk)}}function j1(n,e={}){const{readonlyOk:t=!0,disabled:r=!1}=e;return{id:n,type:"custom",disabled:r,readonlyOk:t}}function H(n,e={}){if(!n)throw Error("No action item provided to menuItem");if(!n.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:t=!1,disabled:r=!1}=e;return{id:n.id,type:"item",actionItem:n,disabled:r,checked:t,readonlyOk:n.readonlyOk}}function lQ(n){return n.getSelectedShapeIds().map(e=>n.getShape(e)).filter(e=>!(!e||n.isShapeOfType(e,"arrow")&&e.props.start.type==="binding"||n.isShapeOfType(e,"arrow")&&e.props.end.type==="binding"))}const Wj=()=>{const n=Y();return Z("threeStackableItems",()=>lQ(n).length>2,[n])};function cQ(n){const e=n.getSelectedShapes(),t=[],r=new Map;e.forEach(o=>{o.type==="arrow"?t.push(o):r.set(o.id,o)});const i=t.filter(o=>!(o.props.start.type==="binding"&&!r.has(o.props.start.boundShapeId)||o.props.end.type==="binding"&&!r.has(o.props.end.boundShapeId)));return Array.from(r.values()).concat(i)}const R1=()=>{const n=Y();return Z("allowGroup",()=>cQ(n).length>1,[n])},O1=()=>{const n=Y();return Z("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},Kj=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,D1=[0,390,428,468,580,640,840,1023],Gj=oe.createContext(0);function uQ({forceMobile:n=!1,children:e}){const t=Y(),r=Z("breakpoint",()=>{const{width:i}=t.getViewportScreenBounds(),o=n?3:D1.length-1;for(let s=0;s<o;s++)if(i>D1[s]&&i<=D1[s+1])return s;return o},[t]);return y.jsx(Gj.Provider,{value:r,children:e})}function Lr(){return S.useContext(Gj)}function L1(){const n=Y();return Z("hasLinkShapeSelected",()=>{const e=n.getSelectedShapes();return e.length===1&&"url"in e[0].props&&e[0].type!=="embed"},[n])}const Yj=oe.createContext({}),dQ=({overrides:n,children:e})=>{const t=Y(),r=Sn(),i=Z("selected count",()=>t.getSelectedShapeIds().length,[t]),o=i>0,s=i>1,a=i>2,l=Wj(),c=R1(),u=O1(),d=L1(),h=Lr(),p=Z("zoom is 1",()=>t.getZoomLevel()===1,[t]),g=S.useMemo(()=>{const f=[H(r["align-left"],{disabled:!s}),H(r["align-center-horizontal"],{disabled:!s}),H(r["align-right"],{disabled:!s}),H(r["stretch-horizontal"],{disabled:!s}),H(r["align-top"],{disabled:!s}),H(r["align-center-vertical"],{disabled:!s}),H(r["align-bottom"],{disabled:!s}),H(r["stretch-vertical"],{disabled:!s}),H(r["distribute-horizontal"],{disabled:!a}),H(r["distribute-vertical"],{disabled:!a}),H(r["stack-horizontal"],{disabled:!l}),H(r["stack-vertical"],{disabled:!l}),H(r["send-to-back"],{disabled:!o}),H(r["send-backward"],{disabled:!o}),H(r["bring-forward"],{disabled:!o}),H(r["bring-to-front"],{disabled:!o}),h<5?H(r["zoom-to-100"],{disabled:!!p}):H(r["rotate-ccw"],{disabled:!o}),H(r["rotate-cw"],{disabled:!o}),H(r["edit-link"],{disabled:!d}),c?H(r.group,{disabled:!s}):u?H(r.ungroup):H(r.group,{disabled:!s})];return n?n(t,f,{actions:r,oneSelected:o,twoSelected:s,threeSelected:a}):f},[t,p,c,n,r,o,s,a,l,u,d,h]);return y.jsx(Yj.Provider,{value:g,children:e})};function hQ(){const n=oe.useContext(Yj);if(!n)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return n}function pQ(){const n=Y();return Z("onlyFlippableShape",()=>{const e=n.getSelectedShapes();return e.length===1&&e.every(t=>n.isShapeOfType(t,"group")||n.isShapeOfType(t,"arrow")||n.isShapeOfType(t,"line")||n.isShapeOfType(t,"draw"))},[n])}function Xj(){const n=Y();return Z("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}const qj=oe.createContext({}),fQ=ze(function({overrides:n,children:e}){var E;const t=Y(),r=Sn(),i=Xj(),o=pQ(),s=t.getSelectedShapes(),a=s.length,l=a>0,c=a>1,u=a>2,d=Wj(),h=Z("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[]),p=Z("isTransparentBg",()=>t.getInstanceState().exportBackground,[]),g=R1(),f=O1(),m=!!((E=window.navigator.clipboard)!=null&&E.write),v=L1(),b=t.getOnlySelectedShape(),_=l&&s.every(I=>t.isShapeOfType(I,"frame")),x=b&&t.isShapeOfType(b,"frame")&&t.getSortedChildIdsForParent(b).length>0,C=b&&t.isShapeOrAncestorLocked(b),k=S.useMemo(()=>{let I=Qg([_e("selection",i&&H(r["toggle-auto-size"]),v&&!C&&H(r["edit-link"]),l&&!C&&H(r.duplicate),g&&!C&&H(r.group),f&&!C&&H(r.ungroup),_&&!C&&H(r["remove-frame"]),x&&!C&&H(r["fit-frame-to-content"]),l&&H(r["toggle-lock"])),_e("modify",(c||o)&&Li("arrange","context-menu.arrange",c&&_e("align",H(r["align-left"]),H(r["align-center-horizontal"]),H(r["align-right"]),H(r["align-top"]),H(r["align-center-vertical"]),H(r["align-bottom"])),u&&_e("distribute",H(r["distribute-horizontal"]),H(r["distribute-vertical"])),c&&_e("stretch",H(r["stretch-horizontal"]),H(r["stretch-vertical"])),o&&!C&&_e("flip",H(r["flip-horizontal"]),H(r["flip-vertical"])),c&&_e("order",H(r.pack,{disabled:!c}),d&&H(r["stack-vertical"]),d&&H(r["stack-horizontal"]))),l&&!C&&Li("reorder","context-menu.reorder",_e("reorder",H(r["bring-to-front"]),H(r["bring-forward"]),H(r["send-backward"]),H(r["send-to-back"]))),l&&!C&&j1("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),_e("clipboard-group",l&&!C&&H(r.cut),l&&H(r.copy),Kj&&H(r.paste)),h&&_e("conversions",Li("copy-as","context-menu.copy-as",_e("copy-as-group",H(r["copy-as-svg"]),m&&H(r["copy-as-png"]),H(r["copy-as-json"])),_e("export-bg",H(r["toggle-transparent"],{checked:!p}))),Li("export-as","context-menu.export-as",_e("export-as-group",H(r["export-as-svg"]),H(r["export-as-png"]),H(r["export-as-json"])),_e("export-bg,",H(r["toggle-transparent"],{checked:!p})))),h&&_e("set-selection-group",H(r["select-all"]),l&&H(r["select-none"])),l&&!C&&_e("delete-group",H(r.delete))]);return n&&(I=n(t,I,{actions:r,oneSelected:l,twoSelected:c,threeSelected:u,showAutoSizeToggle:i,showUngroup:f,onlyFlippableShapeSelected:o})),I},[t,n,r,l,c,u,i,o,h,d,g,f,_,x,m,v,p,C]);return y.jsx(qj.Provider,{value:k,children:e})});function Zj(){const n=oe.useContext(qj);if(!n)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return n}const Jj=S.createContext({});function gQ({overrides:n,children:e}){const t=Y(),r=Ql(),{addDialog:i}=fa(),o=Vj(),s=S.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){t.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){t.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(c){t.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(c){t.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...Pi.values].map(c=>({id:c,label:`tool.${c}`,readonlyOk:!1,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(u){t.batch(()=>{t.updateInstanceState({stylesForNextShape:{...t.getInstanceState().stylesForNextShape,[Pi.id]:c}},{ephemeral:!0}),t.setCurrentTool("geo"),r("select-tool",{source:u,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(c){t.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(c){t.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(c){t.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(c){t.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(c){o(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(c){t.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){t.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(c){i({component:Ij}),r("select-tool",{source:c,id:"embed"})}}];a.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(c){t.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}});const l=Object.fromEntries(a.map(c=>[c.id,c]));return n?n(t,l,{insertMedia:o}):l},[n,t,r,o,i]);return y.jsx(Jj.Provider,{value:s,children:e})}function z1(){const n=S.useContext(Jj);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const Qj=oe.createContext({}),mQ=ze(function({overrides:n,children:e}){const t=Y(),r=z1(),i=Sn(),o=S.useMemo(()=>{const s=ye([_e("shortcuts-dialog.tools",H(i["toggle-tool-lock"]),H(r.select),H(r.draw),H(r.eraser),H(r.hand),H(r.rectangle),H(r.ellipse),H(r.arrow),H(r.line),H(r.text),H(r.frame),H(r.note),H(r.laser)),_e("shortcuts-dialog.file",H(i["insert-media"]),H(i.print)),_e("shortcuts-dialog.preferences",H(i["toggle-dark-mode"]),H(i["toggle-focus-mode"]),H(i["toggle-grid"])),_e("shortcuts-dialog.edit",H(i.undo),H(i.redo),H(i.cut),H(i.copy),H(i.paste),H(i["select-all"]),H(i.delete),H(i.duplicate),H(i["export-as-svg"]),H(i["export-as-png"])),_e("shortcuts-dialog.view",H(i["zoom-in"]),H(i["zoom-out"]),H(i["zoom-to-100"]),H(i["zoom-to-fit"]),H(i["zoom-to-selection"])),_e("shortcuts-dialog.transform",H(i["bring-to-front"]),H(i["bring-forward"]),H(i["send-backward"]),H(i["send-to-back"]),H(i.group),H(i.ungroup),H(i["flip-horizontal"]),H(i["flip-vertical"]),H(i["align-top"]),H(i["align-center-vertical"]),H(i["align-bottom"]),H(i["align-left"]),H(i["align-center-horizontal"]),H(i["align-right"]))]);return n?n(t,s,{tools:r,actions:i}):s},[t,n,i,r]);return y.jsx(Qj.Provider,{value:o,children:e})});function yQ(){const n=oe.useContext(Qj);if(!n)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return n}const wQ=()=>{const n=Me(),e=Rr(),t=yQ();function r(i){if(!i||e&&!i.readonlyOk)return null;switch(i.type){case"group":return y.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[y.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:n(i.id)}),y.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:i.children.filter(o=>o&&o.type==="item"&&o.actionItem.kbd).map(r)})]},i.id);case"item":{const{id:o,label:s,shortcutsLabel:a,kbd:l}=i.actionItem;return y.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[y.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:n(a??s)}),y.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:y.jsx(Ng,{children:l})})]},o)}}}return y.jsxs(y.Fragment,{children:[y.jsxs(Kg,{className:"tlui-shortcuts-dialog__header",children:[y.jsx(Gg,{children:n("shortcuts-dialog.title")}),y.jsx(Yg,{})]}),y.jsx(dd,{className:"tlui-shortcuts-dialog__body",children:t.map(r)}),y.jsx("div",{className:"tlui-dialog__scrim"})]})};function e3(){const n=Y();return{languages:bu,currentLanguage:n.user.getLocale()}}const t3=oe.createContext({}),bQ=ze(function({overrides:n,children:e}){const t=Y(),r=Sn(),i=t.getSelectedShapeIds().length,o=i>0,s=i>1,a=i>2,{languages:l,currentLanguage:c}=e3(),{addDialog:u}=fa(),d=S.useMemo(()=>{const h=ye([_e("top",j1("LANGUAGE_MENU",{readonlyOk:!0}),H({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){u({component:wQ})}}))]);return n?n(t,h,{actions:r,currentLanguage:c,languages:l,oneSelected:o,twoSelected:s,threeSelected:a}):h},[t,n,l,r,o,s,a,c,u]);return y.jsx(t3.Provider,{value:d,children:e})});function vQ(){const n=oe.useContext(t3);if(!n)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return n}function n3(){const n=Y();return Z("useCanRedo",()=>n.getCanRedo(),[n])}function r3(){const n=Y();return Z("useCanUndo",()=>n.getCanUndo(),[n])}const i3=oe.createContext({});function SQ({overrides:n,children:e}){var B;const t=Y(),r=Sn(),i=Lr()<5,o=Z("isDarkMode",()=>t.user.getIsDarkMode(),[t]),s=Z("animationSpeed",()=>t.user.getAnimationSpeed(),[t]),a=Z("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]),l=Z("isGridMode",()=>t.getInstanceState().isGridMode,[t]),c=Z("isSnapMode",()=>t.user.getIsSnapMode(),[t]),u=Z("isToolLock",()=>t.getInstanceState().isToolLocked,[t]),d=Z("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]),h=Z("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]),p=Z("exportBackground",()=>t.getInstanceState().exportBackground,[t]),g=Z("emptyPage",()=>t.getCurrentPageShapeIds().size===0,[t]),f=Z("selectedCount",()=>t.getSelectedShapeIds().length,[t]),m=f===0,v=f>0,b=f>1,_=f>2,x=!!((B=window.navigator.clipboard)!=null&&B.write),C=L1(),k=Xj(),E=R1(),I=O1(),T=r3(),A=n3(),D=Z("isZoomedTo100",()=>t.getZoomLevel()===1,[t]),N=Z("oneEmbedSelected",()=>{const $=t.getOnlySelectedShape();return $?!!(t.isShapeOfType($,"embed")&&$.props.url&&!t.isShapeOrAncestorLocked($)):!1},[]),U=Z("oneEmbeddableBookmarkSelected",()=>{const $=t.getOnlySelectedShape();return $?!!(t.isShapeOfType($,"bookmark")&&$.props.url&&wo($.props.url)&&!t.isShapeOrAncestorLocked($)):!1},[]),R=S.useMemo(()=>{const $=Qg([_e("menu",Li("file","menu.file",_e("print",H(r.print,{disabled:g}))),Li("edit","menu.edit",_e("undo-actions",H(r.undo,{disabled:!T}),H(r.redo,{disabled:!A})),_e("clipboard-actions",H(r.cut,{disabled:m}),H(r.copy,{disabled:m}),H(r.paste,{disabled:!Kj})),_e("conversions",Li("copy-as","menu.copy-as",_e("copy-as-group",H(r["copy-as-svg"],{disabled:g}),H(r["copy-as-png"],{disabled:g||!x}),H(r["copy-as-json"],{disabled:g})),_e("export-bg",H(r["toggle-transparent"],{checked:!p}))),Li("export-as","menu.export-as",_e("export-as-group",H(r["export-as-svg"],{disabled:g}),H(r["export-as-png"],{disabled:g}),H(r["export-as-json"],{disabled:g})),_e("export-bg",H(r["toggle-transparent"],{checked:!p})))),_e("set-selection-group",H(r["select-all"],{disabled:g}),H(r["select-none"],{disabled:!v})),_e("selection",k&&H(r["toggle-auto-size"]),C&&H(r["edit-link"]),H(r.duplicate,{disabled:!v}),E&&H(r.group),I&&H(r.ungroup),H(r["unlock-all"],{disabled:g})),_e("delete-group",H(r.delete,{disabled:!v})),_e("embeds",N&&H(r["open-embed-link"]),N&&H(r["convert-to-bookmark"]),U&&H(r["convert-to-embed"]))),Li("view","menu.view",_e("view-actions",H(r["zoom-in"]),H(r["zoom-out"]),H(r["zoom-to-100"],{disabled:D}),H(r["zoom-to-fit"],{disabled:g}),H(r["zoom-to-selection"],{disabled:g||!v})))),_e("extras",H(r["insert-embed"]),H(r["insert-media"])),_e("preferences",Li("preferences","menu.preferences",_e("preferences-actions",H(r["toggle-snap-mode"],{checked:c}),H(r["toggle-tool-lock"],{checked:u}),H(r["toggle-grid"],{checked:l}),H(r["toggle-dark-mode"],{checked:o}),H(r["toggle-focus-mode"],{checked:d}),H(r["toggle-edge-scrolling"],{checked:a===1}),H(r["toggle-reduce-motion"],{checked:s===0}),H(r["toggle-debug-mode"],{checked:h}))),i&&j1("LANGUAGE_MENU",{readonlyOk:!0}))]);return n?n(t,$,{actions:r,noneSelected:m,oneSelected:v,twoSelected:b,threeSelected:_}):$},[t,n,r,v,b,_,g,i,E,I,C,x,k,m,T,A,s,o,l,c,u,d,p,h,a,D,U,N]);return y.jsx(i3.Provider,{value:R,children:e})}function xQ(){const n=oe.useContext(i3);if(!n)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return n}function Ze(n){return{id:n.id,type:"item",readonlyOk:n.readonlyOk,toolItem:n}}const o3=oe.createContext([]);function _Q({overrides:n,children:e}){const t=Y(),r=z1(),i=oe.useMemo(()=>{const o=ye([Ze(r.select),Ze(r.hand),Ze(r.draw),Ze(r.eraser),Ze(r.arrow),Ze(r.text),Ze(r.note),Ze(r.asset),Ze(r.rectangle),Ze(r.ellipse),Ze(r.diamond),Ze(r.triangle),Ze(r.trapezoid),Ze(r.rhombus),Ze(r.hexagon),Ze(r.cloud),Ze(r.star),Ze(r.oval),Ze(r["x-box"]),Ze(r["check-box"]),Ze(r["arrow-left"]),Ze(r["arrow-up"]),Ze(r["arrow-down"]),Ze(r["arrow-right"]),Ze(r.line),Ze(r.highlight),Ze(r.frame),Ze(r.laser)]);return n?n(t,o,{tools:r}):o},[t,n,r]);return y.jsx(o3.Provider,{value:i,children:e})}function kQ(){const n=oe.useContext(o3);if(!n)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return n}function CQ(){const{addToast:n,removeToast:e,clearToasts:t}=Di(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=fa(),a=Lr()<5,l=Me();return S.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,n,i,t,l,o,e,s,a])}function PQ(n,e){const t={};for(const r of n)if(r.translations)for(const[i,o]of ro(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return{actionsMenu:(r,i,o)=>{for(const s of n)s.actionsMenu&&(i=s.actionsMenu(r,i,{...e,...o}));return i},actions:(r,i)=>{for(const o of n)o.actions&&(i=o.actions(r,i,e));return i},contextMenu:(r,i,o)=>{for(const s of n)s.contextMenu&&(i=s.contextMenu(r,i,{...e,...o}));return i},helpMenu:(r,i,o)=>{for(const s of n)s.helpMenu&&(i=s.helpMenu(r,i,{...e,...o}));return i},menu:(r,i,o)=>{for(const s of n)s.menu&&(i=s.menu(r,i,{...e,...o}));return i},toolbar:(r,i,o)=>{for(const s of n)s.toolbar&&(i=s.toolbar(r,i,{...e,...o}));return i},keyboardShortcutsMenu:(r,i,o)=>{for(const s of n)s.keyboardShortcutsMenu&&(i=s.keyboardShortcutsMenu(r,i,{...e,...o}));return i},tools:(r,i,o)=>{for(const s of n)s.tools&&(i=s.tools(r,i,{...e,...o}));return i},translations:t}}function s3(n){return S.useMemo(()=>n,n)}function EQ(n){const e=s3(n==null?[]:Array.isArray(n)?n:[n]);return S.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,o]of ro(r.translations)){let s=t[i];s||(s=t[i]={}),Object.assign(s,o)}return t},[e])}function IQ(n){const e=CQ(),t=s3(n==null?[]:Array.isArray(n)?n:[n]);return S.useMemo(()=>PQ(t,e),[t,e])}function MQ({overrides:n,assetUrls:e,onUiEvent:t,forceMobile:r,children:i}){return y.jsx(dZ,{assetUrls:aZ(e),children:y.jsx(fZ,{overrides:EQ(n),children:y.jsx(NJ,{onEvent:t,children:y.jsx(QJ,{children:y.jsx(tQ,{children:y.jsx(uQ,{forceMobile:r,children:y.jsx(TQ,{overrides:n,children:i})})})})})})})}function TQ({overrides:n,children:e}){const t=IQ(n);return y.jsx(aQ,{overrides:t.actions,children:y.jsx(gQ,{overrides:t.tools,children:y.jsx(_Q,{overrides:t.toolbar,children:y.jsx(dQ,{overrides:t.actionsMenu,children:y.jsx(mQ,{overrides:t.keyboardShortcutsMenu,children:y.jsx(fQ,{overrides:t.contextMenu,children:y.jsx(bQ,{overrides:t.helpMenu,children:y.jsx(SQ,{overrides:t.menu,children:e})})})})})})})})}function AQ(){const n=Y(),e=Sn()["back-to-content"],[t,r]=S.useState(!1);return S.useEffect(()=>{let i=!1;const o=setInterval(()=>{const s=n.getRenderingShapes(),a=n.getRenderingBounds(),l=s.filter(c=>c.maskedPageBounds&&a.includes(c.maskedPageBounds)).length===0&&n.getCurrentPageShapes().length>0;i!==l&&(r(l),i=l)},1e3);return()=>{clearInterval(o)}},[n]),t?y.jsx(ce,{iconLeft:e.icon,label:e.label,type:"low",onClick:()=>{e.onSelect("helper-buttons"),r(!1)}}):null}const jQ=S.createContext(void 0);function N1(n){const e=S.useContext(jQ);return n||e||"ltr"}const RQ=["top","right","bottom","left"],bs=Math.min,gr=Math.max,em=Math.round,tm=Math.floor,vs=n=>({x:n,y:n}),OQ={left:"right",right:"left",bottom:"top",top:"bottom"},DQ={start:"end",end:"start"};function F1(n,e,t){return gr(n,bs(e,t))}function xo(n,e){return typeof n=="function"?n(e):n}function _o(n){return n.split("-")[0]}function ec(n){return n.split("-")[1]}function $1(n){return n==="x"?"y":"x"}function B1(n){return n==="y"?"height":"width"}function tc(n){return["top","bottom"].includes(_o(n))?"y":"x"}function U1(n){return $1(tc(n))}function LQ(n,e,t){t===void 0&&(t=!1);const r=ec(n),i=U1(n),o=B1(i);let s=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=nm(s)),[s,nm(s)]}function zQ(n){const e=nm(n);return[V1(n),e,V1(e)]}function V1(n){return n.replace(/start|end/g,e=>DQ[e])}function NQ(n,e,t){const r=["left","right"],i=["right","left"],o=["top","bottom"],s=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?o:s;default:return[]}}function FQ(n,e,t,r){const i=ec(n);let o=NQ(_o(n),t==="start",r);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(V1)))),o}function nm(n){return n.replace(/left|right|bottom|top/g,e=>OQ[e])}function $Q(n){return{top:0,right:0,bottom:0,left:0,...n}}function a3(n){return typeof n!="number"?$Q(n):{top:n,right:n,bottom:n,left:n}}function rm(n){return{...n,top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}function l3(n,e,t){let{reference:r,floating:i}=n;const o=tc(e),s=U1(e),a=B1(s),l=_o(e),c=o==="y",u=r.x+r.width/2-i.width/2,d=r.y+r.height/2-i.height/2,h=r[a]/2-i[a]/2;let p;switch(l){case"top":p={x:u,y:r.y-i.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-i.width,y:d};break;default:p={x:r.x,y:r.y}}switch(ec(e)){case"start":p[s]-=h*(t&&c?-1:1);break;case"end":p[s]+=h*(t&&c?-1:1);break}return p}const BQ=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=t,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:n,floating:e,strategy:i}),{x:u,y:d}=l3(c,r,l),h=r,p={},g=0;for(let f=0;f<a.length;f++){const{name:m,fn:v}=a[f],{x:b,y:_,data:x,reset:C}=await v({x:u,y:d,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:s,elements:{reference:n,floating:e}});u=b??u,d=_??d,p={...p,[m]:{...p[m],...x}},C&&g<=50&&(g++,typeof C=="object"&&(C.placement&&(h=C.placement),C.rects&&(c=C.rects===!0?await s.getElementRects({reference:n,floating:e,strategy:i}):C.rects),{x:u,y:d}=l3(c,h,l)),f=-1)}return{x:u,y:d,placement:h,strategy:i,middlewareData:p}};async function pd(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=n,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:p=0}=xo(e,n),g=a3(p),f=a[h?d==="floating"?"reference":"floating":d],m=rm(await o.getClippingRect({element:(t=await(o.isElement==null?void 0:o.isElement(f)))==null||t?f:f.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:u,strategy:l})),v=d==="floating"?{...s.floating,x:r,y:i}:s.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),_=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},x=rm(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:v,offsetParent:b,strategy:l}):v);return{top:(m.top-x.top+g.top)/_.y,bottom:(x.bottom-m.bottom+g.bottom)/_.y,left:(m.left-x.left+g.left)/_.x,right:(x.right-m.right+g.right)/_.x}}const UQ=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=e,{element:c,padding:u=0}=xo(n,e)||{};if(c==null)return{};const d=a3(u),h={x:t,y:r},p=U1(i),g=B1(p),f=await s.getDimensions(c),m=p==="y",v=m?"top":"left",b=m?"bottom":"right",_=m?"clientHeight":"clientWidth",x=o.reference[g]+o.reference[p]-h[p]-o.floating[g],C=h[p]-o.reference[p],k=await(s.getOffsetParent==null?void 0:s.getOffsetParent(c));let E=k?k[_]:0;(!E||!await(s.isElement==null?void 0:s.isElement(k)))&&(E=a.floating[_]||o.floating[g]);const I=x/2-C/2,T=E/2-f[g]/2-1,A=bs(d[v],T),D=bs(d[b],T),N=A,U=E-f[g]-D,R=E/2-f[g]/2+I,B=F1(N,R,U),$=!l.arrow&&ec(i)!=null&&R!==B&&o.reference[g]/2-(R<N?A:D)-f[g]/2<0,q=$?R<N?R-N:R-U:0;return{[p]:h[p]+q,data:{[p]:B,centerOffset:R-B-q,...$&&{alignmentOffset:q}},reset:$}}}),VQ=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:d=!0,fallbackPlacements:h,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:f=!0,...m}=xo(n,e);if((t=o.arrow)!=null&&t.alignmentOffset)return{};const v=_o(i),b=_o(a)===a,_=await(l.isRTL==null?void 0:l.isRTL(c.floating)),x=h||(b||!f?[nm(a)]:zQ(a));!h&&g!=="none"&&x.push(...FQ(a,f,g,_));const C=[a,...x],k=await pd(e,m),E=[];let I=((r=o.flip)==null?void 0:r.overflows)||[];if(u&&E.push(k[v]),d){const N=LQ(i,s,_);E.push(k[N[0]],k[N[1]])}if(I=[...I,{placement:i,overflows:E}],!E.every(N=>N<=0)){var T,A;const N=(((T=o.flip)==null?void 0:T.index)||0)+1,U=C[N];if(U)return{data:{index:N,overflows:I},reset:{placement:U}};let R=(A=I.filter(B=>B.overflows[0]<=0).sort((B,$)=>B.overflows[1]-$.overflows[1])[0])==null?void 0:A.placement;if(!R)switch(p){case"bestFit":{var D;const B=(D=I.map($=>[$.placement,$.overflows.filter(q=>q>0).reduce((q,G)=>q+G,0)]).sort(($,q)=>$[1]-q[1])[0])==null?void 0:D[0];B&&(R=B);break}case"initialPlacement":R=a;break}if(i!==R)return{reset:{placement:R}}}return{}}}};function c3(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function u3(n){return RQ.some(e=>n[e]>=0)}const HQ=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=xo(n,e);switch(r){case"referenceHidden":{const o=await pd(e,{...i,elementContext:"reference"}),s=c3(o,t.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:u3(s)}}}case"escaped":{const o=await pd(e,{...i,altBoundary:!0}),s=c3(o,t.floating);return{data:{escapedOffsets:s,escaped:u3(s)}}}default:return{}}}}};async function WQ(n,e){const{placement:t,platform:r,elements:i}=n,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=_o(t),a=ec(t),l=tc(t)==="y",c=["left","top"].includes(s)?-1:1,u=o&&l?-1:1,d=xo(e,n);let{mainAxis:h,crossAxis:p,alignmentAxis:g}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof g=="number"&&(p=a==="end"?g*-1:g),l?{x:p*u,y:h*c}:{x:h*c,y:p*u}}const KQ=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:o,placement:s,middlewareData:a}=e,l=await WQ(e,n);return s===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},GQ=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:m=>{let{x:v,y:b}=m;return{x:v,y:b}}},...l}=xo(n,e),c={x:t,y:r},u=await pd(e,l),d=tc(_o(i)),h=$1(d);let p=c[h],g=c[d];if(o){const m=h==="y"?"top":"left",v=h==="y"?"bottom":"right",b=p+u[m],_=p-u[v];p=F1(b,p,_)}if(s){const m=d==="y"?"top":"left",v=d==="y"?"bottom":"right",b=g+u[m],_=g-u[v];g=F1(b,g,_)}const f=a.fn({...e,[h]:p,[d]:g});return{...f,data:{x:f.x-t,y:f.y-r}}}}},YQ=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=xo(n,e),u={x:t,y:r},d=tc(i),h=$1(d);let p=u[h],g=u[d];const f=xo(a,e),m=typeof f=="number"?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){const _=h==="y"?"height":"width",x=o.reference[h]-o.floating[_]+m.mainAxis,C=o.reference[h]+o.reference[_]-m.mainAxis;p<x?p=x:p>C&&(p=C)}if(c){var v,b;const _=h==="y"?"width":"height",x=["top","left"].includes(_o(i)),C=o.reference[d]-o.floating[_]+(x&&((v=s.offset)==null?void 0:v[d])||0)+(x?0:m.crossAxis),k=o.reference[d]+o.reference[_]+(x?0:((b=s.offset)==null?void 0:b[d])||0)-(x?m.crossAxis:0);g<C?g=C:g>k&&(g=k)}return{[h]:p,[d]:g}}}},XQ=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:r,platform:i,elements:o}=e,{apply:s=()=>{},...a}=xo(n,e),l=await pd(e,a),c=_o(t),u=ec(t),d=tc(t)==="y",{width:h,height:p}=r.floating;let g,f;c==="top"||c==="bottom"?(g=c,f=u===(await(i.isRTL==null?void 0:i.isRTL(o.floating))?"start":"end")?"left":"right"):(f=c,g=u==="end"?"top":"bottom");const m=p-l[g],v=h-l[f],b=!e.middlewareData.shift;let _=m,x=v;if(d){const k=h-l.left-l.right;x=u||b?bs(v,k):k}else{const k=p-l.top-l.bottom;_=u||b?bs(m,k):k}if(b&&!u){const k=gr(l.left,0),E=gr(l.right,0),I=gr(l.top,0),T=gr(l.bottom,0);d?x=h-2*(k!==0||E!==0?k+E:gr(l.left,l.right)):_=p-2*(I!==0||T!==0?I+T:gr(l.top,l.bottom))}await s({...e,availableWidth:x,availableHeight:_});const C=await i.getDimensions(o.floating);return h!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}};function Ss(n){return h3(n)?(n.nodeName||"").toLowerCase():"#document"}function mr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function ko(n){var e;return(e=(h3(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function h3(n){return n instanceof Node||n instanceof mr(n).Node}function Co(n){return n instanceof Element||n instanceof mr(n).Element}function zi(n){return n instanceof HTMLElement||n instanceof mr(n).HTMLElement}function p3(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof mr(n).ShadowRoot}function fd(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=zr(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function qQ(n){return["table","td","th"].includes(Ss(n))}function H1(n){const e=W1(),t=zr(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function ZQ(n){let e=nc(n);for(;zi(e)&&!im(e);){if(H1(e))return e;e=nc(e)}return null}function W1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function im(n){return["html","body","#document"].includes(Ss(n))}function zr(n){return mr(n).getComputedStyle(n)}function om(n){return Co(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.pageXOffset,scrollTop:n.pageYOffset}}function nc(n){if(Ss(n)==="html")return n;const e=n.assignedSlot||n.parentNode||p3(n)&&n.host||ko(n);return p3(e)?e.host:e}function f3(n){const e=nc(n);return im(e)?n.ownerDocument?n.ownerDocument.body:n.body:zi(e)&&fd(e)?e:f3(e)}function gd(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=f3(n),o=i===((r=n.ownerDocument)==null?void 0:r.body),s=mr(i);return o?e.concat(s,s.visualViewport||[],fd(i)?i:[],s.frameElement&&t?gd(s.frameElement):[]):e.concat(i,gd(i,[],t))}function g3(n){const e=zr(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=zi(n),o=i?n.offsetWidth:t,s=i?n.offsetHeight:r,a=em(t)!==o||em(r)!==s;return a&&(t=o,r=s),{width:t,height:r,$:a}}function K1(n){return Co(n)?n:n.contextElement}function rc(n){const e=K1(n);if(!zi(e))return vs(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:o}=g3(e);let s=(o?em(t.width):t.width)/r,a=(o?em(t.height):t.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const JQ=vs(0);function m3(n){const e=mr(n);return!W1()||!e.visualViewport?JQ:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function QQ(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==mr(n)?!1:e}function ga(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),o=K1(n);let s=vs(1);e&&(r?Co(r)&&(s=rc(r)):s=rc(n));const a=QQ(o,t,r)?m3(o):vs(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,u=i.width/s.x,d=i.height/s.y;if(o){const h=mr(o),p=r&&Co(r)?mr(r):r;let g=h,f=g.frameElement;for(;f&&r&&p!==g;){const m=rc(f),v=f.getBoundingClientRect(),b=zr(f),_=v.left+(f.clientLeft+parseFloat(b.paddingLeft))*m.x,x=v.top+(f.clientTop+parseFloat(b.paddingTop))*m.y;l*=m.x,c*=m.y,u*=m.x,d*=m.y,l+=_,c+=x,g=mr(f),f=g.frameElement}}return rm({width:u,height:d,x:l,y:c})}const eee=[":popover-open",":modal"];function y3(n){return eee.some(e=>{try{return n.matches(e)}catch{return!1}})}function tee(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const o=i==="fixed",s=ko(r),a=e?y3(e.floating):!1;if(r===s||a&&o)return t;let l={scrollLeft:0,scrollTop:0},c=vs(1);const u=vs(0),d=zi(r);if((d||!d&&!o)&&((Ss(r)!=="body"||fd(s))&&(l=om(r)),zi(r))){const h=ga(r);c=rc(r),u.x=h.x+r.clientLeft,u.y=h.y+r.clientTop}return{width:t.width*c.x,height:t.height*c.y,x:t.x*c.x-l.scrollLeft*c.x+u.x,y:t.y*c.y-l.scrollTop*c.y+u.y}}function nee(n){return Array.from(n.getClientRects())}function w3(n){return ga(ko(n)).left+om(n).scrollLeft}function ree(n){const e=ko(n),t=om(n),r=n.ownerDocument.body,i=gr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=gr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-t.scrollLeft+w3(n);const a=-t.scrollTop;return zr(r).direction==="rtl"&&(s+=gr(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}function iee(n,e){const t=mr(n),r=ko(n),i=t.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const c=W1();(!c||c&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}return{width:o,height:s,x:a,y:l}}function oee(n,e){const t=ga(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,o=zi(n)?rc(n):vs(1),s=n.clientWidth*o.x,a=n.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function b3(n,e,t){let r;if(e==="viewport")r=iee(n,t);else if(e==="document")r=ree(ko(n));else if(Co(e))r=oee(e,t);else{const i=m3(n);r={...e,x:e.x-i.x,y:e.y-i.y}}return rm(r)}function v3(n,e){const t=nc(n);return t===e||!Co(t)||im(t)?!1:zr(t).position==="fixed"||v3(t,e)}function see(n,e){const t=e.get(n);if(t)return t;let r=gd(n,[],!1).filter(a=>Co(a)&&Ss(a)!=="body"),i=null;const o=zr(n).position==="fixed";let s=o?nc(n):n;for(;Co(s)&&!im(s);){const a=zr(s),l=H1(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&i&&["absolute","fixed"].includes(i.position)||fd(s)&&!l&&v3(n,s))?r=r.filter(c=>c!==s):i=a,s=nc(s)}return e.set(n,r),r}function aee(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?see(e,this._c):[].concat(t),r],s=o[0],a=o.reduce((l,c)=>{const u=b3(e,c,i);return l.top=gr(u.top,l.top),l.right=bs(u.right,l.right),l.bottom=bs(u.bottom,l.bottom),l.left=gr(u.left,l.left),l},b3(e,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}}function lee(n){const{width:e,height:t}=g3(n);return{width:e,height:t}}function cee(n,e,t){const r=zi(e),i=ko(e),o=t==="fixed",s=ga(n,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=vs(0);if(r||!r&&!o)if((Ss(e)!=="body"||fd(i))&&(a=om(e)),r){const d=ga(e,!0,o,e);l.x=d.x+e.clientLeft,l.y=d.y+e.clientTop}else i&&(l.x=w3(i));const c=s.left+a.scrollLeft-l.x,u=s.top+a.scrollTop-l.y;return{x:c,y:u,width:s.width,height:s.height}}function S3(n,e){return!zi(n)||zr(n).position==="fixed"?null:e?e(n):n.offsetParent}function x3(n,e){const t=mr(n);if(!zi(n)||y3(n))return t;let r=S3(n,e);for(;r&&qQ(r)&&zr(r).position==="static";)r=S3(r,e);return r&&(Ss(r)==="html"||Ss(r)==="body"&&zr(r).position==="static"&&!H1(r))?t:r||ZQ(n)||t}const uee=async function(n){const e=this.getOffsetParent||x3,t=this.getDimensions;return{reference:cee(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,...await t(n.floating)}}};function dee(n){return zr(n).direction==="rtl"}const hee={convertOffsetParentRelativeRectToViewportRelativeRect:tee,getDocumentElement:ko,getClippingRect:aee,getOffsetParent:x3,getElementRects:uee,getClientRects:nee,getDimensions:lee,getScale:rc,isElement:Co,isRTL:dee};function pee(n,e){let t=null,r;const i=ko(n);function o(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const{left:c,top:u,width:d,height:h}=n.getBoundingClientRect();if(a||e(),!d||!h)return;const p=tm(u),g=tm(i.clientWidth-(c+d)),f=tm(i.clientHeight-(u+h)),m=tm(c),v={rootMargin:-p+"px "+-g+"px "+-f+"px "+-m+"px",threshold:gr(0,bs(1,l))||1};let b=!0;function _(x){const C=x[0].intersectionRatio;if(C!==l){if(!b)return s();C?s(!1,C):r=setTimeout(()=>{s(!1,1e-7)},100)}b=!1}try{t=new IntersectionObserver(_,{...v,root:i.ownerDocument})}catch{t=new IntersectionObserver(_,v)}t.observe(n)}return s(!0),o}function fee(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=K1(n),u=i||o?[...c?gd(c):[],...gd(e)]:[];u.forEach(v=>{i&&v.addEventListener("scroll",t,{passive:!0}),o&&v.addEventListener("resize",t)});const d=c&&a?pee(c,t):null;let h=-1,p=null;s&&(p=new ResizeObserver(v=>{let[b]=v;b&&b.target===c&&p&&(p.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{var _;(_=p)==null||_.observe(e)})),t()}),c&&!l&&p.observe(c),p.observe(e));let g,f=l?ga(n):null;l&&m();function m(){const v=ga(n);f&&(v.x!==f.x||v.y!==f.y||v.width!==f.width||v.height!==f.height)&&t(),f=v,g=requestAnimationFrame(m)}return t(),()=>{var v;u.forEach(b=>{i&&b.removeEventListener("scroll",t),o&&b.removeEventListener("resize",t)}),d==null||d(),(v=p)==null||v.disconnect(),p=null,l&&cancelAnimationFrame(g)}}const gee=GQ,mee=VQ,yee=XQ,wee=HQ,_3=UQ,bee=YQ,vee=(n,e,t)=>{const r=new Map,i={platform:hee,...t},o={...i.platform,_c:r};return BQ(n,e,{...i,platform:o})},See=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?_3({element:r.current,padding:i}).fn(t):{}:r?_3({element:r,padding:i}).fn(t):{}}}};var sm=typeof document<"u"?S.useLayoutEffect:S.useEffect;function am(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!am(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const o=i[r];if(!(o==="_owner"&&n.$$typeof)&&!am(n[o],e[o]))return!1}return!0}return n!==n&&e!==e}function k3(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function C3(n,e){const t=k3(n);return Math.round(e*t)/t}function P3(n){const e=S.useRef(n);return sm(()=>{e.current=n}),e}function xee(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=n,[u,d]=S.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[h,p]=S.useState(r);am(h,r)||p(r);const[g,f]=S.useState(null),[m,v]=S.useState(null),b=S.useCallback(q=>{q!==k.current&&(k.current=q,f(q))},[]),_=S.useCallback(q=>{q!==E.current&&(E.current=q,v(q))},[]),x=o||g,C=s||m,k=S.useRef(null),E=S.useRef(null),I=S.useRef(u),T=l!=null,A=P3(l),D=P3(i),N=S.useCallback(()=>{if(!k.current||!E.current)return;const q={placement:e,strategy:t,middleware:h};D.current&&(q.platform=D.current),vee(k.current,E.current,q).then(G=>{const L={...G,isPositioned:!0};U.current&&!am(I.current,L)&&(I.current=L,il.flushSync(()=>{d(L)}))})},[h,e,t,D]);sm(()=>{c===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(q=>({...q,isPositioned:!1})))},[c]);const U=S.useRef(!1);sm(()=>(U.current=!0,()=>{U.current=!1}),[]),sm(()=>{if(x&&(k.current=x),C&&(E.current=C),x&&C){if(A.current)return A.current(x,C,N);N()}},[x,C,N,A,T]);const R=S.useMemo(()=>({reference:k,floating:E,setReference:b,setFloating:_}),[b,_]),B=S.useMemo(()=>({reference:x,floating:C}),[x,C]),$=S.useMemo(()=>{const q={position:t,left:0,top:0};if(!B.floating)return q;const G=C3(B.floating,u.x),L=C3(B.floating,u.y);return a?{...q,transform:"translate("+G+"px, "+L+"px)",...k3(B.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:G,top:L}},[t,a,B.floating,u.x,u.y]);return S.useMemo(()=>({...u,update:N,refs:R,elements:B,floatingStyles:$}),[u,N,R,B,$])}function E3(n){const[e,t]=S.useState(void 0);return ha(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const o=i[0];let s,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;s=c.inlineSize,a=c.blockSize}else s=n.offsetWidth,a=n.offsetHeight;t({width:s,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}const I3="Popper",[M3,lm]=ji(I3),[_ee,T3]=M3(I3),kee=n=>{const{__scopePopper:e,children:t}=n,[r,i]=S.useState(null);return S.createElement(_ee,{scope:e,anchor:r,onAnchorChange:i},t)},Cee="PopperAnchor",Pee=S.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,o=T3(Cee,t),s=S.useRef(null),a=it(e,s);return S.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||s.current)}),r?null:S.createElement(qe.div,te({},i,{ref:a}))}),A3="PopperContent",[Eee,Xpe]=M3(A3),Iee=S.forwardRef((n,e)=>{var t,r,i,o,s,a,l,c;const{__scopePopper:u,side:d="bottom",sideOffset:h=0,align:p="center",alignOffset:g=0,arrowPadding:f=0,avoidCollisions:m=!0,collisionBoundary:v=[],collisionPadding:b=0,sticky:_="partial",hideWhenDetached:x=!1,updatePositionStrategy:C="optimized",onPlaced:k,...E}=n,I=T3(A3,u),[T,A]=S.useState(null),D=it(e,Et=>A(Et)),[N,U]=S.useState(null),R=E3(N),B=(t=R==null?void 0:R.width)!==null&&t!==void 0?t:0,$=(r=R==null?void 0:R.height)!==null&&r!==void 0?r:0,q=d+(p!=="center"?"-"+p:""),G=typeof b=="number"?b:{top:0,right:0,bottom:0,left:0,...b},L=Array.isArray(v)?v:[v],V=L.length>0,J={padding:G,boundary:L.filter(Mee),altBoundary:V},{refs:le,floatingStyles:me,placement:ve,isPositioned:fe,middlewareData:Pe}=xee({strategy:"fixed",placement:q,whileElementsMounted:(...Et)=>fee(...Et,{animationFrame:C==="always"}),elements:{reference:I.anchor},middleware:[KQ({mainAxis:h+$,alignmentAxis:g}),m&&gee({mainAxis:!0,crossAxis:!1,limiter:_==="partial"?bee():void 0,...J}),m&&mee({...J}),yee({...J,apply:({elements:Et,rects:jo,availableWidth:ih,availableHeight:Bx})=>{const{width:Ux,height:Vx}=jo.reference,yc=Et.floating.style;yc.setProperty("--radix-popper-available-width",`${ih}px`),yc.setProperty("--radix-popper-available-height",`${Bx}px`),yc.setProperty("--radix-popper-anchor-width",`${Ux}px`),yc.setProperty("--radix-popper-anchor-height",`${Vx}px`)}}),N&&See({element:N,padding:f}),Tee({arrowWidth:B,arrowHeight:$}),x&&wee({strategy:"referenceHidden",...J})]}),[Rt,Ue]=j3(ve),Le=vn(k);ha(()=>{fe&&(Le==null||Le())},[fe,Le]);const Ve=(i=Pe.arrow)===null||i===void 0?void 0:i.x,gi=(o=Pe.arrow)===null||o===void 0?void 0:o.y,Zn=((s=Pe.arrow)===null||s===void 0?void 0:s.centerOffset)!==0,[Sr,Ot]=S.useState();return ha(()=>{T&&Ot(window.getComputedStyle(T).zIndex)},[T]),S.createElement("div",{ref:le.setFloating,"data-radix-popper-content-wrapper":"",style:{...me,transform:fe?me.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Sr,"--radix-popper-transform-origin":[(a=Pe.transformOrigin)===null||a===void 0?void 0:a.x,(l=Pe.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:n.dir},S.createElement(Eee,{scope:u,placedSide:Rt,onArrowChange:U,arrowX:Ve,arrowY:gi,shouldHideArrow:Zn},S.createElement(qe.div,te({"data-side":Rt,"data-align":Ue},E,{ref:D,style:{...E.style,animation:fe?void 0:"none",opacity:(c=Pe.hide)!==null&&c!==void 0&&c.referenceHidden?0:void 0}}))))});function Mee(n){return n!==null}const Tee=n=>({name:"transformOrigin",options:n,fn(e){var t,r,i,o,s;const{placement:a,rects:l,middlewareData:c}=e,u=((t=c.arrow)===null||t===void 0?void 0:t.centerOffset)!==0,d=u?0:n.arrowWidth,h=u?0:n.arrowHeight,[p,g]=j3(a),f={start:"0%",center:"50%",end:"100%"}[g],m=((r=(i=c.arrow)===null||i===void 0?void 0:i.x)!==null&&r!==void 0?r:0)+d/2,v=((o=(s=c.arrow)===null||s===void 0?void 0:s.y)!==null&&o!==void 0?o:0)+h/2;let b="",_="";return p==="bottom"?(b=u?f:`${m}px`,_=`${-h}px`):p==="top"?(b=u?f:`${m}px`,_=`${l.floating.height+h}px`):p==="right"?(b=`${-h}px`,_=u?f:`${v}px`):p==="left"&&(b=`${l.floating.width+h}px`,_=u?f:`${v}px`),{data:{x:b,y:_}}}});function j3(n){const[e,t="center"]=n.split("-");return[e,t]}const G1=kee,R3=Pee,O3=Iee,Y1="rovingFocusGroup.onEntryFocus",Aee={bubbles:!1,cancelable:!0},X1="RovingFocusGroup",[q1,D3,jee]=Ag(X1),[Ree,L3]=ji(X1,[jee]),[Oee,Dee]=Ree(X1),Lee=S.forwardRef((n,e)=>S.createElement(q1.Provider,{scope:n.__scopeRovingFocusGroup},S.createElement(q1.Slot,{scope:n.__scopeRovingFocusGroup},S.createElement(zee,te({},n,{ref:e}))))),zee=S.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,...u}=n,d=S.useRef(null),h=it(e,d),p=N1(o),[g=null,f]=ys({prop:s,defaultProp:a,onChange:l}),[m,v]=S.useState(!1),b=vn(c),_=D3(t),x=S.useRef(!1),[C,k]=S.useState(0);return S.useEffect(()=>{const E=d.current;if(E)return E.addEventListener(Y1,b),()=>E.removeEventListener(Y1,b)},[b]),S.createElement(Oee,{scope:t,orientation:r,dir:p,loop:i,currentTabStopId:g,onItemFocus:S.useCallback(E=>f(E),[f]),onItemShiftTab:S.useCallback(()=>v(!0),[]),onFocusableItemAdd:S.useCallback(()=>k(E=>E+1),[]),onFocusableItemRemove:S.useCallback(()=>k(E=>E-1),[])},S.createElement(qe.div,te({tabIndex:m||C===0?-1:0,"data-orientation":r},u,{ref:h,style:{outline:"none",...n.style},onMouseDown:ae(n.onMouseDown,()=>{x.current=!0}),onFocus:ae(n.onFocus,E=>{const I=!x.current;if(E.target===E.currentTarget&&I&&!m){const T=new CustomEvent(Y1,Aee);if(E.currentTarget.dispatchEvent(T),!T.defaultPrevented){const A=_().filter(R=>R.focusable),D=A.find(R=>R.active),N=A.find(R=>R.id===g),U=[D,N,...A].filter(Boolean).map(R=>R.ref.current);z3(U)}}x.current=!1}),onBlur:ae(n.onBlur,()=>v(!1))})))}),Nee="RovingFocusGroupItem",Fee=S.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:o,...s}=n,a=vo(),l=o||a,c=Dee(Nee,t),u=c.currentTabStopId===l,d=D3(t),{onFocusableItemAdd:h,onFocusableItemRemove:p}=c;return S.useEffect(()=>{if(r)return h(),()=>p()},[r,h,p]),S.createElement(q1.ItemSlot,{scope:t,id:l,focusable:r,active:i},S.createElement(qe.span,te({tabIndex:u?0:-1,"data-orientation":c.orientation},s,{ref:e,onMouseDown:ae(n.onMouseDown,g=>{r?c.onItemFocus(l):g.preventDefault()}),onFocus:ae(n.onFocus,()=>c.onItemFocus(l)),onKeyDown:ae(n.onKeyDown,g=>{if(g.key==="Tab"&&g.shiftKey){c.onItemShiftTab();return}if(g.target!==g.currentTarget)return;const f=Uee(g,c.orientation,c.dir);if(f!==void 0){g.preventDefault();let m=d().filter(v=>v.focusable).map(v=>v.ref.current);if(f==="last")m.reverse();else if(f==="prev"||f==="next"){f==="prev"&&m.reverse();const v=m.indexOf(g.currentTarget);m=c.loop?Vee(m,v+1):m.slice(v+1)}setTimeout(()=>z3(m))}})})))}),$ee={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Bee(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function Uee(n,e,t){const r=Bee(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return $ee[r]}function z3(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function Vee(n,e){return n.map((t,r)=>n[(e+r)%n.length])}const Hee=Lee,Wee=Fee,Z1=["Enter"," "],Kee=["ArrowDown","PageUp","Home"],N3=["ArrowUp","PageDown","End"],Gee=[...Kee,...N3],Yee={ltr:[...Z1,"ArrowRight"],rtl:[...Z1,"ArrowLeft"]},Xee={ltr:["ArrowLeft"],rtl:["ArrowRight"]},cm="Menu",[md,qee,Zee]=Ag(cm),[ma,um]=ji(cm,[Zee,lm,L3]),dm=lm(),F3=L3(),[$3,xs]=ma(cm),[Jee,yd]=ma(cm),Qee=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=n,a=dm(e),[l,c]=S.useState(null),u=S.useRef(!1),d=vn(o),h=N1(i);return S.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),S.createElement(G1,a,S.createElement($3,{scope:e,open:t,onOpenChange:d,content:l,onContentChange:c},S.createElement(Jee,{scope:e,onClose:S.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:s},r)))},B3=S.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=dm(t);return S.createElement(R3,te({},i,r,{ref:e}))}),U3="MenuPortal",[ete,V3]=ma(U3,{forceMount:void 0}),tte=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,o=xs(U3,e);return S.createElement(ete,{scope:e,forceMount:t},S.createElement(si,{present:t||o.open},S.createElement(Rg,{asChild:!0,container:i},r)))},ai="MenuContent",[nte,J1]=ma(ai),rte=S.forwardRef((n,e)=>{const t=V3(ai,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=xs(ai,n.__scopeMenu),s=yd(ai,n.__scopeMenu);return S.createElement(md.Provider,{scope:n.__scopeMenu},S.createElement(si,{present:r||o.open},S.createElement(md.Slot,{scope:n.__scopeMenu},s.modal?S.createElement(ite,te({},i,{ref:e})):S.createElement(ote,te({},i,{ref:e})))))}),ite=S.forwardRef((n,e)=>{const t=xs(ai,n.__scopeMenu),r=S.useRef(null),i=it(e,r);return S.useEffect(()=>{const o=r.current;if(o)return _1(o)},[]),S.createElement(Q1,te({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:ae(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)}))}),ote=S.forwardRef((n,e)=>{const t=xs(ai,n.__scopeMenu);return S.createElement(Q1,te({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)}))}),Q1=S.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p,disableOutsideScroll:g,...f}=n,m=xs(ai,t),v=yd(ai,t),b=dm(t),_=F3(t),x=qee(t),[C,k]=S.useState(null),E=S.useRef(null),I=it(e,E,m.onContentChange),T=S.useRef(0),A=S.useRef(""),D=S.useRef(0),N=S.useRef(null),U=S.useRef("right"),R=S.useRef(0),B=g?S1:S.Fragment,$=g?{as:da,allowPinchZoom:!0}:void 0,q=L=>{var V,J;const le=A.current+L,me=x().filter(Le=>!Le.disabled),ve=document.activeElement,fe=(V=me.find(Le=>Le.ref.current===ve))===null||V===void 0?void 0:V.textValue,Pe=me.map(Le=>Le.textValue),Rt=wte(Pe,le,fe),Ue=(J=me.find(Le=>Le.textValue===Rt))===null||J===void 0?void 0:J.ref.current;(function Le(Ve){A.current=Ve,window.clearTimeout(T.current),Ve!==""&&(T.current=window.setTimeout(()=>Le(""),1e3))})(le),Ue&&setTimeout(()=>Ue.focus())};S.useEffect(()=>()=>window.clearTimeout(T.current),[]),m1();const G=S.useCallback(L=>{var V,J;return U.current===((V=N.current)===null||V===void 0?void 0:V.side)&&vte(L,(J=N.current)===null||J===void 0?void 0:J.area)},[]);return S.createElement(nte,{scope:t,searchRef:A,onItemEnter:S.useCallback(L=>{G(L)&&L.preventDefault()},[G]),onItemLeave:S.useCallback(L=>{var V;G(L)||((V=E.current)===null||V===void 0||V.focus(),k(null))},[G]),onTriggerLeave:S.useCallback(L=>{G(L)&&L.preventDefault()},[G]),pointerGraceTimerRef:D,onPointerGraceIntentChange:S.useCallback(L=>{N.current=L},[])},S.createElement(B,$,S.createElement(f1,{asChild:!0,trapped:i,onMountAutoFocus:ae(o,L=>{var V;L.preventDefault(),(V=E.current)===null||V===void 0||V.focus()}),onUnmountAutoFocus:s},S.createElement(jg,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:p},S.createElement(Hee,te({asChild:!0},_,{dir:v.dir,orientation:"vertical",loop:r,currentTabStopId:C,onCurrentTabStopIdChange:k,onEntryFocus:ae(l,L=>{v.isUsingKeyboardRef.current||L.preventDefault()})}),S.createElement(O3,te({role:"menu","aria-orientation":"vertical","data-state":q3(m.open),"data-radix-menu-content":"",dir:v.dir},b,f,{ref:I,style:{outline:"none",...f.style},onKeyDown:ae(f.onKeyDown,L=>{const V=L.target.closest("[data-radix-menu-content]")===L.currentTarget,J=L.ctrlKey||L.altKey||L.metaKey,le=L.key.length===1;V&&(L.key==="Tab"&&L.preventDefault(),!J&&le&&q(L.key));const me=E.current;if(L.target!==me||!Gee.includes(L.key))return;L.preventDefault();const ve=x().filter(fe=>!fe.disabled).map(fe=>fe.ref.current);N3.includes(L.key)&&ve.reverse(),mte(ve)}),onBlur:ae(n.onBlur,L=>{L.currentTarget.contains(L.target)||(window.clearTimeout(T.current),A.current="")}),onPointerMove:ae(n.onPointerMove,wd(L=>{const V=L.target,J=R.current!==L.clientX;if(L.currentTarget.contains(V)&&J){const le=L.clientX>R.current?"right":"left";U.current=le,R.current=L.clientX}}))})))))))}),ste=S.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return S.createElement(qe.div,te({role:"group"},r,{ref:e}))}),eS="MenuItem",H3="menu.itemSelect",W3=S.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,o=S.useRef(null),s=yd(eS,n.__scopeMenu),a=J1(eS,n.__scopeMenu),l=it(e,o),c=S.useRef(!1),u=()=>{const d=o.current;if(!t&&d){const h=new CustomEvent(H3,{bubbles:!0,cancelable:!0});d.addEventListener(H3,p=>r==null?void 0:r(p),{once:!0}),r1(d,h),h.defaultPrevented?c.current=!1:s.onClose()}};return S.createElement(K3,te({},i,{ref:l,disabled:t,onClick:ae(n.onClick,u),onPointerDown:d=>{var h;(h=n.onPointerDown)===null||h===void 0||h.call(n,d),c.current=!0},onPointerUp:ae(n.onPointerUp,d=>{var h;c.current||(h=d.currentTarget)===null||h===void 0||h.click()}),onKeyDown:ae(n.onKeyDown,d=>{const h=a.searchRef.current!=="";t||h&&d.key===" "||Z1.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})}))}),K3=S.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...o}=n,s=J1(eS,t),a=F3(t),l=S.useRef(null),c=it(e,l),[u,d]=S.useState(!1),[h,p]=S.useState("");return S.useEffect(()=>{const g=l.current;if(g){var f;p(((f=g.textContent)!==null&&f!==void 0?f:"").trim())}},[o.children]),S.createElement(md.ItemSlot,{scope:t,disabled:r,textValue:i??h},S.createElement(Wee,te({asChild:!0},a,{focusable:!r}),S.createElement(qe.div,te({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:c,onPointerMove:ae(n.onPointerMove,wd(g=>{r?s.onItemLeave(g):(s.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus())})),onPointerLeave:ae(n.onPointerLeave,wd(g=>s.onItemLeave(g))),onFocus:ae(n.onFocus,()=>d(!0)),onBlur:ae(n.onBlur,()=>d(!1))}))))}),ate=S.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return S.createElement(lte,{scope:n.__scopeMenu,checked:t},S.createElement(W3,te({role:"menuitemcheckbox","aria-checked":pm(t)?"mixed":t},i,{ref:e,"data-state":Z3(t),onSelect:ae(i.onSelect,()=>r==null?void 0:r(pm(t)?!0:!t),{checkForDefaultPrevented:!1})})))});ma("MenuRadioGroup",{value:void 0,onValueChange:()=>{}});const G3="MenuItemIndicator",[lte,cte]=ma(G3,{checked:!1}),ute=S.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,o=cte(G3,t);return S.createElement(si,{present:r||pm(o.checked)||o.checked===!0},S.createElement(qe.span,te({},i,{ref:e,"data-state":Z3(o.checked)})))}),Y3="MenuSub",[dte,X3]=ma(Y3),hte=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,o=xs(Y3,e),s=dm(e),[a,l]=S.useState(null),[c,u]=S.useState(null),d=vn(i);return S.useEffect(()=>(o.open===!1&&d(!1),()=>d(!1)),[o.open,d]),S.createElement(G1,s,S.createElement($3,{scope:e,open:r,onOpenChange:d,content:c,onContentChange:u},S.createElement(dte,{scope:e,contentId:vo(),triggerId:vo(),trigger:a,onTriggerChange:l},t)))},hm="MenuSubTrigger",pte=S.forwardRef((n,e)=>{const t=xs(hm,n.__scopeMenu),r=yd(hm,n.__scopeMenu),i=X3(hm,n.__scopeMenu),o=J1(hm,n.__scopeMenu),s=S.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:n.__scopeMenu},u=S.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return S.useEffect(()=>u,[u]),S.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),l(null)}},[a,l]),S.createElement(B3,te({asChild:!0},c),S.createElement(K3,te({id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":q3(t.open)},n,{ref:Tg(e,i.onTriggerChange),onClick:d=>{var h;(h=n.onClick)===null||h===void 0||h.call(n,d),!(n.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:ae(n.onPointerMove,wd(d=>{o.onItemEnter(d),!d.defaultPrevented&&!n.disabled&&!t.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:ae(n.onPointerLeave,wd(d=>{var h;u();const p=(h=t.content)===null||h===void 0?void 0:h.getBoundingClientRect();if(p){var g;const f=(g=t.content)===null||g===void 0?void 0:g.dataset.side,m=f==="right",v=m?-5:5,b=p[m?"left":"right"],_=p[m?"right":"left"];o.onPointerGraceIntentChange({area:[{x:d.clientX+v,y:d.clientY},{x:b,y:p.top},{x:_,y:p.top},{x:_,y:p.bottom},{x:b,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(d),d.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:ae(n.onKeyDown,d=>{const h=o.searchRef.current!=="";if(!(n.disabled||h&&d.key===" ")&&Yee[r.dir].includes(d.key)){var p;t.onOpenChange(!0),(p=t.content)===null||p===void 0||p.focus(),d.preventDefault()}})})))}),fte="MenuSubContent",gte=S.forwardRef((n,e)=>{const t=V3(ai,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,o=xs(ai,n.__scopeMenu),s=yd(ai,n.__scopeMenu),a=X3(fte,n.__scopeMenu),l=S.useRef(null),c=it(e,l);return S.createElement(md.Provider,{scope:n.__scopeMenu},S.createElement(si,{present:r||o.open},S.createElement(md.Slot,{scope:n.__scopeMenu},S.createElement(Q1,te({id:a.contentId,"aria-labelledby":a.triggerId},i,{ref:c,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;s.isUsingKeyboardRef.current&&((d=l.current)===null||d===void 0||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:ae(n.onFocusOutside,u=>{u.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:ae(n.onEscapeKeyDown,u=>{s.onClose(),u.preventDefault()}),onKeyDown:ae(n.onKeyDown,u=>{const d=u.currentTarget.contains(u.target),h=Xee[s.dir].includes(u.key);if(d&&h){var p;o.onOpenChange(!1),(p=a.trigger)===null||p===void 0||p.focus(),u.preventDefault()}})})))))});function q3(n){return n?"open":"closed"}function pm(n){return n==="indeterminate"}function Z3(n){return pm(n)?"indeterminate":n?"checked":"unchecked"}function mte(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function yte(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function wte(n,e,t){const r=e.length>1&&Array.from(e).every(a=>a===e[0])?e[0]:e,i=t?n.indexOf(t):-1;let o=yte(n,Math.max(i,0));r.length===1&&(o=o.filter(a=>a!==t));const s=o.find(a=>a.toLowerCase().startsWith(r.toLowerCase()));return s!==t?s:void 0}function bte(n,e){const{x:t,y:r}=n;let i=!1;for(let o=0,s=e.length-1;o<e.length;s=o++){const a=e[o].x,l=e[o].y,c=e[s].x,u=e[s].y;l>r!=u>r&&t<(c-a)*(r-l)/(u-l)+a&&(i=!i)}return i}function vte(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return bte(t,e)}function wd(n){return e=>e.pointerType==="mouse"?n(e):void 0}const J3=Qee,Q3=B3,eR=tte,tR=rte,nR=ste,rR=W3,iR=ate,Ste=ute,oR=hte,sR=pte,aR=gte,lR="DropdownMenu",[xte,Zpe]=ji(lR,[um]),li=um(),[_te,cR]=xte(lR),kte=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=n,l=li(e),c=S.useRef(null),[u=!1,d]=ys({prop:i,defaultProp:o,onChange:s});return S.createElement(_te,{scope:e,triggerId:vo(),triggerRef:c,contentId:vo(),open:u,onOpenChange:d,onOpenToggle:S.useCallback(()=>d(h=>!h),[d]),modal:a},S.createElement(J3,te({},l,{open:u,onOpenChange:d,dir:r,modal:a}),t))},Cte="DropdownMenuTrigger",Pte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,o=cR(Cte,t),s=li(t);return S.createElement(Q3,te({asChild:!0},s),S.createElement(qe.button,te({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},i,{ref:Tg(e,o.triggerRef),onPointerDown:ae(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:ae(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),Ete=n=>{const{__scopeDropdownMenu:e,...t}=n,r=li(e);return S.createElement(eR,te({},r,t))},Ite="DropdownMenuContent",Mte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=cR(Ite,t),o=li(t),s=S.useRef(!1);return S.createElement(tR,te({id:i.contentId,"aria-labelledby":i.triggerId},o,r,{ref:e,onCloseAutoFocus:ae(n.onCloseAutoFocus,a=>{var l;s.current||(l=i.triggerRef.current)===null||l===void 0||l.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:ae(n.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,u=l.button===2||c;(!i.modal||u)&&(s.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Tte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(nR,te({},i,r,{ref:e}))}),Ate=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(rR,te({},i,r,{ref:e}))}),jte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(iR,te({},i,r,{ref:e}))}),Rte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(Ste,te({},i,r,{ref:e}))}),Ote=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:o}=n,s=li(e),[a=!1,l]=ys({prop:r,defaultProp:o,onChange:i});return S.createElement(oR,te({},s,{open:a,onOpenChange:l}),t)},Dte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(sR,te({},i,r,{ref:e}))}),Lte=S.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=li(t);return S.createElement(aR,te({},i,r,{ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),uR=kte,bd=Pte,tS=Ete,dR=Mte,zte=Tte,ic=Ate,hR=jte,Nte=Rte,Fte=Ote,$te=Dte,Bte=Lte;function ya(n,e){const t=Y(),r=S.useRef(!1),i=Ql(),o=S.useRef(0),s=S.useCallback(l=>{const c=Date.now();c-o.current<50||(o.current=c,r.current=l,t.batch(()=>{l?(t.complete(),t.addOpenMenu(n)):t.updateInstanceState({openMenus:t.getOpenMenus().filter(u=>!u.startsWith(n))}),e==null||e(l)}))},[t,n,e]),a=Z("is menu open",()=>t.getOpenMenus().includes(n),[t,n]);return S.useEffect(()=>(r.current&&(i("open-menu",{source:"unknown",id:n}),t.addOpenMenu(n)),()=>{r.current&&(t.deleteOpenMenu(n),t.getOpenMenus().forEach(l=>{l.startsWith(n)&&(i("close-menu",{source:"unknown",id:n}),t.deleteOpenMenu(l))}),r.current=!1)}),[t,n,i]),[a,s]}function _s({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,o]=ya(n);return y.jsx(uR,{open:r||i,dir:"ltr",modal:t,onOpenChange:o,children:e})}function vd({children:n,"data-testid":e}){return y.jsx(bd,{dir:"ltr","data-testid":e,asChild:!0,onTouchEnd:t=>Oe(t),children:n})}function ks({side:n="bottom",align:e="start",sideOffset:t=8,alignOffset:r=8,children:i}){const o=pn();return y.jsx(tS,{container:o,children:y.jsx(dR,{className:"tlui-menu",align:e,sideOffset:t,side:n,alignOffset:r,collisionPadding:4,children:i})})}function nS({id:n,children:e}){const[t,r]=ya(n);return y.jsx(Fte,{open:t,onOpenChange:r,children:e})}function rS({label:n,"data-testid":e,"data-direction":t}){return y.jsx($te,{dir:"ltr","data-direction":t,"data-testid":e,asChild:!0,children:y.jsx(ce,{type:"menu",className:"tlui-menu__submenu__trigger",label:n,icon:"chevron-right"})})}function iS({alignOffset:n=0,sideOffset:e=5,children:t}){const r=pn();return y.jsx(tS,{container:r,children:y.jsx(Bte,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:n,sideOffset:e,collisionPadding:4,children:t})})}function Po({children:n,size:e="medium"}){return y.jsx(zte,{dir:"ltr",className:"tlui-menu__group","data-size":e,children:n})}function yr({noClose:n,...e}){return y.jsx(ic,{dir:"ltr",asChild:!0,onClick:n||e.isChecked!==void 0?Oe:void 0,children:y.jsx(ce,{...e})})}function pR({children:n,onSelect:e,...t}){return y.jsxs(hR,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),Oe(r)},...t,children:[y.jsx(fr,{small:!0,icon:t.checked?"check":"checkbox-empty"}),n]})}function Ute({children:n,onSelect:e,...t}){return y.jsxs(hR,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{e==null||e(r),Oe(r)},...t,children:[y.jsx("div",{className:"tlui-button__checkbox__indicator",children:y.jsx(Nte,{dir:"ltr",children:y.jsx(fr,{icon:"check",small:!0})})}),n]})}let fR=0;function Vte(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)fR++,t[i]={id:tt("box"+fR),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.batch(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}const Hte=S.memo(function({renderDebugMenuItems:n}){const e=Me();return y.jsxs("div",{className:"tlui-debug-panel",children:[y.jsx(Wte,{}),y.jsx(Kte,{}),y.jsxs(_s,{id:"debug",children:[y.jsx(vd,{children:y.jsx(ce,{type:"icon",icon:"dots-horizontal",title:e("debug-panel.more")})}),y.jsx(ks,{side:"top",align:"end",alignOffset:0,children:y.jsx(Gte,{renderDebugMenuItems:n})})]})]})}),Wte=ze(function(){const n=Y();return y.jsx("div",{className:"tlui-debug-panel__current-state",children:n.getPath()})}),Kte=function(){const n=Y(),e=Z("rendering shapes count",()=>n.getRenderingShapes().length,[n]);return y.jsxs("div",{children:[e," Shapes"]})},Gte=ze(function({renderDebugMenuItems:n}){const e=Y(),{addToast:t}=Di(),{addDialog:r}=fa(),[i,o]=S.useState(!1);return y.jsxs(y.Fragment,{children:[y.jsxs(Po,{children:[y.jsx(yr,{type:"menu",onClick:()=>{t({id:Xe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),t({id:Xe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:Xe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),y.jsx(yr,{type:"menu",onClick:()=>{r({component:({onClose:s})=>y.jsx(Xte,{displayDontShowAgain:!0,onCancel:()=>{s()},onContinue:()=>{s()}}),onClose:()=>{}})},label:"Show dialog"}),y.jsx(yr,{type:"menu",onClick:()=>Vte(e,100),label:"Create 100 shapes"}),y.jsx(yr,{type:"menu",onClick:()=>{function s({children:d}){let h=0;if(!d.length)return 0;for(const p of[...d])h++,h+=s(p);return h}const a=e.getSelectedShapes(),l=a.length===0?e.getRenderingShapes():a,c=l.map(d=>document.getElementById(d.id).parentElement);let u=c.length;for(const d of c)u+=s(d);window.alert(`Shapes ${l.length}, DOM nodes:${u}`)},label:"Count shapes / nodes"}),(()=>{if(i)throw Error("oh no!")})(),y.jsx(yr,{type:"menu",onClick:()=>{o(!0)},label:"Throw error"}),y.jsx(yr,{type:"menu",onClick:()=>{EP()},label:"Hard reset"})]}),y.jsxs(Po,{children:[y.jsx(Sd,{flag:nt.debugSvg}),y.jsx(Sd,{flag:nt.forceSrgb}),y.jsx(Sd,{flag:nt.debugGeometry}),y.jsx(Sd,{flag:nt.hideShapes})]}),y.jsx(Po,{children:Object.values(kN).map(s=>y.jsx(Sd,{flag:s},s.name))}),n==null?void 0:n()]})});function Yte({label:n,value:e,onChange:t}){return y.jsx(pR,{title:n,checked:e,onSelect:()=>t(!e),children:y.jsx("span",{className:"tlui-button__label",draggable:!1,children:n})})}const Sd=ze(function({flag:n,onChange:e}){return y.jsx(Yte,{label:n.name.replace(/([a-z0-9])([A-Z])/g,t=>`${t[0]} ${t[1].toLowerCase()}`).replace(/^[a-z]/,t=>t.toUpperCase()),value:n.get(),onChange:t=>{n.set(t),e==null||e(t)}})});function Xte({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){const[a,l]=S.useState(!1);return y.jsxs(y.Fragment,{children:[y.jsxs(Kg,{children:[y.jsx(Gg,{children:n}),y.jsx(Yg,{})]}),y.jsx(dd,{style:{maxWidth:350},children:e}),y.jsxs(C1,{className:"tlui-dialog__footer__actions",children:[i&&y.jsx(ce,{type:"normal",onClick:()=>l(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),y.jsx(ce,{type:"normal",onClick:o,children:t}),y.jsx(ce,{type:"primary",onClick:async()=>s(),children:r})]})]})}const qte=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=fa(),i=pn(),o=S.useCallback(s=>{if(!s){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return y.jsx(xJ,{onOpenChange:o,defaultOpen:!0,children:y.jsx(_J,{container:i,children:y.jsx(kJ,{dir:"ltr",className:"tlui-dialog__overlay",children:y.jsx(CJ,{dir:"ltr",className:"tlui-dialog__content",children:y.jsx(e,{onClose:()=>o(!1)})})})})})};function Zte(){const{dialogs:n}=fa();return y.jsx(y.Fragment,{children:n.map(e=>y.jsx(qte,{...e},e.id))})}const Jte=oe.memo(Zte);function Qte(){const n=Y(),e=Z("follow",()=>n.getInstanceState().followingUserId,[n]);return e?y.jsx(ene,{userId:e}):null}function ene({userId:n}){const e=dE(n);return e?y.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function gR(){const n=Y(),{languages:e,currentLanguage:t}=e3(),r=S.useCallback(i=>n.user.updateUserPreferences({locale:i}),[n]);return y.jsxs(nS,{id:"help menu language",children:[y.jsx(rS,{label:"menu.language","data-direction":"left"}),y.jsx(iS,{sideOffset:-4,children:y.jsx(Po,{children:e.map(({locale:i,label:o})=>y.jsx(Ute,{title:i,checked:i===t,onSelect:()=>r(i),children:y.jsx("span",{className:"tlui-button__label",children:o})},i))})})]})}const tne=S.memo(function(){const n=pn(),e=Me(),[t,r]=ya("help menu");return y.jsx("div",{className:"tlui-help-menu",children:y.jsxs(uR,{dir:"ltr",open:t,onOpenChange:r,modal:!1,children:[y.jsx(bd,{asChild:!0,dir:"ltr",children:y.jsx(ce,{type:"help",className:"tlui-button",smallIcon:!0,title:e("help-menu.title"),icon:"question-mark"})}),y.jsx(tS,{container:n,children:y.jsx(dR,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:y.jsx(nne,{})})})]})})});function nne(){const n=vQ(),e=Rr();function t(r){if(!r||e&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return y.jsx(gR,{},"item");break}case"group":return y.jsx(Po,{size:"small",children:r.children.map(t)},r.id);case"submenu":return y.jsxs(nS,{id:`help menu ${r.id}`,children:[y.jsx(rS,{label:r.label}),y.jsx(iS,{children:r.children.map(t)})]},r.id);case"item":{const{id:i,kbd:o,label:s,onSelect:a,icon:l}=r.actionItem;return y.jsx(yr,{type:"menu",kbd:o,label:s,onClick:()=>a("help-menu"),iconLeft:l},i)}}}return y.jsx(y.Fragment,{children:n.map(t)})}const mR="Popover",[yR,Jpe]=ji(mR,[lm]),oS=lm(),[rne,oc]=yR(mR),ine=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=n,a=oS(e),l=S.useRef(null),[c,u]=S.useState(!1),[d=!1,h]=ys({prop:r,defaultProp:i,onChange:o});return S.createElement(G1,a,S.createElement(rne,{scope:e,contentId:vo(),triggerRef:l,open:d,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(p=>!p),[h]),hasCustomAnchor:c,onCustomAnchorAdd:S.useCallback(()=>u(!0),[]),onCustomAnchorRemove:S.useCallback(()=>u(!1),[]),modal:s},t))},one="PopoverTrigger",sne=S.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=oc(one,t),o=oS(t),s=it(e,i.triggerRef),a=S.createElement(qe.button,te({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":vR(i.open)},r,{ref:s,onClick:ae(n.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?a:S.createElement(R3,te({asChild:!0},o),a)}),wR="PopoverPortal",[ane,lne]=yR(wR,{forceMount:void 0}),cne=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,o=oc(wR,e);return S.createElement(ane,{scope:e,forceMount:t},S.createElement(si,{present:t||o.open},S.createElement(Rg,{asChild:!0,container:i},r)))},xd="PopoverContent",une=S.forwardRef((n,e)=>{const t=lne(xd,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,o=oc(xd,n.__scopePopover);return S.createElement(si,{present:r||o.open},o.modal?S.createElement(dne,te({},i,{ref:e})):S.createElement(hne,te({},i,{ref:e})))}),dne=S.forwardRef((n,e)=>{const t=oc(xd,n.__scopePopover),r=S.useRef(null),i=it(e,r),o=S.useRef(!1);return S.useEffect(()=>{const s=r.current;if(s)return _1(s)},[]),S.createElement(S1,{as:da,allowPinchZoom:!0},S.createElement(bR,te({},n,{ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:ae(n.onCloseAutoFocus,s=>{var a;s.preventDefault(),o.current||(a=t.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:ae(n.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:ae(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})))}),hne=S.forwardRef((n,e)=>{const t=oc(xd,n.__scopePopover),r=S.useRef(!1),i=S.useRef(!1);return S.createElement(bR,te({},n,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var s;if((s=n.onCloseAutoFocus)===null||s===void 0||s.call(n,o),!o.defaultPrevented){var a;r.current||(a=t.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:o=>{var s,a;(s=n.onInteractOutside)===null||s===void 0||s.call(n,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const l=o.target;!((a=t.triggerRef.current)===null||a===void 0)&&a.contains(l)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),bR=S.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:u,...d}=n,h=oc(xd,t),p=oS(t);return m1(),S.createElement(f1,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},S.createElement(jg,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1)},S.createElement(O3,te({"data-state":vR(h.open),role:"dialog",id:h.contentId},p,d,{ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function vR(n){return n?"open":"closed"}const pne=ine,fne=sne,SR=cne,xR=une,sS=({id:n,children:e,onOpenChange:t,open:r})=>{const[i,o]=ya(n,t);return y.jsx(pne,{onOpenChange:o,open:r||i,children:y.jsx("div",{className:"tlui-popover",children:e})})},aS=({children:n,disabled:e,"data-testid":t})=>y.jsx(fne,{"data-testid":t,disabled:e,asChild:!0,dir:"ltr",children:n}),_R=({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0})=>{const o=pn();return y.jsx(SR,{container:o,children:y.jsx(xR,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",children:e})})},kR=S.memo(function(){const n=Me(),e=pn(),t=hQ(),r=Rr();function i(o){if(!o||r&&!o.readonlyOk)return null;switch(o.type){case"item":{const{id:s,icon:a,label:l,kbd:c,onSelect:u}=o.actionItem;return y.jsx(ce,{"data-testid":`menu-item.${o.id}`,icon:a,type:"icon",title:l?c?`${n(l)} ${Ri(c)}`:`${n(l)}`:c?`${Ri(c)}`:"",onClick:()=>u("actions-menu"),disabled:o.disabled},s)}}}return y.jsxs(sS,{id:"actions-menu",children:[y.jsx(aS,{children:y.jsx(ce,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:n("actions-menu.title"),type:"icon",smallIcon:!0})}),y.jsx(SR,{container:e,children:y.jsx(xR,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:y.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid",children:t.map(i)})})})]})}),CR=ze(function(){const n=Y(),e=Sn(),t=Me(),r=e.duplicate;return y.jsx(ce,{icon:r.icon,type:"icon",onClick:()=>r.onSelect("quick-actions"),disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${Ri(r.kbd)}`,smallIcon:!0})}),gne=S.memo(function(){const n=Me();return y.jsxs(_s,{id:"main menu",children:[y.jsx(vd,{children:y.jsx(ce,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:n("menu.title"),icon:"menu",smallIcon:!0})}),y.jsx(ks,{alignOffset:0,sideOffset:6,children:y.jsx(mne,{})})]})});function mne(){const n=Y(),e=Me(),t=xQ(),r=Lr(),i=Rr();function o(s,a,l,c){if(!a)return null;switch(a.type){case"custom":return i&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?y.jsx(gR,{},"item"):null;case"group":return i&&!a.readonlyOk?null:y.jsx(Po,{size:c<=1?"medium":r<3||(l==null?void 0:l.type)==="submenu"&&c>2?"tiny":"medium",children:a.children.map(u=>o(s,u,a,c+1))},a.id);case"submenu":return i&&!a.readonlyOk?null:y.jsxs(nS,{id:`main menu ${l?l.id+" ":""}${a.id}`,children:[y.jsx(rS,{label:a.label,"data-testid":`menu-item.${a.id}`}),y.jsx(iS,{sideOffset:-4,alignOffset:-1,children:a.children.map(u=>o(s,u,a,c+1))})]},a.id);case"item":{if(i&&!a.readonlyOk)return null;const{id:u,checkbox:d,menuLabel:h,label:p,onSelect:g,kbd:f}=a.actionItem,m=h??p,v=m?e(m):void 0;return d?y.jsxs(pR,{onSelect:()=>g("menu"),title:v||"",checked:a.checked,disabled:a.disabled,children:[v&&y.jsx("span",{className:"tlui-button__label",children:v}),f&&y.jsx(Ng,{children:f})]},u):y.jsx(yr,{type:"menu","data-testid":`menu-item.${a.id}`,kbd:f,label:m,onClick:()=>g("menu"),disabled:a.disabled},u)}}}return y.jsx(y.Fragment,{children:t.map(s=>o(n,s,null,0))})}const yne=function({name:n,id:e,isCurrentPage:t}){const r=Y(),i=S.useRef(null),o=S.useCallback(a=>{r.renamePage(e,a||"New Page",{ephemeral:!0})},[r,e]),s=S.useCallback(a=>{r.mark("rename page"),r.renamePage(e,a||"New Page",{ephemeral:!1})},[r,e]);return y.jsx(P1,{className:"tlui-page-menu__item__input",ref:a=>i.current=a,defaultValue:n,onValueChange:o,onComplete:s,onCancel:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:t,autoselect:!0})},lS=(n,e,t,r)=>{let i;const o=n.getPages(),s=t>r?o[r-1]:o[r],a=t>r?o[r]:o[r+1];s&&!a?i=uo(s.index):!s&&a?i=X9(o[0].index):i=Nu(s.index,a.index),i!==o[t].index&&(n.mark("moving page"),n.updatePage({id:e,index:i}))},PR=ze(function({index:n,listSize:e,item:t,onRename:r}){const i=Y(),o=Me(),s=i.getPages(),a=S.useCallback(()=>{i.mark("creating page");const d=so.createId();i.duplicatePage(t.id,d)},[i,t]),l=S.useCallback(()=>{lS(i,t.id,n,n-1)},[i,t,n]),c=S.useCallback(()=>{lS(i,t.id,n,n+1)},[i,t,n]),u=S.useCallback(()=>{i.mark("deleting page"),i.deletePage(t.id)},[i,t]);return y.jsxs(_s,{id:`page item submenu ${n}`,children:[y.jsx(vd,{children:y.jsx(ce,{type:"icon",title:o("page-menu.submenu.title"),icon:"dots-vertical"})}),y.jsxs(ks,{alignOffset:0,children:[y.jsxs(Po,{children:[r&&y.jsx(ic,{dir:"ltr",onSelect:r,asChild:!0,children:y.jsx(ce,{type:"menu",label:"page-menu.submenu.rename"})}),y.jsx(ic,{dir:"ltr",onSelect:a,disabled:s.length>=ef,asChild:!0,children:y.jsx(ce,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),n>0&&y.jsx(ic,{dir:"ltr",onSelect:l,asChild:!0,children:y.jsx(ce,{type:"menu",label:"page-menu.submenu.move-up"})}),n<e-1&&y.jsx(ic,{dir:"ltr",onSelect:c,asChild:!0,children:y.jsx(ce,{type:"menu",label:"page-menu.submenu.move-down"})})]}),e>1&&y.jsx(Po,{children:y.jsx(ic,{dir:"ltr",onSelect:u,asChild:!0,children:y.jsx(ce,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),wne=function(){const n=Y(),e=Me(),t=Lr(),r=S.useCallback(()=>f(!1),[]),[i,o]=ya("page-menu",r),s=36,a=S.useRef(null),l=Z("pages",()=>n.getPages(),[n]),c=Z("currentPage",()=>n.getCurrentPage(),[n]),u=Z("currentPageId",()=>n.getCurrentPageId(),[n]),d=Rr(),h=Z("maxPageCountReached",()=>n.getPages().length>=ef,[n]),p=Z("isCoarsePointer",()=>n.getInstanceState().isCoarsePointer,[n]),[g,f]=S.useState(!1),m=S.useCallback(()=>{d||f(T=>!T)},[d]),v=S.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[b,_]=S.useState(Object.fromEntries(l.map((T,A)=>[T.id,{y:A*s,offsetY:0,isSelected:!1}])));S.useLayoutEffect(()=>{_(Object.fromEntries(l.map((T,A)=>[T.id,{y:A*s,offsetY:0,isSelected:!1}])))},[s,l]),S.useEffect(()=>{i&&requestAnimationFrame(()=>{const T=document.querySelector(`[data-testid="page-menu-item-${u}"]`);if(T){const A=a.current;if(!A)return;const D=T.offsetTop,N=A.scrollTop;D<N&&A.scrollTo({top:D});const U=D+s,R=A.scrollTop+A.offsetHeight;U>R&&A.scrollTo({top:U-A.offsetHeight})}})},[s,u,i]);const x=S.useCallback(T=>{const{clientY:A,currentTarget:D}=T,{dataset:{id:N,index:U}}=D;if(!N||!U)return;const R=v.current;vu(T.currentTarget,T),R.status="pointing",R.pointing={id:N,index:+U};const B=b[N].y;R.startY=A,R.startIndex=Math.max(0,Math.min(Math.round(B/s),l.length-1))},[s,l.length,b]),C=S.useCallback(T=>{const A=v.current;if(A.status==="pointing"){const{clientY:D}=T,N=D-A.startY;Math.abs(N)>5&&(A.status="dragging")}if(A.status==="dragging"){const{clientY:D}=T,N=D-A.startY,U=b[A.pointing.id],{startIndex:R,pointing:B}=A,$=U.y+N,q=Math.max(0,Math.min(Math.round($/s),l.length-1)),G={...b};if(G[B.id]={y:U.y,offsetY:N,isSelected:!0},q!==A.dragIndex){A.dragIndex=q;for(let L=0;L<l.length;L++){const V=l[L];if(V.id===A.pointing.id)continue;let{y:J}=G[V.id];q===R?J=L*s:q<R?q<=L&&L<R?J=(L+1)*s:J=L*s:q>R&&(q>=L&&L>R?J=(L-1)*s:J=L*s),J!==G[V.id].y&&(G[V.id]={y:J,offsetY:0,isSelected:!0})}}_(G)}},[s,l,b]),k=S.useCallback(T=>{const A=v.current;if(A.status==="dragging"){const{id:D,index:N}=A.pointing;lS(n,D,N,A.dragIndex)}Su(T.currentTarget,T),A.status="idle"},[n]),E=S.useCallback(T=>{const A=v.current;T.key==="Escape"&&(A.status==="dragging"&&_(Object.fromEntries(l.map((D,N)=>[D.id,{y:N*s,offsetY:0,isSelected:!1}]))),A.status="idle")},[s,l]),I=S.useCallback(()=>{d||n.batch(()=>{n.mark("creating page");const T=so.createId();n.createPage({name:e("page-menu.new-page-initial-name"),id:T}),n.setCurrentPage(T),f(!0)})},[n,e,d]);return y.jsxs(sS,{id:"pages",onOpenChange:o,open:i,children:[y.jsx(aS,{children:y.jsx(ce,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:c.name,children:y.jsx("div",{className:"tlui-page-menu__name",children:c.name})})}),y.jsx(_R,{side:"bottom",align:"start",sideOffset:6,children:y.jsxs("div",{className:"tlui-page-menu__wrapper",children:[y.jsxs("div",{className:"tlui-page-menu__header",children:[y.jsx("div",{className:"tlui-page-menu__header__title",children:e("page-menu.title")}),!d&&y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsx(ce,{type:"icon","data-testid":"page-menu.edit",title:e(g?"page-menu.edit-done":"page-menu.edit-start"),icon:g?"check":"edit",onClick:m}),y.jsx(ce,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:e(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:I})]})]}),y.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:s*l.length+4},ref:a,children:l.map((T,A)=>{const D=b[T.id]??{position:A*40,offsetY:0};return g?y.jsxs("div",{"data-testid":`page-menu-item-${T.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:T.id===c.id?888:A,transform:`translate(0px, ${D.y+D.offsetY}px)`},children:[y.jsx(ce,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:x,onPointerUp:k,onPointerMove:C,onKeyDown:E,"data-id":T.id,"data-index":A}),t<5&&p?y.jsx(ce,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const N=window.prompt("Rename page",T.name);N&&N!==T.name&&n.renamePage(T.id,N)},onDoubleClick:m,isChecked:T.id===c.id,children:y.jsx("span",{children:T.name})}):y.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:s},children:y.jsx(yne,{id:T.id,name:T.name,isCurrentPage:T.id===c.id})}),!d&&y.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:y.jsx(PR,{index:A,item:T,listSize:l.length})})]},T.id+"_editing"):y.jsxs("div",{"data-testid":`page-menu-item-${T.id}`,className:"tlui-page-menu__item",children:[y.jsxs(ce,{type:"normal",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>n.setCurrentPage(T.id),onDoubleClick:m,isChecked:T.id===c.id,title:e("page-menu.go-to-page"),children:[y.jsx("div",{className:"tlui-page-menu__item__button__check",children:T.id===c.id&&y.jsx(fr,{icon:"check"})}),y.jsx("span",{children:T.name})]}),!d&&y.jsx("div",{className:"tlui-page_menu__item__submenu",children:y.jsx(PR,{index:A,item:T,listSize:l.length,onRename:()=>{if(n.environment.isIos){const N=window.prompt("Rename page",T.name);N&&N!==T.name&&n.renamePage(T.id,N)}else n.batch(()=>{f(!0),n.setCurrentPage(T.id)})}})})]},T.id)})})]})})]})},ER=S.memo(function(){const n=Me(),e=n3(),t=Sn().redo;return y.jsx(ce,{"data-testid":"main.redo",icon:t.icon,type:"icon",title:`${n(t.label)} ${Ri(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),IR=ze(function(){const n=Y(),e=Sn(),t=Me(),r=e.delete;return Rr()?null:y.jsx(ce,{icon:r.icon,type:"icon",onClick:()=>{r.onSelect("quick-actions"),n.getContainer().focus()},disabled:!(n.isIn("select")&&n.getSelectedShapeIds().length>0),title:`${t(r.label)} ${Ri(r.kbd)}`,smallIcon:!0})}),MR=S.memo(function(){const n=Me(),e=r3(),t=Sn().undo;return y.jsx(ce,{"data-testid":"main.undo",icon:t.icon,type:"icon",title:`${n(t.label)} ${Ri(t.kbd)}`,disabled:!e,onClick:()=>t.onSelect("quick-actions"),smallIcon:!0})}),bne=ze(function(){const n=Y(),e=Lr(),t=Rr();return y.jsx("div",{className:"tlui-menu-zone",children:y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsx(gne,{}),y.jsx(wne,{}),e>=6&&!t&&!n.isInAny("hand","zoom")&&y.jsxs(y.Fragment,{children:[y.jsx(MR,{}),y.jsx(ER,{}),y.jsx(IR,{}),y.jsx(CR,{}),y.jsx(kR,{})]})]})})});function vne(n,e){const[t,r]=oe.useState(e);oe.useLayoutEffect(()=>{const o=localStorage.getItem(n);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=oe.useCallback(o=>{r(s=>{const a=typeof o=="function"?o(s):o;return localStorage.setItem(n,JSON.stringify(a)),a})},[n]);return[t,i]}class _d{constructor(e){w(this,"dpr",1);w(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});w(this,"id",Xe());w(this,"cvs",null);w(this,"pageBounds",[]);w(this,"collaborators",[]);w(this,"canvasScreenBounds",new de);w(this,"canvasPageBounds",new de);w(this,"contentPageBounds",new de);w(this,"contentScreenBounds",new de);w(this,"originPagePoint",new P);w(this,"originPageCenter",new P);w(this,"isInViewport",!1);w(this,"debug",!1);w(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:r}=this;let{x:i,y:o,w:s,h:a}=e;if(t.w>t.h){const l=r.w/(t.w/t.h);l>r.h?(i=(r.w-r.w*(r.h/l))/2,o=0,s=r.w*(r.h/l),a=r.h):(i=0,o=(r.h-l)/2,s=r.w,a=l)}else if(t.w<t.h){const l=r.h/(t.h/t.w);i=(r.w-l)/2,o=0,s=l,a=r.h}else i=r.h/2,o=0,s=r.h,a=r.h;e.set(i,o,s,a)});w(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:r,contentScreenBounds:i}=this;e.set(0,0,r.width/(i.width/t.width),r.height/(i.height/t.height)),e.center=r.center});w(this,"getScreenPoint",(e,t)=>{const{canvasScreenBounds:r}=this,i=(e-r.minX)*this.dpr,o=(t-r.minY)*this.dpr;return{x:i,y:o}});w(this,"getPagePoint",(e,t)=>{const{contentPageBounds:r,contentScreenBounds:i,canvasPageBounds:o}=this,{x:s,y:a}=this.getScreenPoint(e,t);return new P(o.minX+s*r.width/i.width,o.minY+a*r.height/i.height,1)});w(this,"minimapScreenPointToPagePoint",(e,t,r=!1,i=!1)=>{const{editor:o}=this,s=o.getViewportPageBounds();let{x:a,y:l}=this.getPagePoint(e,t);if(i){const c=this.editor.getCurrentPageBounds(),u=s,d=((c==null?void 0:c.minX)??0)-u.width/2,h=((c==null?void 0:c.maxX)??0)+u.width/2,p=((c==null?void 0:c.minY)??0)-u.height/2,g=((c==null?void 0:c.maxY)??0)+u.height/2,f=Math.max(0,d+u.width-a),m=Math.max(0,-(h-u.width-a)),v=Math.max(0,p+u.height-l),b=Math.max(0,-(g-u.height-l)),_=Math.max(0,f-m),x=Math.max(0,m-f),C=Math.max(0,v-b),k=Math.max(0,b-v);_&&_>x?a+=_/2:x&&(a-=x/2),C&&C>k?l+=C/2:k&&(l-=k/2),a=Ei(a,d,h),l=Ei(l,p,g)}if(r){const{originPagePoint:c}=this,u=Math.abs(a-c.x),d=Math.abs(l-c.y);u>d?l=c.y:a=c.x}return new P(a,l)});w(this,"render",()=>{const{cvs:e,pageBounds:t}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:i,canvasPageBounds:o,contentPageBounds:s,contentScreenBounds:a}=this,{width:l,height:c}=i,u=r.getSelectedShapeIds(),d=r.getViewportPageBounds();if(!e||!t)return;const h=e.getContext("2d");if(!h)throw new Error("Minimap (shapes): Could not get context");h.resetTransform(),h.globalAlpha=1,h.clearRect(0,0,l,c);const p=a.width/s.width,g=a.height/s.height;h.translate((l-a.width)/2,(c-a.height)/2),h.scale(p,g),h.translate(-s.minX,-s.minY);const f=8/p,m=8/p,v=1/p,b=1/p,_=f/4,x=m/4,C=new Path2D,k=new Path2D,{shapeFill:E,selectFill:I,viewportFill:T}=this.colors;let A;for(let B=0,$=t.length;B<$;B++)A=t[B],_d.roundedRect(u.includes(A.id)?k:C,A.minX,A.minY,A.width,A.height,Ei(f,v,A.width/_),Ei(m,b,A.height/x));if(h.fillStyle=E,h.fill(C),h.fillStyle=I,h.fill(k),this.debug){const B=de.Common(t),{minX:$,minY:q,width:G,height:L}=B;h.strokeStyle="green",h.lineWidth=2/p,h.strokeRect($+1/p,q+1/g,G-2/p,L-2/g)}{const{brush:B}=r.getInstanceState();if(B){const{x:$,y:q,w:G,h:L}=B;h.beginPath(),_d.sharpRect(h,$,q,G,L),h.closePath(),h.fillStyle=T,h.fill()}}{const{minX:B,minY:$,width:q,height:G}=d;h.beginPath();const L=12/p,V=12/p;_d.roundedRect(h,B,$,q,G,Math.min(q/4,L),Math.min(G/4,V)),h.closePath(),h.fillStyle=T,h.fill(),this.debug&&(h.strokeStyle="orange",h.strokeRect(B+1/p,$+1/g,q-2/p,G-2/g))}const D=2.5/p,N=2.5/g,U=r.getCurrentPageId();let R;for(let B=0;B<this.collaborators.length;B++)R=this.collaborators[B],R.currentPageId===U&&(h.beginPath(),h.ellipse(Ei(R.cursor.x,o.minX+D,o.maxX-D),Ei(R.cursor.y,o.minY+N,o.maxY-N),5/p,5/g,0,0,We),h.fillStyle=R.color,h.fill());if(this.debug){h.lineWidth=2/p;{const{minX:B,minY:$,width:q,height:G}=s;h.strokeStyle="red",h.strokeRect(B+1/p,$+1/g,q-2/p,G-2/g)}{const{minX:B,minY:$,width:q,height:G}=o;h.strokeStyle="blue",h.strokeRect(B+1/p,$+1/g,q-2/p,G-2/g)}}});this.editor=e}setDpr(e){this.dpr=+e.toFixed(2)}static roundedRect(e,t,r,i,o,s,a){if(s<1&&a<1){e.rect(t,r,i,o);return}e.moveTo(t+s,r),e.lineTo(t+i-s,r),e.quadraticCurveTo(t+i,r,t+i,r+a),e.lineTo(t+i,r+o-a),e.quadraticCurveTo(t+i,r+o,t+i-s,r+o),e.lineTo(t+s,r+o),e.quadraticCurveTo(t,r+o,t,r+o-a),e.lineTo(t,r+a),e.quadraticCurveTo(t,r,t+s,r)}static sharpRect(e,t,r,i,o,s,a){e.rect(t,r,i,o)}}function Sne({shapeFill:n,selectFill:e,viewportFill:t}){const r=Y(),i=S.useRef(null),o=S.useRef(!1),s=Sf(),a=R2("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),l=S.useMemo(()=>r.store.query.records("instance_presence"),[r]),c=S.useMemo(()=>new _d(r),[r]);S.useEffect(()=>{const g=requestAnimationFrame(()=>{const f=getComputedStyle(r.getContainer());c.colors={shapeFill:f.getPropertyValue(n).trim(),selectFill:f.getPropertyValue(e).trim(),viewportFill:f.getPropertyValue(t).trim()},c.render()});return()=>{cancelAnimationFrame(g)}},[r,e,n,t,c,s]);const u=S.useCallback(g=>{if(!r.getCurrentPageShapeIds().size)return;const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),m=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0);c.originPagePoint.setTo(m),c.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(f,{duration:co})},[r,c]),d=S.useCallback(g=>{const f=g.currentTarget;if(vu(f,g),!r.getCurrentPageShapeIds().size)return;o.current=!0,c.isInViewport=!1;const m=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!1),v=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,!1,!0),b=r.getViewportPageBounds();if(c.isInViewport=b.containsPoint(v),c.isInViewport)c.originPagePoint.setTo(v),c.originPageCenter.setTo(b.center);else{const x=P.Sub(b.center,b.point),C=P.Add(m,x);c.originPagePoint.setTo(C),c.originPageCenter.setTo(m),r.centerOnPoint(m,{duration:co})}function _(x){f&&Su(f,x),o.current=!1,document.body.removeEventListener("pointerup",_)}document.body.addEventListener("pointerup",_)},[r,c]),h=S.useCallback(g=>{const f=c.minimapScreenPointToPagePoint(g.clientX,g.clientY,g.shiftKey,!0);if(o.current){if(c.isInViewport){const _=c.originPagePoint.clone().sub(c.originPageCenter);r.centerOnPoint(P.Sub(f,_));return}r.centerOnPoint(f)}const m=c.getPagePoint(g.clientX,g.clientY),v=r.pageToScreen(m),b={type:"pointer",target:"canvas",name:"pointer_move",...Kn(g),point:v,isPen:r.getInstanceState().isPenMode};r.dispatch(b)},[r,c]),p=S.useCallback(g=>{const f=tE(g);r.dispatch({type:"wheel",name:"wheel",delta:f,point:new P(g.clientX,g.clientY),shiftKey:g.shiftKey,altKey:g.altKey,ctrlKey:g.metaKey||g.ctrlKey})},[r]);return Xs("update when dpr changes",()=>{const g=a.get();c.setDpr(g);const f=i.current,m=f.getBoundingClientRect(),v=m.width*g,b=m.height*g;f.width=v,f.height=b,c.canvasScreenBounds.set(m.x,m.y,v,b),c.cvs=i.current},[a,c]),Xs("minimap render when pagebounds or collaborators changes",()=>{const g=r.getCurrentPageShapeIds(),f=r.getCurrentPageBounds(),m=r.getViewportPageBounds();a.get(),c.contentPageBounds=f?de.Expand(f,m):m,c.updateContentScreenBounds();const v=[];g.forEach(b=>{let _=r.getShapePageBounds(b);if(!_)return;const x=r.getShapeMask(b);if(x){const C=ub(x,_.corners);if(!C)return;_=de.FromPoints(C)}_&&(_.id=b,v.push(_))}),c.pageBounds=v,c.collaborators=l.get(),c.render()},[r,c]),y.jsx("div",{className:"tlui-minimap",children:y.jsx("canvas",{ref:i,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:h,onPointerDown:d,onWheel:p})})}const cS=ze(function(){const n=Y(),e=Me(),t=Lr(),r=n.getZoomLevel(),i=n.getCurrentPageShapeIds().size>0,o=n.getSelectedShapeIds().length>0,s=n.getZoomLevel()===1,a=S.useCallback(()=>{n.resetZoom(n.getViewportScreenCenter(),{duration:co})},[n]);return y.jsxs(_s,{id:"zoom",children:[y.jsx(vd,{children:y.jsx(ce,{type:"icon",title:`${e("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:t<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:t<4?"zoom-in":void 0,children:t<4?null:y.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),y.jsx(ks,{side:"top",align:"start",alignOffset:0,children:y.jsxs(Po,{children:[y.jsx(kd,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),y.jsx(kd,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),y.jsx(kd,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:s}),y.jsx(kd,{action:"zoom-to-fit",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),y.jsx(kd,{action:"zoom-to-selection",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function kd(n){const{action:e,disabled:t=!1,noClose:r=!1}=n,i=Sn();return y.jsx(yr,{type:"menu",label:i[e].label,kbd:i[e].kbd,"data-testid":n["data-testid"],onClick:()=>i[e].onSelect("zoom-menu"),noClose:r,disabled:t})}const xne=S.memo(function(){const n=Sn(),e=Me(),t=Lr(),[r,i]=vne("minimap",!0),o=S.useCallback(()=>{i(s=>!s)},[i]);return t<4?null:y.jsxs("div",{className:"tlui-navigation-zone",children:[y.jsx("div",{className:"tlui-buttons__horizontal",children:t<6?y.jsx(cS,{}):r?y.jsxs(y.Fragment,{children:[y.jsx(cS,{}),y.jsx(ce,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]}):y.jsxs(y.Fragment,{children:[y.jsx(ce,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${e(n["zoom-out"].label)} ${Ri(n["zoom-out"].kbd)}`,onClick:()=>n["zoom-out"].onSelect("navigation-zone")}),y.jsx(cS,{}),y.jsx(ce,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${e(n["zoom-in"].label)} ${Ri(n["zoom-in"].kbd)}`,onClick:()=>n["zoom-in"].onSelect("navigation-zone")}),y.jsx(ce,{type:"icon",icon:r?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:e("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:o})]})}),t>=6&&!r&&y.jsx(Sne,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),_ne=ze(function(){const n=Y().getInstanceState().isPenMode,e=Sn();if(!n)return null;const t=e["exit-pen-mode"];return y.jsx(ce,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("helper-buttons")})}),kne=ze(function(){const n=Y(),e=Sn();if(!n.getInstanceState().followingUserId)return null;const t=e["stop-following"];return y.jsx(ce,{type:"normal",label:t.label,iconLeft:t.icon,onClick:()=>t.onSelect("people-menu")})}),Cne=[Tr,ea,pl,Ci];function TR(){const n=Y();return Z("getRelevantStyles",()=>{var r;const e=new hb(n.getSharedStyles()),t=n.getSelectedShapeIds().length>0||!!((r=n.root.getCurrent())!=null&&r.shapeType);if(e.size===0&&n.isIn("select")&&n.getSelectedShapeIds().length===0)for(const i of Cne)e.applyValue(i,n.getStyleForNextShape(i));return e.size===0&&!t?null:{styles:e,opacity:n.getSharedOpacity()}},[n])}function Pne(n){const{uiType:e,items:t,title:r,style:i,value:o,onValueChange:s}=n,a=Y(),l=Me(),c=S.useRef(!1),{handleButtonClick:u,handleButtonPointerDown:d,handleButtonPointerEnter:h,handleButtonPointerUp:p}=S.useMemo(()=>{const f=()=>{c.current=!1,window.removeEventListener("pointerup",f)};return{handleButtonClick:m=>{const{id:v}=m.currentTarget.dataset;o.type==="shared"&&o.value===v||(a.mark("point picker item"),s(i,v,!1))},handleButtonPointerDown:m=>{const{id:v}=m.currentTarget.dataset;a.mark("point picker item"),s(i,v,!0),c.current=!0,window.addEventListener("pointerup",f)},handleButtonPointerEnter:m=>{if(!c.current)return;const{id:v}=m.currentTarget.dataset;s(i,v,!0)},handleButtonPointerUp:m=>{const{id:v}=m.currentTarget.dataset;s(i,v,!1)}}},[o,a,s,i]),g=Z("theme",()=>Wn({isDarkMode:a.user.getIsDarkMode()}),[a]);return y.jsx("div",{className:we("tlui-buttons__grid"),children:t.map(f=>y.jsx(ce,{type:"icon","data-id":f.value,"data-testid":`style.${e}.${f.value}`,"aria-label":f.value,"data-state":o.type==="shared"&&o.value===f.value?"hinted":void 0,title:r+" \u2014 "+l(`${e}-style.${f.value}`),className:we("tlui-button-grid__button"),style:i===Tr?{color:g[f.value].solid}:void 0,onPointerEnter:h,onPointerDown:d,onPointerUp:p,onClick:u,icon:f.icon},f.value))})}const sc=S.memo(Pne);function AR(n,[e,t]){return Math.min(t,Math.max(e,n))}function Ene(n){const e=S.useRef({value:n,previous:n});return S.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}const jR=["PageUp","PageDown"],RR=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],OR={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Cd="Slider",[uS,Ine,Mne]=Ag(Cd),[DR,Qpe]=ji(Cd,[Mne]),[Tne,fm]=DR(Cd),Ane=S.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:p=!1,...g}=n,[f,m]=S.useState(null),v=it(e,R=>m(R)),b=S.useRef(new Set),_=S.useRef(0),x=s==="horizontal",C=f?!!f.closest("form"):!0,k=x?jne:Rne,[E=[],I]=ys({prop:u,defaultProp:c,onChange:R=>{var B;(B=[...b.current][_.current])===null||B===void 0||B.focus(),d(R)}}),T=S.useRef(E);function A(R){const B=Une(E,R);U(R,B)}function D(R){U(R,_.current)}function N(){const R=T.current[_.current];E[_.current]!==R&&h(E)}function U(R,B,{commit:$}={commit:!1}){const q=Kne(o),G=Gne(Math.round((R-r)/o)*o+r,q),L=AR(G,[r,i]);I((V=[])=>{const J=$ne(V,L,B);if(Wne(J,l*o)){_.current=J.indexOf(L);const le=String(J)!==String(V);return le&&$&&h(J),le?J:V}else return V})}return S.createElement(Tne,{scope:n.__scopeSlider,disabled:a,min:r,max:i,valueIndexToChangeRef:_,thumbs:b.current,values:E,orientation:s},S.createElement(uS.Provider,{scope:n.__scopeSlider},S.createElement(uS.Slot,{scope:n.__scopeSlider},S.createElement(k,te({"aria-disabled":a,"data-disabled":a?"":void 0},g,{ref:v,onPointerDown:ae(g.onPointerDown,()=>{a||(T.current=E)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:A,onSlideMove:a?void 0:D,onSlideEnd:a?void 0:N,onHomeKeyDown:()=>!a&&U(r,0,{commit:!0}),onEndKeyDown:()=>!a&&U(i,E.length-1,{commit:!0}),onStepKeyDown:({event:R,direction:B})=>{if(!a){const $=jR.includes(R.key)||R.shiftKey&&RR.includes(R.key)?10:1,q=_.current,G=E[q],L=o*$*B;U(G+L,q,{commit:!0})}}})))),C&&E.map((R,B)=>S.createElement(Fne,{key:B,name:t?t+(E.length>1?"[]":""):void 0,value:R})))}),[LR,zR]=DR(Cd,{startEdge:"left",endEdge:"right",size:"width",direction:1}),jne=S.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=n,[d,h]=S.useState(null),p=it(e,_=>h(_)),g=S.useRef(),f=N1(i),m=f==="ltr",v=m&&!o||!m&&o;function b(_){const x=g.current||d.getBoundingClientRect(),C=[0,x.width],k=dS(C,v?[t,r]:[r,t]);return g.current=x,k(_-x.left)}return S.createElement(LR,{scope:n.__scopeSlider,startEdge:v?"left":"right",endEdge:v?"right":"left",direction:v?1:-1,size:"width"},S.createElement(NR,te({dir:f,"data-orientation":"horizontal"},u,{ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const x=b(_.clientX);s==null||s(x)},onSlideMove:_=>{const x=b(_.clientX);a==null||a(x)},onSlideEnd:()=>{g.current=void 0,l==null||l()},onStepKeyDown:_=>{const x=OR[v?"from-left":"from-right"].includes(_.key);c==null||c({event:_,direction:x?-1:1})}})))}),Rne=S.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=n,u=S.useRef(null),d=it(e,u),h=S.useRef(),p=!i;function g(f){const m=h.current||u.current.getBoundingClientRect(),v=[0,m.height],b=dS(v,p?[r,t]:[t,r]);return h.current=m,b(f-m.top)}return S.createElement(LR,{scope:n.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1},S.createElement(NR,te({"data-orientation":"vertical"},c,{ref:d,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:f=>{const m=g(f.clientY);o==null||o(m)},onSlideMove:f=>{const m=g(f.clientY);s==null||s(m)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:f=>{const m=OR[p?"from-bottom":"from-top"].includes(f.key);l==null||l({event:f,direction:m?-1:1})}})))}),NR=S.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=n,u=fm(Cd,t);return S.createElement(qe.span,te({},c,{ref:e,onKeyDown:ae(n.onKeyDown,d=>{d.key==="Home"?(s(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):jR.concat(RR).includes(d.key)&&(l(d),d.preventDefault())}),onPointerDown:ae(n.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():r(d)}),onPointerMove:ae(n.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&i(d)}),onPointerUp:ae(n.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),o(d))})}))}),One="SliderTrack",Dne=S.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=fm(One,t);return S.createElement(qe.span,te({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:e}))}),FR="SliderRange",Lne=S.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=fm(FR,t),o=zR(FR,t),s=S.useRef(null),a=it(e,s),l=i.values.length,c=i.values.map(h=>BR(h,i.min,i.max)),u=l>1?Math.min(...c):0,d=100-Math.max(...c);return S.createElement(qe.span,te({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:a,style:{...n.style,[o.startEdge]:u+"%",[o.endEdge]:d+"%"}}))}),$R="SliderThumb",zne=S.forwardRef((n,e)=>{const t=Ine(n.__scopeSlider),[r,i]=S.useState(null),o=it(e,a=>i(a)),s=S.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return S.createElement(Nne,te({},n,{ref:o,index:s}))}),Nne=S.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,...i}=n,o=fm($R,t),s=zR($R,t),[a,l]=S.useState(null),c=it(e,m=>l(m)),u=E3(a),d=o.values[r],h=d===void 0?0:BR(d,o.min,o.max),p=Bne(r,o.values.length),g=u==null?void 0:u[s.size],f=g?Vne(g,h,s.direction):0;return S.useEffect(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),S.createElement("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[s.startEdge]:`calc(${h}% + ${f}px)`}},S.createElement(uS.ItemSlot,{scope:n.__scopeSlider},S.createElement(qe.span,te({role:"slider","aria-label":n["aria-label"]||p,"aria-valuemin":o.min,"aria-valuenow":d,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:c,style:d===void 0?{display:"none"}:n.style,onFocus:ae(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),Fne=n=>{const{value:e,...t}=n,r=S.useRef(null),i=Ene(e);return S.useEffect(()=>{const o=r.current,s=window.HTMLInputElement.prototype,a=Object.getOwnPropertyDescriptor(s,"value").set;if(i!==e&&a){const l=new Event("input",{bubbles:!0});a.call(o,e),o.dispatchEvent(l)}},[i,e]),S.createElement("input",te({style:{display:"none"}},t,{ref:r,defaultValue:e}))};function $ne(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,o)=>i-o)}function BR(n,e,t){const r=100/(t-e)*(n-e);return AR(r,[0,100])}function Bne(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Une(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function Vne(n,e,t){const r=n/2,i=dS([0,50],[0,r]);return(r-i(e)*t)*t}function Hne(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Wne(n,e){if(e>0){const t=Hne(n);return Math.min(...t)>=e}return!0}function dS(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Kne(n){return(String(n).split(".")[1]||"").length}function Gne(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}const Yne=Ane,Xne=Dne,qne=Lne,Zne=zne,Jne=S.memo(function(n){const{title:e,steps:t,value:r,label:i,onValueChange:o}=n,s=Y(),a=Me(),l=S.useCallback(d=>{o(d[0],!0)},[o]),c=S.useCallback(()=>{s.mark("click slider")},[s]),u=S.useCallback(()=>{r&&o(r,!1)},[r,o]);return y.jsx("div",{className:"tlui-slider__container",children:y.jsxs(Yne,{"data-testid":n["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:t,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:u,title:e+" \u2014 "+a(i),children:[y.jsx(Xne,{className:"tlui-slider__track",dir:"ltr",children:r!==null&&y.jsx(qne,{className:"tlui-slider__range",dir:"ltr"})}),r!==null&&y.jsx(Zne,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),Qne=S.memo(function({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:u,onValueChange:d}){const h=Me(),p=S.useMemo(()=>{var f;return((f=o.find(m=>c.type==="shared"&&c.value===m.value))==null?void 0:f.icon)??"mixed"},[o,c]),g=S.useMemo(()=>{var f;return((f=s.find(m=>u.type==="shared"&&u.value===m.value))==null?void 0:f.icon)??"mixed"},[s,u]);return c===void 0&&u===void 0?null:y.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[y.jsx("div",{title:h(n),className:"tlui-style-panel__double-select-picker-label",children:h(n)}),y.jsxs("div",{className:"tlui-buttons__horizontal",children:[y.jsxs(_s,{id:`style panel ${e} A`,children:[y.jsx(bd,{asChild:!0,onTouchEnd:f=>Oe(f),children:y.jsx(ce,{type:"icon","data-testid":`style.${e}`,title:h(r)+" \u2014 "+(c===null||c.type==="mixed"?h("style-panel.mixed"):h(`${e}-style.${c.value}`)),icon:p,invertIcon:!0,smallIcon:!0})}),y.jsx(ks,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:y.jsx("div",{className:"tlui-buttons__grid",children:o.map(f=>y.jsx(yr,{type:"icon",title:h(r)+" \u2014 "+h(`${e}-style.${f.value}`),"data-testid":`style.${e}.${f.value}`,icon:f.icon,onClick:()=>d(a,f.value,!1),invertIcon:!0},f.value))})})]}),y.jsxs(_s,{id:`style panel ${t}`,children:[y.jsx(bd,{asChild:!0,onTouchEnd:f=>Oe(f),children:y.jsx(ce,{type:"icon","data-testid":`style.${t}`,title:h(i)+" \u2014 "+(u===null||u.type==="mixed"?h("style-panel.mixed"):h(`${t}-style.${u.value}`)),icon:g,smallIcon:!0})}),y.jsx(ks,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:y.jsx("div",{className:"tlui-buttons__grid",children:s.map(f=>y.jsx(yr,{type:"icon",title:h(i)+" \u2014 "+h(`${t}-style.${f.value}`),"data-testid":`style.${t}.${f.value}`,icon:f.icon,onClick:()=>d(l,f.value,!1)},f.value))})})]})]})]})}),hS=S.memo(function({id:n,label:e,uiType:t,style:r,items:i,type:o,value:s,onValueChange:a}){const l=Me(),c=S.useMemo(()=>{var u;return(u=i.find(d=>s.type==="shared"&&d.value===s.value))==null?void 0:u.icon},[i,s]);return y.jsxs(_s,{id:`style panel ${n}`,children:[y.jsx(bd,{asChild:!0,onTouchEnd:u=>Oe(u),children:y.jsx(ce,{type:o,"data-testid":`style.${t}`,title:s.type==="mixed"?l("style-panel.mixed"):l(`${t}-style.${s.value}`),label:e,icon:c??"mixed"})}),y.jsx(ks,{side:"left",align:"center",alignOffset:0,children:y.jsx("div",{className:"tlui-buttons__grid",children:i.map(u=>y.jsx(yr,{type:"icon","data-testid":`style.${t}.${u.value}`,title:l(`${t}-style.${u.value}`),icon:u.icon,onClick:()=>a(r,u.value,!1)},u.value))})})]})}),ci={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},UR=function({isMobile:n}){const e=Y(),t=TR(),r=S.useCallback(()=>{n||e.updateInstanceState({isChangingStyle:!1})},[e,n]);if(!t)return null;const{styles:i,opacity:o}=t,s=i.get(Pi),a=i.get(Hp),l=i.get(Vp),c=i.get(Gp),u=i.get(ki),d=s===void 0,h=a===void 0&&l===void 0,p=c===void 0,g=u===void 0;return y.jsxs("div",{className:"tlui-style-panel","data-ismobile":n,onPointerLeave:r,children:[y.jsx(ere,{styles:i,opacity:o}),!g&&y.jsx(tre,{styles:i}),!(d&&h&&p)&&y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[y.jsx(nre,{styles:i}),y.jsx(ire,{styles:i}),y.jsx(rre,{styles:i})]})]})};function Pd(){const n=Y();return oe.useMemo(()=>function(e,t,r){n.batch(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(e,t,{squashing:r}),n.setStyleForNextShapes(e,t,{squashing:r}),n.updateInstanceState({isChangingStyle:!0})})},[n])}const Ed=[.1,.25,.5,.75,1];function ere({styles:n,opacity:e}){const t=Y(),r=Me(),i=Pd(),o=oe.useCallback((h,p)=>{const g=Ed[h];t.batch(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(g,{ephemeral:p}),t.setOpacityForNextShapes(g,{ephemeral:p}),t.updateInstanceState({isChangingStyle:!0})})},[t]),s=n.get(Tr),a=n.get(pl),l=n.get(ea),c=n.get(Ci),u=a!==void 0||l!==void 0||c!==void 0,d=e.type==="mixed"?-1:Ed.indexOf(AL(Ed,h=>Math.abs(h-e.value)));return y.jsxs(y.Fragment,{children:[y.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[s===void 0?null:y.jsx(sc,{title:r("style-panel.color"),uiType:"color",style:Tr,items:ci.color,value:s,onValueChange:i}),e===void 0?null:y.jsx(Jne,{"data-testid":"style.opacity",value:d>=0?d:Ed.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:o,steps:Ed.length-1,title:r("style-panel.opacity")})]}),u&&y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:y.jsx(sc,{title:r("style-panel.fill"),uiType:"fill",style:pl,items:ci.fill,value:a,onValueChange:i}),l===void 0?null:y.jsx(sc,{title:r("style-panel.dash"),uiType:"dash",style:ea,items:ci.dash,value:l,onValueChange:i}),c===void 0?null:y.jsx(sc,{title:r("style-panel.size"),uiType:"size",style:Ci,items:ci.size,value:c,onValueChange:i})]})]})}function tre({styles:n}){const e=Me(),t=Pd(),r=n.get(ki),i=n.get(wu),o=n.get(Wp);return r===void 0&&i===void 0?null:y.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:y.jsx(sc,{title:e("style-panel.font"),uiType:"font",style:ki,items:ci.font,value:r,onValueChange:t}),i===void 0?null:y.jsxs("div",{className:"tlui-style-panel__row",children:[y.jsx(sc,{title:e("style-panel.align"),uiType:"align",style:wu,items:ci.horizontalAlign,value:i,onValueChange:t}),y.jsx("div",{className:"tlui-style-panel__row__extra-button",children:o===void 0?y.jsx(ce,{type:"icon",title:e("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):y.jsx(hS,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Wp,items:ci.verticalAlign,value:o,onValueChange:t})})]})]})}function nre({styles:n}){const e=Pd(),t=n.get(Pi);return t===void 0?null:y.jsx(hS,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Pi,items:ci.geo,value:t,onValueChange:e})}function rre({styles:n}){const e=Pd(),t=n.get(Gp);return t===void 0?null:y.jsx(hS,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Gp,items:ci.spline,value:t,onValueChange:e})}function ire({styles:n}){const e=Pd(),t=n.get(Hp),r=n.get(Vp);return!t||!r?null:y.jsx(Qne,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Vp,itemsA:ci.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Hp,itemsB:ci.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function ore({toast:n}){const{removeToast:e}=Di(),t=Me(),r=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0;return y.jsxs(nZ,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,children:[n.icon&&y.jsx("div",{className:"tlui-toast__icon",children:y.jsx(fr,{icon:n.icon})}),y.jsxs("div",{className:"tlui-toast__main",children:[y.jsxs("div",{className:"tlui-toast__content",children:[n.title&&y.jsx(rZ,{className:"tlui-toast__title",children:n.title}),n.description&&y.jsx(iZ,{className:"tlui-toast__description",children:n.description})]}),n.actions&&y.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,s)=>y.jsx(oZ,{altText:o.label,asChild:!0,onClick:o.onClick,children:y.jsx(ce,{type:o.type,children:o.label})},s)),y.jsx(YA,{asChild:!0,children:y.jsx(ce,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:n.closeLabel??t("toast.close")})})]})]}),!i&&y.jsx(YA,{asChild:!0,children:y.jsx(ce,{type:"normal",className:"tlui-toast__close",children:n.closeLabel??t("toast.close")})})]})}function sre(){const{toasts:n}=Di();return y.jsx(y.Fragment,{children:n.map(e=>y.jsx(ore,{toast:e},e.id))})}const are=S.memo(sre);function lre(){const{toasts:n}=Di(),[e,t]=S.useState(!1);return S.useEffect(()=>{let r=!1;return n.length?t(!0):setTimeout(()=>{r||t(!1)},1e3),()=>{r=!0}},[n.length,t]),e?y.jsx(Fq,{className:"tlui-toast__viewport"}):null}function cre(){var a;const n=Y(),e=Me(),t=(a=TR())==null?void 0:a.styles.get(Tr),r=Wn({isDarkMode:n.user.getIsDarkMode()}),i=((t==null?void 0:t.type)==="shared"?r[t.value]:r.black).solid,o=Z("isHandOrEraserToolActive",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),s=S.useCallback(l=>{l||n.updateInstanceState({isChangingStyle:!1})},[n]);return y.jsxs(sS,{id:"style menu",onOpenChange:s,children:[y.jsx(aS,{disabled:o,children:y.jsx(ce,{type:"tool","data-testid":"mobile.styles",style:{color:o?"var(--color-muted-1)":i},title:e("style-panel.title"),children:y.jsx(fr,{icon:o?"blob":(t==null?void 0:t.type)==="mixed"?"mixed":"blob"})})}),y.jsx(_R,{side:"top",align:"end",children:y.jsx(UR,{isMobile:!0})})]})}const ure=["select","hand","draw","eraser","text","zoom","laser","highlight"];function dre({activeToolId:n}){const e=Y(),t=Lr(),r=Me(),i=Z("is tool locked",()=>e.getInstanceState().isToolLocked,[e]);return!n||ure.includes(n)?null:y.jsx(ce,{type:"normal",title:r("action.toggle-tool-lock"),className:we("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<5}),icon:i?"lock":"unlock",onClick:()=>e.updateInstanceState({isToolLocked:!i}),smallIcon:!0})}const hre=S.memo(function(){const n=Y(),e=Me(),t=Lr(),r=oe.useRef(void 0),i=Rr(),o=kQ(),s=o.find(f=>f.toolItem.id==="laser"),a=Z("current tool id",()=>n.getCurrentToolId(),[n]),l=Z("geo",()=>n.getSharedStyles().getAsKnownValue(Pi),[n]),c=!i,u=f=>f.label?`${e(f.label)} ${f.kbd?Ri(f.kbd):""}`:"",d=o.find(f=>ac(f.toolItem,a,l)),{itemsInPanel:h,itemsInDropdown:p,dropdownFirstItem:g}=oe.useMemo(()=>{const f=[],m=[];let v;const b=Math.min(8,5+t);for(let _=4;_<o.length;_++){const x=o[_];_<b?f.push(x):(x===d&&(v=x),m.push(x))}return v||(r.current||(r.current=m[0]),v=r.current,m.includes(v)||(v=m[0])),r.current=v,m.length<=2&&(f.push(...m),m.length=0),{itemsInPanel:f,itemsInDropdown:m,dropdownFirstItem:v}},[o,d,t]);return y.jsx("div",{className:"tlui-toolbar",children:y.jsxs("div",{className:"tlui-toolbar__inner",children:[y.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&y.jsxs("div",{className:"tlui-toolbar__extras",children:[t<6&&!(a==="hand"||a==="zoom")&&y.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[y.jsx(MR,{}),y.jsx(ER,{}),y.jsx(IR,{}),y.jsx(CR,{}),y.jsx(kR,{})]}),y.jsx(dre,{activeToolId:a})]}),y.jsxs("div",{className:we("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":t<5}),children:[o.slice(0,2).map(({toolItem:f})=>y.jsx(Id,{item:f,title:u(f),isSelected:ac(f,a,l)},f.id)),i&&s&&y.jsx(Id,{item:s.toolItem,title:u(s.toolItem),isSelected:ac(s.toolItem,a,l)},s.toolItem.id),c&&y.jsxs(y.Fragment,{children:[o.slice(2,4).map(({toolItem:f})=>y.jsx(Id,{item:f,title:u(f),isSelected:ac(f,a,l)},f.id)),h.map(({toolItem:f})=>y.jsx(Id,{item:f,title:u(f),isSelected:ac(f,a,l)},f.id)),p.length?y.jsxs(y.Fragment,{children:[y.jsx(Id,{item:g.toolItem,title:u(g.toolItem),isSelected:ac(g.toolItem,a,l)},g.toolItem.id),y.jsxs(_s,{id:"toolbar overflow",modal:!1,children:[y.jsx(vd,{children:y.jsx(ce,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:e("tool-panel.more")})}),y.jsx(ks,{side:"top",align:"center",children:y.jsx(pre,{toolbarItems:p})})]})]}):null]})]})]}),t<5&&!i&&y.jsx("div",{className:"tlui-toolbar__tools",children:y.jsx(cre,{})})]})})}),pre=ze(function({toolbarItems:n}){const e=Me();return y.jsx("div",{className:"tlui-buttons__grid",children:n.map(({toolItem:{id:t,meta:r,kbd:i,label:o,onSelect:s,icon:a}})=>y.jsx(yr,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${t}`,"data-tool":t,"data-geo":(r==null?void 0:r.geo)??"","aria-label":o,onClick:()=>s("toolbar"),title:o?`${e(o)} ${i?Ri(i):""}`:"",icon:a},t))})});function Id({item:n,title:e,isSelected:t}){var r;return y.jsx(ce,{type:"tool","data-testid":`tools.${n.id}`,"data-tool":n.id,"data-geo":((r=n.meta)==null?void 0:r.geo)??"","aria-label":n.label,title:e,icon:n.icon,"data-state":t?"selected":void 0,onClick:()=>n.onSelect("toolbar"),onTouchStart:i=>{Oe(i),n.onSelect("toolbar")}})}const ac=(n,e,t)=>{var r,i;return(r=n.meta)!=null&&r.geo?e==="geo"&&t===((i=n.meta)==null?void 0:i.geo):e===n.id};function fre(){const n=Y(),{addToast:e}=Di();S.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const pS=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function fS(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function Md(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function VR(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function HR(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function gre(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let i=!0;for(let o=0;o<t.length;o++)r.indexOf(t[o])===-1&&(i=!1);return i}const Td={backspace:8,"\u232B":8,tab:9,clear:12,enter:13,"\u21A9":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"\u21EA":20,",":188,".":190,"/":191,"`":192,"-":pS?173:189,"=":pS?61:187,";":pS?59:186,"'":222,"[":219,"]":221,"\\":220},Ni={"\u21E7":16,shift:16,"\u2325":18,alt:18,option:18,"\u2303":17,ctrl:17,control:17,"\u2318":91,cmd:91,command:91},gS={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Qt={16:!1,18:!1,17:!1,91:!1},bt={};for(let n=1;n<20;n++)Td["f".concat(n)]=111+n;let ot=[],Ad=null,WR="all";const Eo=new Map,jd=n=>Td[n.toLowerCase()]||Ni[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),mre=n=>Object.keys(Td).find(e=>Td[e]===n),yre=n=>Object.keys(Ni).find(e=>Ni[e]===n);function KR(n){WR=n||"all"}function Rd(){return WR||"all"}function wre(){return ot.slice(0)}function bre(){return ot.map(n=>mre(n)||yre(n)||String.fromCharCode(n))}function vre(){const n=[];return Object.keys(bt).forEach(e=>{bt[e].forEach(t=>{let{key:r,scope:i,mods:o,shortcut:s}=t;n.push({scope:i,shortcut:s,mods:o,keys:r.split("+").map(a=>jd(a))})})}),n}function Sre(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function xre(n){return typeof n=="string"&&(n=jd(n)),ot.indexOf(n)!==-1}function _re(n,e){let t,r;n||(n=Rd());for(const i in bt)if(Object.prototype.hasOwnProperty.call(bt,i))for(t=bt[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(o=>{let{element:s}=o;return mS(s)}):r++;Rd()===n&&KR(e||"all")}function kre(n){let e=n.keyCode||n.which||n.charCode;const t=ot.indexOf(e);if(t>=0&&ot.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&ot.splice(0,ot.length),(e===93||e===224)&&(e=91),e in Qt){Qt[e]=!1;for(const r in Ni)Ni[r]===e&&(ui[r]=!1)}}function GR(n){if(typeof n>"u")Object.keys(bt).forEach(i=>{Array.isArray(bt[i])&&bt[i].forEach(o=>gm(o)),delete bt[i]}),mS(null);else if(Array.isArray(n))n.forEach(i=>{i.key&&gm(i)});else if(typeof n=="object")n.key&&gm(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[i,o]=t;typeof i=="function"&&(o=i,i=""),gm({key:n,scope:i,method:o,splitKey:"+"})}}const gm=n=>{let{key:e,scope:t,method:r,splitKey:i="+"}=n;HR(e).forEach(o=>{const s=o.split(i),a=s.length,l=s[a-1],c=l==="*"?"*":jd(l);if(!bt[c])return;t||(t=Rd());const u=a>1?VR(Ni,s):[],d=[];bt[c]=bt[c].filter(h=>{const p=(r?h.method===r:!0)&&h.scope===t&&gre(h.mods,u);return p&&d.push(h.element),!p}),d.forEach(h=>mS(h))})};function YR(n,e,t,r){if(e.element!==r)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const o in Qt)Object.prototype.hasOwnProperty.call(Qt,o)&&(!Qt[o]&&e.mods.indexOf(+o)>-1||Qt[o]&&e.mods.indexOf(+o)===-1)&&(i=!1);(e.mods.length===0&&!Qt[16]&&!Qt[18]&&!Qt[17]&&!Qt[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(ot),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function XR(n,e){const t=bt["*"];let r=n.keyCode||n.which||n.charCode;if(!ui.filter.call(this,n))return;if((r===93||r===224)&&(r=91),ot.indexOf(r)===-1&&r!==229&&ot.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const l=gS[a];n[a]&&ot.indexOf(l)===-1?ot.push(l):!n[a]&&ot.indexOf(l)>-1?ot.splice(ot.indexOf(l),1):a==="metaKey"&&n[a]&&ot.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(ot=ot.slice(ot.indexOf(l))))}),r in Qt){Qt[r]=!0;for(const a in Ni)Ni[a]===r&&(ui[a]=!0);if(!t)return}for(const a in Qt)Object.prototype.hasOwnProperty.call(Qt,a)&&(Qt[a]=n[gS[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(ot.indexOf(17)===-1&&ot.push(17),ot.indexOf(18)===-1&&ot.push(18),Qt[17]=!0,Qt[18]=!0);const i=Rd();if(t)for(let a=0;a<t.length;a++)t[a].scope===i&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&YR(n,t[a],i,e);if(!(r in bt))return;const o=bt[r],s=o.length;for(let a=0;a<s;a++)if((n.type==="keydown"&&o[a].keydown||n.type==="keyup"&&o[a].keyup)&&o[a].key){const l=o[a],{splitKey:c}=l,u=l.key.split(c),d=[];for(let h=0;h<u.length;h++)d.push(jd(u[h]));d.sort().join("")===ot.sort().join("")&&YR(n,l,i,e)}}function ui(n,e,t){ot=[];const r=HR(n);let i=[],o="all",s=document,a=0,l=!1,c=!0,u="+",d=!1,h=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(s=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(h=!0)),typeof e=="string"&&(o=e),h&&GR(n,o);a<r.length;a++)n=r[a].split(u),i=[],n.length>1&&(i=VR(Ni,n)),n=n[n.length-1],n=n==="*"?"*":jd(n),n in bt||(bt[n]=[]),bt[n].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:t,key:r[a],splitKey:u,element:s});if(typeof s<"u"&&window){if(!Eo.has(s)){const p=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return XR(f,s)},g=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;XR(f,s),kre(f)};Eo.set(s,{keydownListener:p,keyupListenr:g,capture:d}),fS(s,"keydown",p,d),fS(s,"keyup",g,d)}if(!Ad){const p=()=>{ot=[]};Ad={listener:p,capture:d},fS(window,"focus",p,d)}}}function Cre(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(bt).forEach(t=>{bt[t].filter(r=>r.scope===e&&r.shortcut===n).forEach(r=>{r&&r.method&&r.method()})})}function mS(n){const e=Object.values(bt).flat();if(e.findIndex(t=>{let{element:r}=t;return r===n})<0){const{keydownListener:t,keyupListenr:r,capture:i}=Eo.get(n)||{};t&&r&&(Md(n,"keyup",r,i),Md(n,"keydown",t,i),Eo.delete(n))}if((e.length<=0||Eo.size<=0)&&(Object.keys(Eo).forEach(t=>{const{keydownListener:r,keyupListenr:i,capture:o}=Eo.get(t)||{};r&&i&&(Md(t,"keyup",i,o),Md(t,"keydown",r,o),Eo.delete(t))}),Eo.clear(),Object.keys(bt).forEach(t=>delete bt[t]),Ad)){const{listener:t,capture:r}=Ad;Md(window,"focus",t,r),Ad=null}}const yS={getPressedKeyString:bre,setScope:KR,getScope:Rd,deleteScope:_re,getPressedKeyCodes:wre,getAllKeyCodes:vre,isPressed:xre,filter:Sre,trigger:Cre,unbind:GR,keyMap:Td,modifier:Ni,modifierMap:gS};for(const n in yS)Object.prototype.hasOwnProperty.call(yS,n)&&(ui[n]=yS[n]);if(typeof window<"u"){const n=window.hotkeys;ui.noConflict=e=>(e&&window.hotkeys===ui&&(window.hotkeys=n),ui),window.hotkeys=ui}const qR=["copy","cut","paste","asset"];function Pre(){const n=Y(),e=Rr(),t=Sn(),r=z1(),i=Z("is focused",()=>n.getInstanceState().isFocused,[n]);S.useEffect(()=>{if(!i)return;const o=n.getContainer();ui.setScope(n.store.id);const s=(l,c)=>{ui(l,{element:o,scope:n.store.id},c)},a=()=>n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError();for(const l of Object.values(t))l.kbd&&(e&&!l.readonlyOk||qR.includes(l.id)||s(ZR(l.kbd),c=>{a()||(Oe(c),l.onSelect("kbd"))}));for(const l of Object.values(r))!l.kbd||!l.readonlyOk&&n.getInstanceState().isReadonly||qR.includes(l.id)||s(ZR(l.kbd),c=>{a()||(Oe(c),l.onSelect("kbd"))});return()=>{ui.deleteScope(n.store.id)}},[t,r,e,n,i])}function ZR(n){return Ere(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd+\u2325+${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function Ere(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}const Ire=oe.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t,children:r,hideUi:i,...o}){return y.jsx(MQ,{...o,children:y.jsx(Mre,{hideUi:i,shareZone:n,topZone:e,renderDebugMenuItems:t,children:r})})}),Mre=oe.memo(function({children:n,hideUi:e,...t}){return y.jsxs(y.Fragment,{children:[n,e?null:y.jsx(Tre,{...t})]})}),Tre=oe.memo(function({shareZone:n,topZone:e,renderDebugMenuItems:t}){const r=Y(),i=Me(),o=Lr(),s=Z("isReadonlyMode",()=>r.getInstanceState().isReadonly,[r]),a=Z("focus",()=>r.getInstanceState().isFocusMode,[r]),l=Z("debug",()=>r.getInstanceState().isDebugMode,[r]);Pre(),GJ(),fre();const{"toggle-focus-mode":c}=Sn();return y.jsx($A,{children:y.jsxs("div",{className:we("tlui-layout",{"tlui-layout__mobile":o<5}),"data-breakpoint":o,children:[a?y.jsx("div",{className:"tlui-layout__top",children:y.jsx(ce,{type:"icon",className:"tlui-focus-button",title:`${i("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>c.onSelect("menu")})}):y.jsxs(y.Fragment,{children:[y.jsxs("div",{className:"tlui-layout__top",children:[y.jsxs("div",{className:"tlui-layout__top__left",children:[y.jsx(bne,{}),y.jsxs("div",{className:"tlui-helper-buttons",children:[y.jsx(_ne,{}),y.jsx(AQ,{}),y.jsx(kne,{})]})]}),y.jsx("div",{className:"tlui-layout__top__center",children:e}),y.jsxs("div",{className:"tlui-layout__top__right",children:[n,o>=5&&!s&&y.jsx("div",{className:"tlui-style-panel__wrapper",children:y.jsx(UR,{})})]})]}),y.jsxs("div",{className:"tlui-layout__bottom",children:[y.jsxs("div",{className:"tlui-layout__bottom__main",children:[y.jsx(xne,{}),y.jsx(hre,{}),o>=4&&y.jsx(tne,{})]}),l&&y.jsx(Hte,{renderDebugMenuItems:t??null})]})]}),y.jsx(are,{}),y.jsx(Jte,{}),y.jsx(lre,{}),y.jsx(Qte,{})]})})}),JR="ContextMenu",[Are,efe]=ji(JR,[um]),Fi=um(),[jre,QR]=Are(JR),Rre=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:o=!0}=n,[s,a]=S.useState(!1),l=Fi(e),c=vn(r),u=S.useCallback(d=>{a(d),c(d)},[c]);return S.createElement(jre,{scope:e,open:s,onOpenChange:u,modal:o},S.createElement(J3,te({},l,{dir:i,open:s,onOpenChange:u,modal:o}),t))},Ore="ContextMenuTrigger",Dre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,o=QR(Ore,t),s=Fi(t),a=S.useRef({x:0,y:0}),l=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=S.useRef(0),u=S.useCallback(()=>window.clearTimeout(c.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},o.onOpenChange(!0)};return S.useEffect(()=>u,[u]),S.useEffect(()=>void(r&&u()),[r,u]),S.createElement(S.Fragment,null,S.createElement(Q3,te({},s,{virtualRef:l})),S.createElement(qe.span,te({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:ae(n.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:r?n.onPointerDown:ae(n.onPointerDown,mm(h=>{u(),c.current=window.setTimeout(()=>d(h),700)})),onPointerMove:r?n.onPointerMove:ae(n.onPointerMove,mm(u)),onPointerCancel:r?n.onPointerCancel:ae(n.onPointerCancel,mm(u)),onPointerUp:r?n.onPointerUp:ae(n.onPointerUp,mm(u))})))}),Lre=n=>{const{__scopeContextMenu:e,...t}=n,r=Fi(e);return S.createElement(eR,te({},r,t))},zre="ContextMenuContent",Nre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=QR(zre,t),o=Fi(t),s=S.useRef(!1);return S.createElement(tR,te({},o,r,{ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var l;(l=n.onCloseAutoFocus)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{var l;(l=n.onInteractOutside)===null||l===void 0||l.call(n,a),!a.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Fre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Fi(t);return S.createElement(nR,te({},i,r,{ref:e}))}),$re=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Fi(t);return S.createElement(rR,te({},i,r,{ref:e}))}),Bre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Fi(t);return S.createElement(iR,te({},i,r,{ref:e}))}),Ure=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:o}=n,s=Fi(e),[a,l]=ys({prop:i,defaultProp:o,onChange:r});return S.createElement(oR,te({},s,{open:a,onOpenChange:l}),t)},Vre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Fi(t);return S.createElement(sR,te({},i,r,{ref:e}))}),Hre=S.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Fi(t);return S.createElement(aR,te({},i,r,{ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function mm(n){return e=>e.pointerType!=="mouse"?n(e):void 0}const Wre=Rre,Kre=Dre,wS=Lre,Gre=Nre,bS=Fre,vS=$re,Yre=Bre,eO=Ure,tO=Vre,nO=Hre,Xre=ze(function(){const n=Y(),e=pn(),t=n.getPages(),r=n.getCurrentPageId(),i=Me(),{addToast:o}=Di();return y.jsxs(eO,{children:[y.jsx(tO,{dir:"ltr",asChild:!0,children:y.jsx(ce,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),y.jsx(wS,{container:e,children:y.jsxs(nO,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[y.jsx(bS,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:t.map(s=>y.jsx(vS,{disabled:r===s.id,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),s.id);const a=n.getPage(s.id);a&&o({title:"Changed Page",description:`Moved to ${a.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(r)}}]})},asChild:!0,children:y.jsx(ce,{type:"menu",title:s.name,className:"tlui-context-menu__move-to-page__name",children:y.jsx("span",{className:"tlui-button__label",children:s.name})})},s.id))},"pages"),y.jsx(bS,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:y.jsx(vS,{onSelect:()=>{const s=so.createId(),a=n.getSelectedShapeIds();n.batch(()=>{n.mark("move_shapes_to_page"),n.createPage({name:i("page-menu.new-page-initial-name"),id:s}),n.moveShapesToPage(a,s)})},asChild:!0,children:y.jsx(ce,{type:"menu",title:i("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:y.jsx("span",{className:"tlui-button__label",children:i("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),qre=function({children:n}){const e=Y(),t=Zj(),r=S.useCallback(c=>{if(c){if(e.getInstanceState().isCoarsePointer){const u=e.getSelectedShapes(),{inputs:{currentPagePoint:d}}=e,h=e.getShapesAtPoint(d);if(!e.getSelectedShapes().length||!h.some(p=>u.includes(p))){const p=h.filter(g=>e.isShapeOrAncestorLocked(g));p.length&&e.select(...p.map(g=>g.id))}}}else{const u=e.getOnlySelectedShape();u&&e.isShapeOrAncestorLocked(u)&&e.setSelectedShapes([])}},[e]),[i,o]=ya("context menu",r),s=Rr(),a=t.length===0||s&&t.every(c=>!c.readonlyOk),l=!Z("isSelectToolActive",()=>e.getCurrentToolId()==="select",[e])||a;return y.jsxs(Wre,{dir:"ltr",onOpenChange:o,modal:!1,children:[y.jsx(Kre,{onContextMenu:l?Oe:void 0,dir:"ltr",disabled:l,children:n}),i&&y.jsx(Zre,{})]})},Zre=S.forwardRef(function(){const n=Y(),e=Me(),t=Zj(),[r,i]=ya("context menu sub"),o=Rr(),s=Lr(),a=pn(),[l,c]=S.useState(!1);function u(d,h,p,g){if(!h||o&&!h.readonlyOk)return null;switch(h.type){case"custom":{switch(h.id){case"MOVE_TO_PAGE_MENU":return y.jsx(Xre,{},h.id)}break}case"group":return y.jsx(bS,{dir:"ltr",className:we("tlui-menu__group",{"tlui-menu__group__small":(p==null?void 0:p.type)==="submenu"}),"data-testid":`menu-item.${h.id}`,children:h.children.map(f=>u(d,f,h,g+1))},h.id);case"submenu":return y.jsxs(eO,{onOpenChange:i,children:[y.jsx(tO,{dir:"ltr",disabled:h.disabled,asChild:!0,children:y.jsx(ce,{type:"menu",label:h.label,"data-testid":`menu-item.${h.id}`,icon:"chevron-right"})}),y.jsx(wS,{container:a,children:y.jsx(nO,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:h.children.map(f=>u(d,f,h,g+1))})})]},h.id);case"item":{if(o&&!h.readonlyOk)return null;const{id:f,checkbox:m,contextMenuLabel:v,label:b,onSelect:_,kbd:x,icon:C}=h.actionItem,k=v??b,E=k?e(k):void 0;return m?y.jsxs(Yre,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:h.disabled,onSelect:I=>{_("context-menu"),Oe(I)},title:E||void 0,checked:h.checked,children:[y.jsx(fr,{small:!0,icon:h.checked?"check":"checkbox-empty"}),E&&y.jsx("span",{className:"tlui-button__label",draggable:!1,children:E}),x&&y.jsx(Ng,{children:x})]},f):y.jsx(vS,{dir:"ltr",asChild:!0,children:y.jsx(ce,{type:"menu","data-testid":`menu-item.${f}`,kbd:x,label:k,disabled:h.disabled,iconLeft:s<3&&g>2?C:void 0,onClick:()=>{l?c(!1):_("context-menu")}})},f)}}}return y.jsx(wS,{container:a,children:y.jsx(Gre,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:Oe,children:t.map(d=>u(n,d,null,0))})})}),ym=(n,e)=>{const[t,r]=S.useState(2);return S.useEffect(()=>{const{url:i,style:o="normal",weight:s="500",display:a,featureSettings:l,stretch:c,unicodeRange:u,variant:d}=e;let h=!1;r(2);const p={style:o,weight:s,display:a,featureSettings:l,stretch:c,unicodeRange:u,variant:d},g=new FontFace(n,`url(${i})`,p);return g.load().then(()=>{h||(document.fonts.add(g),r(0))}).catch(f=>{h||(console.error(f),r(1))}),g.$$_url=i,g.$$_fontface=`
@font-face {
	font-family: ${g.family};
	font-stretch: ${g.stretch};
	font-weight: ${g.weight};
	font-style: ${g.style};
	src: url("${i}") format("woff2")
}`,()=>{document.fonts.delete(g),h=!0}},[n,e]),t};function Jre(n){return{draw:{url:n.fonts.draw},serif:{url:n.fonts.serif},sansSerif:{url:n.fonts.sansSerif},monospace:{url:n.fonts.monospace}}}function Qre(n){const e=S.useMemo(()=>Jre(n),[n]),t=[ym("tldraw_draw",e.draw),ym("tldraw_serif",e.serif),ym("tldraw_sans",e.sansSerif),ym("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function eie(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,...a}=n,l=D$(a.components??{}),c=uI(a.shapeUtils??[]),u=uI(a.tools??[]),d={initialState:"select",...a,components:S.useMemo(()=>({Scribble:rT,CollaboratorScribble:rT,SelectionForeground:VG,SelectionBackground:BG,Handles:DG,HoveredShapeIndicator:LG,...l}),[l]),shapeUtils:S.useMemo(()=>[...nq,...c],[c]),tools:S.useMemo(()=>[...mq,...DY,...u],[u])},h=sZ(a.assetUrls),{done:p,error:g}=Qre(h);return g?y.jsx(A$,{children:"Could not load assets. Please refresh the page."}):p?y.jsx(E$,{...d,children:y.jsxs(Ire,{...d,children:[y.jsx(qre,{children:y.jsx(ab,{})}),y.jsx(tie,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s}),e]})}):y.jsx(aI,{children:"Loading assets..."})}function tie({maxImageDimension:n=1e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=["image/jpeg","image/png","image/gif","image/svg+xml"],acceptedVideoMimeTypes:r=["video/mp4","video/quicktime"],onMount:i}){const o=Y(),s=nie(a=>{const l=[];return l.push(...rq(a)),xY(a,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r}),l.push(i==null?void 0:i(a)),()=>{l.forEach(c=>c==null?void 0:c())}});return S.useLayoutEffect(()=>{if(o)return s==null?void 0:s(o)},[o,s]),null}function nie(n){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=n}),S.useDebugValue(n),S.useCallback((...t)=>{const r=e.current;return qs(r,"fn does not exist"),r(...t)},[])}Te({tldrawFileFormatVersion:tz,schema:Te({schemaVersion:Lp,storeVersion:Lp,recordVersions:Rw(Se,Te({version:Lp,subTypeVersions:Rw(Se,Lp).optional(),subTypeKey:Se.optional()}))}),records:Mn(Te({id:Se,typeName:Se}).allowUnknownProperties())});class rO{constructor(e){this.shapes=new Map,this.listeners=new Set,this.editor=e}onAdd(e){}onRemove(e){}onMembershipChange(){}onShapeChange(e,t){}add(e){e.forEach(t=>{this.shapes.set(t.id,t)}),this.onAdd(e),this.onMembershipChange(),this.notifyListeners()}remove(e){e.forEach(t=>{this.shapes.delete(t.id)}),this.onRemove(e),this.onMembershipChange(),this.notifyListeners()}clear(){this.remove([...this.shapes.values()])}getShapes(){return this.shapes}get size(){return this.shapes.size}_onShapeChange(e,t){this.shapes.set(t.id,t),this.onShapeChange(e,t),this.notifyListeners()}notifyListeners(){for(const e of this.listeners)e()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}}const iO=S.createContext(void 0),rie=({editor:n,collections:e,children:t})=>{const[r,i]=S.useState(null),o=(l,c)=>{if(r)for(const u of r.values())u.getShapes().has(c.id)&&u._onShapeChange(l,c)},s=l=>{if(r)for(const c of r.values())c.remove([l])};S.useEffect(()=>{if(n){const l=new Map;for(const c of e){const u=new c(n);l.set(u.id,u)}i(l)}},[n,e]),S.useEffect(()=>{n&&r&&(n.store.onAfterChange=(l,c)=>{c.typeName==="shape"&&o(l,c)})},[n,r]),S.useEffect(()=>{n&&r&&(n.store.onAfterDelete=(l,c)=>{l.typeName==="shape"&&s(l)})},[n,r]);const a=S.useMemo(()=>({get:l=>r==null?void 0:r.get(l)}),[r]);return y.jsx(iO.Provider,{value:a,children:r?t:null})},oO=n=>{const e=S.useContext(iO);if(!e)throw new Error("CollectionContext not found.");const t=e.get(n);if(!t)throw new Error(`Collection with id '${n}' not found`);const[r,i]=S.useState(t.size);return S.useEffect(()=>{const o=t.subscribe(()=>{i(t.size)});return i(t.size),o},[t]),{collection:t,size:r}},iie=ze(()=>{const n=Y(),{collection:e,size:t}=oO("physics"),{collection:r,size:i}=oO("graph"),o=()=>{e&&(e.add(n.getSelectedShapes()),n.selectNone())},s=()=>{e&&(e.remove(n.getSelectedShapes()),n.selectNone())},a=()=>{e&&(t===0?e.add(n.getCurrentPageShapes()):e.clear())},l=()=>{e&&n.setHintingShapes([...e.getShapes().values()])},c=()=>{r&&(r.add(n.getSelectedShapes()),n.selectNone())},u=()=>{r&&(r.remove(n.getSelectedShapes()),n.selectNone())},d=()=>{r&&(r.getShapes().size===0?r.add(n.getCurrentPageShapes()):r.clear())},h=()=>{r&&n.setHintingShapes([...r.getShapes().values()])};return S.useEffect(()=>(window.addEventListener("togglePhysicsEvent",a),()=>{window.removeEventListener("togglePhysicsEvent",a)}),[a]),S.useEffect(()=>(window.addEventListener("toggleGraphLayoutEvent",d),()=>{window.removeEventListener("toggleGraphLayoutEvent",d)}),[d]),y.jsx("div",{className:"custom-layout",children:y.jsx("div",{className:"custom-toolbar",children:y.jsxs("div",{children:[y.jsxs("span",{children:[t," in physics"]}),y.jsx("button",{type:"button",title:"Add Selected",className:"custom-button",onClick:o,children:"Add"}),y.jsx("button",{type:"button",title:"Remove Selected",className:"custom-button",onClick:s,children:"Remove"}),y.jsx("button",{type:"button",title:"Highlight Collection",className:"custom-button",onClick:l,children:"\u{1F526}"}),y.jsx("span",{children:"|"}),y.jsx("button",{type:"button",title:"Add Selected",className:"custom-button",onClick:c,children:"Add"}),y.jsx("button",{type:"button",title:"Remove Selected",className:"custom-button",onClick:u,children:"Remove"}),y.jsx("button",{type:"button",title:"Highlight Collection",className:"custom-button",onClick:h,children:"\u{1F526}"}),y.jsxs("div",{children:[i," in graph"]})]})})})}),oie=""+new URL("rapier_wasm2d_bg-b5dc53dc.wasm",import.meta.url).href,sie=async(n={},e)=>{let t;if(e.startsWith("data:")){const r=e.replace(/^data:.*?base64,/,"");let i;if(typeof Buffer=="function"&&typeof Buffer.from=="function")i=Buffer.from(r,"base64");else if(typeof atob=="function"){const o=atob(r);i=new Uint8Array(o.length);for(let s=0;s<o.length;s++)i[s]=o.charCodeAt(s)}else throw new Error("Cannot decode base64-encoded data URL");t=await WebAssembly.instantiate(i,n)}else{const r=await fetch(e),i=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&i.startsWith("application/wasm"))t=await WebAssembly.instantiateStreaming(r,n);else{const o=await r.arrayBuffer();t=await WebAssembly.instantiate(o,n)}}return t.instance.exports},je=new Array(32).fill(void 0);je.push(void 0,null,!0,!1);function $e(n){return je[n]}let Od=je.length;function aie(n){n<36||(je[n]=Od,Od=n)}function wm(n){const e=$e(n);return aie(n),e}function jt(n){Od===je.length&&je.push(je.length+1);const e=Od;return Od=je[e],je[e]=n,e}function ue(n){return n==null}let SS=new Float64Array;function bm(){return SS.byteLength===0&&(SS=new Float64Array(cc.buffer)),SS}let xS=new Int32Array;function ht(){return xS.byteLength===0&&(xS=new Int32Array(cc.buffer)),xS}const lie=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let sO=new lie("utf-8",{ignoreBOM:!0,fatal:!0});sO.decode();let _S=new Uint8Array;function cie(){return _S.byteLength===0&&(_S=new Uint8Array(cc.buffer)),_S}function aO(n,e){return sO.decode(cie().subarray(n,n+e))}function uie(){try{const t=De(-16);Oie(t);var n=ht()[t/4+0],e=ht()[t/4+1];return aO(n,e)}finally{De(16),Rm(n,e)}}function z(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`);return n.ptr}let kS=new Float32Array;function Cs(){return kS.byteLength===0&&(kS=new Float32Array(cc.buffer)),kS}let st=32;function vt(n){if(st==1)throw new Error("out of js stack");return je[--st]=n,st}function lO(n,e){return Cs().subarray(n/4,n/4+e)}let CS=new Uint32Array;function cO(){return CS.byteLength===0&&(CS=new Uint32Array(cc.buffer)),CS}function die(n,e){return cO().subarray(n/4,n/4+e)}let di=0;function wa(n,e){const t=e(n.length*4);return Cs().set(n,t/4),di=n.length,t}function uO(n,e){const t=e(n.length*4);return cO().set(n,t/4),di=n.length,t}function PS(n,e){try{return n.apply(this,e)}catch(t){yde(jt(t))}}const vm=Object.freeze({X:0,0:"X",Y:1,1:"Y",AngX:2,2:"AngX"});class Ps{static __wrap(e){const t=Object.create(Ps.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();$ae(e)}constructor(){const e=Bae();return Ps.__wrap(e)}}class lc{static __wrap(e){const t=Object.create(lc.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();poe(e)}constructor(){const e=foe();return lc.__wrap(e)}}class Dd{static __wrap(e){const t=Object.create(Dd.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ooe(e)}constructor(){const e=soe();return Dd.__wrap(e)}handle(){return aoe(this.ptr)}translationApplied(){const e=$d(this.ptr);return K.__wrap(e)}translationRemaining(){const e=dO(this.ptr);return K.__wrap(e)}toi(){return loe(this.ptr)}worldWitness1(){const e=coe(this.ptr);return K.__wrap(e)}worldWitness2(){const e=uoe(this.ptr);return K.__wrap(e)}worldNormal1(){const e=doe(this.ptr);return K.__wrap(e)}worldNormal2(){const e=hoe(this.ptr);return K.__wrap(e)}}class St{static __wrap(e){const t=Object.create(St.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();qle(e)}coTranslation(e){const t=Uae(this.ptr,e);return K.__wrap(t)}coRotation(e){const t=Vae(this.ptr,e);return Re.__wrap(t)}coSetTranslation(e,t,r){Hae(this.ptr,e,t,r)}coSetTranslationWrtParent(e,t,r){Wae(this.ptr,e,t,r)}coSetRotation(e,t){Kae(this.ptr,e,t)}coSetRotationWrtParent(e,t){Gae(this.ptr,e,t)}coIsSensor(e){return Yae(this.ptr,e)!==0}coShapeType(e){return Xae(this.ptr,e)>>>0}coHalfspaceNormal(e){const t=qae(this.ptr,e);return t===0?void 0:K.__wrap(t)}coHalfExtents(e){const t=Zae(this.ptr,e);return t===0?void 0:K.__wrap(t)}coSetHalfExtents(e,t){z(t,K),Jae(this.ptr,e,t.ptr)}coRadius(e){try{const i=De(-16);Qae(i,this.ptr,e);var t=ht()[i/4+0],r=Cs()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetRadius(e,t){ele(this.ptr,e,t)}coHalfHeight(e){try{const i=De(-16);tle(i,this.ptr,e);var t=ht()[i/4+0],r=Cs()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetHalfHeight(e,t){nle(this.ptr,e,t)}coRoundRadius(e){try{const i=De(-16);rle(i,this.ptr,e);var t=ht()[i/4+0],r=Cs()[i/4+1];return t===0?void 0:r}finally{De(16)}}coSetRoundRadius(e,t){ile(this.ptr,e,t)}coVertices(e){try{const i=De(-16);ole(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=lO(t,r).slice(),Rm(t,r*4)),o}finally{De(16)}}coIndices(e){try{const i=De(-16);sle(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=die(t,r).slice(),Rm(t,r*4)),o}finally{De(16)}}coHeightfieldHeights(e){try{const i=De(-16);ale(i,this.ptr,e);var t=ht()[i/4+0],r=ht()[i/4+1];let o;return t!==0&&(o=lO(t,r).slice(),Rm(t,r*4)),o}finally{De(16)}}coHeightfieldScale(e){const t=lle(this.ptr,e);return t===0?void 0:K.__wrap(t)}coParent(e){try{const i=De(-16);cle(i,this.ptr,e);var t=ht()[i/4+0],r=bm()[i/8+1];return t===0?void 0:r}finally{De(16)}}coSetEnabled(e,t){ule(this.ptr,e,t)}coIsEnabled(e){return dle(this.ptr,e)!==0}coFriction(e){return hle(this.ptr,e)}coRestitution(e){return ple(this.ptr,e)}coDensity(e){return fle(this.ptr,e)}coMass(e){return gle(this.ptr,e)}coVolume(e){return mle(this.ptr,e)}coCollisionGroups(e){return yle(this.ptr,e)>>>0}coSolverGroups(e){return wle(this.ptr,e)>>>0}coActiveHooks(e){return ble(this.ptr,e)>>>0}coActiveCollisionTypes(e){return vle(this.ptr,e)}coActiveEvents(e){return Sle(this.ptr,e)>>>0}coContactForceEventThreshold(e){return xle(this.ptr,e)}coContainsPoint(e,t){return z(t,K),_le(this.ptr,e,t.ptr)!==0}coCastShape(e,t,r,i,o,s,a,l){z(t,K),z(r,xe),z(i,K),z(o,Re),z(s,K);const c=kle(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l);return c===0?void 0:Tm.__wrap(c)}coCastCollider(e,t,r,i,o,s){z(t,K),z(i,K);const a=Cle(this.ptr,e,t.ptr,r,i.ptr,o,s);return a===0?void 0:Mm.__wrap(a)}coIntersectsShape(e,t,r,i){return z(t,xe),z(r,K),z(i,Re),Ple(this.ptr,e,t.ptr,r.ptr,i.ptr)!==0}coContactShape(e,t,r,i,o){z(t,xe),z(r,K),z(i,Re);const s=Ele(this.ptr,e,t.ptr,r.ptr,i.ptr,o);return s===0?void 0:Nd.__wrap(s)}coContactCollider(e,t,r){const i=Ile(this.ptr,e,t,r);return i===0?void 0:Nd.__wrap(i)}coProjectPoint(e,t,r){z(t,K);const i=Mle(this.ptr,e,t.ptr,r);return Cm.__wrap(i)}coIntersectsRay(e,t,r,i){return z(t,K),z(r,K),Tle(this.ptr,e,t.ptr,r.ptr,i)!==0}coCastRay(e,t,r,i,o){return z(t,K),z(r,K),Ale(this.ptr,e,t.ptr,r.ptr,i,o)}coCastRayAndGetNormal(e,t,r,i,o){z(t,K),z(r,K);const s=jle(this.ptr,e,t.ptr,r.ptr,i,o);return s===0?void 0:Em.__wrap(s)}coSetSensor(e,t){Rle(this.ptr,e,t)}coSetRestitution(e,t){Ole(this.ptr,e,t)}coSetFriction(e,t){Dle(this.ptr,e,t)}coFrictionCombineRule(e){return Lle(this.ptr,e)>>>0}coSetFrictionCombineRule(e,t){zle(this.ptr,e,t)}coRestitutionCombineRule(e){return Nle(this.ptr,e)>>>0}coSetRestitutionCombineRule(e,t){Fle(this.ptr,e,t)}coSetCollisionGroups(e,t){$le(this.ptr,e,t)}coSetSolverGroups(e,t){Ble(this.ptr,e,t)}coSetActiveHooks(e,t){Ule(this.ptr,e,t)}coSetActiveEvents(e,t){Vle(this.ptr,e,t)}coSetActiveCollisionTypes(e,t){Hle(this.ptr,e,t)}coSetShape(e,t){z(t,xe),Wle(this.ptr,e,t.ptr)}coSetContactForceEventThreshold(e,t){Kle(this.ptr,e,t)}coSetDensity(e,t){Gle(this.ptr,e,t)}coSetMass(e,t){Yle(this.ptr,e,t)}coSetMassProperties(e,t,r,i){z(r,K),Xle(this.ptr,e,t,r.ptr,i)}constructor(){const e=Zle();return St.__wrap(e)}len(){return Jle(this.ptr)>>>0}contains(e){return gO(this.ptr,e)!==0}createCollider(e,t,r,i,o,s,a,l,c,u,d,h,p,g,f,m,v,b,_,x,C,k,E){try{const A=De(-16);z(t,xe),z(r,K),z(i,Re),z(a,K),z(E,Ct),Qle(A,this.ptr,e,t.ptr,r.ptr,i.ptr,o,s,a.ptr,l,c,u,d,h,p,g,f,m,v,b,_,x,C,k,E.ptr);var I=ht()[A/4+0],T=bm()[A/8+1];return I===0?void 0:T}finally{De(16)}}remove(e,t,r,i){z(t,Ui),z(r,Ct),ece(this.ptr,e,t.ptr,r.ptr,i)}isHandleValid(e){return gO(this.ptr,e)!==0}forEachColliderHandle(e){try{tce(this.ptr,vt(e))}finally{je[st++]=void 0}}}class ES{static __wrap(e){const t=Object.create(ES.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Iue(e)}collider1(){return Bd(this.ptr)}collider2(){return Mue(this.ptr)}total_force(){const e=Ud(this.ptr);return K.__wrap(e)}total_force_magnitude(){return jm(this.ptr)}max_force_direction(){const e=$d(this.ptr);return K.__wrap(e)}max_force_magnitude(){return Tue(this.ptr)}}class IS{static __wrap(e){const t=Object.create(IS.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();cce(e)}normal(){const e=fce(this.ptr);return K.__wrap(e)}local_n1(){const e=gce(this.ptr);return K.__wrap(e)}local_n2(){const e=mce(this.ptr);return K.__wrap(e)}subshape1(){return yce(this.ptr)>>>0}subshape2(){return wce(this.ptr)>>>0}num_contacts(){return bce(this.ptr)>>>0}contact_local_p1(e){const t=vce(this.ptr,e);return t===0?void 0:K.__wrap(t)}contact_local_p2(e){const t=Sce(this.ptr,e);return t===0?void 0:K.__wrap(t)}contact_dist(e){return xce(this.ptr,e)}contact_fid1(e){return _ce(this.ptr,e)>>>0}contact_fid2(e){return kce(this.ptr,e)>>>0}contact_impulse(e){return Cce(this.ptr,e)}contact_tangent_impulse(e){return Pce(this.ptr,e)}num_solver_contacts(){return Ece(this.ptr)>>>0}solver_contact_point(e){const t=Ice(this.ptr,e);return t===0?void 0:K.__wrap(t)}solver_contact_dist(e){return Mce(this.ptr,e)}solver_contact_friction(e){return Tce(this.ptr,e)}solver_contact_restitution(e){return Ace(this.ptr,e)}solver_contact_tangent_velocity(e){const t=jce(this.ptr,e);return K.__wrap(t)}}class MS{static __wrap(e){const t=Object.create(MS.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ude(e)}collider1(){return uce(this.ptr)}collider2(){return dce(this.ptr)}numContactManifolds(){return hce(this.ptr)>>>0}contactManifold(e){const t=pce(this.ptr,e);return t===0?void 0:IS.__wrap(t)}}class Sm{static __wrap(e){const t=Object.create(Sm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();xue(e)}constructor(){const e=_ue();return Sm.__wrap(e)}vertices(){const e=kue(this.ptr);return wm(e)}colors(){const e=Cue(this.ptr);return wm(e)}render(e,t,r,i,o){z(e,Ct),z(t,St),z(r,Bi),z(i,Vi),z(o,Io),Pue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)}}class TS{static __wrap(e){const t=Object.create(TS.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Jue(e)}takeGravity(){const e=Que(this.ptr);return e===0?void 0:K.__wrap(e)}takeIntegrationParameters(){const e=ede(this.ptr);return e===0?void 0:Es.__wrap(e)}takeIslandManager(){const e=tde(this.ptr);return e===0?void 0:Ui.__wrap(e)}takeBroadPhase(){const e=nde(this.ptr);return e===0?void 0:Ps.__wrap(e)}takeNarrowPhase(){const e=rde(this.ptr);return e===0?void 0:Io.__wrap(e)}takeBodies(){const e=ide(this.ptr);return e===0?void 0:Ct.__wrap(e)}takeColliders(){const e=ode(this.ptr);return e===0?void 0:St.__wrap(e)}takeImpulseJoints(){const e=sde(this.ptr);return e===0?void 0:Bi.__wrap(e)}takeMultibodyJoints(){const e=ade(this.ptr);return e===0?void 0:Vi.__wrap(e)}}class Ld{static __wrap(e){const t=Object.create(Ld.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Eue(e)}constructor(e){const t=Aue(e);return Ld.__wrap(t)}drainCollisionEvents(e){try{jue(this.ptr,vt(e))}finally{je[st++]=void 0}}drainContactForceEvents(e){try{Rue(this.ptr,vt(e))}finally{je[st++]=void 0}}clear(){Oue(this.ptr)}}class $i{static __wrap(e){const t=Object.create($i.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();ose(e)}static prismatic(e,t,r,i,o,s){z(e,K),z(t,K),z(r,K);const a=sse(e.ptr,t.ptr,r.ptr,i,o,s);return a===0?void 0:$i.__wrap(a)}static fixed(e,t,r,i){z(e,K),z(t,Re),z(r,K),z(i,Re);const o=ase(e.ptr,t.ptr,r.ptr,i.ptr);return $i.__wrap(o)}static revolute(e,t){z(e,K),z(t,K);const r=lse(e.ptr,t.ptr);return r===0?void 0:$i.__wrap(r)}}class Bi{static __wrap(e){const t=Object.create(Bi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Ooe(e)}jointType(e){return goe(this.ptr,e)>>>0}jointBodyHandle1(e){return moe(this.ptr,e)}jointBodyHandle2(e){return yoe(this.ptr,e)}jointFrameX1(e){const t=woe(this.ptr,e);return Re.__wrap(t)}jointFrameX2(e){const t=boe(this.ptr,e);return Re.__wrap(t)}jointAnchor1(e){const t=voe(this.ptr,e);return K.__wrap(t)}jointAnchor2(e){const t=Soe(this.ptr,e);return K.__wrap(t)}jointSetAnchor1(e,t){z(t,K),xoe(this.ptr,e,t.ptr)}jointSetAnchor2(e,t){z(t,K),_oe(this.ptr,e,t.ptr)}jointContactsEnabled(e){return koe(this.ptr,e)!==0}jointSetContactsEnabled(e,t){Coe(this.ptr,e,t)}jointLimitsEnabled(e,t){return Poe(this.ptr,e,t)!==0}jointLimitsMin(e,t){return Eoe(this.ptr,e,t)}jointLimitsMax(e,t){return Ioe(this.ptr,e,t)}jointSetLimits(e,t,r,i){Moe(this.ptr,e,t,r,i)}jointConfigureMotorModel(e,t,r){Toe(this.ptr,e,t,r)}jointConfigureMotorVelocity(e,t,r,i){Aoe(this.ptr,e,t,r,i)}jointConfigureMotorPosition(e,t,r,i,o){joe(this.ptr,e,t,r,i,o)}jointConfigureMotor(e,t,r,i,o,s){Roe(this.ptr,e,t,r,i,o,s)}constructor(){const e=Doe();return Bi.__wrap(e)}createJoint(e,t,r,i){return z(e,$i),Loe(this.ptr,e.ptr,t,r,i)}remove(e,t){zoe(this.ptr,e,t)}len(){return Noe(this.ptr)>>>0}contains(e){return Foe(this.ptr,e)!==0}forEachJointHandle(e){try{$oe(this.ptr,vt(e))}finally{je[st++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{Boe(this.ptr,e,vt(t))}finally{je[st++]=void 0}}}class Es{static __wrap(e){const t=Object.create(Es.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Uoe(e)}constructor(){const e=Voe();return Es.__wrap(e)}get dt(){return jS(this.ptr)}get erp(){return hO(this.ptr)}get allowedLinearError(){return RS(this.ptr)}get predictionDistance(){return jm(this.ptr)}get maxVelocityIterations(){return Hoe(this.ptr)>>>0}get maxVelocityFrictionIterations(){return Woe(this.ptr)>>>0}get maxStabilizationIterations(){return Koe(this.ptr)>>>0}get minIslandSize(){return Goe(this.ptr)>>>0}get maxCcdSubsteps(){return Yoe(this.ptr)>>>0}set dt(e){pO(this.ptr,e)}set erp(e){Xoe(this.ptr,e)}set allowedLinearError(e){fO(this.ptr,e)}set predictionDistance(e){qoe(this.ptr,e)}set maxVelocityIterations(e){Zoe(this.ptr,e)}set maxVelocityFrictionIterations(e){Joe(this.ptr,e)}set maxStabilizationIterations(e){Qoe(this.ptr,e)}set minIslandSize(e){ese(this.ptr,e)}set maxCcdSubsteps(e){tse(this.ptr,e)}}class Ui{static __wrap(e){const t=Object.create(Ui.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();nse(e)}constructor(){const e=rse();return Ui.__wrap(e)}forEachActiveRigidBodyHandle(e){try{ise(this.ptr,vt(e))}finally{je[st++]=void 0}}}class xm{static __wrap(e){const t=Object.create(xm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Die(e)}constructor(e){const t=Lie(e);return xm.__wrap(t)}up(){const e=Fd(this.ptr);return K.__wrap(e)}setUp(e){z(e,K),zie(this.ptr,e.ptr)}offset(){return Nie(this.ptr)}setOffset(e){Fie(this.ptr,e)}slideEnabled(){return $ie(this.ptr)!==0}setSlideEnabled(e){Bie(this.ptr,e)}autostepMaxHeight(){try{const r=De(-16);Uie(r,this.ptr);var e=ht()[r/4+0],t=Cs()[r/4+1];return e===0?void 0:t}finally{De(16)}}autostepMinWidth(){try{const r=De(-16);Vie(r,this.ptr);var e=ht()[r/4+0],t=Cs()[r/4+1];return e===0?void 0:t}finally{De(16)}}autostepIncludesDynamicBodies(){const e=Hie(this.ptr);return e===16777215?void 0:e!==0}autostepEnabled(){return Wie(this.ptr)!==0}enableAutostep(e,t,r){Kie(this.ptr,e,t,r)}disableAutostep(){Gie(this.ptr)}maxSlopeClimbAngle(){return RS(this.ptr)}setMaxSlopeClimbAngle(e){fO(this.ptr,e)}minSlopeSlideAngle(){return Yie(this.ptr)}setMinSlopeSlideAngle(e){Xie(this.ptr,e)}snapToGroundDistance(){try{const r=De(-16);qie(r,this.ptr);var e=ht()[r/4+0],t=Cs()[r/4+1];return e===0?void 0:t}finally{De(16)}}enableSnapToGround(e){Zie(this.ptr,e)}disableSnapToGround(){Jie(this.ptr)}snapToGroundEnabled(){return Qie(this.ptr)!==0}computeColliderMovement(e,t,r,i,o,s,a,l,c,u,d){try{z(t,Ct),z(r,St),z(i,zd),z(s,K),eoe(this.ptr,e,t.ptr,r.ptr,i.ptr,o,s.ptr,a,!ue(l),ue(l)?0:l,c,!ue(u),ue(u)?0:u,vt(d))}finally{je[st++]=void 0}}computedMovement(){const e=toe(this.ptr);return K.__wrap(e)}computedGrounded(){return noe(this.ptr)!==0}numComputedCollisions(){return roe(this.ptr)>>>0}computedCollision(e,t){return z(t,Dd),ioe(this.ptr,e,t.ptr)!==0}}class Vi{static __wrap(e){const t=Object.create(Vi.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();bse(e)}jointType(e){return cse(this.ptr,e)>>>0}jointFrameX1(e){const t=use(this.ptr,e);return Re.__wrap(t)}jointFrameX2(e){const t=dse(this.ptr,e);return Re.__wrap(t)}jointAnchor1(e){const t=hse(this.ptr,e);return K.__wrap(t)}jointAnchor2(e){const t=pse(this.ptr,e);return K.__wrap(t)}jointContactsEnabled(e){return fse(this.ptr,e)!==0}jointSetContactsEnabled(e,t){gse(this.ptr,e,t)}jointLimitsEnabled(e,t){return mse(this.ptr,e,t)!==0}jointLimitsMin(e,t){return yse(this.ptr,e,t)}jointLimitsMax(e,t){return wse(this.ptr,e,t)}constructor(){const e=vse();return Vi.__wrap(e)}createJoint(e,t,r,i){return z(e,$i),Sse(this.ptr,e.ptr,t,r,i)}remove(e,t){xse(this.ptr,e,t)}contains(e){return _se(this.ptr,e)!==0}forEachJointHandle(e){try{kse(this.ptr,vt(e))}finally{je[st++]=void 0}}forEachJointAttachedToRigidBody(e,t){try{Cse(this.ptr,e,vt(t))}finally{je[st++]=void 0}}}class Io{static __wrap(e){const t=Object.create(Io.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();rce(e)}constructor(){const e=ice();return Io.__wrap(e)}contacts_with(e,t){oce(this.ptr,e,jt(t))}contact_pair(e,t){const r=sce(this.ptr,e,t);return r===0?void 0:MS.__wrap(r)}intersections_with(e,t){ace(this.ptr,e,jt(t))}intersection_pair(e,t){return lce(this.ptr,e,t)!==0}}class _m{static __wrap(e){const t=Object.create(_m.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Due(e)}constructor(){const e=Lue();return _m.__wrap(e)}step(e,t,r,i,o,s,a,l,c,u){z(e,K),z(t,Es),z(r,Ui),z(i,Ps),z(o,Io),z(s,Ct),z(a,St),z(l,Bi),z(c,Vi),z(u,lc),zue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,u.ptr)}stepWithEvents(e,t,r,i,o,s,a,l,c,u,d,h,p,g){z(e,K),z(t,Es),z(r,Ui),z(i,Ps),z(o,Io),z(s,Ct),z(a,St),z(l,Bi),z(c,Vi),z(u,lc),z(d,Ld),Nue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr,u.ptr,d.ptr,jt(h),jt(p),jt(g))}}class km{static __wrap(e){const t=Object.create(km.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Dce(e)}colliderHandle(){return Bd(this.ptr)}point(){const e=Ud(this.ptr);return K.__wrap(e)}isInside(){return Lce(this.ptr)!==0}featureType(){return mO(this.ptr)>>>0}featureId(){try{const r=De(-16);yO(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class Cm{static __wrap(e){const t=Object.create(Cm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Rce(e)}point(){const e=Fd(this.ptr);return K.__wrap(e)}isInside(){return Oce(this.ptr)!==0}}class zd{static __wrap(e){const t=Object.create(zd.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Fue(e)}constructor(){const e=$ue();return zd.__wrap(e)}update(e,t){z(e,Ct),z(t,St),Bue(this.ptr,e.ptr,t.ptr)}castRay(e,t,r,i,o,s,a,l,c,u,d){try{z(e,Ct),z(t,St),z(r,K),z(i,K);const h=Uue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ue(l),ue(l)?0:l,!ue(c),ue(c)?0:c,!ue(u),ue(u)?0:u,vt(d));return h===0?void 0:AS.__wrap(h)}finally{je[st++]=void 0}}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,u,d){try{z(e,Ct),z(t,St),z(r,K),z(i,K);const h=Vue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,a,!ue(l),ue(l)?0:l,!ue(c),ue(c)?0:c,!ue(u),ue(u)?0:u,vt(d));return h===0?void 0:Pm.__wrap(h)}finally{je[st++]=void 0}}intersectionsWithRay(e,t,r,i,o,s,a,l,c,u,d,h){try{z(e,Ct),z(t,St),z(r,K),z(i,K),Hue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s,vt(a),l,!ue(c),ue(c)?0:c,!ue(u),ue(u)?0:u,!ue(d),ue(d)?0:d,vt(h))}finally{je[st++]=void 0,je[st++]=void 0}}intersectionWithShape(e,t,r,i,o,s,a,l,c,u){try{const p=De(-16);z(e,Ct),z(t,St),z(r,K),z(i,Re),z(o,xe),Wue(p,this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s,!ue(a),ue(a)?0:a,!ue(l),ue(l)?0:l,!ue(c),ue(c)?0:c,vt(u));var d=ht()[p/4+0],h=bm()[p/8+1];return d===0?void 0:h}finally{De(16),je[st++]=void 0}}projectPoint(e,t,r,i,o,s,a,l,c){try{z(e,Ct),z(t,St),z(r,K);const u=Kue(this.ptr,e.ptr,t.ptr,r.ptr,i,o,!ue(s),ue(s)?0:s,!ue(a),ue(a)?0:a,!ue(l),ue(l)?0:l,vt(c));return u===0?void 0:km.__wrap(u)}finally{je[st++]=void 0}}projectPointAndGetFeature(e,t,r,i,o,s,a,l){try{z(e,Ct),z(t,St),z(r,K);const c=Gue(this.ptr,e.ptr,t.ptr,r.ptr,i,!ue(o),ue(o)?0:o,!ue(s),ue(s)?0:s,!ue(a),ue(a)?0:a,vt(l));return c===0?void 0:km.__wrap(c)}finally{je[st++]=void 0}}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){try{z(e,Ct),z(t,St),z(r,K),Yue(this.ptr,e.ptr,t.ptr,r.ptr,vt(i),o,!ue(s),ue(s)?0:s,!ue(a),ue(a)?0:a,!ue(l),ue(l)?0:l,vt(c))}finally{je[st++]=void 0,je[st++]=void 0}}castShape(e,t,r,i,o,s,a,l,c,u,d,h,p){try{z(e,Ct),z(t,St),z(r,K),z(i,Re),z(o,K),z(s,xe);const g=Xue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a,l,c,!ue(u),ue(u)?0:u,!ue(d),ue(d)?0:d,!ue(h),ue(h)?0:h,vt(p));return g===0?void 0:Mm.__wrap(g)}finally{je[st++]=void 0}}intersectionsWithShape(e,t,r,i,o,s,a,l,c,u,d){try{z(e,Ct),z(t,St),z(r,K),z(i,Re),z(o,xe),que(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,vt(s),a,!ue(l),ue(l)?0:l,!ue(c),ue(c)?0:c,!ue(u),ue(u)?0:u,vt(d))}finally{je[st++]=void 0,je[st++]=void 0}}collidersWithAabbIntersectingAabb(e,t,r){try{z(e,K),z(t,K),Zue(this.ptr,e.ptr,t.ptr,vt(r))}finally{je[st++]=void 0}}}class Pm{static __wrap(e){const t=Object.create(Pm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();dde(e)}colliderHandle(){return Bd(this.ptr)}normal(){const e=Am(this.ptr);return K.__wrap(e)}toi(){return RS(this.ptr)}featureType(){return Fce(this.ptr)>>>0}featureId(){try{const r=De(-16);$ce(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class AS{static __wrap(e){const t=Object.create(AS.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();hde(e)}colliderHandle(){return Bd(this.ptr)}toi(){return hO(this.ptr)}}class Em{static __wrap(e){const t=Object.create(Em.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();zce(e)}normal(){const e=Fd(this.ptr);return K.__wrap(e)}toi(){return Nce(this.ptr)}featureType(){return mO(this.ptr)>>>0}featureId(){try{const r=De(-16);yO(r,this.ptr);var e=ht()[r/4+0],t=ht()[r/4+1];return e===0?void 0:t>>>0}finally{De(16)}}}class Ct{static __wrap(e){const t=Object.create(Ct.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();jae(e)}rbTranslation(e){const t=Pse(this.ptr,e);return K.__wrap(t)}rbRotation(e){const t=Ese(this.ptr,e);return Re.__wrap(t)}rbSleep(e){Ise(this.ptr,e)}rbIsSleeping(e){return Mse(this.ptr,e)!==0}rbIsMoving(e){return Tse(this.ptr,e)!==0}rbNextTranslation(e){const t=Ase(this.ptr,e);return K.__wrap(t)}rbNextRotation(e){const t=jse(this.ptr,e);return Re.__wrap(t)}rbSetTranslation(e,t,r,i){Rse(this.ptr,e,t,r,i)}rbSetRotation(e,t,r){Ose(this.ptr,e,t,r)}rbSetLinvel(e,t,r){z(t,K),Dse(this.ptr,e,t.ptr,r)}rbSetAngvel(e,t,r){Lse(this.ptr,e,t,r)}rbSetNextKinematicTranslation(e,t,r){zse(this.ptr,e,t,r)}rbSetNextKinematicRotation(e,t){Nse(this.ptr,e,t)}rbRecomputeMassPropertiesFromColliders(e,t){z(t,St),Fse(this.ptr,e,t.ptr)}rbSetAdditionalMass(e,t,r){$se(this.ptr,e,t,r)}rbSetAdditionalMassProperties(e,t,r,i,o){z(r,K),Bse(this.ptr,e,t,r.ptr,i,o)}rbLinvel(e){const t=Use(this.ptr,e);return K.__wrap(t)}rbAngvel(e){return Vse(this.ptr,e)}rbLockTranslations(e,t,r){Hse(this.ptr,e,t,r)}rbSetEnabledTranslations(e,t,r,i){Wse(this.ptr,e,t,r,i)}rbLockRotations(e,t,r){Kse(this.ptr,e,t,r)}rbDominanceGroup(e){return Gse(this.ptr,e)}rbSetDominanceGroup(e,t){Yse(this.ptr,e,t)}rbEnableCcd(e,t){Xse(this.ptr,e,t)}rbMass(e){return qse(this.ptr,e)}rbInvMass(e){return Zse(this.ptr,e)}rbEffectiveInvMass(e){const t=Jse(this.ptr,e);return K.__wrap(t)}rbLocalCom(e){const t=Qse(this.ptr,e);return K.__wrap(t)}rbWorldCom(e){const t=eae(this.ptr,e);return K.__wrap(t)}rbInvPrincipalInertiaSqrt(e){return tae(this.ptr,e)}rbPrincipalInertia(e){return nae(this.ptr,e)}rbEffectiveWorldInvInertiaSqrt(e){return rae(this.ptr,e)}rbEffectiveAngularInertia(e){return iae(this.ptr,e)}rbWakeUp(e){oae(this.ptr,e)}rbIsCcdEnabled(e){return sae(this.ptr,e)!==0}rbNumColliders(e){return aae(this.ptr,e)>>>0}rbCollider(e,t){return lae(this.ptr,e,t)}rbBodyType(e){return cae(this.ptr,e)>>>0}rbSetBodyType(e,t,r){uae(this.ptr,e,t,r)}rbIsFixed(e){return dae(this.ptr,e)!==0}rbIsKinematic(e){return hae(this.ptr,e)!==0}rbIsDynamic(e){return pae(this.ptr,e)!==0}rbLinearDamping(e){return fae(this.ptr,e)}rbAngularDamping(e){return gae(this.ptr,e)}rbSetLinearDamping(e,t){mae(this.ptr,e,t)}rbSetAngularDamping(e,t){yae(this.ptr,e,t)}rbSetEnabled(e,t){wae(this.ptr,e,t)}rbIsEnabled(e){return bae(this.ptr,e)!==0}rbGravityScale(e){return vae(this.ptr,e)}rbSetGravityScale(e,t,r){Sae(this.ptr,e,t,r)}rbResetForces(e,t){xae(this.ptr,e,t)}rbResetTorques(e,t){_ae(this.ptr,e,t)}rbAddForce(e,t,r){z(t,K),kae(this.ptr,e,t.ptr,r)}rbApplyImpulse(e,t,r){z(t,K),Cae(this.ptr,e,t.ptr,r)}rbAddTorque(e,t,r){Pae(this.ptr,e,t,r)}rbApplyTorqueImpulse(e,t,r){Eae(this.ptr,e,t,r)}rbAddForceAtPoint(e,t,r,i){z(t,K),z(r,K),Iae(this.ptr,e,t.ptr,r.ptr,i)}rbApplyImpulseAtPoint(e,t,r,i){z(t,K),z(r,K),Mae(this.ptr,e,t.ptr,r.ptr,i)}rbUserData(e){return Tae(this.ptr,e)>>>0}rbSetUserData(e,t){Aae(this.ptr,e,t)}constructor(){const e=Rae();return Ct.__wrap(e)}createRigidBody(e,t,r,i,o,s,a,l,c,u,d,h,p,g,f,m,v,b,_,x){return z(t,K),z(r,Re),z(a,K),z(l,K),Oae(this.ptr,e,t.ptr,r.ptr,i,o,s,a.ptr,l.ptr,c,u,d,h,p,g,f,m,v,b,_,x)}remove(e,t,r,i,o){z(t,Ui),z(r,St),z(i,Bi),z(o,Vi),Dae(this.ptr,e,t.ptr,r.ptr,i.ptr,o.ptr)}len(){return Lae(this.ptr)>>>0}contains(e){return zae(this.ptr,e)!==0}forEachRigidBodyHandle(e){try{Nae(this.ptr,vt(e))}finally{je[st++]=void 0}}propagateModifiedBodyPositionsToColliders(e){z(e,St),Fae(this.ptr,e.ptr)}}class Re{static __wrap(e){const t=Object.create(Re.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();pue(e)}static identity(){const e=fue();return Re.__wrap(e)}static fromAngle(e){const t=gue(e);return Re.__wrap(t)}get im(){return wO(this.ptr)}get re(){return jS(this.ptr)}get angle(){return mue(this.ptr)}}class Im{static __wrap(e){const t=Object.create(Im.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();mde(e)}constructor(){const e=gde();return Im.__wrap(e)}serializeAll(e,t,r,i,o,s,a,l,c){z(e,K),z(t,Es),z(r,Ui),z(i,Ps),z(o,Io),z(s,Ct),z(a,St),z(l,Bi),z(c,Vi);const u=lde(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l.ptr,c.ptr);return wm(u)}deserializeAll(e){const t=cde(this.ptr,jt(e));return t===0?void 0:TS.__wrap(t)}}class xe{static __wrap(e){const t=Object.create(xe.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();Bce(e)}static cuboid(e,t){const r=Uce(e,t);return xe.__wrap(r)}static roundCuboid(e,t,r){const i=Vce(e,t,r);return xe.__wrap(i)}static ball(e){const t=Hce(e);return xe.__wrap(t)}static halfspace(e){z(e,K);const t=Wce(e.ptr);return xe.__wrap(t)}static capsule(e,t){const r=Kce(e,t);return xe.__wrap(r)}static polyline(e,t){const r=wa(e,Mo),i=di,o=uO(t,Mo),s=Gce(r,i,o,di);return xe.__wrap(s)}static trimesh(e,t){const r=wa(e,Mo),i=di,o=uO(t,Mo),s=Yce(r,i,o,di);return xe.__wrap(s)}static heightfield(e,t){const r=wa(e,Mo),i=di;z(t,K);const o=Xce(r,i,t.ptr);return xe.__wrap(o)}static segment(e,t){z(e,K),z(t,K);const r=qce(e.ptr,t.ptr);return xe.__wrap(r)}static triangle(e,t,r){z(e,K),z(t,K),z(r,K);const i=Zce(e.ptr,t.ptr,r.ptr);return xe.__wrap(i)}static roundTriangle(e,t,r,i){z(e,K),z(t,K),z(r,K);const o=Jce(e.ptr,t.ptr,r.ptr,i);return xe.__wrap(o)}static convexHull(e){const t=wa(e,Mo),r=Qce(t,di);return r===0?void 0:xe.__wrap(r)}static roundConvexHull(e,t){const r=wa(e,Mo),i=eue(r,di,t);return i===0?void 0:xe.__wrap(i)}static convexPolyline(e){const t=wa(e,Mo),r=tue(t,di);return r===0?void 0:xe.__wrap(r)}static roundConvexPolyline(e,t){const r=wa(e,Mo),i=nue(r,di,t);return i===0?void 0:xe.__wrap(i)}castShape(e,t,r,i,o,s,a,l,c){z(e,K),z(t,Re),z(r,K),z(i,xe),z(o,K),z(s,Re),z(a,K);const u=rue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s.ptr,a.ptr,l,c);return u===0?void 0:Tm.__wrap(u)}intersectsShape(e,t,r,i,o){return z(e,K),z(t,Re),z(r,xe),z(i,K),z(o,Re),iue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr)!==0}contactShape(e,t,r,i,o,s){z(e,K),z(t,Re),z(r,xe),z(i,K),z(o,Re);const a=oue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o.ptr,s);return a===0?void 0:Nd.__wrap(a)}containsPoint(e,t,r){return z(e,K),z(t,Re),z(r,K),sue(this.ptr,e.ptr,t.ptr,r.ptr)!==0}projectPoint(e,t,r,i){z(e,K),z(t,Re),z(r,K);const o=aue(this.ptr,e.ptr,t.ptr,r.ptr,i);return Cm.__wrap(o)}intersectsRay(e,t,r,i,o){return z(e,K),z(t,Re),z(r,K),z(i,K),lue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o)!==0}castRay(e,t,r,i,o,s){return z(e,K),z(t,Re),z(r,K),z(i,K),cue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s)}castRayAndGetNormal(e,t,r,i,o,s){z(e,K),z(t,Re),z(r,K),z(i,K);const a=uue(this.ptr,e.ptr,t.ptr,r.ptr,i.ptr,o,s);return a===0?void 0:Em.__wrap(a)}}class Mm{static __wrap(e){const t=Object.create(Mm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();due(e)}colliderHandle(){return Bd(this.ptr)}toi(){return hue(this.ptr)}witness1(){const e=Am(this.ptr);return K.__wrap(e)}witness2(){const e=Ud(this.ptr);return K.__wrap(e)}normal1(){const e=$d(this.ptr);return K.__wrap(e)}normal2(){const e=dO(this.ptr);return K.__wrap(e)}}class Nd{static __wrap(e){const t=Object.create(Nd.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();nce(e)}distance(){return jm(this.ptr)}point1(){const e=Fd(this.ptr);return K.__wrap(e)}point2(){const e=Am(this.ptr);return K.__wrap(e)}normal1(){const e=Ud(this.ptr);return K.__wrap(e)}normal2(){const e=$d(this.ptr);return K.__wrap(e)}}class Tm{static __wrap(e){const t=Object.create(Tm.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();fde(e)}toi(){return jm(this.ptr)}witness1(){const e=Fd(this.ptr);return K.__wrap(e)}witness2(){const e=Am(this.ptr);return K.__wrap(e)}normal1(){const e=Ud(this.ptr);return K.__wrap(e)}normal2(){const e=$d(this.ptr);return K.__wrap(e)}}class K{static __wrap(e){const t=Object.create(K.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();pde(e)}static zero(){const e=yue();return K.__wrap(e)}constructor(e,t){const r=wue(e,t);return K.__wrap(r)}get x(){return jS(this.ptr)}set x(e){pO(this.ptr,e)}get y(){return wO(this.ptr)}set y(e){bue(this.ptr,e)}xy(){const e=vue(this.ptr);return K.__wrap(e)}yx(){const e=Sue(this.ptr);return K.__wrap(e)}}function hie(n){wm(n)}function pie(n){return jt(n)}function fie(n,e){const t=$e(e),r=typeof t=="number"?t:void 0;bm()[n/8+1]=ue(r)?0:r,ht()[n/4+0]=!ue(r)}function gie(n){const e=$e(n);return typeof e=="boolean"?e?1:0:2}function mie(n){return typeof $e(n)=="function"}function yie(n){const e=Pm.__wrap(n);return jt(e)}function wie(n){const e=ES.__wrap(n);return jt(e)}function bie(){return PS(function(n,e,t){const r=$e(n).call($e(e),$e(t));return jt(r)},arguments)}function vie(){return PS(function(n,e,t,r){const i=$e(n).call($e(e),$e(t),$e(r));return jt(i)},arguments)}function Sie(){return PS(function(n,e,t,r,i){const o=$e(n).call($e(e),$e(t),$e(r),$e(i));return jt(o)},arguments)}function xie(n,e,t,r){const i=$e(n).bind($e(e),$e(t),$e(r));return jt(i)}function _ie(n){const e=$e(n).buffer;return jt(e)}function kie(n,e,t){const r=new Uint8Array($e(n),e>>>0,t>>>0);return jt(r)}function Cie(n){const e=new Uint8Array($e(n));return jt(e)}function Pie(n,e,t){$e(n).set($e(e),t>>>0)}function Eie(n){return $e(n).length}function Iie(n,e,t){const r=new Float32Array($e(n),e>>>0,t>>>0);return jt(r)}function Mie(n,e,t){$e(n).set($e(e),t>>>0)}function Tie(n){return $e(n).length}function Aie(n){const e=new Float32Array(n>>>0);return jt(e)}function jie(n,e){throw new Error(aO(n,e))}function Rie(){return jt(cc)}URL=globalThis.URL;const M=await sie({"./rapier_wasm2d_bg.js":{__wbindgen_object_drop_ref:hie,__wbindgen_number_new:pie,__wbindgen_number_get:fie,__wbindgen_boolean_get:gie,__wbindgen_is_function:mie,__wbg_rawraycolliderintersection_new:yie,__wbg_rawcontactforceevent_new:wie,__wbg_call_168da88779e35f61:bie,__wbg_call_3999bee59e9f7719:vie,__wbg_call_e1f72c051cdab859:Sie,__wbg_bind_10dfe70e95d2a480:xie,__wbg_buffer_3f3d764d4747d564:_ie,__wbg_newwithbyteoffsetandlength_d9aa266703cb98be:kie,__wbg_new_8c3f0052272a457a:Cie,__wbg_set_83db9690f9353e79:Pie,__wbg_length_9e1ae1900cb0fbd5:Eie,__wbg_newwithbyteoffsetandlength_be22e5fcf4f69ab4:Iie,__wbg_set_0e0314cf6675c1b9:Mie,__wbg_length_9a2deed95d22668d:Tie,__wbg_newwithlength_a7168e4a1e8f5e12:Aie,__wbindgen_throw:jie,__wbindgen_memory:Rie}},oie),cc=M.memory,Oie=M.version,Die=M.__wbg_rawkinematiccharactercontroller_free,Lie=M.rawkinematiccharactercontroller_new,Fd=M.rawkinematiccharactercontroller_up,zie=M.rawkinematiccharactercontroller_setUp,Nie=M.rawkinematiccharactercontroller_offset,Fie=M.rawkinematiccharactercontroller_setOffset,$ie=M.rawkinematiccharactercontroller_slideEnabled,Bie=M.rawkinematiccharactercontroller_setSlideEnabled,Uie=M.rawkinematiccharactercontroller_autostepMaxHeight,Vie=M.rawkinematiccharactercontroller_autostepMinWidth,Hie=M.rawkinematiccharactercontroller_autostepIncludesDynamicBodies,Wie=M.rawkinematiccharactercontroller_autostepEnabled,Kie=M.rawkinematiccharactercontroller_enableAutostep,Gie=M.rawkinematiccharactercontroller_disableAutostep,Yie=M.rawkinematiccharactercontroller_minSlopeSlideAngle,Xie=M.rawkinematiccharactercontroller_setMinSlopeSlideAngle,qie=M.rawkinematiccharactercontroller_snapToGroundDistance,Zie=M.rawkinematiccharactercontroller_enableSnapToGround,Jie=M.rawkinematiccharactercontroller_disableSnapToGround,Qie=M.rawkinematiccharactercontroller_snapToGroundEnabled,eoe=M.rawkinematiccharactercontroller_computeColliderMovement,toe=M.rawkinematiccharactercontroller_computedMovement,noe=M.rawkinematiccharactercontroller_computedGrounded,roe=M.rawkinematiccharactercontroller_numComputedCollisions,ioe=M.rawkinematiccharactercontroller_computedCollision,ooe=M.__wbg_rawcharactercollision_free,soe=M.rawcharactercollision_new,aoe=M.rawcharactercollision_handle,$d=M.rawcharactercollision_translationApplied,dO=M.rawcharactercollision_translationRemaining,loe=M.rawcharactercollision_toi,coe=M.rawcharactercollision_worldWitness1,uoe=M.rawcharactercollision_worldWitness2,doe=M.rawcharactercollision_worldNormal1,hoe=M.rawcharactercollision_worldNormal2,poe=M.__wbg_rawccdsolver_free,foe=M.rawccdsolver_new,goe=M.rawimpulsejointset_jointType,moe=M.rawimpulsejointset_jointBodyHandle1,yoe=M.rawimpulsejointset_jointBodyHandle2,woe=M.rawimpulsejointset_jointFrameX1,boe=M.rawimpulsejointset_jointFrameX2,voe=M.rawimpulsejointset_jointAnchor1,Soe=M.rawimpulsejointset_jointAnchor2,xoe=M.rawimpulsejointset_jointSetAnchor1,_oe=M.rawimpulsejointset_jointSetAnchor2,koe=M.rawimpulsejointset_jointContactsEnabled,Coe=M.rawimpulsejointset_jointSetContactsEnabled,Poe=M.rawimpulsejointset_jointLimitsEnabled,Eoe=M.rawimpulsejointset_jointLimitsMin,Ioe=M.rawimpulsejointset_jointLimitsMax,Moe=M.rawimpulsejointset_jointSetLimits,Toe=M.rawimpulsejointset_jointConfigureMotorModel,Aoe=M.rawimpulsejointset_jointConfigureMotorVelocity,joe=M.rawimpulsejointset_jointConfigureMotorPosition,Roe=M.rawimpulsejointset_jointConfigureMotor,Ooe=M.__wbg_rawimpulsejointset_free,Doe=M.rawimpulsejointset_new,Loe=M.rawimpulsejointset_createJoint,zoe=M.rawimpulsejointset_remove,Noe=M.rawimpulsejointset_len,Foe=M.rawimpulsejointset_contains,$oe=M.rawimpulsejointset_forEachJointHandle,Boe=M.rawimpulsejointset_forEachJointAttachedToRigidBody,Uoe=M.__wbg_rawintegrationparameters_free,Voe=M.rawintegrationparameters_new,jS=M.rawintegrationparameters_dt,hO=M.rawintegrationparameters_erp,RS=M.rawintegrationparameters_allowedLinearError,Hoe=M.rawintegrationparameters_maxVelocityIterations,Woe=M.rawintegrationparameters_maxVelocityFrictionIterations,Koe=M.rawintegrationparameters_maxStabilizationIterations,Goe=M.rawintegrationparameters_minIslandSize,Yoe=M.rawintegrationparameters_maxCcdSubsteps,pO=M.rawintegrationparameters_set_dt,Xoe=M.rawintegrationparameters_set_erp,fO=M.rawintegrationparameters_set_allowedLinearError,qoe=M.rawintegrationparameters_set_predictionDistance,Zoe=M.rawintegrationparameters_set_maxVelocityIterations,Joe=M.rawintegrationparameters_set_maxVelocityFrictionIterations,Qoe=M.rawintegrationparameters_set_maxStabilizationIterations,ese=M.rawintegrationparameters_set_minIslandSize,tse=M.rawintegrationparameters_set_maxCcdSubsteps,nse=M.__wbg_rawislandmanager_free,rse=M.rawislandmanager_new,ise=M.rawislandmanager_forEachActiveRigidBodyHandle,ose=M.__wbg_rawgenericjoint_free,sse=M.rawgenericjoint_prismatic,ase=M.rawgenericjoint_fixed,lse=M.rawgenericjoint_revolute,cse=M.rawmultibodyjointset_jointType,use=M.rawmultibodyjointset_jointFrameX1,dse=M.rawmultibodyjointset_jointFrameX2,hse=M.rawmultibodyjointset_jointAnchor1,pse=M.rawmultibodyjointset_jointAnchor2,fse=M.rawmultibodyjointset_jointContactsEnabled,gse=M.rawmultibodyjointset_jointSetContactsEnabled,mse=M.rawmultibodyjointset_jointLimitsEnabled,yse=M.rawmultibodyjointset_jointLimitsMin,wse=M.rawmultibodyjointset_jointLimitsMax,bse=M.__wbg_rawmultibodyjointset_free,vse=M.rawmultibodyjointset_new,Sse=M.rawmultibodyjointset_createJoint,xse=M.rawmultibodyjointset_remove,_se=M.rawmultibodyjointset_contains,kse=M.rawmultibodyjointset_forEachJointHandle,Cse=M.rawmultibodyjointset_forEachJointAttachedToRigidBody,Pse=M.rawrigidbodyset_rbTranslation,Ese=M.rawrigidbodyset_rbRotation,Ise=M.rawrigidbodyset_rbSleep,Mse=M.rawrigidbodyset_rbIsSleeping,Tse=M.rawrigidbodyset_rbIsMoving,Ase=M.rawrigidbodyset_rbNextTranslation,jse=M.rawrigidbodyset_rbNextRotation,Rse=M.rawrigidbodyset_rbSetTranslation,Ose=M.rawrigidbodyset_rbSetRotation,Dse=M.rawrigidbodyset_rbSetLinvel,Lse=M.rawrigidbodyset_rbSetAngvel,zse=M.rawrigidbodyset_rbSetNextKinematicTranslation,Nse=M.rawrigidbodyset_rbSetNextKinematicRotation,Fse=M.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,$se=M.rawrigidbodyset_rbSetAdditionalMass,Bse=M.rawrigidbodyset_rbSetAdditionalMassProperties,Use=M.rawrigidbodyset_rbLinvel,Vse=M.rawrigidbodyset_rbAngvel,Hse=M.rawrigidbodyset_rbLockTranslations,Wse=M.rawrigidbodyset_rbSetEnabledTranslations,Kse=M.rawrigidbodyset_rbLockRotations,Gse=M.rawrigidbodyset_rbDominanceGroup,Yse=M.rawrigidbodyset_rbSetDominanceGroup,Xse=M.rawrigidbodyset_rbEnableCcd,qse=M.rawrigidbodyset_rbMass,Zse=M.rawrigidbodyset_rbInvMass,Jse=M.rawrigidbodyset_rbEffectiveInvMass,Qse=M.rawrigidbodyset_rbLocalCom,eae=M.rawrigidbodyset_rbWorldCom,tae=M.rawrigidbodyset_rbInvPrincipalInertiaSqrt,nae=M.rawrigidbodyset_rbPrincipalInertia,rae=M.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,iae=M.rawrigidbodyset_rbEffectiveAngularInertia,oae=M.rawrigidbodyset_rbWakeUp,sae=M.rawrigidbodyset_rbIsCcdEnabled,aae=M.rawrigidbodyset_rbNumColliders,lae=M.rawrigidbodyset_rbCollider,cae=M.rawrigidbodyset_rbBodyType,uae=M.rawrigidbodyset_rbSetBodyType,dae=M.rawrigidbodyset_rbIsFixed,hae=M.rawrigidbodyset_rbIsKinematic,pae=M.rawrigidbodyset_rbIsDynamic,fae=M.rawrigidbodyset_rbLinearDamping,gae=M.rawrigidbodyset_rbAngularDamping,mae=M.rawrigidbodyset_rbSetLinearDamping,yae=M.rawrigidbodyset_rbSetAngularDamping,wae=M.rawrigidbodyset_rbSetEnabled,bae=M.rawrigidbodyset_rbIsEnabled,vae=M.rawrigidbodyset_rbGravityScale,Sae=M.rawrigidbodyset_rbSetGravityScale,xae=M.rawrigidbodyset_rbResetForces,_ae=M.rawrigidbodyset_rbResetTorques,kae=M.rawrigidbodyset_rbAddForce,Cae=M.rawrigidbodyset_rbApplyImpulse,Pae=M.rawrigidbodyset_rbAddTorque,Eae=M.rawrigidbodyset_rbApplyTorqueImpulse,Iae=M.rawrigidbodyset_rbAddForceAtPoint,Mae=M.rawrigidbodyset_rbApplyImpulseAtPoint,Tae=M.rawrigidbodyset_rbUserData,Aae=M.rawrigidbodyset_rbSetUserData,jae=M.__wbg_rawrigidbodyset_free,Rae=M.rawrigidbodyset_new,Oae=M.rawrigidbodyset_createRigidBody,Dae=M.rawrigidbodyset_remove,Lae=M.rawrigidbodyset_len,zae=M.rawrigidbodyset_contains,Nae=M.rawrigidbodyset_forEachRigidBodyHandle,Fae=M.rawrigidbodyset_propagateModifiedBodyPositionsToColliders,$ae=M.__wbg_rawbroadphase_free,Bae=M.rawbroadphase_new,Uae=M.rawcolliderset_coTranslation,Vae=M.rawcolliderset_coRotation,Hae=M.rawcolliderset_coSetTranslation,Wae=M.rawcolliderset_coSetTranslationWrtParent,Kae=M.rawcolliderset_coSetRotation,Gae=M.rawcolliderset_coSetRotationWrtParent,Yae=M.rawcolliderset_coIsSensor,Xae=M.rawcolliderset_coShapeType,qae=M.rawcolliderset_coHalfspaceNormal,Zae=M.rawcolliderset_coHalfExtents,Jae=M.rawcolliderset_coSetHalfExtents,Qae=M.rawcolliderset_coRadius,ele=M.rawcolliderset_coSetRadius,tle=M.rawcolliderset_coHalfHeight,nle=M.rawcolliderset_coSetHalfHeight,rle=M.rawcolliderset_coRoundRadius,ile=M.rawcolliderset_coSetRoundRadius,ole=M.rawcolliderset_coVertices,sle=M.rawcolliderset_coIndices,ale=M.rawcolliderset_coHeightfieldHeights,lle=M.rawcolliderset_coHeightfieldScale,cle=M.rawcolliderset_coParent,ule=M.rawcolliderset_coSetEnabled,dle=M.rawcolliderset_coIsEnabled,hle=M.rawcolliderset_coFriction,ple=M.rawcolliderset_coRestitution,fle=M.rawcolliderset_coDensity,gle=M.rawcolliderset_coMass,mle=M.rawcolliderset_coVolume,yle=M.rawcolliderset_coCollisionGroups,wle=M.rawcolliderset_coSolverGroups,ble=M.rawcolliderset_coActiveHooks,vle=M.rawcolliderset_coActiveCollisionTypes,Sle=M.rawcolliderset_coActiveEvents,xle=M.rawcolliderset_coContactForceEventThreshold,_le=M.rawcolliderset_coContainsPoint,kle=M.rawcolliderset_coCastShape,Cle=M.rawcolliderset_coCastCollider,Ple=M.rawcolliderset_coIntersectsShape,Ele=M.rawcolliderset_coContactShape,Ile=M.rawcolliderset_coContactCollider,Mle=M.rawcolliderset_coProjectPoint,Tle=M.rawcolliderset_coIntersectsRay,Ale=M.rawcolliderset_coCastRay,jle=M.rawcolliderset_coCastRayAndGetNormal,Rle=M.rawcolliderset_coSetSensor,Ole=M.rawcolliderset_coSetRestitution,Dle=M.rawcolliderset_coSetFriction,Lle=M.rawcolliderset_coFrictionCombineRule,zle=M.rawcolliderset_coSetFrictionCombineRule,Nle=M.rawcolliderset_coRestitutionCombineRule,Fle=M.rawcolliderset_coSetRestitutionCombineRule,$le=M.rawcolliderset_coSetCollisionGroups,Ble=M.rawcolliderset_coSetSolverGroups,Ule=M.rawcolliderset_coSetActiveHooks,Vle=M.rawcolliderset_coSetActiveEvents,Hle=M.rawcolliderset_coSetActiveCollisionTypes,Wle=M.rawcolliderset_coSetShape,Kle=M.rawcolliderset_coSetContactForceEventThreshold,Gle=M.rawcolliderset_coSetDensity,Yle=M.rawcolliderset_coSetMass,Xle=M.rawcolliderset_coSetMassProperties,qle=M.__wbg_rawcolliderset_free,Zle=M.rawcolliderset_new,Jle=M.rawcolliderset_len,gO=M.rawcolliderset_contains,Qle=M.rawcolliderset_createCollider,ece=M.rawcolliderset_remove,tce=M.rawcolliderset_forEachColliderHandle,nce=M.__wbg_rawshapecontact_free,rce=M.__wbg_rawnarrowphase_free,ice=M.rawnarrowphase_new,oce=M.rawnarrowphase_contacts_with,sce=M.rawnarrowphase_contact_pair,ace=M.rawnarrowphase_intersections_with,lce=M.rawnarrowphase_intersection_pair,cce=M.__wbg_rawcontactmanifold_free,uce=M.rawcontactpair_collider1,dce=M.rawcontactpair_collider2,hce=M.rawcontactpair_numContactManifolds,pce=M.rawcontactpair_contactManifold,fce=M.rawcontactmanifold_normal,gce=M.rawcontactmanifold_local_n1,mce=M.rawcontactmanifold_local_n2,yce=M.rawcontactmanifold_subshape1,wce=M.rawcontactmanifold_subshape2,bce=M.rawcontactmanifold_num_contacts,vce=M.rawcontactmanifold_contact_local_p1,Sce=M.rawcontactmanifold_contact_local_p2,xce=M.rawcontactmanifold_contact_dist,_ce=M.rawcontactmanifold_contact_fid1,kce=M.rawcontactmanifold_contact_fid2,Cce=M.rawcontactmanifold_contact_impulse,Pce=M.rawcontactmanifold_contact_tangent_impulse,Ece=M.rawcontactmanifold_num_solver_contacts,Ice=M.rawcontactmanifold_solver_contact_point,Mce=M.rawcontactmanifold_solver_contact_dist,Tce=M.rawcontactmanifold_solver_contact_friction,Ace=M.rawcontactmanifold_solver_contact_restitution,jce=M.rawcontactmanifold_solver_contact_tangent_velocity,Rce=M.__wbg_rawpointprojection_free,Oce=M.rawpointprojection_isInside,Dce=M.__wbg_rawpointcolliderprojection_free,Lce=M.rawpointcolliderprojection_isInside,mO=M.rawpointcolliderprojection_featureType,yO=M.rawpointcolliderprojection_featureId,zce=M.__wbg_rawrayintersection_free,Nce=M.rawrayintersection_toi,Am=M.rawraycolliderintersection_normal,Fce=M.rawraycolliderintersection_featureType,$ce=M.rawraycolliderintersection_featureId,Bce=M.__wbg_rawshape_free,Uce=M.rawshape_cuboid,Vce=M.rawshape_roundCuboid,Hce=M.rawshape_ball,Wce=M.rawshape_halfspace,Kce=M.rawshape_capsule,Gce=M.rawshape_polyline,Yce=M.rawshape_trimesh,Xce=M.rawshape_heightfield,qce=M.rawshape_segment,Zce=M.rawshape_triangle,Jce=M.rawshape_roundTriangle,Qce=M.rawshape_convexHull,eue=M.rawshape_roundConvexHull,tue=M.rawshape_convexPolyline,nue=M.rawshape_roundConvexPolyline,rue=M.rawshape_castShape,iue=M.rawshape_intersectsShape,oue=M.rawshape_contactShape,sue=M.rawshape_containsPoint,aue=M.rawshape_projectPoint,lue=M.rawshape_intersectsRay,cue=M.rawshape_castRay,uue=M.rawshape_castRayAndGetNormal,due=M.__wbg_rawshapecollidertoi_free,hue=M.rawshapecollidertoi_toi,pue=M.__wbg_rawrotation_free,fue=M.rawrotation_identity,gue=M.rawrotation_fromAngle,wO=M.rawrotation_im,mue=M.rawrotation_angle,yue=M.rawvector_zero,wue=M.rawvector_new,bue=M.rawvector_set_y,vue=M.rawvector_xy,Sue=M.rawvector_yx,xue=M.__wbg_rawdebugrenderpipeline_free,_ue=M.rawdebugrenderpipeline_new,kue=M.rawdebugrenderpipeline_vertices,Cue=M.rawdebugrenderpipeline_colors,Pue=M.rawdebugrenderpipeline_render,Eue=M.__wbg_raweventqueue_free,Iue=M.__wbg_rawcontactforceevent_free,Bd=M.rawcontactforceevent_collider1,Mue=M.rawcontactforceevent_collider2,Ud=M.rawcontactforceevent_total_force,jm=M.rawcontactforceevent_total_force_magnitude,Tue=M.rawcontactforceevent_max_force_magnitude,Aue=M.raweventqueue_new,jue=M.raweventqueue_drainCollisionEvents,Rue=M.raweventqueue_drainContactForceEvents,Oue=M.raweventqueue_clear,Due=M.__wbg_rawphysicspipeline_free,Lue=M.rawphysicspipeline_new,zue=M.rawphysicspipeline_step,Nue=M.rawphysicspipeline_stepWithEvents,Fue=M.__wbg_rawquerypipeline_free,$ue=M.rawquerypipeline_new,Bue=M.rawquerypipeline_update,Uue=M.rawquerypipeline_castRay,Vue=M.rawquerypipeline_castRayAndGetNormal,Hue=M.rawquerypipeline_intersectionsWithRay,Wue=M.rawquerypipeline_intersectionWithShape,Kue=M.rawquerypipeline_projectPoint,Gue=M.rawquerypipeline_projectPointAndGetFeature,Yue=M.rawquerypipeline_intersectionsWithPoint,Xue=M.rawquerypipeline_castShape,que=M.rawquerypipeline_intersectionsWithShape,Zue=M.rawquerypipeline_collidersWithAabbIntersectingAabb,Jue=M.__wbg_rawdeserializedworld_free,Que=M.rawdeserializedworld_takeGravity,ede=M.rawdeserializedworld_takeIntegrationParameters,tde=M.rawdeserializedworld_takeIslandManager,nde=M.rawdeserializedworld_takeBroadPhase,rde=M.rawdeserializedworld_takeNarrowPhase,ide=M.rawdeserializedworld_takeBodies,ode=M.rawdeserializedworld_takeColliders,sde=M.rawdeserializedworld_takeImpulseJoints,ade=M.rawdeserializedworld_takeMultibodyJoints,lde=M.rawserializationpipeline_serializeAll,cde=M.rawserializationpipeline_deserializeAll,ude=M.__wbg_rawcontactpair_free,dde=M.__wbg_rawraycolliderintersection_free,hde=M.__wbg_rawraycollidertoi_free,pde=M.__wbg_rawvector_free,fde=M.__wbg_rawshapetoi_free;M.rawkinematiccharactercontroller_setMaxSlopeClimbAngle,M.rawvector_set_x,M.rawcolliderset_isHandleValid,M.rawrayintersection_featureType,M.rawrayintersection_featureId,M.rawshapecontact_point1,M.rawshapecontact_normal2,M.rawpointprojection_point,M.rawshapecontact_normal1,M.rawrayintersection_normal,M.rawshapecontact_point2,M.rawshapetoi_witness1,M.rawshapetoi_witness2,M.rawshapetoi_normal1,M.rawshapetoi_normal2,M.rawshapecollidertoi_witness1,M.rawshapecollidertoi_witness2,M.rawshapecollidertoi_normal1,M.rawshapecollidertoi_normal2,M.rawpointcolliderprojection_point,M.rawcontactforceevent_max_force_direction;const gde=M.rawserializationpipeline_new;M.rawkinematiccharactercontroller_maxSlopeClimbAngle,M.rawshapecontact_distance,M.rawraycolliderintersection_toi,M.rawraycollidertoi_toi,M.rawshapetoi_toi,M.rawrotation_re,M.rawvector_x,M.rawvector_y,M.rawintegrationparameters_predictionDistance,M.rawraycolliderintersection_colliderHandle,M.rawraycollidertoi_colliderHandle,M.rawshapecollidertoi_colliderHandle,M.rawpointcolliderprojection_colliderHandle;const mde=M.__wbg_rawserializationpipeline_free,De=M.__wbindgen_add_to_stack_pointer,Rm=M.__wbindgen_free,Mo=M.__wbindgen_malloc,yde=M.__wbindgen_exn_store;class bO{constructor(e,t){this.x=e,this.y=t}}class W{static new(e,t){return new bO(e,t)}static zeros(){return W.new(0,0)}static fromRaw(e){if(!e)return null;let t=W.new(e.x,e.y);return e.free(),t}static intoRaw(e){return new K(e.x,e.y)}static copy(e,t){e.x=t.x,e.y=t.y}}class Qe{static identity(){return 0}static fromRaw(e){if(!e)return null;let t=e.angle;return e.free(),t}static intoRaw(e){return Re.fromAngle(e)}}var hi;(function(n){n[n.Dynamic=0]="Dynamic",n[n.Fixed=1]="Fixed",n[n.KinematicPositionBased=2]="KinematicPositionBased",n[n.KinematicVelocityBased=3]="KinematicVelocityBased"})(hi||(hi={}));class OS{constructor(e,t,r){this.rawSet=e,this.colliderSet=t,this.handle=r}finalizeDeserialization(e){this.colliderSet=e}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(e,t){return this.rawSet.rbLockTranslations(this.handle,e,t)}lockRotations(e,t){return this.rawSet.rbLockRotations(this.handle,e,t)}setEnabledTranslations(e,t,r){return this.rawSet.rbSetEnabledTranslations(this.handle,e,t,r)}restrictTranslations(e,t,r){this.setEnabledTranslations(e,e,r)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(e){this.rawSet.rbSetDominanceGroup(this.handle,e)}enableCcd(e){this.rawSet.rbEnableCcd(this.handle,e)}translation(){let e=this.rawSet.rbTranslation(this.handle);return W.fromRaw(e)}rotation(){let e=this.rawSet.rbRotation(this.handle);return Qe.fromRaw(e)}nextTranslation(){let e=this.rawSet.rbNextTranslation(this.handle);return W.fromRaw(e)}nextRotation(){let e=this.rawSet.rbNextRotation(this.handle);return Qe.fromRaw(e)}setTranslation(e,t){this.rawSet.rbSetTranslation(this.handle,e.x,e.y,t)}setLinvel(e,t){let r=W.intoRaw(e);this.rawSet.rbSetLinvel(this.handle,r,t),r.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(e,t){this.rawSet.rbSetGravityScale(this.handle,e,t)}setRotation(e,t){this.rawSet.rbSetRotation(this.handle,e,t)}setAngvel(e,t){this.rawSet.rbSetAngvel(this.handle,e,t)}setNextKinematicTranslation(e){this.rawSet.rbSetNextKinematicTranslation(this.handle,e.x,e.y)}setNextKinematicRotation(e){this.rawSet.rbSetNextKinematicRotation(this.handle,e)}linvel(){return W.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return this.rawSet.rbAngvel(this.handle)}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return W.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return W.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return W.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return this.rawSet.rbInvPrincipalInertiaSqrt(this.handle)}principalInertia(){return this.rawSet.rbPrincipalInertia(this.handle)}effectiveWorldInvInertiaSqrt(){return this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle)}effectiveAngularInertia(){return this.rawSet.rbEffectiveAngularInertia(this.handle)}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(e){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,e))}setEnabled(e){this.rawSet.rbSetEnabled(this.handle,e)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(e,t){return this.rawSet.rbSetBodyType(this.handle,e,t)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(e){this.rawSet.rbSetLinearDamping(this.handle,e)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(e,t){this.rawSet.rbSetAdditionalMass(this.handle,e,t)}setAdditionalMassProperties(e,t,r,i){let o=W.intoRaw(t);this.rawSet.rbSetAdditionalMassProperties(this.handle,e,o,r,i),o.free()}setAngularDamping(e){this.rawSet.rbSetAngularDamping(this.handle,e)}resetForces(e){this.rawSet.rbResetForces(this.handle,e)}resetTorques(e){this.rawSet.rbResetTorques(this.handle,e)}addForce(e,t){const r=W.intoRaw(e);this.rawSet.rbAddForce(this.handle,r,t),r.free()}applyImpulse(e,t){const r=W.intoRaw(e);this.rawSet.rbApplyImpulse(this.handle,r,t),r.free()}addTorque(e,t){this.rawSet.rbAddTorque(this.handle,e,t)}applyTorqueImpulse(e,t){this.rawSet.rbApplyTorqueImpulse(this.handle,e,t)}addForceAtPoint(e,t,r){const i=W.intoRaw(e),o=W.intoRaw(t);this.rawSet.rbAddForceAtPoint(this.handle,i,o,r),i.free(),o.free()}applyImpulseAtPoint(e,t,r){const i=W.intoRaw(e),o=W.intoRaw(t);this.rawSet.rbApplyImpulseAtPoint(this.handle,i,o,r),i.free(),o.free()}}class Hi{constructor(e){this.enabled=!0,this.status=e,this.translation=W.zeros(),this.rotation=Qe.identity(),this.gravityScale=1,this.linvel=W.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=W.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=0,this.principalAngularInertia=0,this.rotationsEnabled=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.dominanceGroup=0}static dynamic(){return new Hi(hi.Dynamic)}static kinematicPositionBased(){return new Hi(hi.KinematicPositionBased)}static kinematicVelocityBased(){return new Hi(hi.KinematicVelocityBased)}static fixed(){return new Hi(hi.Fixed)}static newDynamic(){return new Hi(hi.Dynamic)}static newKinematicPositionBased(){return new Hi(hi.KinematicPositionBased)}static newKinematicVelocityBased(){return new Hi(hi.KinematicVelocityBased)}static newStatic(){return new Hi(hi.Fixed)}setDominanceGroup(e){return this.dominanceGroup=e,this}setEnabled(e){return this.enabled=e,this}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setGravityScale(e){return this.gravityScale=e,this}setAdditionalMass(e){return this.mass=e,this.massOnly=!0,this}setLinvel(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The linvel components must be numbers.");return this.linvel={x:e,y:t},this}setAngvel(e){return this.angvel=e,this}setAdditionalMassProperties(e,t,r){return this.mass=e,W.copy(this.centerOfMass,t),this.principalAngularInertia=r,this.massOnly=!1,this}enabledTranslations(e,t){return this.translationsEnabledX=e,this.translationsEnabledY=t,this}restrictTranslations(e,t){return this.enabledTranslations(e,t)}lockTranslations(){return this.restrictTranslations(!1,!1)}lockRotations(){return this.rotationsEnabled=!1,this}setLinearDamping(e){return this.linearDamping=e,this}setAngularDamping(e){return this.angularDamping=e,this}setCanSleep(e){return this.canSleep=e,this}setSleeping(e){return this.sleeping=e,this}setCcdEnabled(e){return this.ccdEnabled=e,this}setUserData(e){return this.userData=e,this}}class Om{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(e,t){let r=this.index(e);for(;this.data.length<=r;)this.data.push(null);this.data[r]==null&&(this.size+=1),this.data[r]=t}len(){return this.size}delete(e){let t=this.index(e);t<this.data.length&&(this.data[t]!=null&&(this.size-=1),this.data[t]=null)}clear(){this.data=new Array}get(e){let t=this.index(e);return t<this.data.length?this.data[t]:null}forEach(e){for(const t of this.data)t!=null&&e(t)}getAll(){return this.data.filter(e=>e!=null)}index(e){return this.fconv[0]=e,this.uconv[0]}}class vO{constructor(e){this.raw=e||new Ct,this.map=new Om,e&&e.forEachRigidBodyHandle(t=>{this.map.set(t,new OS(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createRigidBody(e,t){let r=W.intoRaw(t.translation),i=Qe.intoRaw(t.rotation),o=W.intoRaw(t.linvel),s=W.intoRaw(t.centerOfMass),a=this.raw.createRigidBody(t.enabled,r,i,t.gravityScale,t.mass,t.massOnly,s,o,t.angvel,t.principalAngularInertia,t.translationsEnabledX,t.translationsEnabledY,t.rotationsEnabled,t.linearDamping,t.angularDamping,t.status,t.canSleep,t.sleeping,t.ccdEnabled,t.dominanceGroup);r.free(),i.free(),o.free(),s.free();const l=new OS(this.raw,e,a);return l.userData=t.userData,this.map.set(a,l),l}remove(e,t,r,i,o){for(let s=0;s<this.raw.rbNumColliders(e);s+=1)r.unmap(this.raw.rbCollider(e,s));i.forEachJointHandleAttachedToRigidBody(e,s=>i.unmap(s)),o.forEachJointHandleAttachedToRigidBody(e,s=>o.unmap(s)),this.raw.remove(e,t.raw,r.raw,i.raw,o.raw),this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachActiveRigidBody(e,t){e.forEachActiveRigidBodyHandle(r=>{t(this.get(r))})}getAll(){return this.map.getAll()}}class SO{constructor(e){this.raw=e||new Es}free(){this.raw&&this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get erp(){return this.raw.erp}get allowedLinearError(){return this.raw.allowedLinearError}get predictionDistance(){return this.raw.predictionDistance}get maxVelocityIterations(){return this.raw.maxVelocityIterations}get maxVelocityFrictionIterations(){return this.raw.maxVelocityFrictionIterations}get maxStabilizationIterations(){return this.raw.maxStabilizationIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(e){this.raw.dt=e}set erp(e){this.raw.erp=e}set allowedLinearError(e){this.raw.allowedLinearError=e}set predictionDistance(e){this.raw.predictionDistance=e}set maxVelocityIterations(e){this.raw.maxVelocityIterations=e}set maxVelocityFrictionIterations(e){this.raw.maxVelocityFrictionIterations=e}set maxStabilizationIterations(e){this.raw.maxStabilizationIterations=e}set minIslandSize(e){this.raw.minIslandSize=e}set maxCcdSubsteps(e){this.raw.maxCcdSubsteps=e}}var Rn;(function(n){n[n.Revolute=0]="Revolute",n[n.Fixed=1]="Fixed",n[n.Prismatic=2]="Prismatic"})(Rn||(Rn={}));var DS;(function(n){n[n.AccelerationBased=0]="AccelerationBased",n[n.ForceBased=1]="ForceBased"})(DS||(DS={}));class ba{constructor(e,t,r){this.rawSet=e,this.bodySet=t,this.handle=r}static newTyped(e,t,r){switch(e.jointType(r)){case Rn.Revolute:return new kO(e,t,r);case Rn.Prismatic:return new _O(e,t,r);case Rn.Fixed:return new xO(e,t,r);default:return new ba(e,t,r)}}finalizeDeserialization(e){this.bodySet=e}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}anchor1(){return W.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return W.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(e){const t=W.intoRaw(e);this.rawSet.jointSetAnchor1(this.handle,t),t.free()}setAnchor2(e){const t=W.intoRaw(e);this.rawSet.jointSetAnchor2(this.handle,t),t.free()}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class LS extends ba{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(e,t){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),e,t)}configureMotorModel(e){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),e)}configureMotorVelocity(e,t){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),e,t)}configureMotorPosition(e,t,r){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),e,t,r)}configureMotor(e,t,r,i){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),e,t,r,i)}}class xO extends ba{}class _O extends LS{rawAxis(){return vm.X}}class kO extends LS{rawAxis(){return vm.AngX}}class Vd{constructor(){}static fixed(e,t,r,i){let o=new Vd;return o.anchor1=e,o.anchor2=r,o.frame1=t,o.frame2=i,o.jointType=Rn.Fixed,o}static revolute(e,t){let r=new Vd;return r.anchor1=e,r.anchor2=t,r.jointType=Rn.Revolute,r}static prismatic(e,t,r){let i=new Vd;return i.anchor1=e,i.anchor2=t,i.axis=r,i.jointType=Rn.Prismatic,i}intoRaw(){let e=W.intoRaw(this.anchor1),t=W.intoRaw(this.anchor2),r,i,o=!1,s=0,a=0;switch(this.jointType){case Rn.Fixed:let l=Qe.intoRaw(this.frame1),c=Qe.intoRaw(this.frame2);i=$i.fixed(e,l,t,c),l.free(),c.free();break;case Rn.Prismatic:r=W.intoRaw(this.axis),this.limitsEnabled&&(o=!0,s=this.limits[0],a=this.limits[1]),i=$i.prismatic(e,t,r,o,s,a),r.free();break;case Rn.Revolute:i=$i.revolute(e,t);break}return e.free(),t.free(),i}}class CO{constructor(e){this.raw=e||new Bi,this.map=new Om,e&&e.forEachJointHandle(t=>{this.map.set(t,ba.newTyped(e,null,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createJoint(e,t,r,i,o){const s=t.intoRaw(),a=this.raw.createJoint(s,r,i,o);s.free();let l=ba.newTyped(this.raw,e,a);return this.map.set(a,l),l}remove(e,t){this.raw.remove(e,t),this.unmap(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class va{constructor(e,t){this.rawSet=e,this.handle=t}static newTyped(e,t){switch(e.jointType(t)){case Rn.Revolute:return new IO(e,t);case Rn.Prismatic:return new EO(e,t);case Rn.Fixed:return new PO(e,t);default:return new va(e,t)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(e){this.rawSet.jointSetContactsEnabled(this.handle,e)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class zS extends va{}class PO extends va{}class EO extends zS{rawAxis(){return vm.X}}class IO extends zS{rawAxis(){return vm.AngX}}class MO{constructor(e){this.raw=e||new Vi,this.map=new Om,e&&e.forEachJointHandle(t=>{this.map.set(t,va.newTyped(this.raw,t))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}createJoint(e,t,r,i){const o=e.intoRaw(),s=this.raw.createJoint(o,t,r,i);o.free();let a=va.newTyped(this.raw,s);return this.map.set(s,a),a}remove(e,t){this.raw.remove(e,t),this.map.delete(e)}unmap(e){this.map.delete(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}get(e){return this.map.get(e)}forEach(e){this.map.forEach(e)}forEachJointHandleAttachedToRigidBody(e,t){this.raw.forEachJointAttachedToRigidBody(e,t)}getAll(){return this.map.getAll()}}var Hd;(function(n){n[n.Average=0]="Average",n[n.Min=1]="Min",n[n.Multiply=2]="Multiply",n[n.Max=3]="Max"})(Hd||(Hd={}));class TO{constructor(e){this.raw=e||new lc}free(){this.raw&&this.raw.free(),this.raw=void 0}}class AO{constructor(e){this.raw=e||new Ui}free(){this.raw&&this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(e){this.raw.forEachActiveRigidBodyHandle(e)}}class jO{constructor(e){this.raw=e||new Ps}free(){this.raw&&this.raw.free(),this.raw=void 0}}class RO{constructor(e){this.raw=e||new Io,this.tempManifold=new OO(null)}free(){this.raw&&this.raw.free(),this.raw=void 0}contactsWith(e,t){this.raw.contacts_with(e,t)}intersectionsWith(e,t){this.raw.intersections_with(e,t)}contactPair(e,t,r){const i=this.raw.contact_pair(e,t);if(i){const o=i.collider1()!=e;let s;for(s=0;s<i.numContactManifolds();++s)this.tempManifold.raw=i.contactManifold(s),this.tempManifold.raw&&r(this.tempManifold,o),this.tempManifold.free();i.free()}}intersectionPair(e,t){return this.raw.intersection_pair(e,t)}}class OO{constructor(e){this.raw=e}free(){this.raw&&this.raw.free(),this.raw=void 0}normal(){return W.fromRaw(this.raw.normal())}localNormal1(){return W.fromRaw(this.raw.local_n1())}localNormal2(){return W.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(e){return W.fromRaw(this.raw.contact_local_p1(e))}localContactPoint2(e){return W.fromRaw(this.raw.contact_local_p2(e))}contactDist(e){return this.raw.contact_dist(e)}contactFid1(e){return this.raw.contact_fid1(e)}contactFid2(e){return this.raw.contact_fid2(e)}contactImpulse(e){return this.raw.contact_impulse(e)}contactTangentImpulse(e){return this.raw.contact_tangent_impulse(e)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(e){return W.fromRaw(this.raw.solver_contact_point(e))}solverContactDist(e){return this.raw.solver_contact_dist(e)}solverContactFriction(e){return this.raw.solver_contact_friction(e)}solverContactRestitution(e){return this.raw.solver_contact_restitution(e)}solverContactTangentVelocity(e){return W.fromRaw(this.raw.solver_contact_tangent_velocity(e))}}class uc{constructor(e,t,r,i,o){this.distance=e,this.point1=t,this.point2=r,this.normal1=i,this.normal2=o}static fromRaw(e){if(!e)return null;const t=new uc(e.distance(),W.fromRaw(e.point1()),W.fromRaw(e.point2()),W.fromRaw(e.normal1()),W.fromRaw(e.normal2()));return e.free(),t}}var dc;(function(n){n[n.Vertex=0]="Vertex",n[n.Face=1]="Face",n[n.Unknown=2]="Unknown"})(dc||(dc={}));class Wd{constructor(e,t){this.point=e,this.isInside=t}static fromRaw(e){if(!e)return null;const t=new Wd(W.fromRaw(e.point()),e.isInside());return e.free(),t}}class Kd{constructor(e,t,r,i,o){this.featureType=dc.Unknown,this.featureId=void 0,this.collider=e,this.point=t,this.isInside=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new Kd(e.get(t.colliderHandle()),W.fromRaw(t.point()),t.isInside(),t.featureType(),t.featureId());return t.free(),r}}class wde{constructor(e,t){this.origin=e,this.dir=t}pointAt(e){return{x:this.origin.x+this.dir.x*e,y:this.origin.y+this.dir.y*e}}}class Gd{constructor(e,t,r,i){this.featureType=dc.Unknown,this.featureId=void 0,this.toi=e,this.normal=t,i!==void 0&&(this.featureId=i),r!==void 0&&(this.featureType=r)}static fromRaw(e){if(!e)return null;const t=new Gd(e.toi(),W.fromRaw(e.normal()),e.featureType(),e.featureId());return e.free(),t}}class Yd{constructor(e,t,r,i,o){this.featureType=dc.Unknown,this.featureId=void 0,this.collider=e,this.toi=t,this.normal=r,o!==void 0&&(this.featureId=o),i!==void 0&&(this.featureType=i)}static fromRaw(e,t){if(!t)return null;const r=new Yd(e.get(t.colliderHandle()),t.toi(),W.fromRaw(t.normal()),t.featureType(),t.featureId());return t.free(),r}}class Dm{constructor(e,t){this.collider=e,this.toi=t}static fromRaw(e,t){if(!t)return null;const r=new Dm(e.get(t.colliderHandle()),t.toi());return t.free(),r}}class hc{constructor(e,t,r,i,o){this.toi=e,this.witness1=t,this.witness2=r,this.normal1=i,this.normal2=o}static fromRaw(e,t){if(!t)return null;const r=new hc(t.toi(),W.fromRaw(t.witness1()),W.fromRaw(t.witness2()),W.fromRaw(t.normal1()),W.fromRaw(t.normal2()));return t.free(),r}}class Xd extends hc{constructor(e,t,r,i,o,s){super(t,r,i,o,s),this.collider=e}static fromRaw(e,t){if(!t)return null;const r=new Xd(e.get(t.colliderHandle()),t.toi(),W.fromRaw(t.witness1()),W.fromRaw(t.witness2()),W.fromRaw(t.normal1()),W.fromRaw(t.normal2()));return t.free(),r}}class On{static fromRaw(e,t){const r=e.coShapeType(t);let i,o,s,a,l,c,u;switch(r){case Ge.Ball:return new NS(e.coRadius(t));case Ge.Cuboid:return i=e.coHalfExtents(t),new $S(i.x,i.y);case Ge.RoundCuboid:return i=e.coHalfExtents(t),o=e.coRoundRadius(t),new BS(i.x,i.y,o);case Ge.Capsule:return l=e.coHalfHeight(t),c=e.coRadius(t),new US(l,c);case Ge.Segment:return s=e.coVertices(t),new VS(W.new(s[0],s[1]),W.new(s[2],s[3]));case Ge.Polyline:return s=e.coVertices(t),a=e.coIndices(t),new KS(s,a);case Ge.Triangle:return s=e.coVertices(t),new HS(W.new(s[0],s[1]),W.new(s[2],s[3]),W.new(s[4],s[5]));case Ge.RoundTriangle:return s=e.coVertices(t),o=e.coRoundRadius(t),new WS(W.new(s[0],s[1]),W.new(s[2],s[3]),W.new(s[4],s[5]),o);case Ge.HalfSpace:return u=W.fromRaw(e.coHalfspaceNormal(t)),new FS(u);case Ge.TriMesh:return s=e.coVertices(t),a=e.coIndices(t),new GS(s,a);case Ge.HeightField:const d=e.coHeightfieldScale(t),h=e.coHeightfieldHeights(t);return new YS(h,d);case Ge.ConvexPolygon:return s=e.coVertices(t),new Lm(s,!1);case Ge.RoundConvexPolygon:return s=e.coVertices(t),o=e.coRoundRadius(t),new zm(s,o,!1);default:throw new Error("unknown shape type: "+r)}}castShape(e,t,r,i,o,s,a,l,c){let u=W.intoRaw(e),d=Qe.intoRaw(t),h=W.intoRaw(r),p=W.intoRaw(o),g=Qe.intoRaw(s),f=W.intoRaw(a),m=this.intoRaw(),v=i.intoRaw(),b=hc.fromRaw(null,m.castShape(u,d,h,v,p,g,f,l,c));return u.free(),d.free(),h.free(),p.free(),g.free(),f.free(),m.free(),v.free(),b}intersectsShape(e,t,r,i,o){let s=W.intoRaw(e),a=Qe.intoRaw(t),l=W.intoRaw(i),c=Qe.intoRaw(o),u=this.intoRaw(),d=r.intoRaw(),h=u.intersectsShape(s,a,d,l,c);return s.free(),a.free(),l.free(),c.free(),u.free(),d.free(),h}contactShape(e,t,r,i,o,s){let a=W.intoRaw(e),l=Qe.intoRaw(t),c=W.intoRaw(i),u=Qe.intoRaw(o),d=this.intoRaw(),h=r.intoRaw(),p=uc.fromRaw(d.contactShape(a,l,h,c,u,s));return a.free(),l.free(),c.free(),u.free(),d.free(),h.free(),p}containsPoint(e,t,r){let i=W.intoRaw(e),o=Qe.intoRaw(t),s=W.intoRaw(r),a=this.intoRaw(),l=a.containsPoint(i,o,s);return i.free(),o.free(),s.free(),a.free(),l}projectPoint(e,t,r,i){let o=W.intoRaw(e),s=Qe.intoRaw(t),a=W.intoRaw(r),l=this.intoRaw(),c=Wd.fromRaw(l.projectPoint(o,s,a,i));return o.free(),s.free(),a.free(),l.free(),c}intersectsRay(e,t,r,i){let o=W.intoRaw(t),s=Qe.intoRaw(r),a=W.intoRaw(e.origin),l=W.intoRaw(e.dir),c=this.intoRaw(),u=c.intersectsRay(o,s,a,l,i);return o.free(),s.free(),a.free(),l.free(),c.free(),u}castRay(e,t,r,i,o){let s=W.intoRaw(t),a=Qe.intoRaw(r),l=W.intoRaw(e.origin),c=W.intoRaw(e.dir),u=this.intoRaw(),d=u.castRay(s,a,l,c,i,o);return s.free(),a.free(),l.free(),c.free(),u.free(),d}castRayAndGetNormal(e,t,r,i,o){let s=W.intoRaw(t),a=Qe.intoRaw(r),l=W.intoRaw(e.origin),c=W.intoRaw(e.dir),u=this.intoRaw(),d=Gd.fromRaw(u.castRayAndGetNormal(s,a,l,c,i,o));return s.free(),a.free(),l.free(),c.free(),u.free(),d}}var Ge;(function(n){n[n.Ball=0]="Ball",n[n.Cuboid=1]="Cuboid",n[n.Capsule=2]="Capsule",n[n.Segment=3]="Segment",n[n.Polyline=4]="Polyline",n[n.Triangle=5]="Triangle",n[n.TriMesh=6]="TriMesh",n[n.HeightField=7]="HeightField",n[n.ConvexPolygon=9]="ConvexPolygon",n[n.RoundCuboid=10]="RoundCuboid",n[n.RoundTriangle=11]="RoundTriangle",n[n.RoundConvexPolygon=12]="RoundConvexPolygon",n[n.HalfSpace=13]="HalfSpace"})(Ge||(Ge={}));class NS extends On{constructor(e){super(),this.type=Ge.Ball,this.radius=e}intoRaw(){return xe.ball(this.radius)}}class FS extends On{constructor(e){super(),this.type=Ge.HalfSpace,this.normal=e}intoRaw(){let e=W.intoRaw(this.normal),t=xe.halfspace(e);return e.free(),t}}class $S extends On{constructor(e,t){super(),this.type=Ge.Cuboid,this.halfExtents=W.new(e,t)}intoRaw(){return xe.cuboid(this.halfExtents.x,this.halfExtents.y)}}class BS extends On{constructor(e,t,r){super(),this.type=Ge.RoundCuboid,this.halfExtents=W.new(e,t),this.borderRadius=r}intoRaw(){return xe.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.borderRadius)}}class US extends On{constructor(e,t){super(),this.type=Ge.Capsule,this.halfHeight=e,this.radius=t}intoRaw(){return xe.capsule(this.halfHeight,this.radius)}}class VS extends On{constructor(e,t){super(),this.type=Ge.Segment,this.a=e,this.b=t}intoRaw(){let e=W.intoRaw(this.a),t=W.intoRaw(this.b),r=xe.segment(e,t);return e.free(),t.free(),r}}class HS extends On{constructor(e,t,r){super(),this.type=Ge.Triangle,this.a=e,this.b=t,this.c=r}intoRaw(){let e=W.intoRaw(this.a),t=W.intoRaw(this.b),r=W.intoRaw(this.c),i=xe.triangle(e,t,r);return e.free(),t.free(),r.free(),i}}class WS extends On{constructor(e,t,r,i){super(),this.type=Ge.RoundTriangle,this.a=e,this.b=t,this.c=r,this.borderRadius=i}intoRaw(){let e=W.intoRaw(this.a),t=W.intoRaw(this.b),r=W.intoRaw(this.c),i=xe.roundTriangle(e,t,r,this.borderRadius);return e.free(),t.free(),r.free(),i}}class KS extends On{constructor(e,t){super(),this.type=Ge.Polyline,this.vertices=e,this.indices=t??new Uint32Array(0)}intoRaw(){return xe.polyline(this.vertices,this.indices)}}class GS extends On{constructor(e,t){super(),this.type=Ge.TriMesh,this.vertices=e,this.indices=t}intoRaw(){return xe.trimesh(this.vertices,this.indices)}}class Lm extends On{constructor(e,t){super(),this.type=Ge.ConvexPolygon,this.vertices=e,this.skipConvexHullComputation=!!t}intoRaw(){return this.skipConvexHullComputation?xe.convexPolyline(this.vertices):xe.convexHull(this.vertices)}}class zm extends On{constructor(e,t,r){super(),this.type=Ge.RoundConvexPolygon,this.vertices=e,this.borderRadius=t,this.skipConvexHullComputation=!!r}intoRaw(){return this.skipConvexHullComputation?xe.roundConvexPolyline(this.vertices,this.borderRadius):xe.roundConvexHull(this.vertices,this.borderRadius)}}class YS extends On{constructor(e,t){super(),this.type=Ge.HeightField,this.heights=e,this.scale=t}intoRaw(){let e=W.intoRaw(this.scale),t=xe.heightfield(this.heights,e);return e.free(),t}}var Nm;(function(n){n[n.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",n[n.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",n[n.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",n[n.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",n[n.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",n[n.FIXED_FIXED=32]="FIXED_FIXED",n[n.DEFAULT=15]="DEFAULT",n[n.ALL=60943]="ALL"})(Nm||(Nm={}));class XS{constructor(e,t,r,i){this.colliderSet=e,this.handle=t,this._parent=r,this._shape=i}finalizeDeserialization(e){this.handle!=null&&(this._parent=e.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=On.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return W.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return Qe.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(e){this.colliderSet.raw.coSetSensor(this.handle,e)}setShape(e){let t=e.intoRaw();this.colliderSet.raw.coSetShape(this.handle,t),t.free(),this._shape=e}setEnabled(e){this.colliderSet.raw.coSetEnabled(this.handle,e)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(e){this.colliderSet.raw.coSetRestitution(this.handle,e)}setFriction(e){this.colliderSet.raw.coSetFriction(this.handle,e)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(e){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,e)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(e){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,e)}setCollisionGroups(e){this.colliderSet.raw.coSetCollisionGroups(this.handle,e)}setSolverGroups(e){this.colliderSet.raw.coSetSolverGroups(this.handle,e)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(e){this.colliderSet.raw.coSetActiveHooks(this.handle,e)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(e){this.colliderSet.raw.coSetActiveEvents(this.handle,e)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(e){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,e)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(e){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,e)}setDensity(e){this.colliderSet.raw.coSetDensity(this.handle,e)}setMass(e){this.colliderSet.raw.coSetMass(this.handle,e)}setMassProperties(e,t,r){let i=W.intoRaw(t);this.colliderSet.raw.coSetMassProperties(this.handle,e,i,r),i.free()}setTranslation(e){this.colliderSet.raw.coSetTranslation(this.handle,e.x,e.y)}setTranslationWrtParent(e){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,e.x,e.y)}setRotation(e){this.colliderSet.raw.coSetRotation(this.handle,e)}setRotationWrtParent(e){this.colliderSet.raw.coSetRotationWrtParent(this.handle,e)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return W.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(e){const t=W.intoRaw(e);this.colliderSet.raw.coSetHalfExtents(this.handle,t)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(e){this.colliderSet.raw.coSetRadius(this.handle,e)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(e){this.colliderSet.raw.coSetRoundRadius(this.handle,e)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(e){this.colliderSet.raw.coSetHalfHeight(this.handle,e)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let e=this.colliderSet.raw.coHeightfieldScale(this.handle);return W.fromRaw(e)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(e){let t=W.intoRaw(e),r=this.colliderSet.raw.coContainsPoint(this.handle,t);return t.free(),r}projectPoint(e,t){let r=W.intoRaw(e),i=Wd.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,r,t));return r.free(),i}intersectsRay(e,t){let r=W.intoRaw(e.origin),i=W.intoRaw(e.dir),o=this.colliderSet.raw.coIntersectsRay(this.handle,r,i,t);return r.free(),i.free(),o}castShape(e,t,r,i,o,s,a){let l=W.intoRaw(e),c=W.intoRaw(r),u=Qe.intoRaw(i),d=W.intoRaw(o),h=t.intoRaw(),p=hc.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,l,h,c,u,d,s,a));return l.free(),c.free(),u.free(),d.free(),h.free(),p}castCollider(e,t,r,i,o){let s=W.intoRaw(e),a=W.intoRaw(r),l=Xd.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,s,t.handle,a,i,o));return s.free(),a.free(),l}intersectsShape(e,t,r){let i=W.intoRaw(t),o=Qe.intoRaw(r),s=e.intoRaw(),a=this.colliderSet.raw.coIntersectsShape(this.handle,s,i,o);return i.free(),o.free(),s.free(),a}contactShape(e,t,r,i){let o=W.intoRaw(t),s=Qe.intoRaw(r),a=e.intoRaw(),l=uc.fromRaw(this.colliderSet.raw.coContactShape(this.handle,a,o,s,i));return o.free(),s.free(),a.free(),l}contactCollider(e,t){return uc.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,e.handle,t))}castRay(e,t,r){let i=W.intoRaw(e.origin),o=W.intoRaw(e.dir),s=this.colliderSet.raw.coCastRay(this.handle,i,o,t,r);return i.free(),o.free(),s}castRayAndGetNormal(e,t,r){let i=W.intoRaw(e.origin),o=W.intoRaw(e.dir),s=Gd.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,i,o,t,r));return i.free(),o.free(),s}}var Sa;(function(n){n[n.Density=0]="Density",n[n.Mass=1]="Mass",n[n.MassProps=2]="MassProps"})(Sa||(Sa={}));class en{constructor(e){this.enabled=!0,this.shape=e,this.massPropsMode=Sa.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=Qe.identity(),this.translation=W.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=Hd.Average,this.restitutionCombineRule=Hd.Average,this.activeCollisionTypes=Nm.DEFAULT,this.activeEvents=0,this.activeHooks=0,this.mass=0,this.centerOfMass=W.zeros(),this.contactForceEventThreshold=0,this.principalAngularInertia=0,this.rotationsEnabled=!0}static ball(e){const t=new NS(e);return new en(t)}static capsule(e,t){const r=new US(e,t);return new en(r)}static segment(e,t){const r=new VS(e,t);return new en(r)}static triangle(e,t,r){const i=new HS(e,t,r);return new en(i)}static roundTriangle(e,t,r,i){const o=new WS(e,t,r,i);return new en(o)}static polyline(e,t){const r=new KS(e,t);return new en(r)}static trimesh(e,t){const r=new GS(e,t);return new en(r)}static cuboid(e,t){const r=new $S(e,t);return new en(r)}static roundCuboid(e,t,r){const i=new BS(e,t,r);return new en(i)}static halfspace(e){const t=new FS(e);return new en(t)}static heightfield(e,t){const r=new YS(e,t);return new en(r)}static convexHull(e){const t=new Lm(e,!1);return new en(t)}static convexPolyline(e){const t=new Lm(e,!0);return new en(t)}static roundConvexHull(e,t){const r=new zm(e,t,!1);return new en(r)}static roundConvexPolyline(e,t){const r=new zm(e,t,!0);return new en(r)}setTranslation(e,t){if(typeof e!="number"||typeof t!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:e,y:t},this}setRotation(e){return this.rotation=e,this}setSensor(e){return this.isSensor=e,this}setEnabled(e){return this.enabled=e,this}setDensity(e){return this.massPropsMode=Sa.Density,this.density=e,this}setMass(e){return this.massPropsMode=Sa.Mass,this.mass=e,this}setMassProperties(e,t,r){return this.massPropsMode=Sa.MassProps,this.mass=e,W.copy(this.centerOfMass,t),this.principalAngularInertia=r,this}setRestitution(e){return this.restitution=e,this}setFriction(e){return this.friction=e,this}setFrictionCombineRule(e){return this.frictionCombineRule=e,this}setRestitutionCombineRule(e){return this.restitutionCombineRule=e,this}setCollisionGroups(e){return this.collisionGroups=e,this}setSolverGroups(e){return this.solverGroups=e,this}setActiveHooks(e){return this.activeHooks=e,this}setActiveEvents(e){return this.activeEvents=e,this}setActiveCollisionTypes(e){return this.activeCollisionTypes=e,this}setContactForceEventThreshold(e){return this.contactForceEventThreshold=e,this}}class DO{constructor(e){this.raw=e||new St,this.map=new Om,e&&e.forEachColliderHandle(t=>{this.map.set(t,new XS(this,t,null))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}castClosure(e){return t=>{if(e)return e(this.get(t))}}finalizeDeserialization(e){this.map.forEach(t=>t.finalizeDeserialization(e))}createCollider(e,t,r){let i=r!=null&&r!=null;if(i&&isNaN(r))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let o=t.shape.intoRaw(),s=W.intoRaw(t.translation),a=Qe.intoRaw(t.rotation),l=W.intoRaw(t.centerOfMass),c=this.raw.createCollider(t.enabled,o,s,a,t.massPropsMode,t.mass,l,t.principalAngularInertia,t.density,t.friction,t.restitution,t.frictionCombineRule,t.restitutionCombineRule,t.isSensor,t.collisionGroups,t.solverGroups,t.activeCollisionTypes,t.activeHooks,t.activeEvents,t.contactForceEventThreshold,i,i?r:0,e.raw);o.free(),s.free(),a.free(),l.free();let u=i?e.get(r):null,d=new XS(this,c,u,t.shape);return this.map.set(c,d),d}remove(e,t,r,i){this.raw.remove(e,t.raw,r.raw,i),this.unmap(e)}unmap(e){this.map.delete(e)}get(e){return this.map.get(e)}len(){return this.map.len()}contains(e){return this.get(e)!=null}forEach(e){this.map.forEach(e)}getAll(){return this.map.getAll()}}class LO{constructor(e){this.raw=e||new _m}free(){this.raw&&this.raw.free(),this.raw=void 0}step(e,t,r,i,o,s,a,l,c,u,d,h){let p=W.intoRaw(e);d?this.raw.stepWithEvents(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,u.raw,d.raw,h,h?h.filterContactPair:null,h?h.filterIntersectionPair:null):this.raw.step(p,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw,u.raw),p.free()}}var qS;(function(n){n[n.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",n[n.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",n[n.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",n[n.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",n[n.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",n[n.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",n[n.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",n[n.ONLY_FIXED=6]="ONLY_FIXED"})(qS||(qS={}));class zO{constructor(e){this.raw=e||new zd}free(){this.raw&&this.raw.free(),this.raw=void 0}update(e,t){this.raw.update(e.raw,t.raw)}castRay(e,t,r,i,o,s,a,l,c,u){let d=W.intoRaw(r.origin),h=W.intoRaw(r.dir),p=Dm.fromRaw(t,this.raw.castRay(e.raw,t.raw,d,h,i,o,s,a,l,c,u));return d.free(),h.free(),p}castRayAndGetNormal(e,t,r,i,o,s,a,l,c,u){let d=W.intoRaw(r.origin),h=W.intoRaw(r.dir),p=Yd.fromRaw(t,this.raw.castRayAndGetNormal(e.raw,t.raw,d,h,i,o,s,a,l,c,u));return d.free(),h.free(),p}intersectionsWithRay(e,t,r,i,o,s,a,l,c,u,d){let h=W.intoRaw(r.origin),p=W.intoRaw(r.dir),g=f=>s(Yd.fromRaw(t,f));this.raw.intersectionsWithRay(e.raw,t.raw,h,p,i,o,g,a,l,c,u,d),h.free(),p.free()}intersectionWithShape(e,t,r,i,o,s,a,l,c,u){let d=W.intoRaw(r),h=Qe.intoRaw(i),p=o.intoRaw(),g=this.raw.intersectionWithShape(e.raw,t.raw,d,h,p,s,a,l,c,u);return d.free(),h.free(),p.free(),g}projectPoint(e,t,r,i,o,s,a,l,c){let u=W.intoRaw(r),d=Kd.fromRaw(t,this.raw.projectPoint(e.raw,t.raw,u,i,o,s,a,l,c));return u.free(),d}projectPointAndGetFeature(e,t,r,i,o,s,a,l){let c=W.intoRaw(r),u=Kd.fromRaw(t,this.raw.projectPointAndGetFeature(e.raw,t.raw,c,i,o,s,a,l));return c.free(),u}intersectionsWithPoint(e,t,r,i,o,s,a,l,c){let u=W.intoRaw(r);this.raw.intersectionsWithPoint(e.raw,t.raw,u,i,o,s,a,l,c),u.free()}castShape(e,t,r,i,o,s,a,l,c,u,d,h,p){let g=W.intoRaw(r),f=Qe.intoRaw(i),m=W.intoRaw(o),v=s.intoRaw(),b=Xd.fromRaw(t,this.raw.castShape(e.raw,t.raw,g,f,m,v,a,l,c,u,d,h,p));return g.free(),f.free(),m.free(),v.free(),b}intersectionsWithShape(e,t,r,i,o,s,a,l,c,u,d){let h=W.intoRaw(r),p=Qe.intoRaw(i),g=o.intoRaw();this.raw.intersectionsWithShape(e.raw,t.raw,h,p,g,s,a,l,c,u,d),h.free(),p.free(),g.free()}collidersWithAabbIntersectingAabb(e,t,r){let i=W.intoRaw(e),o=W.intoRaw(t);this.raw.collidersWithAabbIntersectingAabb(i,o,r),i.free(),o.free()}}class ZS{constructor(e){this.raw=e||new Im}free(){this.raw&&this.raw.free(),this.raw=void 0}serializeAll(e,t,r,i,o,s,a,l,c){let u=W.intoRaw(e);const d=this.raw.serializeAll(u,t.raw,r.raw,i.raw,o.raw,s.raw,a.raw,l.raw,c.raw);return u.free(),d}deserializeAll(e){return Fm.fromRaw(this.raw.deserializeAll(e))}}class NO{constructor(e,t){this.vertices=e,this.colors=t}}class FO{constructor(e){this.raw=e||new Sm}free(){this.raw&&this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(e,t,r,i,o){this.raw.render(e.raw,t.raw,r.raw,i.raw,o.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}class $O{}class BO{constructor(e,t,r,i,o){this.params=t,this.bodies=r,this.colliders=i,this.queries=o,this.raw=new xm(e),this.rawCharacterCollision=new Dd,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(e){let t=W.intoRaw(e);return this.raw.setUp(t)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(e){this._applyImpulsesToDynamicBodies=e}characterMass(){return this._characterMass}setCharacterMass(e){this._characterMass=e}offset(){return this.raw.offset()}setOffset(e){this.raw.setOffset(e)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(e){this.raw.setSlideEnabled(e)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(e,t,r){this.raw.enableAutostep(e,t,r)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(e){this.raw.setMaxSlopeClimbAngle(e)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(e){this.raw.setMinSlopeSlideAngle(e)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(e){this.raw.enableSnapToGround(e)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(e,t,r,i,o){let s=W.intoRaw(t);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,e.handle,s,this._applyImpulsesToDynamicBodies,this._characterMass,r,i,this.colliders.castClosure(o)),s.free()}computedMovement(){return W.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(e,t){if(this.raw.computedCollision(e,this.rawCharacterCollision)){let r=this.rawCharacterCollision;return t=t??new $O,t.translationApplied=W.fromRaw(r.translationApplied()),t.translationRemaining=W.fromRaw(r.translationRemaining()),t.toi=r.toi(),t.witness1=W.fromRaw(r.worldWitness1()),t.witness2=W.fromRaw(r.worldWitness2()),t.normal1=W.fromRaw(r.worldNormal1()),t.normal2=W.fromRaw(r.worldNormal2()),t.collider=this.colliders.get(r.handle()),t}else return null}}class Fm{constructor(e,t,r,i,o,s,a,l,c,u,d,h,p,g){this.gravity=e,this.integrationParameters=new SO(t),this.islands=new AO(r),this.broadPhase=new jO(i),this.narrowPhase=new RO(o),this.bodies=new vO(s),this.colliders=new DO(a),this.impulseJoints=new CO(l),this.multibodyJoints=new MO(c),this.ccdSolver=new TO(u),this.queryPipeline=new zO(d),this.physicsPipeline=new LO(h),this.serializationPipeline=new ZS(p),this.debugRenderPipeline=new FO(g),this.characterControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach(e=>e.free()),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0}static fromRaw(e){return e?new Fm(W.fromRaw(e.takeGravity()),e.takeIntegrationParameters(),e.takeIslandManager(),e.takeBroadPhase(),e.takeNarrowPhase(),e.takeBodies(),e.takeColliders(),e.takeImpulseJoints(),e.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(e){return new ZS().deserializeAll(e)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new NO(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(e,t){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,e,t),this.queryPipeline.update(this.bodies,this.colliders)}propagateModifiedBodyPositionsToColliders(){this.bodies.raw.propagateModifiedBodyPositionsToColliders(this.colliders.raw)}updateSceneQueries(){this.propagateModifiedBodyPositionsToColliders(),this.queryPipeline.update(this.bodies,this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(e){this.integrationParameters.dt=e}get maxVelocityIterations(){return this.integrationParameters.maxVelocityIterations}set maxVelocityIterations(e){this.integrationParameters.maxVelocityIterations=e}get maxVelocityFrictionIterations(){return this.integrationParameters.maxVelocityFrictionIterations}set maxVelocityFrictionIterations(e){this.integrationParameters.maxVelocityFrictionIterations=e}get maxStabilizationIterations(){return this.integrationParameters.maxStabilizationIterations}set maxStabilizationIterations(e){this.integrationParameters.maxStabilizationIterations=e}createRigidBody(e){return this.bodies.createRigidBody(this.colliders,e)}createCharacterController(e){let t=new BO(e,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(t),t}removeCharacterController(e){this.characterControllers.delete(e),e.free()}createCollider(e,t){let r=t?t.handle:void 0;return this.colliders.createCollider(this.bodies,e,r)}createImpulseJoint(e,t,r,i){return this.impulseJoints.createJoint(this.bodies,e,t.handle,r.handle,i)}createMultibodyJoint(e,t,r,i){return this.multibodyJoints.createJoint(e,t.handle,r.handle,i)}getRigidBody(e){return this.bodies.get(e)}getCollider(e){return this.colliders.get(e)}getImpulseJoint(e){return this.impulseJoints.get(e)}getMultibodyJoint(e){return this.multibodyJoints.get(e)}removeRigidBody(e){this.bodies&&this.bodies.remove(e.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(e,t){this.colliders&&this.colliders.remove(e.handle,this.islands,this.bodies,t)}removeImpulseJoint(e,t){this.impulseJoints&&this.impulseJoints.remove(e.handle,t)}removeMultibodyJoint(e,t){this.impulseJoints&&this.multibodyJoints.remove(e.handle,t)}forEachCollider(e){this.colliders.forEach(e)}forEachRigidBody(e){this.bodies.forEach(e)}forEachActiveRigidBody(e){this.bodies.forEachActiveRigidBody(this.islands,e)}castRay(e,t,r,i,o,s,a,l){return this.queryPipeline.castRay(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}castRayAndGetNormal(e,t,r,i,o,s,a,l){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l))}intersectionsWithRay(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,e,t,r,i,o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}intersectionWithShape(e,t,r,i,o,s,a,l){let c=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,e,t,r,i,o,s?s.handle:null,a?a.handle:null,this.colliders.castClosure(l));return c!=null?this.colliders.get(c):null}projectPoint(e,t,r,i,o,s,a){return this.queryPipeline.projectPoint(this.bodies,this.colliders,e,t,r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}projectPointAndGetFeature(e,t,r,i,o,s){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,e,t,r,i?i.handle:null,o?o.handle:null,this.colliders.castClosure(s))}intersectionsWithPoint(e,t,r,i,o,s,a){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,e,this.colliders.castClosure(t),r,i,o?o.handle:null,s?s.handle:null,this.colliders.castClosure(a))}castShape(e,t,r,i,o,s,a,l,c,u,d){return this.queryPipeline.castShape(this.bodies,this.colliders,e,t,r,i,o,s,a,l,c?c.handle:null,u?u.handle:null,this.colliders.castClosure(d))}intersectionsWithShape(e,t,r,i,o,s,a,l,c){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,e,t,r,this.colliders.castClosure(i),o,s,a?a.handle:null,l?l.handle:null,this.colliders.castClosure(c))}collidersWithAabbIntersectingAabb(e,t,r){this.queryPipeline.collidersWithAabbIntersectingAabb(e,t,this.colliders.castClosure(r))}contactsWith(e,t){this.narrowPhase.contactsWith(e.handle,this.colliders.castClosure(t))}intersectionsWith(e,t){this.narrowPhase.intersectionsWith(e.handle,this.colliders.castClosure(t))}contactPair(e,t,r){this.narrowPhase.contactPair(e.handle,t.handle,r)}intersectionPair(e,t){return this.narrowPhase.intersectionPair(e.handle,t.handle)}}var JS;(function(n){n[n.COLLISION_EVENTS=1]="COLLISION_EVENTS",n[n.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(JS||(JS={}));class UO{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return W.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return W.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class bde{constructor(e,t){this.raw=t||new Ld(e)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(e){this.raw.drainCollisionEvents(e)}drainContactForceEvents(e){let t=new UO;this.raw.drainContactForceEvents(r=>{t.raw=r,e(t),t.free()})}clear(){this.raw.clear()}}var QS;(function(n){n[n.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",n[n.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(QS||(QS={}));var ex;(function(n){n[n.EMPTY=0]="EMPTY",n[n.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"})(ex||(ex={}));function vde(){return uie()}const Xn=Object.freeze(Object.defineProperty({__proto__:null,get ActiveCollisionTypes(){return Nm},get ActiveEvents(){return JS},get ActiveHooks(){return QS},Ball:NS,BroadPhase:jO,CCDSolver:TO,Capsule:US,CharacterCollision:$O,get CoefficientCombineRule(){return Hd},Collider:XS,ColliderDesc:en,ColliderSet:DO,ConvexPolygon:Lm,Cuboid:$S,DebugRenderBuffers:NO,DebugRenderPipeline:FO,EventQueue:bde,get FeatureType(){return dc},FixedImpulseJoint:xO,FixedMultibodyJoint:PO,HalfSpace:FS,Heightfield:YS,ImpulseJoint:ba,ImpulseJointSet:CO,IntegrationParameters:SO,IslandManager:AO,JointData:Vd,get JointType(){return Rn},KinematicCharacterController:BO,get MassPropsMode(){return Sa},get MotorModel(){return DS},MultibodyJoint:va,MultibodyJointSet:MO,NarrowPhase:RO,PhysicsPipeline:LO,PointColliderProjection:Kd,PointProjection:Wd,Polyline:KS,PrismaticImpulseJoint:_O,PrismaticMultibodyJoint:EO,get QueryFilterFlags(){return qS},QueryPipeline:zO,Ray:wde,RayColliderIntersection:Yd,RayColliderToi:Dm,RayIntersection:Gd,RevoluteImpulseJoint:kO,RevoluteMultibodyJoint:IO,RigidBody:OS,RigidBodyDesc:Hi,RigidBodySet:vO,get RigidBodyType(){return hi},RotationOps:Qe,RoundConvexPolygon:zm,RoundCuboid:BS,RoundTriangle:WS,Segment:VS,SerializationPipeline:ZS,Shape:On,ShapeColliderTOI:Xd,ShapeContact:uc,ShapeTOI:hc,get ShapeType(){return Ge},get SolverFlags(){return ex},TempContactForceEvent:UO,TempContactManifold:OO,TriMesh:GS,Triangle:HS,UnitImpulseJoint:LS,UnitMultibodyJoint:zS,Vector2:bO,VectorOps:W,World:Fm,version:vde},Symbol.toStringTag,{value:"Module"})),VO={x:0,y:98};function tx(n){return!(!n||n==="black")}function Sde(n){return n==="grey"?0:1}function xde(n){return n==="orange"?.9:0}function _de(n){return n==="blue"?.1:.8}const HO={defaultRestitution:0,defaultFriction:.1},qn={up:{x:0,y:-1},additionalMass:20,maxSlopeClimbAngle:1,slideEnabled:!0,minSlopeSlideAngle:.9,applyImpulsesToDynamicBodies:!0,autostepHeight:5,autostepMaxClimbAngle:1,snapToGroundDistance:3,maxMoveSpeedX:100,moveAcceleration:600,moveDeceleration:500,jumpVelocity:300,gravityMultiplier:10},nx=(n,e,t,r,i)=>{const o=Math.cos(i),s=Math.sin(i);return{x:o*(t-n)-s*(r-e)+n,y:s*(t-n)+o*(r-e)+e}},qd=({x:n,y:e,width:t,height:r,rotation:i,parentGroupShape:o})=>{const s=n+t/2,a=e+r/2;return o?nx(o.x,o.y,s,a,i):nx(n,e,s,a,i)},kde=({x:n,y:e,width:t,height:r,rotation:i})=>{const o=n-t/2,s=e-r/2;return nx(n,e,o,s,i)},Cde=(n,e,t,r,i)=>{let o=e.x===0&&n.x!==0?Math.max(Math.abs(n.x)-i*t,0)*Math.sign(n.x):n.x+e.x*t;o=Math.min(Math.abs(o),r)*Math.sign(o);const s=(n.x+o)/2*t,a=n.y*t+.5*e.y*t**2;return{x:s,y:a}},WO=(n,e,t)=>{const r=new Float32Array(n.length*2),i=e/2,o=t/2;for(let s=0;s<n.length;s++)r[s*2]=n[s].x-i,r[s*2+1]=n[s].y-o;return r},Pde=n=>!(n.type==="geo"&&n.props.geo==="rectangle");class Ede extends rO{constructor(t){super(t);w(this,"id","physics");w(this,"world");w(this,"rigidbodyLookup");w(this,"colliderLookup");w(this,"exogenousShapes");w(this,"characterLookup");w(this,"animFrame",-1);w(this,"getShapeDimensionsOrBounds",t=>{let r,i;if(t.type==="geo"){const o=t;r=o.props.w,i=o.props.h}else{const o=this.editor.getShapeGeometry(t);r=o.bounds.x,i=o.bounds.y}return{w:r,h:i}});this.world=new Xn.World(VO),this.rigidbodyLookup=new Map,this.colliderLookup=new Map,this.characterLookup=new Map,this.exogenousShapes=new Set,this.simStart()}onAdd(t){const r=new Set;for(const i of t)if(i.type!=="arrow"){if("graph"in i.meta&&this.exogenousShapes.add(i.id),i.parentId!=="page:page"){r.add(i.parentId);continue}if(i.type==="group"){r.add(i.id);continue}if(!(this.colliderLookup.has(i.id)||this.rigidbodyLookup.has(i.id)))if("color"in i.props&&i.props.color==="violet")this.createCharacterObject(i);else switch(i.type){case"draw":this.createCompoundLineObject(i);break;case"group":this.createGroupObject(i);break;default:this.createShape(i);break}}for(const i of r){const o=this.editor.getShape(i);!o||o.type!=="group"||this.createGroupObject(o)}}onRemove(t){for(const r of t){if(this.exogenousShapes.delete(r.id),this.rigidbodyLookup.has(r.id)){const i=this.rigidbodyLookup.get(r.id);if(!i)continue;this.world.removeRigidBody(i),this.rigidbodyLookup.delete(r.id)}if(this.colliderLookup.has(r.id)){const i=this.colliderLookup.get(r.id);if(!i)continue;this.world.removeCollider(i,!0),this.colliderLookup.delete(r.id)}if(this.characterLookup.has(r.id)){const i=this.characterLookup.get(r.id);if(!i)continue;this.world.removeCharacterController(i.controller),this.characterLookup.delete(r.id)}}}onShapeChange(t,r){t.meta!==r.meta&&("graph"in r.meta?this.exogenousShapes.add(r.id):this.exogenousShapes.delete(r.id)),t.props.color,r.props.color}simStart(){const t=()=>{this.world.step(),this.updateCharacterControllers(),this.updateRigidbodies(),this.updateKinematic(),this.animFrame=requestAnimationFrame(t)};return t(),()=>cancelAnimationFrame(this.animFrame)}simStop(){this.animFrame!==-1&&(cancelAnimationFrame(this.animFrame),this.animFrame=-1)}addCollider(t,r,i){const o=this.world.createCollider(r,i);return o&&this.colliderLookup.set(t,o),o}addRigidbody(t,r){const i=this.world.createRigidBody(r);return i&&this.rigidbodyLookup.set(t,i),i}addCharacter(t){const r=this.world.createCharacterController(.1);return r.setUp(qn.up),r.setMaxSlopeClimbAngle(qn.maxSlopeClimbAngle),r.setSlideEnabled(qn.slideEnabled),r.setMinSlopeSlideAngle(qn.minSlopeSlideAngle),r.setApplyImpulsesToDynamicBodies(qn.applyImpulsesToDynamicBodies),r.enableAutostep(qn.autostepHeight,qn.autostepMaxClimbAngle,!0),r.enableSnapToGround(qn.snapToGroundDistance),this.characterLookup.set(t,{controller:r,id:t}),r}createShape(t){if(!("dash"in t.props&&t.props.dash==="dashed"))if("color"in t.props&&tx(t.props.color)){const r=Sde(t.props.color),i=this.createRigidbodyObject(t,r);this.createColliderObject(t,i)}else this.createColliderObject(t)}createCharacterObject(t){const r=qd({x:t.x,y:t.y,width:t.props.w,height:t.props.h,rotation:t.rotation}),i=this.editor.getShapeGeometry(t).vertices,o=WO(i,t.props.w,t.props.h),s=Xn.ColliderDesc.convexHull(o);if(!s){console.error("Failed to create collider description.");return}const a=Xn.RigidBodyDesc.kinematicPositionBased().setTranslation(r.x,r.y).setAdditionalMass(qn.additionalMass);a.userData={id:t.id,type:t.type,w:t.props.w,h:t.props.h,rbType:Xn.RigidBodyType.KinematicPositionBased};const l=this.addRigidbody(t.id,a);this.addCollider(t.id,s,l),this.addCharacter(t.id)}createGroupObject(t){const r=this.createRigidbodyObject(t);this.editor.getSortedChildIdsForParent(t.id).forEach(i=>{const o=this.editor.getShape(i);o&&("color"in o.props&&tx(o.props.color)?this.createColliderObject(o,r,t):this.createColliderObject(o))})}createCompoundLineObject(t){const r=this.createRigidbodyObject(t),i=this.editor.getShapeGeometry(t).vertices,o="color"in t.props&&tx(t.props.color);i.forEach(s=>{o?this.createColliderRelativeToParentObject(s,t,r):this.createColliderRelativeToParentObject(s,t)})}createRigidbodyObject(t,r=1){const{w:i,h:o}=this.getShapeDimensionsOrBounds(t),s=qd({x:t.x,y:t.y,width:i,height:o,rotation:t.rotation}),a=Xn.RigidBodyDesc.dynamic().setTranslation(s.x,s.y).setRotation(t.rotation).setGravityScale(r);return a.userData={id:t.id,type:t.type,w:i,h:o,rbType:Xn.RigidBodyType.Dynamic},this.addRigidbody(t.id,a)}createColliderRelativeToParentObject(t,r,i=null){const o=qd({x:t.x,y:t.y,width:3,height:3,rotation:0,parentGroupShape:r});let s=null;if(s=Xn.ColliderDesc.ball(3),!s){console.error("Failed to create collider description.");return}i?(s.setTranslation(o.x,o.y),this.addCollider(r.id,s,i)):(s.setTranslation(r.x+o.x,r.y+o.y),this.addCollider(r.id,s))}createColliderObject(t,r=null,i=void 0){const{w:o,h:s}=this.getShapeDimensionsOrBounds(t),a=i?this.editor.getShape(i.id):void 0,l=qd({x:t.x,y:t.y,width:o,height:s,rotation:t.rotation,parentGroupShape:a}),c="color"in t.props?xde(t.props.color):HO.defaultRestitution,u="color"in t.props?_de(t.props.color):HO.defaultFriction;let d=null;if(Pde(t)){const h=this.editor.getShapeGeometry(t).vertices,p=WO(h,o,s);d=Xn.ColliderDesc.convexHull(p)}else d=Xn.ColliderDesc.cuboid(o/2,s/2);if(!d){console.error("Failed to create collider description.");return}d.setRestitution(c).setRestitutionCombineRule(Xn.CoefficientCombineRule.Max).setFriction(u).setFrictionCombineRule(Xn.CoefficientCombineRule.Min),r?(i&&(d.setTranslation(l.x,l.y),d.setRotation(t.rotation)),this.addCollider(t.id,d,r)):(d.setTranslation(l.x,l.y).setRotation(t.rotation),this.addCollider(t.id,d))}updateRigidbodies(){this.world.bodies.forEach(t=>{if(!t.userData)return;const r=t.userData;if(this.editor.getSelectedShapeIds().includes(r.id)||this.exogenousShapes.has(r.id))return;t.setBodyType(r.rbType,!0);const i=t.translation(),o=t.rotation(),s=kde({x:i.x,y:i.y,width:r.w,height:r.h,rotation:o});this.editor.updateShape({id:r.id,type:r.type,rotation:o,x:s.x,y:s.y})})}updateKinematic(){const t=new Set([...this.exogenousShapes,...this.editor.getSelectedShapeIds()]);for(const r of t){const i=this.editor.getShape(r);if(!i)continue;const o=this.colliderLookup.get(r),s=this.rigidbodyLookup.get(r),{w:a,h:l}=this.getShapeDimensionsOrBounds(i),c=qd({x:i.x,y:i.y,width:a,height:l,rotation:i.rotation});if(o&&s){const u=s.userData;s.isKinematic()||s.setBodyType(Xn.RigidBodyType.KinematicPositionBased,!0),s.setNextKinematicTranslation({x:c.x,y:c.y}),s.setNextKinematicRotation(i.rotation),o.setHalfExtents({x:a/2,y:l/2}),u.w=a,u.h=l;continue}if(s){s.isKinematic()||s.setBodyType(Xn.RigidBodyType.KinematicPositionBased,!0),s.setNextKinematicTranslation({x:c.x,y:c.y}),s.setNextKinematicRotation(i.rotation);continue}o&&(o.setTranslation({x:c.x,y:c.y}),o.setRotation(i.rotation),o.setHalfExtents({x:a/2,y:l/2}))}}updateCharacterControllers(){const t=this.editor.inputs.keys.has("ArrowRight")?1:0,r=this.editor.inputs.keys.has("ArrowLeft")?-1:0,i={x:(t+r)*qn.moveAcceleration,y:qn.gravityMultiplier*VO.y};for(const o of this.characterLookup.values()){const s=this.rigidbodyLookup.get(o.id);if(!s)continue;const a=s.userData,l=this.colliderLookup.get(o.id),c=o.controller.computedGrounded(),u=this.editor.inputs.keys.has("ArrowUp")&&c,d={x:s.linvel().x,y:u?-qn.jumpVelocity:s.linvel().y},h=Cde(d,i,1/60,qn.maxMoveSpeedX,qn.moveDeceleration);o.controller.computeColliderMovement(l,new Xn.Vector2(h.x,h.y));const p=o.controller.computedMovement(),g=s.translation(),f=g.x+p.x,m=g.y+p.y;s==null||s.setNextKinematicTranslation({x:f,y:m});const v=a.w,b=a.h;this.editor.updateShape({id:a.id,type:a.type,x:f-v/2,y:m-b/2})}}}var KO={},$m={},pc={},To={};Object.defineProperty(To,"__esModule",{value:!0});var rx=function(){function n(e,t,r){this.source=e,this.target=t,this.type=r}return n}();To.PowerEdge=rx;var GO=function(){function n(e,t,r,i){var o=this;if(this.linkAccessor=r,this.modules=new Array(e),this.roots=[],i)this.initModulesFromGroup(i);else{this.roots.push(new fc);for(var s=0;s<e;++s)this.roots[0].add(this.modules[s]=new Zd(s))}this.R=t.length,t.forEach(function(a){var l=o.modules[r.getSourceIndex(a)],c=o.modules[r.getTargetIndex(a)],u=r.getType(a);l.outgoing.add(u,c),c.incoming.add(u,l)})}return n.prototype.initModulesFromGroup=function(e){var t=new fc;this.roots.push(t);for(var r=0;r<e.leaves.length;++r){var i=e.leaves[r],o=new Zd(i.id);this.modules[i.id]=o,t.add(o)}if(e.groups)for(var s=0;s<e.groups.length;++s){var a=e.groups[s],l={};for(var c in a)c!=="leaves"&&c!=="groups"&&a.hasOwnProperty(c)&&(l[c]=a[c]);t.add(new Zd(-1-s,new Jd,new Jd,this.initModulesFromGroup(a),l))}return t},n.prototype.merge=function(e,t,r){r===void 0&&(r=0);var i=e.incoming.intersection(t.incoming),o=e.outgoing.intersection(t.outgoing),s=new fc;s.add(e),s.add(t);var a=new Zd(this.modules.length,o,i,s);this.modules.push(a);var l=function(c,u,d){c.forAll(function(h,p){h.forAll(function(g){var f=g[u];f.add(p,a),f.remove(p,e),f.remove(p,t),e[d].remove(p,g),t[d].remove(p,g)})})};return l(o,"incoming","outgoing"),l(i,"outgoing","incoming"),this.R-=i.count()+o.count(),this.roots[r].remove(e),this.roots[r].remove(t),this.roots[r].add(a),a},n.prototype.rootMerges=function(e){e===void 0&&(e=0);for(var t=this.roots[e].modules(),r=t.length,i=new Array(r*(r-1)),o=0,s=0,a=r-1;s<a;++s)for(var l=s+1;l<r;++l){var c=t[s],u=t[l];i[o]={id:o,nEdges:this.nEdges(c,u),a:c,b:u},o++}return i},n.prototype.greedyMerge=function(){for(var e=0;e<this.roots.length;++e)if(!(this.roots[e].modules().length<2)){var t=this.rootMerges(e).sort(function(i,o){return i.nEdges==o.nEdges?i.id-o.id:i.nEdges-o.nEdges}),r=t[0];if(!(r.nEdges>=this.R))return this.merge(r.a,r.b,e),!0}},n.prototype.nEdges=function(e,t){var r=e.incoming.intersection(t.incoming),i=e.outgoing.intersection(t.outgoing);return this.R-r.count()-i.count()},n.prototype.getGroupHierarchy=function(e){var t=this,r=[],i={};YO(this.roots[0],i,r);var o=this.allEdges();return o.forEach(function(s){var a=t.modules[s.source],l=t.modules[s.target];e.push(new rx(typeof a.gid>"u"?s.source:r[a.gid],typeof l.gid>"u"?s.target:r[l.gid],s.type))}),r},n.prototype.allEdges=function(){var e=[];return n.getEdges(this.roots[0],e),e},n.getEdges=function(e,t){e.forAll(function(r){r.getEdges(t),n.getEdges(r.children,t)})},n}();To.Configuration=GO;function YO(n,e,t){n.forAll(function(r){if(r.isLeaf())e.leaves||(e.leaves=[]),e.leaves.push(r.id);else{var i=e;if(r.gid=t.length,!r.isIsland()||r.isPredefined()){if(i={id:r.gid},r.isPredefined())for(var o in r.definition)i[o]=r.definition[o];e.groups||(e.groups=[]),e.groups.push(r.gid),t.push(i)}YO(r.children,i,t)}})}var Zd=function(){function n(e,t,r,i,o){t===void 0&&(t=new Jd),r===void 0&&(r=new Jd),i===void 0&&(i=new fc),this.id=e,this.outgoing=t,this.incoming=r,this.children=i,this.definition=o}return n.prototype.getEdges=function(e){var t=this;this.outgoing.forAll(function(r,i){r.forAll(function(o){e.push(new rx(t.id,o.id,i))})})},n.prototype.isLeaf=function(){return this.children.count()===0},n.prototype.isIsland=function(){return this.outgoing.count()===0&&this.incoming.count()===0},n.prototype.isPredefined=function(){return typeof this.definition<"u"},n}();To.Module=Zd;function Ide(n,e){var t={};for(var r in n)r in e&&(t[r]=n[r]);return t}var fc=function(){function n(){this.table={}}return n.prototype.count=function(){return Object.keys(this.table).length},n.prototype.intersection=function(e){var t=new n;return t.table=Ide(this.table,e.table),t},n.prototype.intersectionCount=function(e){return this.intersection(e).count()},n.prototype.contains=function(e){return e in this.table},n.prototype.add=function(e){this.table[e.id]=e},n.prototype.remove=function(e){delete this.table[e.id]},n.prototype.forAll=function(e){for(var t in this.table)e(this.table[t])},n.prototype.modules=function(){var e=[];return this.forAll(function(t){t.isPredefined()||e.push(t)}),e},n}();To.ModuleSet=fc;var Jd=function(){function n(){this.sets={},this.n=0}return n.prototype.count=function(){return this.n},n.prototype.contains=function(e){var t=!1;return this.forAllModules(function(r){!t&&r.id==e&&(t=!0)}),t},n.prototype.add=function(e,t){var r=e in this.sets?this.sets[e]:this.sets[e]=new fc;r.add(t),++this.n},n.prototype.remove=function(e,t){var r=this.sets[e];r.remove(t),r.count()===0&&delete this.sets[e],--this.n},n.prototype.forAll=function(e){for(var t in this.sets)e(this.sets[t],Number(t))},n.prototype.forAllModules=function(e){this.forAll(function(t,r){return t.forAll(e)})},n.prototype.intersection=function(e){var t=new n;return this.forAll(function(r,i){if(i in e.sets){var o=r.intersection(e.sets[i]),s=o.count();s>0&&(t.sets[i]=o,t.n+=s)}}),t},n}();To.LinkSets=Jd;function Mde(n,e,t,r){for(var i=n.length,o=new GO(i,e,t,r);o.greedyMerge(););var s=[],a=o.getGroupHierarchy(s);return s.forEach(function(l){var c=function(u){var d=l[u];typeof d=="number"&&(l[u]=n[d])};c("source"),c("target")}),{groups:a,powerEdges:s}}To.getGroups=Mde;var Is={};Object.defineProperty(Is,"__esModule",{value:!0});function XO(n,e){var t={};for(var r in n)t[r]={};for(var r in e)t[r]={};return Object.keys(t).length}function qO(n,e){var t=0;for(var r in n)typeof e[r]<"u"&&++t;return t}function Tde(n,e){var t={},r=function(i,o){typeof t[i]>"u"&&(t[i]={}),t[i][o]={}};return n.forEach(function(i){var o=e.getSourceIndex(i),s=e.getTargetIndex(i);r(o,s),r(s,o)}),t}function ZO(n,e,t,r){var i=Tde(n,r);n.forEach(function(o){var s=i[r.getSourceIndex(o)],a=i[r.getTargetIndex(o)];r.setLength(o,1+e*t(s,a))})}function Ade(n,e,t){t===void 0&&(t=1),ZO(n,t,function(r,i){return Math.sqrt(XO(r,i)-qO(r,i))},e)}Is.symmetricDiffLinkLengths=Ade;function jde(n,e,t){t===void 0&&(t=1),ZO(n,t,function(r,i){return Math.min(Object.keys(r).length,Object.keys(i).length)<1.1?0:qO(r,i)/XO(r,i)},e)}Is.jaccardLinkLengths=jde;function Rde(n,e,t,r){var i=JO(n,e,r),o={};i.forEach(function(a,l){return a.forEach(function(c){return o[c]=l})});var s=[];return e.forEach(function(a){var l=r.getSourceIndex(a),c=r.getTargetIndex(a),u=o[l],d=o[c];u!==d&&s.push({axis:t,left:l,right:c,gap:r.getMinSeparation(a)})}),s}Is.generateDirectedEdgeConstraints=Rde;function JO(n,e,t){var r=[],i=0,o=[],s=[];function a(v){v.index=v.lowlink=i++,o.push(v),v.onStack=!0;for(var b=0,_=v.out;b<_.length;b++){var x=_[b];typeof x.index>"u"?(a(x),v.lowlink=Math.min(v.lowlink,x.lowlink)):x.onStack&&(v.lowlink=Math.min(v.lowlink,x.index))}if(v.lowlink===v.index){for(var C=[];o.length&&(x=o.pop(),x.onStack=!1,C.push(x),x!==v););s.push(C.map(function(k){return k.id}))}}for(var l=0;l<n;l++)r.push({id:l,out:[]});for(var c=0,u=e;c<u.length;c++){var d=u[c],h=r[t.getSourceIndex(d)],p=r[t.getTargetIndex(d)];h.out.push(p)}for(var g=0,f=r;g<f.length;g++){var m=f[g];typeof m.index>"u"&&a(m)}return s}Is.stronglyConnectedComponents=JO;var xa={};Object.defineProperty(xa,"__esModule",{value:!0});var QO=function(){function n(){this.locks={}}return n.prototype.add=function(e,t){this.locks[e]=t},n.prototype.clear=function(){this.locks={}},n.prototype.isEmpty=function(){for(var e in this.locks)return!1;return!0},n.prototype.apply=function(e){for(var t in this.locks)e(Number(t),this.locks[t])},n}();xa.Locks=QO;var Ode=function(){function n(e,t,r){r===void 0&&(r=null),this.D=t,this.G=r,this.threshold=1e-4,this.numGridSnapNodes=0,this.snapGridSize=100,this.snapStrength=1e3,this.scaleSnapByMaxH=!1,this.random=new e4,this.project=null,this.x=e,this.k=e.length;var i=this.n=e[0].length;this.H=new Array(this.k),this.g=new Array(this.k),this.Hd=new Array(this.k),this.a=new Array(this.k),this.b=new Array(this.k),this.c=new Array(this.k),this.d=new Array(this.k),this.e=new Array(this.k),this.ia=new Array(this.k),this.ib=new Array(this.k),this.xtmp=new Array(this.k),this.locks=new QO,this.minD=Number.MAX_VALUE;for(var o=i,s;o--;)for(s=i;--s>o;){var a=t[o][s];a>0&&a<this.minD&&(this.minD=a)}for(this.minD===Number.MAX_VALUE&&(this.minD=1),o=this.k;o--;){for(this.g[o]=new Array(i),this.H[o]=new Array(i),s=i;s--;)this.H[o][s]=new Array(i);this.Hd[o]=new Array(i),this.a[o]=new Array(i),this.b[o]=new Array(i),this.c[o]=new Array(i),this.d[o]=new Array(i),this.e[o]=new Array(i),this.ia[o]=new Array(i),this.ib[o]=new Array(i),this.xtmp[o]=new Array(i)}}return n.createSquareMatrix=function(e,t){for(var r=new Array(e),i=0;i<e;++i){r[i]=new Array(e);for(var o=0;o<e;++o)r[i][o]=t(i,o)}return r},n.prototype.offsetDir=function(){for(var e=this,t=new Array(this.k),r=0,i=0;i<this.k;++i){var o=t[i]=this.random.getNextBetween(.01,1)-.5;r+=o*o}return r=Math.sqrt(r),t.map(function(s){return s*=e.minD/r})},n.prototype.computeDerivatives=function(e){var t=this,r=this.n;if(!(r<1)){for(var i,o=new Array(this.k),s=new Array(this.k),a=new Array(this.k),l=0,c=0;c<r;++c){for(i=0;i<this.k;++i)a[i]=this.g[i][c]=0;for(var u=0;u<r;++u)if(c!==u){for(var d=r;d--;){var h=0;for(i=0;i<this.k;++i){var p=o[i]=e[i][c]-e[i][u];h+=s[i]=p*p}if(h>1e-9)break;var g=this.offsetDir();for(i=0;i<this.k;++i)e[i][u]+=g[i]}var f=Math.sqrt(h),m=this.D[c][u],v=this.G!=null?this.G[c][u]:1;if(v>1&&f>m||!isFinite(m)){for(i=0;i<this.k;++i)this.H[i][c][u]=0;continue}v>1&&(v=1);var b=m*m,_=2*v*(f-m)/(b*f),x=f*f*f,C=2*-v/(b*x);for(isFinite(_)||console.log(_),i=0;i<this.k;++i)this.g[i][c]+=o[i]*_,a[i]-=this.H[i][c][u]=C*(x+m*(s[i]-h)+f*h)}for(i=0;i<this.k;++i)l=Math.max(l,this.H[i][c][c]=a[i])}for(var k=this.snapGridSize/2,E=this.snapGridSize,I=this.snapStrength,T=I/(k*k),A=this.numGridSnapNodes,c=0;c<A;++c)for(i=0;i<this.k;++i){var D=this.x[i][c],N=D/E,U=N%1,R=N-U,B=Math.abs(U),p=B<=.5?D-R*E:D>0?D-(R+1)*E:D-(R-1)*E;-k<p&&p<=k&&(this.scaleSnapByMaxH?(this.g[i][c]+=l*T*p,this.H[i][c][c]+=l*T):(this.g[i][c]+=T*p,this.H[i][c][c]+=T))}this.locks.isEmpty()||this.locks.apply(function($,q){for(i=0;i<t.k;++i)t.H[i][$][$]+=l,t.g[i][$]-=l*(q[i]-e[i][$])})}},n.dotProd=function(e,t){for(var r=0,i=e.length;i--;)r+=e[i]*t[i];return r},n.rightMultiply=function(e,t,r){for(var i=e.length;i--;)r[i]=n.dotProd(e[i],t)},n.prototype.computeStepSize=function(e){for(var t=0,r=0,i=0;i<this.k;++i)t+=n.dotProd(this.g[i],e[i]),n.rightMultiply(this.H[i],e[i],this.Hd[i]),r+=n.dotProd(e[i],this.Hd[i]);return r===0||!isFinite(r)?0:1*t/r},n.prototype.reduceStress=function(){this.computeDerivatives(this.x);for(var e=this.computeStepSize(this.g),t=0;t<this.k;++t)this.takeDescentStep(this.x[t],this.g[t],e);return this.computeStress()},n.copy=function(e,t){for(var r=e.length,i=t[0].length,o=0;o<r;++o)for(var s=0;s<i;++s)t[o][s]=e[o][s]},n.prototype.stepAndProject=function(e,t,r,i){n.copy(e,t),this.takeDescentStep(t[0],r[0],i),this.project&&this.project[0](e[0],e[1],t[0]),this.takeDescentStep(t[1],r[1],i),this.project&&this.project[1](t[0],e[1],t[1]);for(var o=2;o<this.k;o++)this.takeDescentStep(t[o],r[o],i)},n.mApply=function(e,t,r){for(var i=e;i-- >0;)for(var o=t;o-- >0;)r(i,o)},n.prototype.matrixApply=function(e){n.mApply(this.k,this.n,e)},n.prototype.computeNextPosition=function(e,t){var r=this;this.computeDerivatives(e);var i=this.computeStepSize(this.g);if(this.stepAndProject(e,t,this.g,i),this.project){this.matrixApply(function(s,a){return r.e[s][a]=e[s][a]-t[s][a]});var o=this.computeStepSize(this.e);o=Math.max(.2,Math.min(o,1)),this.stepAndProject(e,t,this.e,o)}},n.prototype.run=function(e){for(var t=Number.MAX_VALUE,r=!1;!r&&e-- >0;){var i=this.rungeKutta();r=Math.abs(t/i-1)<this.threshold,t=i}return t},n.prototype.rungeKutta=function(){var e=this;this.computeNextPosition(this.x,this.a),n.mid(this.x,this.a,this.ia),this.computeNextPosition(this.ia,this.b),n.mid(this.x,this.b,this.ib),this.computeNextPosition(this.ib,this.c),this.computeNextPosition(this.c,this.d);var t=0;return this.matrixApply(function(r,i){var o=(e.a[r][i]+2*e.b[r][i]+2*e.c[r][i]+e.d[r][i])/6,s=e.x[r][i]-o;t+=s*s,e.x[r][i]=o}),t},n.mid=function(e,t,r){n.mApply(e.length,e[0].length,function(i,o){return r[i][o]=e[i][o]+(t[i][o]-e[i][o])/2})},n.prototype.takeDescentStep=function(e,t,r){for(var i=0;i<this.n;++i)e[i]=e[i]-r*t[i]},n.prototype.computeStress=function(){for(var e=0,t=0,r=this.n-1;t<r;++t)for(var i=t+1,o=this.n;i<o;++i){for(var s=0,a=0;a<this.k;++a){var l=this.x[a][t]-this.x[a][i];s+=l*l}s=Math.sqrt(s);var c=this.D[t][i];if(isFinite(c)){var u=c-s,d=c*c;e+=u*u/d}}return e},n.zeroDistance=1e-10,n}();xa.Descent=Ode;var e4=function(){function n(e){e===void 0&&(e=1),this.seed=e,this.a=214013,this.c=2531011,this.m=2147483648,this.range=32767}return n.prototype.getNext=function(){return this.seed=(this.seed*this.a+this.c)%this.m,(this.seed>>16)/this.range},n.prototype.getNextBetween=function(e,t){return e+this.getNext()*(t-e)},n}();xa.PseudoRandom=e4;var tn={},pi={};Object.defineProperty(pi,"__esModule",{value:!0});var t4=function(){function n(e){this.scale=e,this.AB=0,this.AD=0,this.A2=0}return n.prototype.addVariable=function(e){var t=this.scale/e.scale,r=e.offset/e.scale,i=e.weight;this.AB+=i*t*r,this.AD+=i*t*e.desiredPosition,this.A2+=i*t*t},n.prototype.getPosn=function(){return(this.AD-this.AB)/this.A2},n}();pi.PositionStats=t4;var Bm=function(){function n(e,t,r,i){i===void 0&&(i=!1),this.left=e,this.right=t,this.gap=r,this.equality=i,this.active=!1,this.unsatisfiable=!1,this.left=e,this.right=t,this.gap=r,this.equality=i}return n.prototype.slack=function(){return this.unsatisfiable?Number.MAX_VALUE:this.right.scale*this.right.position()-this.gap-this.left.scale*this.left.position()},n}();pi.Constraint=Bm;var Um=function(){function n(e,t,r){t===void 0&&(t=1),r===void 0&&(r=1),this.desiredPosition=e,this.weight=t,this.scale=r,this.offset=0}return n.prototype.dfdv=function(){return 2*this.weight*(this.position()-this.desiredPosition)},n.prototype.position=function(){return(this.block.ps.scale*this.block.posn+this.offset)/this.scale},n.prototype.visitNeighbours=function(e,t){var r=function(i,o){return i.active&&e!==o&&t(i,o)};this.cOut.forEach(function(i){return r(i,i.right)}),this.cIn.forEach(function(i){return r(i,i.left)})},n}();pi.Variable=Um;var ix=function(){function n(e){this.vars=[],e.offset=0,this.ps=new t4(e.scale),this.addVariable(e)}return n.prototype.addVariable=function(e){e.block=this,this.vars.push(e),this.ps.addVariable(e),this.posn=this.ps.getPosn()},n.prototype.updateWeightedPosition=function(){this.ps.AB=this.ps.AD=this.ps.A2=0;for(var e=0,t=this.vars.length;e<t;++e)this.ps.addVariable(this.vars[e]);this.posn=this.ps.getPosn()},n.prototype.compute_lm=function(e,t,r){var i=this,o=e.dfdv();return e.visitNeighbours(t,function(s,a){var l=i.compute_lm(a,e,r);a===s.right?(o+=l*s.left.scale,s.lm=l):(o+=l*s.right.scale,s.lm=-l),r(s)}),o/e.scale},n.prototype.populateSplitBlock=function(e,t){var r=this;e.visitNeighbours(t,function(i,o){o.offset=e.offset+(o===i.right?i.gap:-i.gap),r.addVariable(o),r.populateSplitBlock(o,e)})},n.prototype.traverse=function(e,t,r,i){var o=this;r===void 0&&(r=this.vars[0]),i===void 0&&(i=null),r.visitNeighbours(i,function(s,a){t.push(e(s)),o.traverse(e,t,a,r)})},n.prototype.findMinLM=function(){var e=null;return this.compute_lm(this.vars[0],null,function(t){!t.equality&&(e===null||t.lm<e.lm)&&(e=t)}),e},n.prototype.findMinLMBetween=function(e,t){this.compute_lm(e,null,function(){});var r=null;return this.findPath(e,null,t,function(i,o){!i.equality&&i.right===o&&(r===null||i.lm<r.lm)&&(r=i)}),r},n.prototype.findPath=function(e,t,r,i){var o=this,s=!1;return e.visitNeighbours(t,function(a,l){!s&&(l===r||o.findPath(l,e,r,i))&&(s=!0,i(a,l))}),s},n.prototype.isActiveDirectedPathBetween=function(e,t){if(e===t)return!0;for(var r=e.cOut.length;r--;){var i=e.cOut[r];if(i.active&&this.isActiveDirectedPathBetween(i.right,t))return!0}return!1},n.split=function(e){return e.active=!1,[n.createSplitBlock(e.left),n.createSplitBlock(e.right)]},n.createSplitBlock=function(e){var t=new n(e);return t.populateSplitBlock(e,null),t},n.prototype.splitBetween=function(e,t){var r=this.findMinLMBetween(e,t);if(r!==null){var i=n.split(r);return{constraint:r,lb:i[0],rb:i[1]}}return null},n.prototype.mergeAcross=function(e,t,r){t.active=!0;for(var i=0,o=e.vars.length;i<o;++i){var s=e.vars[i];s.offset+=r,this.addVariable(s)}this.posn=this.ps.getPosn()},n.prototype.cost=function(){for(var e=0,t=this.vars.length;t--;){var r=this.vars[t],i=r.position()-r.desiredPosition;e+=i*i*r.weight}return e},n}();pi.Block=ix;var ox=function(){function n(e){this.vs=e;var t=e.length;for(this.list=new Array(t);t--;){var r=new ix(e[t]);this.list[t]=r,r.blockInd=t}}return n.prototype.cost=function(){for(var e=0,t=this.list.length;t--;)e+=this.list[t].cost();return e},n.prototype.insert=function(e){e.blockInd=this.list.length,this.list.push(e)},n.prototype.remove=function(e){var t=this.list.length-1,r=this.list[t];this.list.length=t,e!==r&&(this.list[e.blockInd]=r,r.blockInd=e.blockInd)},n.prototype.merge=function(e){var t=e.left.block,r=e.right.block,i=e.right.offset-e.left.offset-e.gap;t.vars.length<r.vars.length?(r.mergeAcross(t,e,i),this.remove(t)):(t.mergeAcross(r,e,-i),this.remove(r))},n.prototype.forEach=function(e){this.list.forEach(e)},n.prototype.updateBlockPositions=function(){this.list.forEach(function(e){return e.updateWeightedPosition()})},n.prototype.split=function(e){var t=this;this.updateBlockPositions(),this.list.forEach(function(r){var i=r.findMinLM();i!==null&&i.lm<sx.LAGRANGIAN_TOLERANCE&&(r=i.left.block,ix.split(i).forEach(function(o){return t.insert(o)}),t.remove(r),e.push(i))})},n}();pi.Blocks=ox;var sx=function(){function n(e,t){this.vs=e,this.cs=t,this.vs=e,e.forEach(function(r){r.cIn=[],r.cOut=[]}),this.cs=t,t.forEach(function(r){r.left.cOut.push(r),r.right.cIn.push(r)}),this.inactive=t.map(function(r){return r.active=!1,r}),this.bs=null}return n.prototype.cost=function(){return this.bs.cost()},n.prototype.setStartingPositions=function(e){this.inactive=this.cs.map(function(t){return t.active=!1,t}),this.bs=new ox(this.vs),this.bs.forEach(function(t,r){return t.posn=e[r]})},n.prototype.setDesiredPositions=function(e){this.vs.forEach(function(t,r){return t.desiredPosition=e[r]})},n.prototype.mostViolated=function(){for(var e=Number.MAX_VALUE,t=null,r=this.inactive,i=r.length,o=i,s=0;s<i;++s){var a=r[s];if(!a.unsatisfiable){var l=a.slack();if((a.equality||l<e)&&(e=l,t=a,o=s,a.equality))break}}return o!==i&&(e<n.ZERO_UPPERBOUND&&!t.active||t.equality)&&(r[o]=r[i-1],r.length=i-1),t},n.prototype.satisfy=function(){this.bs==null&&(this.bs=new ox(this.vs)),this.bs.split(this.inactive);for(var e=null;(e=this.mostViolated())&&(e.equality||e.slack()<n.ZERO_UPPERBOUND&&!e.active);){var t=e.left.block,r=e.right.block;if(t!==r)this.bs.merge(e);else{if(t.isActiveDirectedPathBetween(e.right,e.left)){e.unsatisfiable=!0;continue}var i=t.splitBetween(e.left,e.right);if(i!==null)this.bs.insert(i.lb),this.bs.insert(i.rb),this.bs.remove(t),this.inactive.push(i.constraint);else{e.unsatisfiable=!0;continue}e.slack()>=0?this.inactive.push(e):this.bs.merge(e)}}},n.prototype.solve=function(){this.satisfy();for(var e=Number.MAX_VALUE,t=this.bs.cost();Math.abs(e-t)>1e-4;)this.satisfy(),e=t,t=this.bs.cost();return t},n.LAGRANGIAN_TOLERANCE=-1e-4,n.ZERO_UPPERBOUND=-1e-10,n}();pi.Solver=sx;function Dde(n,e,t){for(var r=n.map(function(m){return new Um(m.desiredCenter)}),i=[],o=n.length,s=0;s<o-1;s++){var a=n[s],l=n[s+1];i.push(new Bm(r[s],r[s+1],(a.size+l.size)/2))}var c=r[0],u=r[o-1],d=n[0].size/2,h=n[o-1].size/2,p=null,g=null;e&&(p=new Um(e,c.weight*1e3),r.push(p),i.push(new Bm(p,c,d))),t&&(g=new Um(t,u.weight*1e3),r.push(g),i.push(new Bm(u,g,h)));var f=new sx(r,i);return f.solve(),{newCenters:r.slice(0,n.length).map(function(m){return m.position()}),lowerBound:p?p.position():c.position()-d,upperBound:g?g.position():u.position()+h}}pi.removeOverlapInOneDimension=Dde;var gc={},Lde=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(gc,"__esModule",{value:!0});var n4=function(){function n(){this.findIter=function(e){for(var t=this._root,r=this.iterator();t!==null;){var i=this._comparator(e,t.data);if(i===0)return r._cursor=t,r;r._ancestors.push(t),t=t.get_child(i>0)}return null}}return n.prototype.clear=function(){this._root=null,this.size=0},n.prototype.find=function(e){for(var t=this._root;t!==null;){var r=this._comparator(e,t.data);if(r===0)return t.data;t=t.get_child(r>0)}return null},n.prototype.lowerBound=function(e){return this._bound(e,this._comparator)},n.prototype.upperBound=function(e){var t=this._comparator;function r(i,o){return t(o,i)}return this._bound(e,r)},n.prototype.min=function(){var e=this._root;if(e===null)return null;for(;e.left!==null;)e=e.left;return e.data},n.prototype.max=function(){var e=this._root;if(e===null)return null;for(;e.right!==null;)e=e.right;return e.data},n.prototype.iterator=function(){return new r4(this)},n.prototype.each=function(e){for(var t=this.iterator(),r;(r=t.next())!==null;)e(r)},n.prototype.reach=function(e){for(var t=this.iterator(),r;(r=t.prev())!==null;)e(r)},n.prototype._bound=function(e,t){for(var r=this._root,i=this.iterator();r!==null;){var o=this._comparator(e,r.data);if(o===0)return i._cursor=r,i;i._ancestors.push(r),r=r.get_child(o>0)}for(var s=i._ancestors.length-1;s>=0;--s)if(r=i._ancestors[s],t(e,r.data)>0)return i._cursor=r,i._ancestors.length=s,i;return i._ancestors.length=0,i},n}();gc.TreeBase=n4;var r4=function(){function n(e){this._tree=e,this._ancestors=[],this._cursor=null}return n.prototype.data=function(){return this._cursor!==null?this._cursor.data:null},n.prototype.next=function(){if(this._cursor===null){var e=this._tree._root;e!==null&&this._minNode(e)}else if(this._cursor.right===null){var t;do if(t=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.right===t)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return this._cursor!==null?this._cursor.data:null},n.prototype.prev=function(){if(this._cursor===null){var e=this._tree._root;e!==null&&this._maxNode(e)}else if(this._cursor.left===null){var t;do if(t=this._cursor,this._ancestors.length)this._cursor=this._ancestors.pop();else{this._cursor=null;break}while(this._cursor.left===t)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return this._cursor!==null?this._cursor.data:null},n.prototype._minNode=function(e){for(;e.left!==null;)this._ancestors.push(e),e=e.left;this._cursor=e},n.prototype._maxNode=function(e){for(;e.right!==null;)this._ancestors.push(e),e=e.right;this._cursor=e},n}();gc.Iterator=r4;var Vm=function(){function n(e){this.data=e,this.left=null,this.right=null,this.red=!0}return n.prototype.get_child=function(e){return e?this.right:this.left},n.prototype.set_child=function(e,t){e?this.right=t:this.left=t},n}(),zde=function(n){Lde(e,n);function e(t){var r=n.call(this)||this;return r._root=null,r._comparator=t,r.size=0,r}return e.prototype.insert=function(t){var r=!1;if(this._root===null)this._root=new Vm(t),r=!0,this.size++;else{var i=new Vm(void 0),o=!1,s=!1,a=null,l=i,c=null,u=this._root;for(l.right=this._root;;){if(u===null?(u=new Vm(t),c.set_child(o,u),r=!0,this.size++):e.is_red(u.left)&&e.is_red(u.right)&&(u.red=!0,u.left.red=!1,u.right.red=!1),e.is_red(u)&&e.is_red(c)){var d=l.right===a;u===c.get_child(s)?l.set_child(d,e.single_rotate(a,!s)):l.set_child(d,e.double_rotate(a,!s))}var h=this._comparator(u.data,t);if(h===0)break;s=o,o=h<0,a!==null&&(l=a),a=c,c=u,u=u.get_child(o)}this._root=i.right}return this._root.red=!1,r},e.prototype.remove=function(t){if(this._root===null)return!1;var r=new Vm(void 0),i=r;i.right=this._root;for(var o=null,s=null,a=null,l=!0;i.get_child(l)!==null;){var c=l;s=o,o=i,i=i.get_child(l);var u=this._comparator(t,i.data);if(l=u>0,u===0&&(a=i),!e.is_red(i)&&!e.is_red(i.get_child(l))){if(e.is_red(i.get_child(!l))){var d=e.single_rotate(i,l);o.set_child(c,d),o=d}else if(!e.is_red(i.get_child(!l))){var h=o.get_child(!c);if(h!==null)if(!e.is_red(h.get_child(!c))&&!e.is_red(h.get_child(c)))o.red=!1,h.red=!0,i.red=!0;else{var p=s.right===o;e.is_red(h.get_child(c))?s.set_child(p,e.double_rotate(o,c)):e.is_red(h.get_child(!c))&&s.set_child(p,e.single_rotate(o,c));var g=s.get_child(p);g.red=!0,i.red=!0,g.left.red=!1,g.right.red=!1}}}}return a!==null&&(a.data=i.data,o.set_child(o.right===i,i.get_child(i.left===null)),this.size--),this._root=r.right,this._root!==null&&(this._root.red=!1),a!==null},e.is_red=function(t){return t!==null&&t.red},e.single_rotate=function(t,r){var i=t.get_child(!r);return t.set_child(!r,i.get_child(r)),i.set_child(r,t),t.red=!0,i.red=!1,i},e.double_rotate=function(t,r){return t.set_child(!r,e.single_rotate(t.get_child(!r),!r)),e.single_rotate(t,r)},e}(n4);gc.RBTree=zde;var Nde=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(tn,"__esModule",{value:!0});var Ao=pi,Fde=gc;function Qd(n){return n.bounds=typeof n.leaves<"u"?n.leaves.reduce(function(e,t){return t.bounds.union(e)},Ms.empty()):Ms.empty(),typeof n.groups<"u"&&(n.bounds=n.groups.reduce(function(e,t){return Qd(t).union(e)},n.bounds)),n.bounds=n.bounds.inflate(n.padding),n.bounds}tn.computeGroupBounds=Qd;var Ms=function(){function n(e,t,r,i){this.x=e,this.X=t,this.y=r,this.Y=i}return n.empty=function(){return new n(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY)},n.prototype.cx=function(){return(this.x+this.X)/2},n.prototype.cy=function(){return(this.y+this.Y)/2},n.prototype.overlapX=function(e){var t=this.cx(),r=e.cx();return t<=r&&e.x<this.X?this.X-e.x:r<=t&&this.x<e.X?e.X-this.x:0},n.prototype.overlapY=function(e){var t=this.cy(),r=e.cy();return t<=r&&e.y<this.Y?this.Y-e.y:r<=t&&this.y<e.Y?e.Y-this.y:0},n.prototype.setXCentre=function(e){var t=e-this.cx();this.x+=t,this.X+=t},n.prototype.setYCentre=function(e){var t=e-this.cy();this.y+=t,this.Y+=t},n.prototype.width=function(){return this.X-this.x},n.prototype.height=function(){return this.Y-this.y},n.prototype.union=function(e){return new n(Math.min(this.x,e.x),Math.max(this.X,e.X),Math.min(this.y,e.y),Math.max(this.Y,e.Y))},n.prototype.lineIntersections=function(e,t,r,i){for(var o=[[this.x,this.y,this.X,this.y],[this.X,this.y,this.X,this.Y],[this.X,this.Y,this.x,this.Y],[this.x,this.Y,this.x,this.y]],s=[],a=0;a<4;++a){var l=n.lineIntersection(e,t,r,i,o[a][0],o[a][1],o[a][2],o[a][3]);l!==null&&s.push({x:l.x,y:l.y})}return s},n.prototype.rayIntersection=function(e,t){var r=this.lineIntersections(this.cx(),this.cy(),e,t);return r.length>0?r[0]:null},n.prototype.vertices=function(){return[{x:this.x,y:this.y},{x:this.X,y:this.y},{x:this.X,y:this.Y},{x:this.x,y:this.Y}]},n.lineIntersection=function(e,t,r,i,o,s,a,l){var c=r-e,u=a-o,d=i-t,h=l-s,p=h*c-u*d;if(p==0)return null;var g=e-o,f=t-s,m=u*f-h*g,v=m/p,b=c*f-d*g,_=b/p;return v>=0&&v<=1&&_>=0&&_<=1?{x:e+v*c,y:t+v*d}:null},n.prototype.inflate=function(e){return new n(this.x-e,this.X+e,this.y-e,this.Y+e)},n}();tn.Rectangle=Ms;function $de(n,e,t){var r=n.rayIntersection(e.cx(),e.cy())||{x:n.cx(),y:n.cy()},i=e.rayIntersection(n.cx(),n.cy())||{x:e.cx(),y:e.cy()},o=i.x-r.x,s=i.y-r.y,a=Math.sqrt(o*o+s*s),l=a-t;return{sourceIntersection:r,targetIntersection:i,arrowStart:{x:r.x+l*o/a,y:r.y+l*s/a}}}tn.makeEdgeBetween=$de;function Bde(n,e,t){var r=e.rayIntersection(n.x,n.y);r||(r={x:e.cx(),y:e.cy()});var i=r.x-n.x,o=r.y-n.y,s=Math.sqrt(i*i+o*o);return{x:r.x-t*i/s,y:r.y-t*o/s}}tn.makeEdgeTo=Bde;var Ude=function(){function n(e,t,r){this.v=e,this.r=t,this.pos=r,this.prev=ax(),this.next=ax()}return n}(),i4=function(){function n(e,t,r){this.isOpen=e,this.v=t,this.pos=r}return n}();function Vde(n,e){return n.pos>e.pos?1:n.pos<e.pos||n.isOpen?-1:e.isOpen?1:0}function ax(){return new Fde.RBTree(function(n,e){return n.pos-e.pos})}var o4={getCentre:function(n){return n.cx()},getOpen:function(n){return n.y},getClose:function(n){return n.Y},getSize:function(n){return n.width()},makeRect:function(n,e,t,r){return new Ms(t-r/2,t+r/2,n,e)},findNeighbours:Hde},s4={getCentre:function(n){return n.cy()},getOpen:function(n){return n.x},getClose:function(n){return n.X},getSize:function(n){return n.height()},makeRect:function(n,e,t,r){return new Ms(n,e,t-r/2,t+r/2)},findNeighbours:Wde};function lx(n,e,t,r){r===void 0&&(r=!1);var i=n.padding,o=typeof n.groups<"u"?n.groups.length:0,s=typeof n.leaves<"u"?n.leaves.length:0,a=o?n.groups.reduce(function(C,k){return C.concat(lx(k,e,t,!0))},[]):[],l=(r?2:0)+s+o,c=new Array(l),u=new Array(l),d=0,h=function(C,k){u[d]=C,c[d++]=k};if(r){var p=n.bounds,g=e.getCentre(p),f=e.getSize(p)/2,m=e.getOpen(p),v=e.getClose(p),b=g-f+i/2,_=g+f-i/2;n.minVar.desiredPosition=b,h(e.makeRect(m,v,b,i),n.minVar),n.maxVar.desiredPosition=_,h(e.makeRect(m,v,_,i),n.maxVar)}s&&n.leaves.forEach(function(C){return h(C.bounds,C.variable)}),o&&n.groups.forEach(function(C){var k=C.bounds;h(e.makeRect(e.getOpen(k),e.getClose(k),e.getCentre(k),e.getSize(k)),C.minVar)});var x=cx(u,c,e,t);return o&&(c.forEach(function(C){C.cOut=[],C.cIn=[]}),x.forEach(function(C){C.left.cOut.push(C),C.right.cIn.push(C)}),n.groups.forEach(function(C){var k=(C.padding-e.getSize(C.bounds))/2;C.minVar.cIn.forEach(function(E){return E.gap+=k}),C.minVar.cOut.forEach(function(E){E.left=C.maxVar,E.gap+=k})})),a.concat(x)}function cx(n,e,t,r){var i,o=n.length,s=2*o;console.assert(e.length>=o);var a=new Array(s);for(i=0;i<o;++i){var l=n[i],c=new Ude(e[i],l,t.getCentre(l));a[i]=new i4(!0,c,t.getOpen(l)),a[i+o]=new i4(!1,c,t.getClose(l))}a.sort(Vde);var u=new Array,d=ax();for(i=0;i<s;++i){var h=a[i],c=h.v;if(h.isOpen)d.insert(c),t.findNeighbours(c,d);else{d.remove(c);var p=function(m,v){var b=(t.getSize(m.r)+t.getSize(v.r))/2+r;u.push(new Ao.Constraint(m.v,v.v,b))},g=function(m,v,b){for(var _,x=c[m].iterator();(_=x[m]())!==null;)b(_,c),_[v].remove(c)};g("prev","next",function(m,v){return p(m,v)}),g("next","prev",function(m,v){return p(v,m)})}}return console.assert(d.size===0),u}function Hde(n,e){var t=function(r,i){for(var o=e.findIter(n),s;(s=o[r]())!==null;){var a=s.r.overlapX(n.r);if((a<=0||a<=s.r.overlapY(n.r))&&(n[r].insert(s),s[i].insert(n)),a<=0)break}};t("next","prev"),t("prev","next")}function Wde(n,e){var t=function(r,i){var o=e.findIter(n)[r]();o!==null&&o.r.overlapX(n.r)>0&&(n[r].insert(o),o[i].insert(n))};t("next","prev"),t("prev","next")}function a4(n,e){return cx(n,e,o4,1e-6)}tn.generateXConstraints=a4;function l4(n,e){return cx(n,e,s4,1e-6)}tn.generateYConstraints=l4;function c4(n){return lx(n,o4,1e-6)}tn.generateXGroupConstraints=c4;function u4(n){return lx(n,s4,1e-6)}tn.generateYGroupConstraints=u4;function Kde(n){var e=n.map(function(i){return new Ao.Variable(i.cx())}),t=a4(n,e),r=new Ao.Solver(e,t);r.solve(),e.forEach(function(i,o){return n[o].setXCentre(i.position())}),e=n.map(function(i){return new Ao.Variable(i.cy())}),t=l4(n,e),r=new Ao.Solver(e,t),r.solve(),e.forEach(function(i,o){return n[o].setYCentre(i.position())})}tn.removeOverlaps=Kde;var Hm=function(n){Nde(e,n);function e(t,r){var i=n.call(this,0,r)||this;return i.index=t,i}return e}(Ao.Variable);tn.IndexedVariable=Hm;var Gde=function(){function n(e,t,r,i,o){var s=this;if(r===void 0&&(r=null),i===void 0&&(i=null),o===void 0&&(o=!1),this.nodes=e,this.groups=t,this.rootGroup=r,this.avoidOverlaps=o,this.variables=e.map(function(l,c){return l.variable=new Hm(c,1)}),i&&this.createConstraints(i),o&&r&&typeof r.groups<"u"){e.forEach(function(l){if(!l.width||!l.height){l.bounds=new Ms(l.x,l.x,l.y,l.y);return}var c=l.width/2,u=l.height/2;l.bounds=new Ms(l.x-c,l.x+c,l.y-u,l.y+u)}),Qd(r);var a=e.length;t.forEach(function(l){s.variables[a]=l.minVar=new Hm(a++,typeof l.stiffness<"u"?l.stiffness:.01),s.variables[a]=l.maxVar=new Hm(a++,typeof l.stiffness<"u"?l.stiffness:.01)})}}return n.prototype.createSeparation=function(e){return new Ao.Constraint(this.nodes[e.left].variable,this.nodes[e.right].variable,e.gap,typeof e.equality<"u"?e.equality:!1)},n.prototype.makeFeasible=function(e){var t=this;if(this.avoidOverlaps){var r="x",i="width";e.axis==="x"&&(r="y",i="height");var o=e.offsets.map(function(a){return t.nodes[a.node]}).sort(function(a,l){return a[r]-l[r]}),s=null;o.forEach(function(a){if(s){var l=s[r]+s[i];l>a[r]&&(a[r]=l)}s=a})}},n.prototype.createAlignment=function(e){var t=this,r=this.nodes[e.offsets[0].node].variable;this.makeFeasible(e);var i=e.axis==="x"?this.xConstraints:this.yConstraints;e.offsets.slice(1).forEach(function(o){var s=t.nodes[o.node].variable;i.push(new Ao.Constraint(r,s,o.offset,!0))})},n.prototype.createConstraints=function(e){var t=this,r=function(i){return typeof i.type>"u"||i.type==="separation"};this.xConstraints=e.filter(function(i){return i.axis==="x"&&r(i)}).map(function(i){return t.createSeparation(i)}),this.yConstraints=e.filter(function(i){return i.axis==="y"&&r(i)}).map(function(i){return t.createSeparation(i)}),e.filter(function(i){return i.type==="alignment"}).forEach(function(i){return t.createAlignment(i)})},n.prototype.setupVariablesAndBounds=function(e,t,r,i){this.nodes.forEach(function(o,s){o.fixed?(o.variable.weight=o.fixedWeight?o.fixedWeight:1e3,r[s]=i(o)):o.variable.weight=1;var a=(o.width||0)/2,l=(o.height||0)/2,c=e[s],u=t[s];o.bounds=new Ms(c-a,c+a,u-l,u+l)})},n.prototype.xProject=function(e,t,r){!this.rootGroup&&!(this.avoidOverlaps||this.xConstraints)||this.project(e,t,e,r,function(i){return i.px},this.xConstraints,c4,function(i){return i.bounds.setXCentre(r[i.variable.index]=i.variable.position())},function(i){var o=r[i.minVar.index]=i.minVar.position(),s=r[i.maxVar.index]=i.maxVar.position(),a=i.padding/2;i.bounds.x=o-a,i.bounds.X=s+a})},n.prototype.yProject=function(e,t,r){!this.rootGroup&&!this.yConstraints||this.project(e,t,t,r,function(i){return i.py},this.yConstraints,u4,function(i){return i.bounds.setYCentre(r[i.variable.index]=i.variable.position())},function(i){var o=r[i.minVar.index]=i.minVar.position(),s=r[i.maxVar.index]=i.maxVar.position(),a=i.padding/2;i.bounds.y=o-a,i.bounds.Y=s+a})},n.prototype.projectFunctions=function(){var e=this;return[function(t,r,i){return e.xProject(t,r,i)},function(t,r,i){return e.yProject(t,r,i)}]},n.prototype.project=function(e,t,r,i,o,s,a,l,c){this.setupVariablesAndBounds(e,t,i,o),this.rootGroup&&this.avoidOverlaps&&(Qd(this.rootGroup),s=s.concat(a(this.rootGroup))),this.solve(this.variables,s,r,i),this.nodes.forEach(l),this.rootGroup&&this.avoidOverlaps&&(this.groups.forEach(c),Qd(this.rootGroup))},n.prototype.solve=function(e,t,r,i){var o=new Ao.Solver(e,t);o.setStartingPositions(r),o.setDesiredPositions(i),o.solve()},n}();tn.Projection=Gde;var mc={},eh={};Object.defineProperty(eh,"__esModule",{value:!0});var d4=function(){function n(e){this.elem=e,this.subheaps=[]}return n.prototype.toString=function(e){for(var t="",r=!1,i=0;i<this.subheaps.length;++i){var o=this.subheaps[i];if(!o.elem){r=!1;continue}r&&(t=t+","),t=t+o.toString(e),r=!0}return t!==""&&(t="("+t+")"),(this.elem?e(this.elem):"")+t},n.prototype.forEach=function(e){this.empty()||(e(this.elem,this),this.subheaps.forEach(function(t){return t.forEach(e)}))},n.prototype.count=function(){return this.empty()?0:1+this.subheaps.reduce(function(e,t){return e+t.count()},0)},n.prototype.min=function(){return this.elem},n.prototype.empty=function(){return this.elem==null},n.prototype.contains=function(e){if(this===e)return!0;for(var t=0;t<this.subheaps.length;t++)if(this.subheaps[t].contains(e))return!0;return!1},n.prototype.isHeap=function(e){var t=this;return this.subheaps.every(function(r){return e(t.elem,r.elem)&&r.isHeap(e)})},n.prototype.insert=function(e,t){return this.merge(new n(e),t)},n.prototype.merge=function(e,t){return this.empty()?e:e.empty()?this:t(this.elem,e.elem)?(this.subheaps.push(e),this):(e.subheaps.push(this),e)},n.prototype.removeMin=function(e){return this.empty()?null:this.mergePairs(e)},n.prototype.mergePairs=function(e){if(this.subheaps.length==0)return new n(null);if(this.subheaps.length==1)return this.subheaps[0];var t=this.subheaps.pop().merge(this.subheaps.pop(),e),r=this.mergePairs(e);return t.merge(r,e)},n.prototype.decreaseKey=function(e,t,r,i){var o=e.removeMin(i);e.elem=o.elem,e.subheaps=o.subheaps,r!==null&&o.elem!==null&&r(e.elem,e);var s=new n(t);return r!==null&&r(t,s),this.merge(s,i)},n}();eh.PairingHeap=d4;var Yde=function(){function n(e){this.lessThan=e}return n.prototype.top=function(){return this.empty()?null:this.root.elem},n.prototype.push=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r,i=0,o;o=e[i];++i)r=new d4(o),this.root=this.empty()?r:this.root.merge(r,this.lessThan);return r},n.prototype.empty=function(){return!this.root||!this.root.elem},n.prototype.isHeap=function(){return this.root.isHeap(this.lessThan)},n.prototype.forEach=function(e){this.root.forEach(e)},n.prototype.pop=function(){if(this.empty())return null;var e=this.root.min();return this.root=this.root.removeMin(this.lessThan),e},n.prototype.reduceKey=function(e,t,r){r===void 0&&(r=null),this.root=this.root.decreaseKey(e,t,r,this.lessThan)},n.prototype.toString=function(e){return this.root.toString(e)},n.prototype.count=function(){return this.root.count()},n}();eh.PriorityQueue=Yde,Object.defineProperty(mc,"__esModule",{value:!0});var h4=eh,p4=function(){function n(e,t){this.id=e,this.distance=t}return n}(),Xde=function(){function n(e){this.id=e,this.neighbours=[]}return n}(),f4=function(){function n(e,t,r){this.node=e,this.prev=t,this.d=r}return n}(),qde=function(){function n(e,t,r,i,o){this.n=e,this.es=t,this.neighbours=new Array(this.n);for(var s=this.n;s--;)this.neighbours[s]=new Xde(s);for(s=this.es.length;s--;){var a=this.es[s],l=r(a),c=i(a),u=o(a);this.neighbours[l].neighbours.push(new p4(c,u)),this.neighbours[c].neighbours.push(new p4(l,u))}}return n.prototype.DistanceMatrix=function(){for(var e=new Array(this.n),t=0;t<this.n;++t)e[t]=this.dijkstraNeighbours(t);return e},n.prototype.DistancesFromNode=function(e){return this.dijkstraNeighbours(e)},n.prototype.PathFromNodeToNode=function(e,t){return this.dijkstraNeighbours(e,t)},n.prototype.PathFromNodeToNodeWithPrevCost=function(e,t,r){var i=new h4.PriorityQueue(function(f,m){return f.d<=m.d}),o=this.neighbours[e],s=new f4(o,null,0),a={};for(i.push(s);!i.empty()&&(s=i.pop(),o=s.node,o.id!==t);)for(var l=o.neighbours.length;l--;){var c=o.neighbours[l],u=this.neighbours[c.id];if(!(s.prev&&u.id===s.prev.node.id)){var d=u.id+","+o.id;if(!(d in a&&a[d]<=s.d)){var h=s.prev?r(s.prev.node.id,o.id,u.id):0,p=s.d+c.distance+h;a[d]=p,i.push(new f4(u,s,p))}}}for(var g=[];s.prev;)s=s.prev,g.push(s.node.id);return g},n.prototype.dijkstraNeighbours=function(e,t){t===void 0&&(t=-1);for(var r=new h4.PriorityQueue(function(h,p){return h.d<=p.d}),i=this.neighbours.length,o=new Array(i);i--;){var s=this.neighbours[i];s.d=i===e?0:Number.POSITIVE_INFINITY,s.q=r.push(s)}for(;!r.empty();){var a=r.pop();if(o[a.id]=a.d,a.id===t){for(var l=[],c=a;typeof c.prev<"u";)l.push(c.prev.id),c=c.prev;return l}for(i=a.neighbours.length;i--;){var u=a.neighbours[i],c=this.neighbours[u.id],d=a.d+u.distance;a.d!==Number.MAX_VALUE&&c.d>d&&(c.d=d,c.prev=a,r.reduceKey(c.q,c,function(p,g){return p.q=g}))}}return o},n}();mc.Calculator=qde;var Pt={},g4=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(Pt,"__esModule",{value:!0});var Zde=tn,ux=function(){function n(){}return n}();Pt.Point=ux;var dx=function(){function n(e,t,r,i){this.x1=e,this.y1=t,this.x2=r,this.y2=i}return n}();Pt.LineSegment=dx;var Jde=function(n){g4(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ux);Pt.PolyPoint=Jde;function wr(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}Pt.isLeft=wr;function fi(n,e,t){return wr(n,e,t)>0}function Nr(n,e,t){return wr(n,e,t)<0}function Qde(n){var e=n.slice(0).sort(function(h,p){return h.x!==p.x?p.x-h.x:p.y-h.y}),t=n.length,r,i=0,o=e[0].x;for(r=1;r<t&&e[r].x===o;++r);var s=r-1,a=[];if(a.push(e[i]),s===t-1)e[s].y!==e[i].y&&a.push(e[s]);else{var l,c=t-1,u=e[t-1].x;for(r=t-2;r>=0&&e[r].x===u;r--);for(l=r+1,r=s;++r<=l;)if(!(wr(e[i],e[l],e[r])>=0&&r<l)){for(;a.length>1&&!(wr(a[a.length-2],a[a.length-1],e[r])>0);)a.length-=1;r!=i&&a.push(e[r])}c!=l&&a.push(e[c]);var d=a.length;for(r=l;--r>=s;)if(!(wr(e[c],e[s],e[r])>=0&&r>s)){for(;a.length>d&&!(wr(a[a.length-2],a[a.length-1],e[r])>0);)a.length-=1;r!=i&&a.push(e[r])}}return a}Pt.ConvexHull=Qde;function ehe(n,e,t){e.slice(0).sort(function(r,i){return Math.atan2(r.y-n.y,r.x-n.x)-Math.atan2(i.y-n.y,i.x-n.x)}).forEach(t)}Pt.clockwiseRadialSweep=ehe;function the(n,e){var t=e.slice(0);return t.push(e[0]),{rtan:Wm(n,t),ltan:Km(n,t)}}function Wm(n,e){var t=e.length-1,r,i,o,s,a;if(Nr(n,e[1],e[0])&&!fi(n,e[t-1],e[0]))return 0;for(r=0,i=t;;){if(i-r===1)return fi(n,e[r],e[i])?r:i;if(o=Math.floor((r+i)/2),a=Nr(n,e[o+1],e[o]),a&&!fi(n,e[o-1],e[o]))return o;s=fi(n,e[r+1],e[r]),s?a||fi(n,e[r],e[o])?i=o:r=o:a&&Nr(n,e[r],e[o])?i=o:r=o}}function Km(n,e){var t=e.length-1,r,i,o,s,a;if(fi(n,e[t-1],e[0])&&!Nr(n,e[1],e[0]))return 0;for(r=0,i=t;;){if(i-r===1)return Nr(n,e[r],e[i])?r:i;if(o=Math.floor((r+i)/2),a=Nr(n,e[o+1],e[o]),fi(n,e[o-1],e[o])&&!a)return o;s=Nr(n,e[r+1],e[r]),s?a?Nr(n,e[r],e[o])?i=o:r=o:i=o:a?r=o:fi(n,e[r],e[o])?i=o:r=o}}function Gm(n,e,t,r,i,o){var s,a;s=t(e[0],n),a=r(n[s],e);for(var l=!1;!l;){for(l=!0;s===n.length-1&&(s=0),!i(e[a],n[s],n[s+1]);)++s;for(;a===0&&(a=e.length-1),!o(n[s],e[a],e[a-1]);)--a,l=!1}return{t1:s,t2:a}}Pt.tangent_PolyPolyC=Gm;function nhe(n,e){var t=m4(e,n);return{t1:t.t2,t2:t.t1}}Pt.LRtangent_PolyPolyC=nhe;function m4(n,e){return Gm(n,e,Wm,Km,fi,Nr)}Pt.RLtangent_PolyPolyC=m4;function rhe(n,e){return Gm(n,e,Km,Km,Nr,Nr)}Pt.LLtangent_PolyPolyC=rhe;function ihe(n,e){return Gm(n,e,Wm,Wm,fi,fi)}Pt.RRtangent_PolyPolyC=ihe;var th=function(){function n(e,t){this.t1=e,this.t2=t}return n}();Pt.BiTangent=th;var y4=function(){function n(){}return n}();Pt.BiTangents=y4;var ohe=function(n){g4(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ux);Pt.TVGPoint=ohe;var hx=function(){function n(e,t,r,i){this.id=e,this.polyid=t,this.polyvertid=r,this.p=i,i.vv=this}return n}();Pt.VisibilityVertex=hx;var Ym=function(){function n(e,t){this.source=e,this.target=t}return n.prototype.length=function(){var e=this.source.p.x-this.target.p.x,t=this.source.p.y-this.target.p.y;return Math.sqrt(e*e+t*t)},n}();Pt.VisibilityEdge=Ym;var she=function(){function n(e,t){if(this.P=e,this.V=[],this.E=[],t)this.V=t.V.slice(0),this.E=t.E.slice(0);else{for(var r=e.length,i=0;i<r;i++){for(var o=e[i],s=0;s<o.length;++s){var a=o[s],l=new hx(this.V.length,i,s,a);this.V.push(l),s>0&&this.E.push(new Ym(o[s-1].vv,l))}o.length>1&&this.E.push(new Ym(o[0].vv,o[o.length-1].vv))}for(var i=0;i<r-1;i++)for(var c=e[i],s=i+1;s<r;s++){var u=e[s],d=b4(c,u);for(var h in d){var p=d[h],g=c[p.t1],f=u[p.t2];this.addEdgeIfVisible(g,f,i,s)}}}}return n.prototype.addEdgeIfVisible=function(e,t,r,i){this.intersectsPolys(new dx(e.x,e.y,t.x,t.y),r,i)||this.E.push(new Ym(e.vv,t.vv))},n.prototype.addPoint=function(e,t){var r=this.P.length;this.V.push(new hx(this.V.length,r,0,e));for(var i=0;i<r;++i)if(i!==t){var o=this.P[i],s=the(e,o);this.addEdgeIfVisible(e,o[s.ltan],t,i),this.addEdgeIfVisible(e,o[s.rtan],t,i)}return e.vv},n.prototype.intersectsPolys=function(e,t,r){for(var i=0,o=this.P.length;i<o;++i)if(i!=t&&i!=r&&w4(e,this.P[i]).length>0)return!0;return!1},n}();Pt.TangentVisibilityGraph=she;function w4(n,e){for(var t=[],r=1,i=e.length;r<i;++r){var o=Zde.Rectangle.lineIntersection(n.x1,n.y1,n.x2,n.y2,e[r-1].x,e[r-1].y,e[r].x,e[r].y);o&&t.push(o)}return t}function b4(n,e){for(var t=n.length-1,r=e.length-1,i=new y4,o=0;o<t;++o)for(var s=0;s<r;++s){var a=n[o==0?t-1:o-1],l=n[o],c=n[o+1],u=e[s==0?r-1:s-1],d=e[s],h=e[s+1],p=wr(a,l,d),g=wr(l,u,d),f=wr(l,d,h),m=wr(u,d,l),v=wr(d,a,l),b=wr(d,l,c);p>=0&&g>=0&&f<0&&m>=0&&v>=0&&b<0?i.ll=new th(o,s):p<=0&&g<=0&&f>0&&m<=0&&v<=0&&b>0?i.rr=new th(o,s):p<=0&&g>0&&f<=0&&m>=0&&v<0&&b>=0?i.rl=new th(o,s):p>=0&&g<0&&f>=0&&m<=0&&v>0&&b<=0&&(i.lr=new th(o,s))}return i}Pt.tangents=b4;function ahe(n,e){for(var t=1,r=e.length;t<r;++t)if(Nr(e[t-1],e[t],n))return!1;return!0}function v4(n,e){return!n.every(function(t){return!ahe(t,e)})}function lhe(n,e){if(v4(n,e)||v4(e,n))return!0;for(var t=1,r=n.length;t<r;++t){var i=n[t],o=n[t-1];if(w4(new dx(o.x,o.y,i.x,i.y),e).length>0)return!0}return!1}Pt.polysOverlap=lhe;var nh={};Object.defineProperty(nh,"__esModule",{value:!0});var Fr={PADDING:10,GOLDEN_SECTION:(1+Math.sqrt(5))/2,FLOAT_EPSILON:1e-4,MAX_INERATIONS:100};function che(n,e,t,d,u,o){u===void 0&&(u=1),o===void 0&&(o=!0);var s=0,a=0,l=e,c=t,u=typeof u<"u"?u:1,d=typeof d<"u"?d:0,h=0,p=0,g=0,f=0,m=[];if(n.length==0)return;v(n),_(n),o&&b(n);function v(I){I.forEach(function(A){T(A)});function T(A){var D=Number.MAX_VALUE,N=Number.MAX_VALUE,U=0,R=0;A.array.forEach(function(B){var $=typeof B.width<"u"?B.width:d,q=typeof B.height<"u"?B.height:d;$/=2,q/=2,U=Math.max(B.x+$,U),D=Math.min(B.x-$,D),R=Math.max(B.y+q,R),N=Math.min(B.y-q,N)}),A.width=U-D,A.height=R-N}}function b(I){I.forEach(function(T){var A={x:0,y:0};T.array.forEach(function(U){A.x+=U.x,A.y+=U.y}),A.x/=T.array.length,A.y/=T.array.length;var D={x:A.x-T.width/2,y:A.y-T.height/2},N={x:T.x-D.x+l/2-h/2,y:T.y-D.y+c/2-p/2};T.array.forEach(function(U){U.x+=N.x,U.y+=N.y})})}function _(I,T){var A=Number.POSITIVE_INFINITY,D=0;I.sort(function(le,me){return me.height-le.height}),g=I.reduce(function(le,me){return le.width<me.width?le.width:me.width});for(var N=V=g,U=J=k(I),R=0,B=Number.MAX_VALUE,$=Number.MAX_VALUE,q=-1,G=Number.MAX_VALUE,L=Number.MAX_VALUE;G>g||L>Fr.FLOAT_EPSILON;){if(q!=1)var V=U-(U-N)/Fr.GOLDEN_SECTION,B=x(I,V);if(q!=0)var J=N+(U-N)/Fr.GOLDEN_SECTION,$=x(I,J);if(G=Math.abs(V-J),L=Math.abs(B-$),B<A&&(A=B,D=V),$<A&&(A=$,D=J),B>$?(N=V,V=J,B=$,q=1):(U=J,J=V,$=B,q=0),R++>100)break}x(I,D)}function x(I,T){m=[],h=0,p=0,f=a;for(var A=0;A<I.length;A++){var D=I[A];C(D,T)}return Math.abs(E()-u)}function C(I,T){for(var A=void 0,D=0;D<m.length;D++)if(m[D].space_left>=I.height&&m[D].x+m[D].width+I.width+Fr.PADDING-T<=Fr.FLOAT_EPSILON){A=m[D];break}m.push(I),A!==void 0?(I.x=A.x+A.width+Fr.PADDING,I.y=A.bottom,I.space_left=I.height,I.bottom=I.y,A.space_left-=I.height+Fr.PADDING,A.bottom+=I.height+Fr.PADDING):(I.y=f,f+=I.height+Fr.PADDING,I.x=s,I.bottom=I.y,I.space_left=I.height),I.y+I.height-p>-Fr.FLOAT_EPSILON&&(p=I.y+I.height-a),I.x+I.width-h>-Fr.FLOAT_EPSILON&&(h=I.x+I.width-s)}function k(I){var T=0;return I.forEach(function(A){return T+=A.width+Fr.PADDING}),T}function E(){return h/p}}nh.applyPacking=che;function uhe(n,e){for(var t={},r={},i=[],o=0,s=0;s<e.length;s++){var a=e[s],l=a.source,c=a.target;r[l.index]?r[l.index].push(c):r[l.index]=[c],r[c.index]?r[c.index].push(l):r[c.index]=[l]}for(var s=0;s<n.length;s++){var u=n[s];t[u.index]||d(u,!0)}function d(h,p){if(t[h.index]===void 0){p&&(o++,i.push({array:[]})),t[h.index]=o,i[o-1].array.push(h);var g=r[h.index];if(g)for(var f=0;f<g.length;f++)d(g[f],!1)}}return i}nh.separateGraphs=uhe,function(n){Object.defineProperty(n,"__esModule",{value:!0});var e=To,t=Is,r=xa,i=tn,o=mc,s=Pt,a=nh,l;(function(d){d[d.start=0]="start",d[d.tick=1]="tick",d[d.end=2]="end"})(l=n.EventType||(n.EventType={}));function c(d){return typeof d.leaves<"u"||typeof d.groups<"u"}var u=function(){function d(){var h=this;this._canvasSize=[1,1],this._linkDistance=20,this._defaultNodeSize=10,this._linkLengthCalculator=null,this._linkType=null,this._avoidOverlaps=!1,this._handleDisconnected=!0,this._running=!1,this._nodes=[],this._groups=[],this._rootGroup=null,this._links=[],this._constraints=[],this._distanceMatrix=null,this._descent=null,this._directedLinkConstraints=null,this._threshold=.01,this._visibilityGraph=null,this._groupCompactness=1e-6,this.event=null,this.linkAccessor={getSourceIndex:d.getSourceIndex,getTargetIndex:d.getTargetIndex,setLength:d.setLinkLength,getType:function(p){return typeof h._linkType=="function"?h._linkType(p):0}}}return d.prototype.on=function(h,p){return this.event||(this.event={}),typeof h=="string"?this.event[l[h]]=p:this.event[h]=p,this},d.prototype.trigger=function(h){this.event&&typeof this.event[h.type]<"u"&&this.event[h.type](h)},d.prototype.kick=function(){for(;!this.tick(););},d.prototype.tick=function(){if(this._alpha<this._threshold)return this._running=!1,this.trigger({type:l.end,alpha:this._alpha=0,stress:this._lastStress}),!0;var h=this._nodes.length;this._links.length;var p,g;for(this._descent.locks.clear(),g=0;g<h;++g)if(p=this._nodes[g],p.fixed){(typeof p.px>"u"||typeof p.py>"u")&&(p.px=p.x,p.py=p.y);var f=[p.px,p.py];this._descent.locks.add(g,f)}var m=this._descent.rungeKutta();return m===0?this._alpha=0:typeof this._lastStress<"u"&&(this._alpha=m),this._lastStress=m,this.updateNodePositions(),this.trigger({type:l.tick,alpha:this._alpha,stress:this._lastStress}),!1},d.prototype.updateNodePositions=function(){for(var h=this._descent.x[0],p=this._descent.x[1],g,f=this._nodes.length;f--;)g=this._nodes[f],g.x=h[f],g.y=p[f]},d.prototype.nodes=function(h){if(!h){if(this._nodes.length===0&&this._links.length>0){var p=0;this._links.forEach(function(f){p=Math.max(p,f.source,f.target)}),this._nodes=new Array(++p);for(var g=0;g<p;++g)this._nodes[g]={}}return this._nodes}return this._nodes=h,this},d.prototype.groups=function(h){var p=this;return h?(this._groups=h,this._rootGroup={},this._groups.forEach(function(g){typeof g.padding>"u"&&(g.padding=1),typeof g.leaves<"u"&&g.leaves.forEach(function(f,m){typeof f=="number"&&((g.leaves[m]=p._nodes[f]).parent=g)}),typeof g.groups<"u"&&g.groups.forEach(function(f,m){typeof f=="number"&&((g.groups[m]=p._groups[f]).parent=g)})}),this._rootGroup.leaves=this._nodes.filter(function(g){return typeof g.parent>"u"}),this._rootGroup.groups=this._groups.filter(function(g){return typeof g.parent>"u"}),this):this._groups},d.prototype.powerGraphGroups=function(h){var p=e.getGroups(this._nodes,this._links,this.linkAccessor,this._rootGroup);return this.groups(p.groups),h(p),this},d.prototype.avoidOverlaps=function(h){return arguments.length?(this._avoidOverlaps=h,this):this._avoidOverlaps},d.prototype.handleDisconnected=function(h){return arguments.length?(this._handleDisconnected=h,this):this._handleDisconnected},d.prototype.flowLayout=function(h,p){return arguments.length||(h="y"),this._directedLinkConstraints={axis:h,getMinSeparation:typeof p=="number"?function(){return p}:p},this},d.prototype.links=function(h){return arguments.length?(this._links=h,this):this._links},d.prototype.constraints=function(h){return arguments.length?(this._constraints=h,this):this._constraints},d.prototype.distanceMatrix=function(h){return arguments.length?(this._distanceMatrix=h,this):this._distanceMatrix},d.prototype.size=function(h){return h?(this._canvasSize=h,this):this._canvasSize},d.prototype.defaultNodeSize=function(h){return h?(this._defaultNodeSize=h,this):this._defaultNodeSize},d.prototype.groupCompactness=function(h){return h?(this._groupCompactness=h,this):this._groupCompactness},d.prototype.linkDistance=function(h){return h?(this._linkDistance=typeof h=="function"?h:+h,this._linkLengthCalculator=null,this):this._linkDistance},d.prototype.linkType=function(h){return this._linkType=h,this},d.prototype.convergenceThreshold=function(h){return h?(this._threshold=typeof h=="function"?h:+h,this):this._threshold},d.prototype.alpha=function(h){return arguments.length?(h=+h,this._alpha?h>0?this._alpha=h:this._alpha=0:h>0&&(this._running||(this._running=!0,this.trigger({type:l.start,alpha:this._alpha=h}),this.kick())),this):this._alpha},d.prototype.getLinkLength=function(h){return typeof this._linkDistance=="function"?+this._linkDistance(h):this._linkDistance},d.setLinkLength=function(h,p){h.length=p},d.prototype.getLinkType=function(h){return typeof this._linkType=="function"?this._linkType(h):0},d.prototype.symmetricDiffLinkLengths=function(h,p){var g=this;return p===void 0&&(p=1),this.linkDistance(function(f){return h*f.length}),this._linkLengthCalculator=function(){return t.symmetricDiffLinkLengths(g._links,g.linkAccessor,p)},this},d.prototype.jaccardLinkLengths=function(h,p){var g=this;return p===void 0&&(p=1),this.linkDistance(function(f){return h*f.length}),this._linkLengthCalculator=function(){return t.jaccardLinkLengths(g._links,g.linkAccessor,p)},this},d.prototype.start=function(h,p,g,f,m,v){var b=this;h===void 0&&(h=0),p===void 0&&(p=0),g===void 0&&(g=0),f===void 0&&(f=0),m===void 0&&(m=!0),v===void 0&&(v=!0);var _,x=this.nodes().length,C=x+2*this._groups.length;this._links.length;var k=this._canvasSize[0],E=this._canvasSize[1],I=new Array(C),T=new Array(C),A=null,D=this._avoidOverlaps;this._nodes.forEach(function(L,V){L.index=V,typeof L.x>"u"&&(L.x=k/2,L.y=E/2),I[V]=L.x,T[V]=L.y}),this._linkLengthCalculator&&this._linkLengthCalculator();var N;this._distanceMatrix?N=this._distanceMatrix:(N=new o.Calculator(C,this._links,d.getSourceIndex,d.getTargetIndex,function(L){return b.getLinkLength(L)}).DistanceMatrix(),A=r.Descent.createSquareMatrix(C,function(){return 2}),this._links.forEach(function(L){typeof L.source=="number"&&(L.source=b._nodes[L.source]),typeof L.target=="number"&&(L.target=b._nodes[L.target])}),this._links.forEach(function(L){var V=d.getSourceIndex(L),J=d.getTargetIndex(L);A[V][J]=A[J][V]=L.weight||1}));var U=r.Descent.createSquareMatrix(C,function(L,V){return N[L][V]});if(this._rootGroup&&typeof this._rootGroup.groups<"u"){var _=x,R=function(V,J,le,me){A[V][J]=A[J][V]=le,U[V][J]=U[J][V]=me};this._groups.forEach(function(V){R(_,_+1,b._groupCompactness,.1),I[_]=0,T[_++]=0,I[_]=0,T[_++]=0})}else this._rootGroup={leaves:this._nodes,groups:[]};var B=this._constraints||[];this._directedLinkConstraints&&(this.linkAccessor.getMinSeparation=this._directedLinkConstraints.getMinSeparation,B=B.concat(t.generateDirectedEdgeConstraints(x,this._links,this._directedLinkConstraints.axis,this.linkAccessor))),this.avoidOverlaps(!1),this._descent=new r.Descent([I,T],U),this._descent.locks.clear();for(var _=0;_<x;++_){var $=this._nodes[_];if($.fixed){$.px=$.x,$.py=$.y;var q=[$.x,$.y];this._descent.locks.add(_,q)}}if(this._descent.threshold=this._threshold,this.initialLayout(h,I,T),B.length>0&&(this._descent.project=new i.Projection(this._nodes,this._groups,this._rootGroup,B).projectFunctions()),this._descent.run(p),this.separateOverlappingComponents(k,E,v),this.avoidOverlaps(D),D&&(this._nodes.forEach(function(L,V){L.x=I[V],L.y=T[V]}),this._descent.project=new i.Projection(this._nodes,this._groups,this._rootGroup,B,!0).projectFunctions(),this._nodes.forEach(function(L,V){I[V]=L.x,T[V]=L.y})),this._descent.G=A,this._descent.run(g),f){this._descent.snapStrength=1e3,this._descent.snapGridSize=this._nodes[0].width,this._descent.numGridSnapNodes=x,this._descent.scaleSnapByMaxH=x!=C;var G=r.Descent.createSquareMatrix(C,function(L,V){return L>=x||V>=x?A[L][V]:0});this._descent.G=G,this._descent.run(f)}return this.updateNodePositions(),this.separateOverlappingComponents(k,E,v),m?this.resume():this},d.prototype.initialLayout=function(h,p,g){if(this._groups.length>0&&h>0){var f=this._nodes.length,m=this._links.map(function(b){return{source:b.source.index,target:b.target.index}}),v=this._nodes.map(function(b){return{index:b.index}});this._groups.forEach(function(b,_){v.push({index:b.index=f+_})}),this._groups.forEach(function(b,_){typeof b.leaves<"u"&&b.leaves.forEach(function(x){return m.push({source:b.index,target:x.index})}),typeof b.groups<"u"&&b.groups.forEach(function(x){return m.push({source:b.index,target:x.index})})}),new d().size(this.size()).nodes(v).links(m).avoidOverlaps(!1).linkDistance(this.linkDistance()).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(h,0,0,0,!1),this._nodes.forEach(function(b){p[b.index]=v[b.index].x,g[b.index]=v[b.index].y})}else this._descent.run(h)},d.prototype.separateOverlappingComponents=function(h,p,g){var f=this;if(g===void 0&&(g=!0),!this._distanceMatrix&&this._handleDisconnected){var m=this._descent.x[0],v=this._descent.x[1];this._nodes.forEach(function(_,x){_.x=m[x],_.y=v[x]});var b=a.separateGraphs(this._nodes,this._links);a.applyPacking(b,h,p,this._defaultNodeSize,1,g),this._nodes.forEach(function(_,x){f._descent.x[0][x]=_.x,f._descent.x[1][x]=_.y,_.bounds&&(_.bounds.setXCentre(_.x),_.bounds.setYCentre(_.y))})}},d.prototype.resume=function(){return this.alpha(.1)},d.prototype.stop=function(){return this.alpha(0)},d.prototype.prepareEdgeRouting=function(h){h===void 0&&(h=0),this._visibilityGraph=new s.TangentVisibilityGraph(this._nodes.map(function(p){return p.bounds.inflate(-h).vertices()}))},d.prototype.routeEdge=function(h,p,g){p===void 0&&(p=5);var f=[],m=new s.TangentVisibilityGraph(this._visibilityGraph.P,{V:this._visibilityGraph.V,E:this._visibilityGraph.E}),v={x:h.source.x,y:h.source.y},b={x:h.target.x,y:h.target.y},_=m.addPoint(v,h.source.index),x=m.addPoint(b,h.target.index);m.addEdgeIfVisible(v,b,h.source.index,h.target.index),typeof g<"u"&&g(m);var C=function(B){return B.source.id},k=function(B){return B.target.id},E=function(B){return B.length()},I=new o.Calculator(m.V.length,m.E,C,k,E),T=I.PathFromNodeToNode(_.id,x.id);if(T.length===1||T.length===m.V.length){var A=i.makeEdgeBetween(h.source.innerBounds,h.target.innerBounds,p);f=[A.sourceIntersection,A.arrowStart]}else{for(var D=T.length-2,N=m.V[T[D]].p,U=m.V[T[0]].p,f=[h.source.innerBounds.rayIntersection(N.x,N.y)],R=D;R>=0;--R)f.push(m.V[T[R]].p);f.push(i.makeEdgeTo(U,h.target.innerBounds,p))}return f},d.getSourceIndex=function(h){return typeof h.source=="number"?h.source:h.source.index},d.getTargetIndex=function(h){return typeof h.target=="number"?h.target:h.target.index},d.linkId=function(h){return d.getSourceIndex(h)+"-"+d.getTargetIndex(h)},d.dragStart=function(h){c(h)?d.storeOffset(h,d.dragOrigin(h)):(d.stopNode(h),h.fixed|=2)},d.stopNode=function(h){h.px=h.x,h.py=h.y},d.storeOffset=function(h,p){typeof h.leaves<"u"&&h.leaves.forEach(function(g){g.fixed|=2,d.stopNode(g),g._dragGroupOffsetX=g.x-p.x,g._dragGroupOffsetY=g.y-p.y}),typeof h.groups<"u"&&h.groups.forEach(function(g){return d.storeOffset(g,p)})},d.dragOrigin=function(h){return c(h)?{x:h.bounds.cx(),y:h.bounds.cy()}:h},d.drag=function(h,p){c(h)?(typeof h.leaves<"u"&&h.leaves.forEach(function(g){h.bounds.setXCentre(p.x),h.bounds.setYCentre(p.y),g.px=g._dragGroupOffsetX+p.x,g.py=g._dragGroupOffsetY+p.y}),typeof h.groups<"u"&&h.groups.forEach(function(g){return d.drag(g,p)})):(h.px=p.x,h.py=p.y)},d.dragEnd=function(h){c(h)?(typeof h.leaves<"u"&&h.leaves.forEach(function(p){d.dragEnd(p),delete p._dragGroupOffsetX,delete p._dragGroupOffsetY}),typeof h.groups<"u"&&h.groups.forEach(d.dragEnd)):h.fixed&=-7},d.mouseOver=function(h){h.fixed|=4,h.px=h.x,h.py=h.y},d.mouseOut=function(h){h.fixed&=-5},d}();n.Layout=u}(pc);var dhe=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty($m,"__esModule",{value:!0});var px=pc,S4=function(n){dhe(e,n);function e(t){var r=n.call(this)||this,i=t;return i.trigger&&(r.trigger=i.trigger),i.kick&&(r.kick=i.kick),i.drag&&(r.drag=i.drag),i.on&&(r.on=i.on),r.dragstart=r.dragStart=px.Layout.dragStart,r.dragend=r.dragEnd=px.Layout.dragEnd,r}return e.prototype.trigger=function(t){},e.prototype.kick=function(){},e.prototype.drag=function(){},e.prototype.on=function(t,r){return this},e}(px.Layout);$m.LayoutAdaptor=S4;function hhe(n){return new S4(n)}$m.adaptor=hhe;var fx={},Xm={},phe=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(Xm,"__esModule",{value:!0});var br=pc,x4=function(n){phe(e,n);function e(){var t=n.call(this)||this;t.event=d3.dispatch(br.EventType[br.EventType.start],br.EventType[br.EventType.tick],br.EventType[br.EventType.end]);var r=t;return t.drag=function(){if(!i)var i=d3.behavior.drag().origin(br.Layout.dragOrigin).on("dragstart.d3adaptor",br.Layout.dragStart).on("drag.d3adaptor",function(o){br.Layout.drag(o,d3.event),r.resume()}).on("dragend.d3adaptor",br.Layout.dragEnd);if(!arguments.length)return i;this.call(i)},t}return e.prototype.trigger=function(t){var r={type:br.EventType[t.type],alpha:t.alpha,stress:t.stress};this.event[r.type](r)},e.prototype.kick=function(){var t=this;d3.timer(function(){return n.prototype.tick.call(t)})},e.prototype.on=function(t,r){return typeof t=="string"?this.event.on(t,r):this.event.on(br.EventType[t],r),this},e}(br.Layout);Xm.D3StyleLayoutAdaptor=x4;function fhe(){return new x4}Xm.d3adaptor=fhe;var gx={},ghe=Ce&&Ce.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)i.hasOwnProperty(o)&&(r[o]=i[o])},n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();Object.defineProperty(gx,"__esModule",{value:!0});var vr=pc,mhe=function(n){ghe(e,n);function e(t){var r=n.call(this)||this;r.d3Context=t,r.event=t.dispatch(vr.EventType[vr.EventType.start],vr.EventType[vr.EventType.tick],vr.EventType[vr.EventType.end]);var i=r;return r.drag=function(){if(!o)var o=t.drag().subject(vr.Layout.dragOrigin).on("start.d3adaptor",vr.Layout.dragStart).on("drag.d3adaptor",function(s){vr.Layout.drag(s,t.event),i.resume()}).on("end.d3adaptor",vr.Layout.dragEnd);if(!arguments.length)return o;arguments[0].call(o)},r}return e.prototype.trigger=function(t){var r={type:vr.EventType[t.type],alpha:t.alpha,stress:t.stress};this.event.call(r.type,r)},e.prototype.kick=function(){var t=this,r=this.d3Context.timer(function(){return n.prototype.tick.call(t)&&r.stop()})},e.prototype.on=function(t,r){return typeof t=="string"?this.event.on(t,r):this.event.on(vr.EventType[t],r),this},e}(vr.Layout);gx.D3StyleLayoutAdaptor=mhe,Object.defineProperty(fx,"__esModule",{value:!0});var yhe=Xm,whe=gx;function bhe(n){return!n||vhe(n)?new yhe.D3StyleLayoutAdaptor:new whe.D3StyleLayoutAdaptor(n)}fx.d3adaptor=bhe;function vhe(n){var e=/^3\./;return n.version&&n.version.match(e)!==null}var _a={};Object.defineProperty(_a,"__esModule",{value:!0});var She=tn,mx=pi,xhe=mc,_4=function(){function n(e,t,r){this.id=e,this.rect=t,this.children=r,this.leaf=typeof r>"u"||r.length===0}return n}();_a.NodeWrapper=_4;var yx=function(){function n(e,t,r,i,o){i===void 0&&(i=null),o===void 0&&(o=null),this.id=e,this.x=t,this.y=r,this.node=i,this.line=o}return n}();_a.Vert=yx;var wx=function(){function n(e,t){this.s=e,this.t=t;var r=n.findMatch(e,t),i=t.slice(0).reverse(),o=n.findMatch(e,i);r.length>=o.length?(this.length=r.length,this.si=r.si,this.ti=r.ti,this.reversed=!1):(this.length=o.length,this.si=o.si,this.ti=t.length-o.ti-o.length,this.reversed=!0)}return n.findMatch=function(e,t){for(var r=e.length,i=t.length,o={length:0,si:-1,ti:-1},s=new Array(r),a=0;a<r;a++){s[a]=new Array(i);for(var l=0;l<i;l++)if(e[a]===t[l]){var c=s[a][l]=a===0||l===0?1:s[a-1][l-1]+1;c>o.length&&(o.length=c,o.si=a-c+1,o.ti=l-c+1)}else s[a][l]=0}return o},n.prototype.getSequence=function(){return this.length>=0?this.s.slice(this.si,this.si+this.length):[]},n}();_a.LongestCommonSubsequence=wx;var _he=function(){function n(e,t,r){var i=this;r===void 0&&(r=12),this.originalnodes=e,this.groupPadding=r,this.leaves=null,this.nodes=e.map(function(f,m){return new _4(m,t.getBounds(f),t.getChildren(f))}),this.leaves=this.nodes.filter(function(f){return f.leaf}),this.groups=this.nodes.filter(function(f){return!f.leaf}),this.cols=this.getGridLines("x"),this.rows=this.getGridLines("y"),this.groups.forEach(function(f){return f.children.forEach(function(m){return i.nodes[m].parent=f})}),this.root={children:[]},this.nodes.forEach(function(f){typeof f.parent>"u"&&(f.parent=i.root,i.root.children.push(f.id)),f.ports=[]}),this.backToFront=this.nodes.slice(0),this.backToFront.sort(function(f,m){return i.getDepth(f)-i.getDepth(m)});var o=this.backToFront.slice(0).reverse().filter(function(f){return!f.leaf});o.forEach(function(f){var m=She.Rectangle.empty();f.children.forEach(function(v){return m=m.union(i.nodes[v].rect)}),f.rect=m.inflate(i.groupPadding)});var s=this.midPoints(this.cols.map(function(f){return f.pos})),a=this.midPoints(this.rows.map(function(f){return f.pos})),l=s[0],c=s[s.length-1],u=a[0],d=a[a.length-1],h=this.rows.map(function(f){return{x1:l,x2:c,y1:f.pos,y2:f.pos}}).concat(a.map(function(f){return{x1:l,x2:c,y1:f,y2:f}})),p=this.cols.map(function(f){return{x1:f.pos,x2:f.pos,y1:u,y2:d}}).concat(s.map(function(f){return{x1:f,x2:f,y1:u,y2:d}})),g=h.concat(p);g.forEach(function(f){return f.verts=[]}),this.verts=[],this.edges=[],h.forEach(function(f){return p.forEach(function(m){var v=new yx(i.verts.length,m.x1,f.y1);f.verts.push(v),m.verts.push(v),i.verts.push(v);for(var b=i.backToFront.length;b-- >0;){var _=i.backToFront[b],x=_.rect,C=Math.abs(v.x-x.cx()),k=Math.abs(v.y-x.cy());if(C<x.width()/2&&k<x.height()/2){v.node=_;break}}})}),g.forEach(function(f,m){i.nodes.forEach(function(k,E){k.rect.lineIntersections(f.x1,f.y1,f.x2,f.y2).forEach(function(I,T){var A=new yx(i.verts.length,I.x,I.y,k,f);i.verts.push(A),f.verts.push(A),k.ports.push(A)})});var v=Math.abs(f.y1-f.y2)<.1,b=function(k,E){return v?E.x-k.x:E.y-k.y};f.verts.sort(b);for(var _=1;_<f.verts.length;_++){var x=f.verts[_-1],C=f.verts[_];x.node&&x.node===C.node&&x.node.leaf||i.edges.push({source:x.id,target:C.id,length:Math.abs(b(x,C))})}})}return n.prototype.avg=function(e){return e.reduce(function(t,r){return t+r})/e.length},n.prototype.getGridLines=function(e){for(var t=[],r=this.leaves.slice(0,this.leaves.length);r.length>0;){var i=r.filter(function(s){return s.rect["overlap"+e.toUpperCase()](r[0].rect)}),o={nodes:i,pos:this.avg(i.map(function(s){return s.rect["c"+e]()}))};t.push(o),o.nodes.forEach(function(s){return r.splice(r.indexOf(s),1)})}return t.sort(function(s,a){return s.pos-a.pos}),t},n.prototype.getDepth=function(e){for(var t=0;e.parent!==this.root;)t++,e=e.parent;return t},n.prototype.midPoints=function(e){for(var t=e[1]-e[0],r=[e[0]-t/2],i=1;i<e.length;i++)r.push((e[i]+e[i-1])/2);return r.push(e[e.length-1]+t/2),r},n.prototype.findLineage=function(e){var t=[e];do e=e.parent,t.push(e);while(e!==this.root);return t.reverse()},n.prototype.findAncestorPathBetween=function(e,t){for(var r=this.findLineage(e),i=this.findLineage(t),o=0;r[o]===i[o];)o++;return{commonAncestor:r[o-1],lineages:r.slice(o).concat(i.slice(o))}},n.prototype.siblingObstacles=function(e,t){var r=this,i=this.findAncestorPathBetween(e,t),o={};i.lineages.forEach(function(a){return o[a.id]={}});var s=i.commonAncestor.children.filter(function(a){return!(a in o)});return i.lineages.filter(function(a){return a.parent!==i.commonAncestor}).forEach(function(a){return s=s.concat(a.parent.children.filter(function(l){return l!==a.id}))}),s.map(function(a){return r.nodes[a]})},n.getSegmentSets=function(e,t,r){for(var i=[],o=0;o<e.length;o++)for(var s=e[o],a=0;a<s.length;a++){var l=s[a];l.edgeid=o,l.i=a;var c=l[1][t]-l[0][t];Math.abs(c)<.1&&i.push(l)}i.sort(function(p,g){return p[0][t]-g[0][t]});for(var u=[],d=null,h=0;h<i.length;h++){var l=i[h];(!d||Math.abs(l[0][t]-d.pos)>.1)&&(d={pos:l[0][t],segments:[]},u.push(d)),d.segments.push(l)}return u},n.nudgeSegs=function(e,t,r,i,o,s){var a=i.length;if(!(a<=1)){for(var l=i.map(function(_){return new mx.Variable(_[0][e])}),c=[],u=0;u<a;u++)for(var d=0;d<a;d++)if(u!==d){var h=i[u],p=i[d],g=h.edgeid,f=p.edgeid,m=-1,v=-1;e=="x"?o(g,f)&&(h[0][t]<h[1][t]?(m=d,v=u):(m=u,v=d)):o(g,f)&&(h[0][t]<h[1][t]?(m=u,v=d):(m=d,v=u)),m>=0&&c.push(new mx.Constraint(l[m],l[v],s))}var b=new mx.Solver(l,c);b.solve(),l.forEach(function(_,x){var C=i[x],k=_.position();C[0][e]=C[1][e]=k;var E=r[C.edgeid];C.i>0&&(E[C.i-1][1][e]=k),C.i<E.length-1&&(E[C.i+1][0][e]=k)})}},n.nudgeSegments=function(e,t,r,i,o){for(var s=n.getSegmentSets(e,t,r),a=0;a<s.length;a++){for(var l=s[a],c=[],u=0;u<l.segments.length;u++){var d=l.segments[u];c.push({type:0,s:d,pos:Math.min(d[0][r],d[1][r])}),c.push({type:1,s:d,pos:Math.max(d[0][r],d[1][r])})}c.sort(function(g,f){return g.pos-f.pos+g.type-f.type});var h=[],p=0;c.forEach(function(g){g.type===0?(h.push(g.s),p++):p--,p==0&&(n.nudgeSegs(t,r,e,h,i,o),h=[])})}},n.prototype.routeEdges=function(e,t,r,i){var o=this,s=e.map(function(c){return o.route(r(c),i(c))}),a=n.orderEdges(s),l=s.map(function(c){return n.makeSegments(c)});return n.nudgeSegments(l,"x","y",a,t),n.nudgeSegments(l,"y","x",a,t),n.unreverseEdges(l,s),l},n.unreverseEdges=function(e,t){e.forEach(function(r,i){var o=t[i];o.reversed&&(r.reverse(),r.forEach(function(s){s.reverse()}))})},n.angleBetween2Lines=function(e,t){var r=Math.atan2(e[0].y-e[1].y,e[0].x-e[1].x),i=Math.atan2(t[0].y-t[1].y,t[0].x-t[1].x),o=r-i;return(o>Math.PI||o<-Math.PI)&&(o=i-r),o},n.isLeft=function(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)<=0},n.getOrder=function(e){for(var t={},r=0;r<e.length;r++){var i=e[r];typeof t[i.l]>"u"&&(t[i.l]={}),t[i.l][i.r]=!0}return function(o,s){return typeof t[o]<"u"&&t[o][s]}},n.orderEdges=function(e){for(var t=[],r=0;r<e.length-1;r++)for(var i=r+1;i<e.length;i++){var o=e[r],s=e[i],a=new wx(o,s),l,c,u;if(a.length!==0){if(a.reversed&&(s.reverse(),s.reversed=!0,a=new wx(o,s)),(a.si<=0||a.ti<=0)&&(a.si+a.length>=o.length||a.ti+a.length>=s.length)){t.push({l:r,r:i});continue}a.si+a.length>=o.length||a.ti+a.length>=s.length?(l=o[a.si+1],u=o[a.si-1],c=s[a.ti-1]):(l=o[a.si+a.length-2],c=o[a.si+a.length],u=s[a.ti+a.length]),n.isLeft(l,c,u)?t.push({l:i,r}):t.push({l:r,r:i})}}return n.getOrder(t)},n.makeSegments=function(e){function t(c){return{x:c.x,y:c.y}}for(var r=function(c,u,d){return Math.abs((u.x-c.x)*(d.y-c.y)-(u.y-c.y)*(d.x-c.x))<.001},i=[],o=t(e[0]),s=1;s<e.length;s++){var a=t(e[s]),l=s<e.length-1?e[s+1]:null;(!l||!r(o,a,l))&&(i.push([o,a]),o=a)}return i},n.prototype.route=function(e,t){var r=this,i=this.nodes[e],o=this.nodes[t];this.obstacles=this.siblingObstacles(i,o);var s={};this.obstacles.forEach(function(v){return s[v.id]=v}),this.passableEdges=this.edges.filter(function(v){var b=r.verts[v.source],_=r.verts[v.target];return!(b.node&&b.node.id in s||_.node&&_.node.id in s)});for(var a=1;a<i.ports.length;a++){var l=i.ports[0].id,c=i.ports[a].id;this.passableEdges.push({source:l,target:c,length:0})}for(var a=1;a<o.ports.length;a++){var l=o.ports[0].id,c=o.ports[a].id;this.passableEdges.push({source:l,target:c,length:0})}var u=function(v){return v.source},d=function(v){return v.target},h=function(v){return v.length},p=new xhe.Calculator(this.verts.length,this.passableEdges,u,d,h),g=function(v,b,_){var x=r.verts[v],C=r.verts[b],k=r.verts[_],E=Math.abs(k.x-x.x),I=Math.abs(k.y-x.y);return x.node===i&&x.node===C.node||C.node===o&&C.node===k.node?0:E>1&&I>1?1e3:0},f=p.PathFromNodeToNodeWithPrevCost(i.ports[0].id,o.ports[0].id,g),m=f.reverse().map(function(v){return r.verts[v]});return m.push(this.nodes[o.id].ports[0]),m.filter(function(v,b){return!(b<m.length-1&&m[b+1].node===i&&v.node===i||b>0&&v.node===o&&m[b-1].node===o)})},n.getRoutePath=function(e,t,r,i){var o={routepath:"M "+e[0][0].x+" "+e[0][0].y+" ",arrowpath:""};if(e.length>1)for(var s=0;s<e.length;s++){var a=e[s],l=a[1].x,c=a[1].y,u=l-a[0].x,d=c-a[0].y;if(s<e.length-1){Math.abs(u)>0?l-=u/Math.abs(u)*t:c-=d/Math.abs(d)*t,o.routepath+="L "+l+" "+c+" ";var h=e[s+1],p=h[0].x,g=h[0].y,f=h[1].x,m=h[1].y;u=f-p,d=m-g;var v=n.angleBetween2Lines(a,h)<0?1:0,b,_;Math.abs(u)>0?(b=p+u/Math.abs(u)*t,_=g):(b=p,_=g+d/Math.abs(d)*t);var x=Math.abs(b-l),C=Math.abs(_-c);o.routepath+="A "+x+" "+C+" 0 0 "+v+" "+b+" "+_+" "}else{var k=[l,c],E,I;Math.abs(u)>0?(l-=u/Math.abs(u)*i,E=[l,c+r],I=[l,c-r]):(c-=d/Math.abs(d)*i,E=[l+r,c],I=[l-r,c]),o.routepath+="L "+l+" "+c+" ",i>0&&(o.arrowpath="M "+k[0]+" "+k[1]+" L "+E[0]+" "+E[1]+" L "+I[0]+" "+I[1])}}else{var a=e[0],l=a[1].x,c=a[1].y,u=l-a[0].x,d=c-a[0].y,k=[l,c],E,I;Math.abs(u)>0?(l-=u/Math.abs(u)*i,E=[l,c+r],I=[l,c-r]):(c-=d/Math.abs(d)*i,E=[l+r,c],I=[l-r,c]),o.routepath+="L "+l+" "+c+" ",i>0&&(o.arrowpath="M "+k[0]+" "+k[1]+" L "+E[0]+" "+E[1]+" L "+I[0]+" "+I[1])}return o},n}();_a.GridRouter=_he;var rh={};Object.defineProperty(rh,"__esModule",{value:!0});var khe=mc,bx=xa,Che=tn,Phe=Is,Ehe=function(){function n(e,t){this.source=e,this.target=t}return n.prototype.actualLength=function(e){var t=this;return Math.sqrt(e.reduce(function(r,i){var o=i[t.target]-i[t.source];return r+o*o},0))},n}();rh.Link3D=Ehe;var Ihe=function(){function n(e,t,r){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),this.x=e,this.y=t,this.z=r}return n}();rh.Node3D=Ihe;var Mhe=function(){function n(e,t,r){var i=this;r===void 0&&(r=1),this.nodes=e,this.links=t,this.idealLinkLength=r,this.constraints=null,this.useJaccardLinkLengths=!0,this.result=new Array(n.k);for(var o=0;o<n.k;++o)this.result[o]=new Array(e.length);e.forEach(function(s,a){for(var l=0,c=n.dims;l<c.length;l++){var u=c[l];typeof s[u]>"u"&&(s[u]=Math.random())}i.result[0][a]=s.x,i.result[1][a]=s.y,i.result[2][a]=s.z})}return n.prototype.linkLength=function(e){return e.actualLength(this.result)},n.prototype.start=function(e){var t=this;e===void 0&&(e=100);var r=this.nodes.length,i=new The;this.useJaccardLinkLengths&&Phe.jaccardLinkLengths(this.links,i,1.5),this.links.forEach(function(u){return u.length*=t.idealLinkLength});var o=new khe.Calculator(r,this.links,function(u){return u.source},function(u){return u.target},function(u){return u.length}).DistanceMatrix(),s=bx.Descent.createSquareMatrix(r,function(u,d){return o[u][d]}),a=bx.Descent.createSquareMatrix(r,function(){return 2});this.links.forEach(function(u){var d=u.source,h=u.target;return a[d][h]=a[h][d]=1}),this.descent=new bx.Descent(this.result,s),this.descent.threshold=.001,this.descent.G=a,this.constraints&&(this.descent.project=new Che.Projection(this.nodes,null,null,this.constraints).projectFunctions());for(var l=0;l<this.nodes.length;l++){var c=this.nodes[l];c.fixed&&this.descent.locks.add(l,[c.x,c.y,c.z])}return this.descent.run(e),this},n.prototype.tick=function(){this.descent.locks.clear();for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];t.fixed&&this.descent.locks.add(e,[t.x,t.y,t.z])}return this.descent.rungeKutta()},n.dims=["x","y","z"],n.k=n.dims.length,n}();rh.Layout3D=Mhe;var The=function(){function n(){}return n.prototype.getSourceIndex=function(e){return e.source},n.prototype.getTargetIndex=function(e){return e.target},n.prototype.getLength=function(e){return e.length},n.prototype.setLength=function(e,t){e.length=t},n}(),qm={};Object.defineProperty(qm,"__esModule",{value:!0});var vx=pc,Ahe=_a;function jhe(n,e,t,r){n.cola.start(0,0,0,10,!1);var i=Rhe(n.cola.nodes(),n.cola.groups(),t,r);return i.routeEdges(n.powerGraph.powerEdges,e,function(o){return o.source.routerNode.id},function(o){return o.target.routerNode.id})}qm.gridify=jhe;function Rhe(n,e,t,r){n.forEach(function(o){o.routerNode={name:o.name,bounds:o.bounds.inflate(-t)}}),e.forEach(function(o){o.routerNode={bounds:o.bounds.inflate(-r),children:(typeof o.groups<"u"?o.groups.map(function(s){return n.length+s.id}):[]).concat(typeof o.leaves<"u"?o.leaves.map(function(s){return s.index}):[])}});var i=n.concat(e).map(function(o,s){return o.routerNode.id=s,o.routerNode});return new Ahe.GridRouter(i,{getChildren:function(o){return o.children},getBounds:function(o){return o.bounds}},t-r)}function Ohe(n,e,t){var r;n.nodes.forEach(function(a,l){return a.index=l}),new vx.Layout().avoidOverlaps(!1).nodes(n.nodes).links(n.links).powerGraphGroups(function(a){r=a,r.groups.forEach(function(l){return l.padding=t})});var i=n.nodes.length,o=[],s=n.nodes.slice(0);return s.forEach(function(a,l){return a.index=l}),r.groups.forEach(function(a){var l=a.index=a.id+i;s.push(a),typeof a.leaves<"u"&&a.leaves.forEach(function(c){return o.push({source:l,target:c.index})}),typeof a.groups<"u"&&a.groups.forEach(function(c){return o.push({source:l,target:c.id+i})})}),r.powerEdges.forEach(function(a){o.push({source:a.source.index,target:a.target.index})}),new vx.Layout().size(e).nodes(s).links(o).avoidOverlaps(!1).linkDistance(30).symmetricDiffLinkLengths(5).convergenceThreshold(1e-4).start(100,0,0,0,!1),{cola:new vx.Layout().convergenceThreshold(.001).size(e).avoidOverlaps(!0).nodes(n.nodes).links(n.links).groupCompactness(1e-4).linkDistance(30).symmetricDiffLinkLengths(5).powerGraphGroups(function(a){r=a,r.groups.forEach(function(l){l.padding=t})}).start(50,0,100,0,!1),powerGraph:r}}qm.powerGraphGridLayout=Ohe,function(n){function e(t){for(var r in t)n.hasOwnProperty(r)||(n[r]=t[r])}Object.defineProperty(n,"__esModule",{value:!0}),e($m),e(fx),e(xa),e(Pt),e(_a),e(nh),e(pc),e(rh),e(Is),e(To),e(eh),e(gc),e(tn),e(mc),e(pi),e(qm)}(KO);class Dhe extends rO{constructor(t){super(t);w(this,"id","graph");w(this,"graphSim");w(this,"animFrame",-1);w(this,"colaNodes",new Map);w(this,"colaLinks",new Map);w(this,"colaConstraints",[]);w(this,"step",()=>{this.graphSim.start(1,0,0,0,!0,!1);for(const t of this.graphSim.nodes()){const r=this.editor.getShape(t.id),{w:i,h:o}=this.editor.getShapeGeometry(t.id).bounds;if(!r)continue;const{x:s,y:a}=k4(i,o,r.rotation);this.editor.getSelectedShapeIds().includes(t.id)&&(t.x=r.x+s,t.y=r.y+a),t.width=i,t.height=o,t.rotation=r.rotation,this.editor.updateShape({id:t.id,type:"geo",x:t.x-s,y:t.y-a})}});w(this,"addArrow",t=>{const r=t.props.start.type==="binding"?this.editor.getShape(t.props.start.boundShapeId):void 0,i=t.props.end.type==="binding"?this.editor.getShape(t.props.end.boundShapeId):void 0;if(r&&i){const o=`${r.id}->${i.id}`,s={source:r.id,target:i.id};this.colaLinks.set(o,s)}});w(this,"addGeo",t=>{const{w:r,h:i}=this.editor.getShapeGeometry(t).bounds,{x:o,y:s}=k4(r,i,t.rotation),a={id:t.id,x:t.x+o,y:t.y+s,width:r,height:i,rotation:t.rotation,color:t.props.color};this.colaNodes.set(t.id,a)});this.graphSim=new KO.Layout;const r=()=>{this.step(),this.animFrame=requestAnimationFrame(r)};r()}onAdd(t){for(const r of t)this.editor.updateShape({id:r.id,type:r.type,meta:{graph:!0}}),r.type==="arrow"?this.addArrow(r):this.addGeo(r);this.refreshGraph()}onRemove(t){const r=new Set(t.map(i=>i.id));for(const i of t)this.editor.updateShape({id:i.id,type:i.type,meta:{}}),this.colaNodes.delete(i.id);for(const[i,o]of this.colaLinks)(r.has(o.source)||r.has(o.target))&&this.colaLinks.delete(i);this.refreshGraph()}onShapeChange(t,r){if(t.type==="geo"&&r.type==="geo"){const i=t,o=r;if(i.props.color!==o.props.color){const s=this.colaNodes.get(r.id);s&&this.colaNodes.set(r.id,{...s,color:o.props.color}),this.refreshGraph()}}}refreshGraph(){this.editor.selectNone(),this.refreshConstraints();const t=[...this.colaNodes.values()],r=new Map(t.map((s,a)=>[s.id,a])),i=Array.from(this.colaLinks.values()).map(s=>({source:r.get(s.source),target:r.get(s.target)})),o=this.colaConstraints.map(s=>s.type==="alignment"?{...s,offsets:s.offsets.map(a=>({node:r.get(a.node),offset:a.offset}))}:s);this.graphSim.nodes(t).links(i).constraints(o).linkDistance(s=>Lhe(s)).avoidOverlaps(!0).handleDisconnected(!0)}refreshConstraints(){const t={type:"alignment",axis:"x",offsets:[]},r={type:"alignment",axis:"y",offsets:[]};for(const o of this.colaNodes.values())o.color==="red"&&t.offsets.push({node:o.id,offset:0}),o.color==="blue"&&r.offsets.push({node:o.id,offset:0});const i=[];t.offsets.length>0&&i.push(t),r.offsets.length>0&&i.push(r),this.colaConstraints=i}}function k4(n,e,t){const r=n/2,i=e/2,o=r*Math.cos(t)-i*Math.sin(t),s=r*Math.sin(t)+i*Math.cos(t);return{x:o,y:s}}function Lhe(n){const e=n.target.x-n.source.x,t=n.target.y-n.source.y,r=n.source.rotation,i=n.target.rotation,o=Math.abs(n.source.width*Math.cos(r))+Math.abs(n.source.height*Math.sin(r)),s=Math.abs(n.source.width*Math.sin(r))+Math.abs(n.source.height*Math.cos(r)),a=Math.abs(n.target.width*Math.cos(i))+Math.abs(n.target.height*Math.sin(i)),l=Math.abs(n.target.width*Math.sin(i))+Math.abs(n.target.height*Math.cos(i)),c=Math.max(0,Math.abs(e)-(o+a)/2),u=Math.max(0,Math.abs(t)-(s+l)/2);return Math.sqrt(e*e+t*t)-Math.sqrt(c*c+u*u)+100}const zhe=[Ede,Dhe];function Nhe(){const[n,e]=S.useState(null);return y.jsx("div",{className:"tldraw__editor",children:y.jsx(eie,{autoFocus:!0,shareZone:y.jsx(Fhe,{}),onMount:e,persistenceKey:"tldraw-physics",children:n&&y.jsx(rie,{editor:n,collections:zhe,children:y.jsx(iie,{})})})})}const Fhe=ze(()=>{const n=Y(),{color:e,name:t}=n.user.getUserPreferences();return y.jsxs("div",{style:{pointerEvents:"all",display:"flex",width:"148px",margin:"4px 8px",border:"none"},children:[y.jsx("input",{style:{borderRadius:"9px 0px 0px 9px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},type:"color",value:e,onChange:r=>{n.user.updateUserPreferences({color:r.currentTarget.value})}}),y.jsx("input",{style:{width:"100%",borderRadius:"0px 9px 9px 0px",border:"none",backgroundColor:"white",boxShadow:"0px 0px 4px rgba(0, 0, 0, 0.25)"},value:t,onChange:r=>{n.user.updateUserPreferences({name:r.currentTarget.value})}})]})});uy.createRoot(document.getElementById("root")).render(y.jsx(Nhe,{}))})();
